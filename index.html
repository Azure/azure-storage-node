<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Microsoft Azure Storage Client Library for node.js Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Microsoft Azure Storage Client Library for node.js</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="BlobUtilities.html">BlobUtilities</a>
						</li>
						
						<li>
							<a href="FileUtilities.html">FileUtilities</a>
						</li>
						
						<li>
							<a href="QueueUtilities.html">QueueUtilities</a>
						</li>
						
						<li>
							<a href="TableUtilities.html">TableUtilities</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="BlobService.html">BlobService</a>
						</li>
						
						<li>
							<a href="ExponentialRetryPolicyFilter.html">ExponentialRetryPolicyFilter</a>
						</li>
						
						<li>
							<a href="FileService.html">FileService</a>
						</li>
						
						<li>
							<a href="LinearRetryPolicyFilter.html">LinearRetryPolicyFilter</a>
						</li>
						
						<li>
							<a href="QueueService.html">QueueService</a>
						</li>
						
						<li>
							<a href="RetryPolicyFilter.html">RetryPolicyFilter</a>
						</li>
						
						<li>
							<a href="TableBatch.html">TableBatch</a>
						</li>
						
						<li>
							<a href="TableQuery.html">TableQuery</a>
						</li>
						
						<li>
							<a href="TableService.html">TableService</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#createBlobService">createBlobService</a>
						</li>
						
						<li>
							<a href="global.html#createBlobServiceAnonymous">createBlobServiceAnonymous</a>
						</li>
						
						<li>
							<a href="global.html#createBlobServiceWithSas">createBlobServiceWithSas</a>
						</li>
						
						<li>
							<a href="global.html#createFileService">createFileService</a>
						</li>
						
						<li>
							<a href="global.html#createFileServiceWithSas">createFileServiceWithSas</a>
						</li>
						
						<li>
							<a href="global.html#createQueueService">createQueueService</a>
						</li>
						
						<li>
							<a href="global.html#createQueueServiceWithSas">createQueueServiceWithSas</a>
						</li>
						
						<li>
							<a href="global.html#createTableService">createTableService</a>
						</li>
						
						<li>
							<a href="global.html#createTableServiceWithSas">createTableServiceWithSas</a>
						</li>
						
						<li>
							<a href="global.html#generateAccountSharedAccessSignature">generateAccountSharedAccessSignature</a>
						</li>
						
						<li>
							<a href="global.html#generateDevelopmentStorageCredentials">generateDevelopmentStorageCredentials</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
		<div class="span8">
			
				<div id="main">
					


	
	<span class="page-title">Index</span>
	
	












	
	





    <section class="readme-section">
        <article><h1>Microsoft Azure Storage SDK for Node.js</h1>
<p><a href="http://badge.fury.io/js/azure-storage"><img src="https://badge.fury.io/js/azure-storage.svg" alt="NPM version"></a> <a href="https://travis-ci.org/Azure/azure-storage-node"><img src="https://travis-ci.org/Azure/azure-storage-node.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/Azure/azure-storage-node?branch=master"><img src="https://coveralls.io/repos/Azure/azure-storage-node/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a></p>
<p>This project provides a Node.js package that makes it easy to consume and manage Microsoft Azure Storage Services.</p>
<blockquote>
<p>If you are looking for the Node.js SDK for other Azure services, visit <a href="https://github.com/Azure/azure-sdk-for-node"><a href="https://github.com/Azure/azure-sdk-for-node">https://github.com/Azure/azure-sdk-for-node</a></a>.</p>
</blockquote>
<h1>Features</h1>
<ul>
<li>Tables<ul>
<li>Create/Delete Tables</li>
<li>Query/Create/Read/Update/Delete Entities</li>
</ul>
</li>
<li>Blobs<ul>
<li>Create/Delete Containers</li>
<li>Create/Read/Update/Delete Blobs</li>
</ul>
</li>
<li>Files<ul>
<li>Create/Delete Shares</li>
<li>Create/Delete Directories</li>
<li>Create/Read/Update/Delete Files</li>
</ul>
</li>
<li>Queues<ul>
<li>Create/Delete Queues</li>
<li>Insert/Peek Queue Messages</li>
<li>Advanced Queue Operations</li>
</ul>
</li>
<li>Service Properties<ul>
<li>Get Service Properties</li>
<li>Set Service Properties</li>
</ul>
</li>
</ul>
<p>Please check details on <a href="http://azure.github.io/azure-storage-node">API reference documents</a>.</p>
<h1>Getting Started</h1>
<h2>Install</h2>
<pre><code class="lang-shell">npm install azure-storage</code></pre>
<h2>Usage</h2>
<pre><code class="lang-Javascript">var azure = require('azure-storage');</code></pre>
<p>When using the Storage SDK, you must provide connection information for the storage account to use. This can be provided using:</p>
<ul>
<li><p>Environment variables - <strong>AZURE_STORAGE_ACCOUNT</strong> and <strong>AZURE_STORAGE_ACCESS_KEY</strong>, or <strong>AZURE_STORAGE_CONNECTION_STRING</strong>.</p>
</li>
<li><p>Constructors - For example, <code>var tableSvc = azure.createTableService(accountName, accountKey);</code></p>
</li>
</ul>
<h3>Table Storage</h3>
<p>To ensure a table exists, call <strong>createTableIfNotExists</strong>:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var tableService = azure.createTableService();
tableService.createTableIfNotExists('mytable', function(error, result, response) {
  if (!error) {
    // result contains true if created; false if already exists
  }
});</code></pre>
<p>A new entity can be added by calling <strong>insertEntity</strong>:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var tableService = azure.createTableService();
var entGen = azure.TableUtilities.entityGenerator;
var entity = {
  PartitionKey: entGen.String('part2'),
  RowKey: entGen.String('row1'),
  boolValueTrue: entGen.Boolean(true),
  boolValueFalse: entGen.Boolean(false),
  intValue: entGen.Int32(42),
  dateValue: entGen.DateTime(new Date(Date.UTC(2011, 10, 25))),
  complexDateValue: entGen.DateTime(new Date(Date.UTC(2013, 02, 16, 01, 46, 20)))
};
tableService.insertEntity('mytable', entity, function(error, result, response) {
  if (!error) {
    // result contains the ETag for the new entity
  }
});</code></pre>
<p>Instead of creating entities manually, you can use <strong>entityGenerator</strong>:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var entGen = azure.TableUtilities.entityGenerator;
var task = {
  PartitionKey: entGen.String('hometasks'),
  RowKey: entGen.String('1'),
  description: entGen.String('take out the trash'),
  dueDate: entGen.DateTime(new Date(Date.UTC(2015, 6, 20))),
};</code></pre>
<p>The method <strong>retrieveEntity</strong> can then be used to fetch the entity that was just inserted:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var tableService = azure.createTableService();
tableService.retrieveEntity('mytable', 'part2', 'row1', function(error, result, response) {
  if (!error) {
    // result contains the entity
  }
});</code></pre>
<p>Use <strong>TableQuery</strong> to build complex queries:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var tableService = azure.createTableService();
var query = new azure.TableQuery()
  .top(5)
  .where('PartitionKey eq ?', 'part2');

tableSvc.queryEntities('mytable', query, null, function(error, result, response) {
  if (!error) {
    // result.entries contains entities matching the query
  }
});</code></pre>
<h3>Blob Storage</h3>
<p>The <strong>createContainerIfNotExists</strong> method can be used to create a
container in which to store a blob:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var blobService = azure.createBlobService();
blobService.createContainerIfNotExists('taskcontainer', {
  publicAccessLevel: 'blob'
}, function(error, result, response) {
  if (!error) {
    // if result = true, container was created.
    // if result = false, container already existed.
  }
});</code></pre>
<p>To upload a file (assuming it is called task1-upload.txt and it is placed in the same folder as the script below), the method <strong>createBlockBlobFromLocalFile</strong> can be used.</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var blobService = azure.createBlobService();

blobService.createBlockBlobFromLocalFile('mycontainer', 'taskblob', 'task1-upload.txt', function(error, result, response) {
  if (!error) {
    // file uploaded
  }
});</code></pre>
<p>For page blobs, use <strong>createPageBlobFromLocalFile</strong>. There are other methods for uploading blobs also, such as <strong>createBlockBlobFromText</strong> or <strong>createPageBlobFromStream</strong>.</p>
<p>There are also several ways to download block and page blobs. For example, <strong>getBlobToStream</strong> downloads the blob to a stream:</p>
<pre><code class="lang-Javascript">var blobService = azure.createBlobService();
var fs = require('fs');
blobService.getBlobToStream('mycontainer', 'taskblob', fs.createWriteStream('output.txt'), function(error, result, response) {
  if (!error) {
    // blob retrieved
  }
});</code></pre>
<p>To create a Shared Access Signature (SAS), use the <strong>generateSharedAccessSignature</strong> method. Additionally you can use the <strong>date</strong> helper functions to easily create a SAS that expires at some point relative to the current time.</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var blobService = azure.createBlobService();

var startDate = new Date();
var expiryDate = new Date(startDate);
expiryDate.setMinutes(startDate.getMinutes() + 100);
startDate.setMinutes(startDate.getMinutes() - 100);

var sharedAccessPolicy = {
  AccessPolicy: {
    Permissions: azure.BlobUtilities.SharedAccessPermissions.READ,
    Start: startDate,
    Expiry: expiryDate
  },
};

var token = blobService.generateSharedAccessSignature(containerName, blobName, sharedAccessPolicy);
var sasUrl = blobService.getUrl(containerName, blobName, token);</code></pre>
<h3>Queue Storage</h3>
<p>The <strong>createQueueIfNotExists</strong> method can be used to ensure a queue exists:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var queueService = azure.createQueueService();
queueService.createQueueIfNotExists('taskqueue', function(error) {
  if (!error) {
    // Queue exists
  }
});</code></pre>
<p>The <strong>createMessage</strong> method can then be called to insert the message into the queue:</p>
<pre><code class="lang-Javascript">var queueService = azure.createQueueService();
queueService.createMessage('taskqueue', 'Hello world!', function(error) {
  if (!error) {
    // Message inserted
  }
});</code></pre>
<p>It is then possible to call the <strong>getMessage</strong> method, process the message and then call <strong>deleteMessage</strong> inside the callback. This two-step process ensures messages don't get lost when they are removed from the queue.</p>
<pre><code class="lang-Javascript">var queueService = azure.createQueueService(),
  queueName = 'taskqueue';
queueService.getMessages(queueName, function(error, serverMessages) {
  if (!error) {
    // Process the message in less than 30 seconds, the message
    // text is available in serverMessages[0].messagetext

    queueService.deleteMessage(queueName, serverMessages[0].messageid, serverMessages[0].popreceipt, function(error) {
      if (!error) {
        // Message deleted
      }
    });
  }
});</code></pre>
<h3>File Storage</h3>
<p>The <strong>createShareIfNotExists</strong> method can be used to create a
share in which to store a file or a directory of files:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var fileService = azure.createFileService();
fileService.createShareIfNotExists('taskshare', function(error, result, response) {
  if (!error) {
    // if result = true, share was created.
    // if result = false, share already existed.
  }
});</code></pre>
<p>To create a directory, the method <strong>createDirectoryIfNotExists</strong> can be used.</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var fileService = azure.createFileService();

fileService.createDirectoryIfNotExists('taskshare', 'taskdirectory', function(error, result, response) {
  if (!error) {
    // if result = true, share was created.
    // if result = false, share already existed.
  }
});</code></pre>
<p>To upload a file (assuming it is called task1-upload.txt and it is placed in the same folder as the script below), the method <strong>createFileFromLocalFile</strong> can be used.</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var fileService = azure.createFileService();

fileService.createFileFromLocalFile('taskshare', 'taskdirectory', 'taskfile', 'task1-upload.txt', function(error, result, response) {
  if (!error) {
    // file uploaded
  }
});</code></pre>
<p>There are other methods for uploading files also, such as <strong>createFileFromText</strong> or <strong>createFileFromStream</strong>.</p>
<p>There are also several ways to download files. For example, <strong>getFileToStream</strong> downloads the file to a stream:</p>
<pre><code class="lang-Javascript">var fileService = azure.createFileService();
var fs = require('fs');
fileService.getFileToStream('taskshare', 'taskdirectory', 'taskfile', fs.createWriteStream('output.txt'), function(error, result, response) {
  if (!error) {
    // file retrieved
  }
});</code></pre>
<h3>Service Properties</h3>
<p>The <strong>getServiceProperties</strong> method can be used to fetch the logging, metrics and CORS settings on your storage account:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var blobService = azure.createBlobService();

blobService.getServiceProperties(function(error, result, response) {  
  if (!error) {
     var serviceProperties = result;
     // properties are fetched
  } 
});</code></pre>
<p>The <strong>setServiceProperties</strong> method can be used to modify the logging, metrics and CORS settings on your storage account:</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var blobService = azure.createBlobService();

var serviceProperties = generateServiceProperties(); 

blobService.setServiceProperties(serviceProperties, function(error, result, response) {  
  if (!error) {
    // properties are set
  }
});  

function generateServiceProperties() {
  return serviceProperties = {
    Logging: {
      Version: '1.0',
      Delete: true,
      Read: true,
      Write: true,
      RetentionPolicy: {
        Enabled: true,
        Days: 10,
      },
    },
    HourMetrics: {
      Version: '1.0',
      Enabled: true,
      IncludeAPIs: true,
      RetentionPolicy: {
        Enabled: true,
        Days: 10,
      },
    },
    MinuteMetrics: {
      Version: '1.0',
      Enabled: true,
      IncludeAPIs: true,
      RetentionPolicy: {
        Enabled: true,
        Days: 10,
      },
    },
    Cors: {
      CorsRule: [
        {
          AllowedOrigins: ['www.azure.com', 'www.microsoft.com'],
          AllowedMethods: ['GET', 'PUT'],
          AllowedHeaders: ['x-ms-meta-data*', 'x-ms-meta-target*', 'x-ms-meta-xyz', 'x-ms-meta-foo'],
          ExposedHeaders: ['x-ms-meta-data*', 'x-ms-meta-source*', 'x-ms-meta-abc', 'x-ms-meta-bcd'],
          MaxAgeInSeconds: 500,
        },
        {
          AllowedOrigins: ['www.msdn.com', 'www.asp.com'],
          AllowedMethods: ['GET', 'PUT'],
          AllowedHeaders: ['x-ms-meta-data*', 'x-ms-meta-target*', 'x-ms-meta-xyz', 'x-ms-meta-foo'],
          ExposedHeaders: ['x-ms-meta-data*', 'x-ms-meta-source*', 'x-ms-meta-abc', 'x-ms-meta-bcd'],
          MaxAgeInSeconds: 500,
        },
      ],
    },
  };
}</code></pre>
<p>When modifying the service properties, you can fetch the properties and then modify the them to prevent overwriting the existing settings.</p>
<pre><code class="lang-Javascript">var azure = require('azure-storage');
var blobService = azure.createBlobService();

blobService.getServiceProperties(function(error, result, response) {  
  if (!error) {
    var serviceProperties = result;

    // modify the properties

    blobService.setServiceProperties(serviceProperties, function(error, result, response) {  
      if (!error) {
        // properties are set
      }
    });
  } 
});</code></pre>
<h2>Code Samples</h2>
<p>How-Tos focused around accomplishing specific tasks are available on the <a href="http://azure.microsoft.com/en-us/develop/nodejs/">Microsoft Azure Node.js Developer Center</a>.</p>
<ul>
<li><p><a href="http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-blob-storage/">How to use the Blob Service from Node.js</a></p>
</li>
<li><p><a href="http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-table-storage/">How to use the Table Service from Node.js</a></p>
</li>
<li><p><a href="http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-queues/">How to use the Queue Service from Node.js</a></p>
</li>
</ul>
<h1>Running Tests</h1>
<p>Unit tests can then be run from the module's root directory using:</p>
<pre><code class="lang-shell">npm test</code></pre>
<p>Running test is also supported by Grunt by:</p>
<pre><code class="lang-shell">grunt # mochaTest as the default task</code></pre>
<p>By default the unit tests are ran with Nock recording data. To run tests against real storage account, please set environment variable to turn off Nock by:</p>
<pre><code>set NOCK_OFF=true</code></pre>
<p>and set up the following environment variables for storage account credentials by </p>
<pre><code class="lang-Batchfile">set AZURE_STORAGE_CONNECTION_STRING=&quot;valid storage connection string&quot;</code></pre>
<p>or </p>
<pre><code class="lang-Batchfile">set AZURE_STORAGE_ACCOUNT=&quot;valid storage account name&quot;
set AZURE_STORAGE_ACCESS_KEY=&quot;valid storage account key&quot;</code></pre>
<p>To record the data in a test pass against real storage account for future Nock usage:</p>
<pre><code class="lang-Batchfile">set AZURE_NOCK_RECORD=true</code></pre>
<p>In order to be able to use a proxy like fiddler, an additional environment variable should be set up:</p>
<pre><code class="lang-Batchfile">set HTTP_PROXY=http://127.0.0.1:8888</code></pre>
<p>On Linux, please use <code>export</code> other than <code>set</code> to set the variables.</p>
<h1>JsDoc</h1>
<p>JsDoc can be generated by <code>grunt jsdoc</code>.</p>
<p>To load the docs by devserver after generation, run <code>grunt doc</code> and then browse the docs at <a href="http://localhost:8888"><a href="http://localhost:8888">http://localhost:8888</a></a>.</p>
<h1>Need Help?</h1>
<p>Be sure to check out the Microsoft Azure <a href="http://go.microsoft.com/fwlink/?LinkId=234489">Developer Forums on MSDN</a> if you have trouble with the provided code or use StackOverflow.</p>
<h1>Learn More</h1>
<ul>
<li><a href="http://azure.microsoft.com/en-us/develop/nodejs/">Microsoft Azure Node.js Developer Center</a></li>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/">Azure Storage Team Blog</a></li>
</ul>
<h1>Contribute</h1>
<p>We gladly accept community contributions.</p>
<ul>
<li>Issues: Please report bugs using the Issues section of GitHub</li>
<li>Forums: Interact with the development teams on StackOverflow or the Microsoft Azure Forums</li>
<li>Source Code Contributions: If you would like to become an active contributor to this project please follow the instructions provided in <a href="http://azure.github.com/guidelines.html">Microsoft Azure Projects Contribution Guidelines</a>.</li>
</ul>
<p>For general suggestions about Microsoft Azure please use our <a href="http://feedback.azure.com/forums/34192--general-feedback">UserVoice forum</a>.</p></article>
    </section>







				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Wed Mar 9th 2016 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<div class="span3">
				<div id="toc"></div>
			</div>
			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>