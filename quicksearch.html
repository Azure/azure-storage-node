<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"azure-storage.js.html":{"id":"azure-storage.js.html","title":"Source: azure-storage.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: azure-storage.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // var exports = module.exports; /** * Creates a connection string that can be used to create a service which runs on the storage emulator. The emulator must be downloaded separately. * * @param {string} [proxyUri] The proxyUri. By default, http://127.0.0.1 * @return {string} A connection string representing the development storage credentials. * @example * var azure = require('azure-storage'); * var devStoreCreds = azure.generateDevelopmentStorageCredentials(); * var blobService = azure.createBlobService(devStoreCreds); */ exports.generateDevelopmentStorageCredentials = function (proxyUri) { var devStore = 'UseDevelopmentStorage=true;'; if(proxyUri){ devStore += 'DevelopmentStorageProxyUri=' + proxyUri; } return devStore; }; /** * Table client exports. * @ignore */ var TableService = require('./services/table/tableservice'); exports.TableService = TableService; exports.TableQuery = require('./services/table/tablequery'); exports.TableBatch = require('./services/table/tablebatch'); exports.TableUtilities = require('./services/table/tableutilities'); /** * Creates a new {@link TableService} object. * If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY * environment variables will be used. * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @return {TableService} A new TableService object. * */ exports.createTableService = function (storageAccountOrConnectionString, storageAccessKey, host) { return new TableService(storageAccountOrConnectionString, storageAccessKey, host); }; /** * Creates a new {@link TableService} object using the host Uri and the SAS credentials provided. * * @param {string|object} host The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} sasToken The Shared Access Signature token. * @return {TableService} A new TableService object with the SAS credentials. */ exports.createTableServiceWithSas = function (hostUri, sasToken) { return new TableService(null, null, hostUri, sasToken); }; /** * Blob client exports. * @ignore */ var BlobService = require('./services/blob/blobservice.node'); exports.BlobService = BlobService; exports.BlobUtilities = require('./services/blob/blobutilities'); /** * Creates a new {@link BlobService} object. * If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY * environment variables will be used. * * @param {string} storageAccountOrConnectionString The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @return {BlobService} A new BlobService object. */ exports.createBlobService = function (storageAccountOrConnectionString, storageAccessKey, host) { return new BlobService(storageAccountOrConnectionString, storageAccessKey, host, null); }; /** * Creates a new {@link BlobService} object using the host Uri and the SAS credentials provided. * * @param {string|object} host The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} sasToken The Shared Access Signature token. * @return {BlobService} A new BlobService object with the SAS credentials. */ exports.createBlobServiceWithSas = function (host, sasToken) { return new BlobService(null, null, host, sasToken); }; /** * Creates a new {@link BlobService} object using the host uri and anonymous access. * * @param {string|object} host The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @return {BlobService} A new BlobService object with the anonymous credentials. */ exports.createBlobServiceAnonymous = function (host) { return new BlobService(null, null, host, null); }; /** * File client exports. * @ignore */ var FileService = require('./services/file/fileservice.node'); exports.FileService = FileService; exports.FileUtilities = require('./services/file/fileutilities'); /** * Creates a new {@link FileService} object. * If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY * environment variables will be used. * * @param {string} storageAccountOrConnectionString The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @return {FileService} A new FileService object. */ exports.createFileService = function (storageAccountOrConnectionString, storageAccessKey, host) { return new FileService(storageAccountOrConnectionString, storageAccessKey, host); }; /** * Creates a new {@link FileService} object using the host Uri and the SAS credentials provided. * * @param {string|object} host The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} sasToken The Shared Access Signature token. * @return {FileService} A new FileService object with the SAS credentials. */ exports.createFileServiceWithSas = function (hostUri, sasToken) { return new FileService(null, null, hostUri, sasToken); }; /** * Queue client exports. * @ignore */ var QueueService = require('./services/queue/queueservice'); exports.QueueService = QueueService; exports.QueueUtilities = require('./services/queue/queueutilities'); exports.QueueMessageEncoder = require('./services/queue/queuemessageencoder'); /** * Creates a new {@link QueueService} object. * If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY * environment variables will be used. * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @return {QueueService} A new QueueService object. */ exports.createQueueService = function (storageAccountOrConnectionString, storageAccessKey, host) { return new QueueService(storageAccountOrConnectionString, storageAccessKey, host); }; /** * Creates a new {@link QueueService} object using the host Uri and the SAS credentials provided. * * @param {string|object} host The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} sasToken The Shared Access Signature token. * @return {QueueService} A new QueueService object with the SAS credentials. */ exports.createQueueServiceWithSas = function(hostUri, sasToken) { return new QueueService(null, null, hostUri, sasToken); }; /** * Account SAS * @ignore */ var azureCommon = require('./common/common.node'); var StorageServiceClient = azureCommon.StorageServiceClient; var SharedKey = azureCommon.SharedKey; /** * Generates an account shared access signature token * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {object} sharedAccessPolicy The shared access policy. * @param {SharedAccessServices} sharedAccessPolicy.AccessPolicy.Services The services (blob, file, queue, table) for a shared access signature associated with this shared access policy. * Refer to `Constants.AccountSasConstants.Services`. * @param {SharedAccessResourceTypes} sharedAccessPolicy.AccessPolicy.ResourceTypes The resource type for a shared access signature associated with this shared access policy. * Refer to `Constants.AccountSasConstants.ResourceTypes`. * @param {SharedAccessPermissions} sharedAccessPolicy.AccessPolicy.Permissions The permissions for a shared access signature. * Refer to `Constants.AccountSasConstants.Permissions`. * @param {date} sharedAccessPolicy.AccessPolicy.Start The time at which the Shared Access Signature becomes valid. * @param {date} sharedAccessPolicy.AccessPolicy.Expiry The time at which the Shared Access Signature becomes expired. * @param {string} sharedAccessPolicy.AccessPolicy.IPAddressOrRange The permission type. Refer to `Constants.AccountSasConstants.ResourceTypes`. * @param {string} sharedAccessPolicy.AccessPolicy.Protocols The possible protocols. Refer to `Constants.AccountSasConstants.ResourceTypes`. */ exports.generateAccountSharedAccessSignature = function(storageAccountOrConnectionString, storageAccessKey, sharedAccessAccountPolicy) { var storageSettings = StorageServiceClient.getStorageSettings(storageAccountOrConnectionString, storageAccessKey); var sharedKey = new SharedKey(storageSettings._name, storageSettings._key); return sharedKey.generateAccountSignedQueryString(sharedAccessAccountPolicy); }; /** * A callback that returns a response object. * @callback errorOrResponse * @param {object} error If an error occurs, will contain information about the error. * @param {object} response Contains information about the response returned for the operation. * For example, HTTP status codes and headers. */ /** * A callback that returns result and response objects. * @callback errorOrResult * @param {object} error If an error occurs, will contain information about the error. * @param {object} result The result of the operation. * @param {object} response Contains information about the response returned for the operation. * For example, HTTP status codes and headers. */ /** * Specifying conditional headers for blob service operations. See http://msdn.microsoft.com/en-us/library/dd179371.aspx for more information. * @typedef {object} AccessConditions * @property {string} EtagMatch If the ETag for the blob matches the specified ETag. * Specify the wildcard character (*) to perform the operation only if the resource does exist, and fail the operation if it does not exist. * @property {string} EtagNonMatch If the ETag for the blob does not match the specified ETag. * Specify the wildcard character (*) to perform the operation only if the resource does not exist, and fail the operation if it does exist. * @property {Date|string} DateModifedSince If the blob has been modified since the specified date. * @property {Date|string} DateUnModifiedSince If the blob has not been modified since the specified date. * @property {Number|string} SequenceNumberLessThanOrEqual If the blob's sequence number is less than or equal to the specified value. * For Put Page operation only. See https://msdn.microsoft.com/en-us/library/azure/ee691975.aspx for more information. * @property {Number|string} SequenceNumberLessThan If the blob's sequence number is less than the specified value. * For Put Page operation only. See https://msdn.microsoft.com/en-us/library/azure/ee691975.aspx for more information. * @property {Number|string} SequenceNumberEqual If the blob's sequence number is equal to the specified value. * For Put Page operation only. See https://msdn.microsoft.com/en-us/library/azure/ee691975.aspx for more information. * @property {Number|string} MaxBlobSize If the Append Block operation would cause the blob to exceed that limit or if the blob size is already greater than the specified value. * For Append Block operation only. See https://msdn.microsoft.com/en-us/library/mt427365.aspx for more information. * @property {Number|string} MaxAppendPosition If the append position is equal to the specified value. * For Append Block operation only. See https://msdn.microsoft.com/en-us/library/mt427365.aspx for more information. */ /** * The properties of a storage service, including properties of Storage Analytics and CORS (Cross-Origin Resource Sharing) rules. * @typedef {object} ServiceProperties * @property {string} DefaultServiceVersion The default version of Storage Analytics currently in use. * @property {LoggingProperties} Logging The Logging settings. * @property {MetricsProperties} HourMetrics The HourMetrics settings provide a summary of request statistics grouped by API in hourly aggregates. * @property {MetricsProperties} MinuteMetrics The HourMetrics settings provide request statistics grouped by API for each minute. * @property {object} Cors Groups all CORS rules. * @property {CorsRule[]} Cors.CorsRules Groups settings for a `[CORS rule]{@link CorsRule}`. */ /** * The Azure Analytics logging settings. * @typedef {object} LoggingProperties * @property {string} Version The version of Storage Analytics currently in use for logging. * @property {boolean} Delete Indicates whether delete requests are being logged. * @property {boolean} Read Indicates whether read requests are being logged. * @property {boolean} Write Indicates whether write requests are being logged. * @property {RetentionPolicy} RetentionPolicy The retention policy of the log data. */ /** * The setting of Azure Analytics summary of request stastics. * @typedef {object} MetricsProperties * @property {string} Version The version of Storage Analytics currently in use for hour metrics. * @property {string} Enabled Indicates whether metrics are enabled * @property {boolean} IncludeAPIs Indicates whether metrics generate summary statistics for called API operations. * @property {RetentionPolicy} RetentionPolicy The retention policy of the metrics data. */ /** * The CORS rule of a storage service. * @typedef {object} CorsRule * @property {string[]} AllowedMethods A list of HTTP methods that are allowed to be executed by the origin. For Azure Storage, permitted methods are DELETE, GET, HEAD, MERGE, POST, OPTIONS or PUT. * @property {string[]} AllowedOrigins A list of origin domains that are allowed via CORS, or &quot;*&quot; if all domains are allowed. * @property {string[]} AllowedHeaders A list of headers allowed to be part of the cross-origin request. * @property {string[]} ExposedHeaders A list of response headers to expose to CORS clients. * @property {number} MaxAgeInSeconds The number of seconds that the client/browser should cache a preflight response. */ /** * The Azure Analytics logging or metrics retention policy. * @typedef {object} RetentionPolicy * @property {boolean} Enabled Indicates whether a retention policy is enabled for the storage service. * @property {number} Days Indicates the number of days that logging data is retained. All data older than this value will be deleted. */ /** * The access policy. * @typedef {object} AccessPolicy * @property {string} Permissions The permission type. * @property {Date} Start The time at which the access policy becomes valid. * @property {Date} Expiry The time at which the access policy becomes expired. * @property {string} IPAddressOrRange An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. * @property {string} Protocols The protocols permitted for a request made with the SAS. * @property {string} Services The services (blob, file, queue, table) for a shared access signature associated with this shared access policy. * @property {string} ResourceTypes The resource type for a shared access signature associated with this shared access policy. */ /** * The service statistics. * @typedef {object} ServiceStats * @property {object} GeoReplication The geo replication stastics. * @property {string} GeoReplication.Status The status of the secondary location. * @property {Date} GeoReplication.LastSyncTime A GMT date/time value, to the second. * All primary writes preceding this value are guaranteed to be available for read operations at the secondary. * Primary writes after this point in time may or may not be available for reads. */ /** * The range. * @typedef {object} Range * @property {number} start The start of the range. * @property {number} end The end of the range. */ /** * The range diff. Refer to https://msdn.microsoft.com/en-us/library/azure/mt736912.aspx * @typedef {object} RangeDiff * @property {number} start The start of the range. * @property {number} end The end of the range. * @property {boolean} isCleared If the range is cleared or not. */ exports.Constants = azureCommon.Constants; exports.StorageUtilities = azureCommon.StorageUtilities; exports.AccessCondition = azureCommon.AccessCondition; exports.SR = azureCommon.SR; exports.StorageServiceClient = StorageServiceClient; exports.Logger = azureCommon.Logger; exports.WebResource = azureCommon.WebResource; exports.Validate = azureCommon.validate; exports.date = azureCommon.date; // Other filters exports.LinearRetryPolicyFilter = azureCommon.LinearRetryPolicyFilter; exports.ExponentialRetryPolicyFilter = azureCommon.ExponentialRetryPolicyFilter; exports.RetryPolicyFilter = azureCommon.RetryPolicyFilter; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_queue_queuemessageencoder.js.html":{"id":"services_queue_queuemessageencoder.js.html","title":"Source: services/queue/queuemessageencoder.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/queue/queuemessageencoder.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var util = require('util'); /** * The interface for classes that represent a encoder which can be used to specify how the queue service encodes and decodes queue messages. * * To specify how the queue service encodes and decodes queue messages, set `queueService.messageEncoder` to object of built-in encoder types * `[TextBase64QueueMessageEncoder]{@link TextBase64QueueMessageEncoder}`, `[BinaryBase64QueueMessageEncoder]{@link BinaryBase64QueueMessageEncoder}`, `[TextXmlQueueMessageEncoder]{@link TextXmlQueueMessageEncoder}`, * or custom implementation of the QueueMessageEncoder. * * @class */ function QueueMessageEncoder() { } /** * Function to encode queue messages. * * @param {object} [input] The target to be encoded. * @return {string} */ QueueMessageEncoder.prototype.encode = function(input){ return input; }; /** * Function to decode queue messages * * @param {string} [textToBeDecoded] The base64 string to be decoded. * @returns {any} */ QueueMessageEncoder.prototype.decode = function(textToBeDecoded){ return textToBeDecoded; }; /** * Create a new TextBase64QueueMessageEncoder object * @class * * Encode from utf-8 string to base64 string * Decode from base64 string to utf-8 string. * * @constructor * @extends {QueueMessageEncoder} */ function TextBase64QueueMessageEncoder(){ } util.inherits(TextBase64QueueMessageEncoder, QueueMessageEncoder); /** * Encode from utf-8 string to base64 string * @this TextBase64QueueMessageEncoder * * @param {string} [input] The target to be encoded. * * @return {string} */ TextBase64QueueMessageEncoder.prototype.encode = function(input){ return new Buffer(input, 'utf8').toString('base64'); }; /** * Decode from base64 string to utf-8 string. * @this TextBase64QueueMessageEncoder * * @param {string} [textToBeDecoded] The base64 string to be decoded. * * @return {string} */ TextBase64QueueMessageEncoder.prototype.decode = function(textToDecode){ return new Buffer(textToDecode, 'base64').toString('utf8'); }; /** * Create a new BinaryBase64QueueMessageEncoder object * @class * * Encode from binary buffer to base64 string * Decode from base64 string to binary buffer. * * @constructor * @extends {QueueMessageEncoder} */ function BinaryBase64QueueMessageEncoder(){ } util.inherits(BinaryBase64QueueMessageEncoder, QueueMessageEncoder); /** * Encode from binary buffer string to base64 string * @this BinaryBase64QueueMessageEncoder * * @param {Buffer} [input] The target to be encoded. * * @return {string} */ BinaryBase64QueueMessageEncoder.prototype.encode = function(input){ return input.toString('base64'); }; /** * Decode from base64 string to binary buffer. * @this BinaryBase64QueueMessageEncoder * * @param {string} [textToBeDecoded] The base64 string to be decoded. * * @return {Buffer} */ BinaryBase64QueueMessageEncoder.prototype.decode = function(textToDecode){ return new Buffer(textToDecode, 'base64'); }; /** * Create a new TextXmlQueueMessageEncoder object * @class * * Encode utf-8 string by escaping the xml markup characters. * Decode from utf-8 string by unescaping the xml markup characters. * * @constructor * @extends {QueueMessageEncoder} */ function TextXmlQueueMessageEncoder(){ } util.inherits(TextXmlQueueMessageEncoder, QueueMessageEncoder); /** * Encode utf-8 string by escaping the xml markup characters. * @this TextXmlQueueMessageEncoder * * @param {string} [input] The target to be encoded. * * @return {string} */ TextXmlQueueMessageEncoder.prototype.encode = function(input){ return input.replace(/&amp;/gm, '&amp;amp;') .replace(/&lt;/gm, '&amp;lt;') .replace(/&gt;/gm, '&amp;gt;') .replace(/&quot;/gm, '&amp;quot;') .replace(/'/gm, '&amp;apos;'); }; /** * Decode from utf-8 string by unescaping the xml markup characters. * @this TextXmlQueueMessageEncoder * * @param {string} [textToBeDecoded] The base64 string to be decoded. * * @return {string} */ TextXmlQueueMessageEncoder.prototype.decode = function(textToDecode){ return textToDecode.replace(/&amp;amp;/gm, '&amp;') .replace(/&amp;lt;/gm, '&lt;') .replace(/&amp;gt;/gm, '&gt;') .replace(/&amp;quot;/gm, '&quot;') .replace(/&amp;apos;/gm, '\\''); }; module.exports = QueueMessageEncoder; module.exports.TextBase64QueueMessageEncoder = TextBase64QueueMessageEncoder; module.exports.BinaryBase64QueueMessageEncoder = BinaryBase64QueueMessageEncoder; module.exports.TextXmlQueueMessageEncoder = TextXmlQueueMessageEncoder; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_blobservice.core.js.html":{"id":"services_blob_blobservice.core.js.html","title":"Source: services/blob/blobservice.core.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/blobservice.core.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var qs = require('querystring'); var url = require('url'); var util = require('util'); var _ = require('underscore'); var extend = require('extend'); var azureCommon = require('./../../common/common.core'); var BlockRangeStream = require('./internal/blockrangestream'); var Md5Wrapper = require('./../../common/md5-wrapper'); var PageRangeStream = require('./internal/pagerangestream'); var RangeStream = require('./../../common/streams/rangestream'); var azureutil = azureCommon.util; var SR = azureCommon.SR; var validate = azureCommon.validate; var StorageServiceClient = azureCommon.StorageServiceClient; var WebResource = azureCommon.WebResource; // Constants var Constants = azureCommon.Constants; var BlobConstants = Constants.BlobConstants; var HeaderConstants = Constants.HeaderConstants; var QueryStringConstants = Constants.QueryStringConstants; var RequestLocationMode = Constants.RequestLocationMode; // Streams var BatchOperation = azureCommon.BatchOperation; var SpeedSummary = azureCommon.SpeedSummary; var ChunkAllocator = azureCommon.ChunkAllocator; var ChunkStream = azureCommon.ChunkStream; var ChunkStreamWithStream = azureCommon.ChunkStreamWithStream; // Models requires var AclResult = azureCommon.AclResult; var ServiceStatsParser = azureCommon.ServiceStatsParser; var BlockListResult = require('./models/blocklistresult'); var BlobResult = require('./models/blobresult'); var ContainerResult = require('./models/containerresult'); var LeaseResult = require('./models/leaseresult'); var BlobUtilities = require('./blobutilities'); // Errors requires var errors = require('../../common/errors/errors'); var ArgumentError = errors.ArgumentError; var ArgumentNullError = errors.ArgumentNullError; var StorageError = errors.StorageError; /** * Creates a new BlobService object. * If no connection string or storageaccount and storageaccesskey are provided, * the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. * @class * The BlobService class is used to perform operations on the Microsoft Azure Blob Service. * The Blob Service provides storage for binary large objects, and provides * functions for working with data stored in blobs as either streams or pages of data. * * For more information on the Blob Service, as well as task focused information on using it in a Node.js application, see * [How to Use the Blob Service from Node.js](http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-blob-storage/). * The following defaults can be set on the blob service. * singleBlobPutThresholdInBytes The default maximum size, in bytes, of a blob before it must be separated into blocks. * defaultEnableReuseSocket The default boolean value to enable socket reuse when uploading local files or streams. * If the Node.js version is lower than 0.10.x, socket reuse will always be turned off. * defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the Blob service. * defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the Blob service. * defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the Blob service. * defaultLocationMode The default location mode for requests made via the Blob service. * parallelOperationThreadCount The number of parallel operations that may be performed when uploading a blob that is greater than * the value specified by the singleBlobPutThresholdInBytes property in size. * useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the Blob service; true to use the * Nagle algorithm; otherwise, false. The default value is false. * @constructor * @extends {StorageServiceClient} * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} [sasToken] The Shared Access Signature token. * @param {string} [endpointSuffix] The endpoint suffix. */ function BlobService(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix) { var storageServiceSettings = StorageServiceClient.getStorageSettings(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix); BlobService['super_'].call(this, storageServiceSettings._name, storageServiceSettings._key, storageServiceSettings._blobEndpoint, storageServiceSettings._usePathStyleUri, storageServiceSettings._sasToken); this.defaultEnableReuseSocket = Constants.DEFAULT_ENABLE_REUSE_SOCKET; this.singleBlobPutThresholdInBytes = BlobConstants.DEFAULT_SINGLE_BLOB_PUT_THRESHOLD_IN_BYTES; this.parallelOperationThreadCount = Constants.DEFAULT_PARALLEL_OPERATION_THREAD_COUNT; } util.inherits(BlobService, StorageServiceClient); // Non-class methods /** * Create resource name * @ignore * * @param {string} containerName Container name * @param {string} blobName Blob name * @return {string} The encoded resource name. */ function createResourceName(containerName, blobName, forSAS) { // Resource name if (blobName &amp;&amp; !forSAS) { blobName = encodeURIComponent(blobName); blobName = blobName.replace(/%2F/g, '/'); blobName = blobName.replace(/%5C/g, '/'); blobName = blobName.replace(/\\+/g, '%20'); } // return URI encoded resource name if (blobName) { return containerName + '/' + blobName; } else { return containerName; } } // Blob service methods /** * Gets the service stats for a storage account’s Blob service. * * @this {BlobService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; otherwise, `[result]{@link ServiceStats}` will contain the stats and * `response` will contain information related to this operation. */ BlobService.prototype.getServiceStats = function (optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); validate.validateArgs('getServiceStats', function (v) { v.callback(callback); }); var webResource = WebResource.get() .withQueryOption(QueryStringConstants.COMP, 'stats') .withQueryOption(QueryStringConstants.RESTYPE, 'service'); options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.serviceStatsResult = null; if (!responseObject.error) { responseObject.serviceStatsResult = ServiceStatsParser.parse(responseObject.response.body.StorageServiceStats); } // function to be called after all filters var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.serviceStatsResult, returnObject.response); }; // call the first filter next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets the properties of a storage account’s Blob service, including Azure Storage Analytics. * * @this {BlobService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; otherwise, `[result]{@link ServiceProperties}` will contain the properties * and `response` will contain information related to this operation. */ BlobService.prototype.getServiceProperties = function (optionsOrCallback, callback) { return this.getAccountServiceProperties(optionsOrCallback, callback); }; /** * Sets the properties of a storage account's Blob service, including Azure Storage Analytics. * You can also use this operation to set the default request version for all incoming requests that do not have a version specified. * * @this {BlobService} * @param {object} serviceProperties The service properties. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise, `response` * will contain information related to this operation. */ BlobService.prototype.setServiceProperties = function (serviceProperties, optionsOrCallback, callback) { return this.setAccountServiceProperties(serviceProperties, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of container items under the specified account. * * @this {BlobService} * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.maxResults] Specifies the maximum number of containers to return per call to Azure storage. * @param {string} [options.include] Include this parameter to specify that the container's metadata be returned as part of the response body. (allowed values: '', 'metadata') * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[containers]{@link ContainerResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype.listContainersSegmented = function (currentToken, optionsOrCallback, callback) { this.listContainersSegmentedWithPrefix(null /* prefix */, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of container items whose names begin with the specified prefix under the specified account. * * @this {BlobService} * @param {string} prefix The prefix of the container name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.maxResults] Specifies the maximum number of containers to return per call to Azure storage. * @param {string} [options.include] Include this parameter to specify that the container's metadata be returned as part of the response body. (allowed values: '', 'metadata') * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[containers]{@link ContainerResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype.listContainersSegmentedWithPrefix = function (prefix, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listContainers', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get() .withQueryOption(QueryStringConstants.COMP, 'list') .withQueryOption(QueryStringConstants.MAX_RESULTS, options.maxResults) .withQueryOption(QueryStringConstants.INCLUDE, options.include); if (!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(QueryStringConstants.MARKER, currentToken.nextMarker); } webResource.withQueryOption(QueryStringConstants.PREFIX, prefix); options.requestLocationMode = azureutil.getNextListingLocationMode(currentToken); var processResponseCallback = function (responseObject, next) { responseObject.listContainersResult = null; if (!responseObject.error) { responseObject.listContainersResult = { entries: null, continuationToken: null }; responseObject.listContainersResult.entries = []; var containers = []; if (responseObject.response.body.EnumerationResults.Containers &amp;&amp; responseObject.response.body.EnumerationResults.Containers.Container) { containers = responseObject.response.body.EnumerationResults.Containers.Container; if (!_.isArray(containers)) { containers = [containers]; } } containers.forEach(function (currentContainer) { var containerResult = ContainerResult.parse(currentContainer); responseObject.listContainersResult.entries.push(containerResult); }); if (responseObject.response.body.EnumerationResults.NextMarker) { responseObject.listContainersResult.continuationToken = { nextMarker: null, targetLocation: null }; responseObject.listContainersResult.continuationToken.nextMarker = responseObject.response.body.EnumerationResults.NextMarker; responseObject.listContainersResult.continuationToken.targetLocation = responseObject.targetLocation; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.listContainersResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; // Container methods /** * Checks whether or not a container exists on the service. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerResult}` will contain * the container information including `exists` boolean member. * `response` will contain information related to this operation. */ BlobService.prototype.doesContainerExist = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('doesContainerExist', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); this._doesContainerExist(container, false, options, callback); }; /** * Creates a new container under the specified account. * If a container with the same name already exists, the operation fails. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {object} [options.metadata] The metadata key/value pairs. * @param {string} [options.publicAccessLevel] Specifies whether data in the container may be accessed publicly and the level of access. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerResult}` will contain * the container information. * `response` will contain information related to this operation. */ BlobService.prototype.createContainer = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createContainer', function (v) { v.string(container, 'container'); v.test(function () { return container !== '$logs'; }, 'Container name format is incorrect'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container'); webResource.addOptionalMetadataHeaders(options.metadata); webResource.withHeader(HeaderConstants.BLOB_PUBLIC_ACCESS, options.publicAccessLevel); var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.containerResult = new ContainerResult(container); responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); if (options.metadata) { responseObject.containerResult.metadata = options.metadata; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Creates a new container under the specified account if the container does not exists. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {object} [options.metadata] The metadata key/value pairs. * @param {string} [options.publicAccessLevel] Specifies whether data in the container may be accessed publicly and the level of access. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerResult}` will contain * the container information including `created` boolean member. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * blobService.createContainerIfNotExists('taskcontainer', {publicAccessLevel : 'blob'}, function(error) { * if(!error) { * // Container created or exists, and is public * } * }); */ BlobService.prototype.createContainerIfNotExists = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createContainerIfNotExists', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesContainerExist(container, true, options, function (error, result, response) { var exists = result.exists; result.created = false; delete result.exists; if (error) { callback(error, result, response); } else if (exists) { response.isSuccessful = true; callback(error, result, response); } else { self.createContainer(container, options, function (createError, containerResult, createResponse) { if (!createError) { containerResult.created = true; } else if (createError &amp;&amp; createError.statusCode === Constants.HttpConstants.HttpResponseCodes.Conflict &amp;&amp; createError.code === Constants.BlobErrorCodeStrings.CONTAINER_ALREADY_EXISTS) { // If it was created before, there was no actual error. createError = null; createResponse.isSuccessful = true; } callback(createError, containerResult, createResponse); }); } }); }; /** * Retrieves a container and its properties from a specified account. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {string} [options.leaseId] The container lease identifier. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerResult}` will contain * information for the container. * `response` will contain information related to this operation. */ BlobService.prototype.getContainerProperties = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getContainerProperties', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withHeader(HeaderConstants.LEASE_ID, options.leaseId); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.containerResult = new ContainerResult(container); responseObject.containerResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Returns all user-defined metadata for the container. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {string} [options.leaseId] The container lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerResult}` will contain * information for the container. * `response` will contain information related to this operation. */ BlobService.prototype.getContainerMetadata = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getContainerMetadata', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withQueryOption(QueryStringConstants.COMP, 'metadata') .withHeader(HeaderConstants.LEASE_ID, options.leaseId); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.containerResult = new ContainerResult(container); responseObject.containerResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets the container's metadata. * * Calling the Set Container Metadata operation overwrites all existing metadata that is associated with the container. * It's not possible to modify an individual name/value pair. * * @this {BlobService} * @param {string} container The container name. * @param {object} metadata The metadata key/value pairs. * @param {object} [options] The request options. * @param {string} [options.leaseId] The container lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.setContainerMetadata = function (container, metadata, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setContainerMetadata', function (v) { v.string(container, 'container'); v.object(metadata, 'metadata'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withQueryOption(QueryStringConstants.COMP, 'metadata') .withHeader(HeaderConstants.LEASE_ID, options.leaseId); webResource.addOptionalMetadataHeaders(metadata); var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.containerResult = new ContainerResult(container); responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets the container's ACL. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {string} [options.leaseId] The container lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerAclResult}` will contain * information for the container. * `response` will contain information related to this operation. */ BlobService.prototype.getContainerAcl = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getContainerAcl', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withQueryOption(QueryStringConstants.COMP, 'acl') .withHeader(HeaderConstants.LEASE_ID, options.leaseId); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.containerResult = new ContainerResult(container); responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); responseObject.containerResult.signedIdentifiers = AclResult.parse(responseObject.response.body); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Updates the container's ACL. * * @this {BlobService} * @param {string} container The container name. * @param {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The container ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {string} [options.publicAccessLevel] Specifies whether data in the container may be accessed publicly and the level of access. * @param {string} [options.leaseId] The container lease identifier. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ContainerAclResult}` will contain * information for the container. * `response` will contain information related to this operation. */ BlobService.prototype.setContainerAcl = function (container, signedIdentifiers, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setContainerAcl', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var policies = null; if (signedIdentifiers) { if (_.isArray(signedIdentifiers)) { throw new TypeError(SR.INVALID_SIGNED_IDENTIFIERS); } policies = AclResult.serialize(signedIdentifiers); } var webResource = WebResource.put(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withQueryOption(QueryStringConstants.COMP, 'acl') .withHeader(HeaderConstants.CONTENT_LENGTH, !azureutil.objectIsNull(policies) ? Buffer.byteLength(policies) : 0) .withHeader(HeaderConstants.BLOB_PUBLIC_ACCESS, options.publicAccessLevel) .withHeader(HeaderConstants.LEASE_ID, options.leaseId) .withBody(policies); var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.containerResult = new ContainerResult(container, options.publicAccessLevel); responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); if (signedIdentifiers) { responseObject.containerResult.signedIdentifiers = signedIdentifiers; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Marks the specified container for deletion. * The container and any blobs contained within it are later deleted during garbage collection. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {string} [options.leaseId] The container lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.deleteContainer = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteContainer', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.del(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withHeader(HeaderConstants.LEASE_ID, options.leaseId); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified container for deletion if it exists. * The container and any blobs contained within it are later deleted during garbage collection. * * @this {BlobService} * @param {string} container The container name. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {string} [options.leaseId] The container lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will * be true if the container exists and was deleted, or false if the container * did not exist. * `response` will contain information related to this operation. */ BlobService.prototype.deleteContainerIfExists = function (container, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteContainerIfExists', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesContainerExist(container, true, options, function (error, result, response) { if (error) { callback(error, result.exists, response); } else if (!result.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteContainer(container, options, function (deleteError, deleteResponse) { var deleted; if (!deleteError) { deleted = true; } else if (deleteError &amp;&amp; deleteError.statuscode === Constants.HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.BlobErrorCodeStrings.CONTAINER_NOT_FOUND) { // If it was deleted already, there was no actual error. deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; /** * Lists a segment containing a collection of blob directory items in the container. * * @this {BlobService} * @param {string} container The container name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {int} [options.maxResults] Specifies the maximum number of directories to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[directories]{@link DirectoryResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype.listBlobDirectoriesSegmented = function (container, currentToken, optionsOrCallback, callback) { this.listBlobDirectoriesSegmentedWithPrefix(container, null /* prefix */, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of blob directory items in the container. * * @this {BlobService} * @param {string} container The container name. * @param {string} prefix The prefix of the blob directory. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {int} [options.maxResults] Specifies the maximum number of directories to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[directories]{@link BlobResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype.listBlobDirectoriesSegmentedWithPrefix = function (container, prefix, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); userOptions.delimiter = '/'; this._listBlobsOrDircotriesSegmentedWithPrefix(container, prefix, currentToken, BlobConstants.ListBlobTypes.Directory, userOptions, callback); }; /** * Lists a segment containing a collection of blob items in the container. * * @this {BlobService} * @param {string} container The container name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {string} [options.delimiter] Delimiter, i.e. '/', for specifying folder hierarchy. * @param {int} [options.maxResults] Specifies the maximum number of blobs to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {string} [options.include] Specifies that the response should include one or more of the following subsets: '', 'metadata', 'snapshots', 'uncommittedblobs', 'copy'). * Please find these values in BlobUtilities.BlobListingDetails. Multiple values can be added separated with a comma (,). * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[blobs]{@link BlobResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype.listBlobsSegmented = function (container, currentToken, optionsOrCallback, callback) { this.listBlobsSegmentedWithPrefix(container, null /* prefix */, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of blob items whose names begin with the specified prefix in the container. * * @this {BlobService} * @param {string} container The container name. * @param {string} prefix The prefix of the blob name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {string} [options.delimiter] Delimiter, i.e. '/', for specifying folder hierarchy. * @param {int} [options.maxResults] Specifies the maximum number of blobs to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {string} [options.include] Specifies that the response should include one or more of the following subsets: '', 'metadata', 'snapshots', 'uncommittedblobs', 'copy'). * Please find these values in BlobUtilities.BlobListingDetails. Multiple values can be added separated with a comma (,). * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the entries of `[blobs]{@link BlobResult}` and the continuation token for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype.listBlobsSegmentedWithPrefix = function (container, prefix, currentToken, optionsOrCallback, callback) { this._listBlobsOrDircotriesSegmentedWithPrefix(container, prefix, currentToken, BlobConstants.ListBlobTypes.Blob, optionsOrCallback, callback); }; // Lease methods /** * Acquires a new lease. If container and blob are specified, acquires a blob lease. Otherwise, if only container is specified and blob is null, acquires a container lease. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.leaseDuration] The lease duration in seconds. A non-infinite lease can be between 15 and 60 seconds. Default is never to expire. * @param {string} [options.proposedLeaseId] The proposed lease identifier. Must be a GUID. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link LeaseResult}` will contain * the lease information. * `response` will contain information related to this operation. */ BlobService.prototype.acquireLease = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('acquireLease', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); if (!options.leaseDuration) { options.leaseDuration = -1; } this._leaseImpl(container, blob, null /* leaseId */, BlobConstants.LeaseOperation.ACQUIRE, options, callback); }; /** * Renews an existing lease. If container and blob are specified, renews the blob lease. Otherwise, if only container is specified and blob is null, renews the container lease. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} leaseId The lease identifier. Must be a GUID. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link LeaseResult}` will contain * the lease information. * `response` will contain information related to this operation. */ BlobService.prototype.renewLease = function (container, blob, leaseId, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('renewLease', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); this._leaseImpl(container, blob, leaseId, BlobConstants.LeaseOperation.RENEW, options, callback); }; /** * Changes the lease ID of an active lease. If container and blob are specified, changes the blob lease. Otherwise, if only container is specified and blob is null, changes the * container lease. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} leaseId The current lease identifier. * @param {string} proposedLeaseId The proposed lease identifier. Must be a GUID. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link LeaseResult}` will contain the lease information. * `response` will contain information related to this operation. */ BlobService.prototype.changeLease = function (container, blob, leaseId, proposedLeaseId, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('changeLease', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); options.proposedLeaseId = proposedLeaseId; this._leaseImpl(container, blob, leaseId, BlobConstants.LeaseOperation.CHANGE, options, callback); }; /** * Releases the lease. If container and blob are specified, releases the blob lease. Otherwise, if only container is specified and blob is null, releases the container lease. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} leaseId The lease identifier. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link LeaseResult}` will contain * the lease information. * `response` will contain information related to this operation. */ BlobService.prototype.releaseLease = function (container, blob, leaseId, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('releaseLease', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); this._leaseImpl(container, blob, leaseId, BlobConstants.LeaseOperation.RELEASE, options, callback); }; /** * Breaks the lease but ensures that another client cannot acquire a new lease until the current lease period has expired. If container and blob are specified, breaks the blob lease. * Otherwise, if only container is specified and blob is null, breaks the container lease. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {int} [options.leaseBreakPeriod] The lease break period, between 0 and 60 seconds. If unspecified, a fixed-duration lease breaks after * the remaining lease period elapses, and an infinite lease breaks immediately. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link LeaseResult}` will contain * the lease information. * `response` will contain information related to this operation. */ BlobService.prototype.breakLease = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('breakLease', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); this._leaseImpl(container, blob, null /*leaseId*/, BlobConstants.LeaseOperation.BREAK, options, callback); }; // Blob methods /** * Returns all user-defined metadata, standard HTTP properties, and system properties for the blob. * It does not return or modify the content of the blob. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * information about the blob. * `response` will contain information related to this operation. */ BlobService.prototype.getBlobProperties = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getBlobProperties', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.head(resourceName); if (options.snapshotId) { webResource.withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); } BlobResult.setHeadersFromBlob(webResource, options); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Returns all user-defined metadata for the specified blob or snapshot. * It does not modify or return the content of the blob. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * information about the blob. * `response` will contain information related to this operation. */ BlobService.prototype.getBlobMetadata = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getBlobMetadata', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.head(resourceName); webResource.withQueryOption(QueryStringConstants.COMP, 'metadata'); webResource.withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); BlobResult.setHeadersFromBlob(webResource, options); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets user-defined properties for the specified blob or snapshot. * It does not modify or return the content of the blob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [properties] The blob properties to set. * @param {string} [properties.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [properties.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [properties.contentLanguage] The natural languages used by this resource. * @param {string} [properties.cacheControl] The blob's cache control. * @param {string} [properties.contentDisposition] The blob's content disposition. * @param {string} [properties.contentMD5] The blob's MD5 hash. * @param {object} [options] The request options. * @param {string} [options.leaseId] The lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * information about the blob. * `response` will contain information related to this operation. */ BlobService.prototype.setBlobProperties = function (container, blob, properties, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setBlobProperties', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, { contentSettings: properties }, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'properties'); BlobResult.setPropertiesFromBlob(webResource, options); this._setBlobPropertiesHelper({ webResource: webResource, options: options, container: container, blob: blob, callback: callback }); }; /** * Sets user-defined metadata for the specified blob or snapshot as one or more name-value pairs * It does not modify or return the content of the blob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} metadata The metadata key/value pairs. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * information on the blob. * `response` will contain information related to this operation. */ BlobService.prototype.setBlobMetadata = function (container, blob, metadata, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setBlobMetadata', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.object(metadata, 'metadata'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'metadata'); webResource.withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); options.metadata = metadata; BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Provides a stream to read from a blob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link BlobResult}` will contain the blob information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * var writable = fs.createWriteStream(destinationFileNameTarget); * blobService.createReadStream(containerName, blobName).pipe(writable); */ BlobService.prototype.createReadStream = function (container, blob, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); validate.validateArgs('createReadStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); }); var readStream = new ChunkStream(); this.getBlobToStream(container, blob, readStream, options, function (error, responseBlob, response) { if (error) { readStream.emit('error', error); } if (callback) { callback(error, responseBlob, response); } }); return readStream; }; /** * Downloads a blob into a stream. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {Stream} writeStream The write stream. * @param {object} [options] The request options. * @param {boolean} [options.skipSizeCheck] Skip the size check to perform direct download. * Set the option to true for small blobs. * Parallel download and speed summary won't work with this option on. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link BlobResult}` will contain the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} * * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * blobService.getBlobToStream('taskcontainer', 'task1', fs.createWriteStream('task1-download.txt'), function(error, serverBlob) { * if(!error) { * // Blob available in serverBlob.blob variable * } * }); */ BlobService.prototype.getBlobToStream = function (container, blob, writeStream, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); userOptions.speedSummary = userOptions.speedSummary || new SpeedSummary(blob); validate.validateArgs('getBlobToStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.object(writeStream, 'writeStream'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var propertiesRequestOptions = { timeoutIntervalInMs: options.timeoutIntervalInMs, clientRequestTimeoutInMs: options.clientRequestTimeoutInMs, snapshotId: options.snapshotId, accessConditions: options.accessConditions }; if (options.skipSizeCheck) { this._getBlobToStream(container, blob, writeStream, options, callback); } else { var self = this; this.getBlobProperties(container, blob, propertiesRequestOptions, function (error, properties) { if (error) { callback(error); } else { var size; if (options.rangeStart) { var endOffset = properties.contentLength - 1; var end = options.rangeEnd ? Math.min(options.rangeEnd, endOffset) : endOffset; size = end - options.rangeStart + 1; } else { size = properties.contentLength; } options.speedSummary.totalSize = size; if (size &gt; self.singleBlobPutThresholdInBytes) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], azureutil.tryGetValueChain(properties, ['contentSettings', 'contentMD5'], null)); self._getBlobToRangeStream(container, blob, properties.blobType, writeStream, options, callback); } else { self._getBlobToStream(container, blob, writeStream, options, callback); } } }); } return options.speedSummary; }; /** * Downloads a blob into a text string. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {BlobService~blobToText} callback `error` will contain information * if an error occurs; otherwise `text` will contain the blob contents, * and `[blockBlob]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.getBlobToText = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getBlobToText', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.get(resourceName) .withRawResponse(); webResource.withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); BlobResult.setHeadersFromBlob(webResource, options); this._setRangeContentMD5Header(webResource, options); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.text = null; responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); responseObject.text = responseObject.response.body; self._validateLengthAndMD5(options, responseObject); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.text, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified blob or snapshot for deletion. The blob is later deleted during garbage collection. * If a blob has snapshots, you must delete them when deleting the blob. Using the deleteSnapshots option, you can choose either to delete both the blob and its snapshots, * or to delete only the snapshots but not the blob itself. If the blob has snapshots, you must include the deleteSnapshots option or the blob service will return an error * and nothing will be deleted. * If you are deleting a specific snapshot using the snapshotId option, the deleteSnapshots option must NOT be included. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.deleteSnapshots] The snapshot delete option. See azure.BlobUtilities.SnapshotDeleteOptions.*. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; `response` will contain information related to this operation. */ BlobService.prototype.deleteBlob = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteBlob', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.del(resourceName) .withHeader(HeaderConstants.LEASE_ID, options.leaseId); if (!azureutil.objectIsNull(options.snapshotId) &amp;&amp; !azureutil.objectIsNull(options.deleteSnapshots)) { throw new ArgumentError('options', SR.INVALID_DELETE_SNAPSHOT_OPTION); } webResource.withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); webResource.withHeader(HeaderConstants.DELETE_SNAPSHOT, options.deleteSnapshots); BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks whether or not a blob exists on the service. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information including the `exists` boolean member. * `response` will contain information related to this operation. */ BlobService.prototype.doesBlobExist = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('doesBlobExist', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); this._doesBlobExist(container, blob, false, options, callback); }; /** * Marks the specified blob or snapshot for deletion if it exists. The blob is later deleted during garbage collection. * If a blob has snapshots, you must delete them when deleting the blob. Using the deleteSnapshots option, you can choose either to delete both the blob and its snapshots, * or to delete only the snapshots but not the blob itself. If the blob has snapshots, you must include the deleteSnapshots option or the blob service will return an error * and nothing will be deleted. * If you are deleting a specific snapshot using the snapshotId option, the deleteSnapshots option must NOT be included. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.deleteSnapshots] The snapshot delete option. See azure.BlobUtilities.SnapshotDeleteOptions.*. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will * be true if the blob was deleted, or false if the blob * does not exist. * `response` will contain information related to this operation. */ BlobService.prototype.deleteBlobIfExists = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteBlobIfExists', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesBlobExist(container, blob, true, options, function (error, existsResult, response) { if (error) { callback(error, existsResult.exists, response); } else if (!existsResult.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteBlob(container, blob, options, function (deleteError, deleteResponse) { var deleted; if (!deleteError) { deleted = true; } else if (deleteError &amp;&amp; deleteError.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.BlobErrorCodeStrings.BLOB_NOT_FOUND) { // If it was deleted already, there was no actual error. deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; /** * Creates a read-only snapshot of a blob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {string} [options.leaseId] The lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the ID of the snapshot. * `response` will contain information related to this operation. */ BlobService.prototype.createBlobSnapshot = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createBlobSnapshot', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'snapshot'); BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.snapshotId = null; if (!responseObject.error) { responseObject.snapshotId = responseObject.response.headers[HeaderConstants.SNAPSHOT]; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.snapshotId, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Starts to copy a blob to a destination within the storage account. The Copy Blob operation copies the entire committed blob. * * @this {BlobService} * @param {string} sourceUri The source blob URI. * @param {string} targetContainer The target container name. * @param {string} targetBlob The target blob name. * @param {object} [options] The request options. * @param {boolean} [options.isIncrementalCopy] If it's incremental copy or not. Refer to https://docs.microsoft.com/en-us/rest/api/storageservices/fileservices/incremental-copy-blob * @param {string} [options.snapshotId] The source blob snapshot identifier. * @param {object} [options.metadata] The target blob metadata key/value pairs. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.sourceLeaseId] The source blob lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {AccessConditions} [options.sourceAccessConditions] The source access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.startCopyBlob = function (sourceUri, targetContainer, targetBlob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('startCopyBlob', function (v) { v.string(sourceUri, 'sourceUri'); v.string(targetContainer, 'targetContainer'); v.string(targetBlob, 'targetBlob'); v.containerNameIsValid(targetContainer); v.callback(callback); }); var targetResourceName = createResourceName(targetContainer, targetBlob); var options = extend(true, {}, userOptions); if (options.snapshotId) { var uri = url.parse(sourceUri, true); if (uri.query['snapshot']) { throw new ArgumentError('options.snapshotId', 'Duplicate snapshot supplied in both the source uri and option.'); } uri.search = undefined; uri.query['snapshot'] = options.snapshotId; sourceUri = url.format(uri); } var webResource = WebResource.put(targetResourceName) .withHeader(HeaderConstants.COPY_SOURCE, sourceUri); if (options.isIncrementalCopy) { webResource.withQueryOption(QueryStringConstants.COMP, 'incrementalcopy'); } webResource.withHeader(HeaderConstants.LEASE_ID, options.leaseId); webResource.withHeader(HeaderConstants.SOURCE_LEASE_ID, options.sourceLeaseId); webResource.addOptionalMetadataHeaders(options.metadata); var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(targetContainer, targetBlob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); if (options.metadata) { responseObject.blobResult.metadata = options.metadata; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Abort a blob copy operation. * * @this {BlobService} * @param {string} container The destination container name. * @param {string} blob The destination blob name. * @param {string} copyId The copy operation identifier. * @param {object} [options] The request options. * @param {string} [options.leaseId] The target blob lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information if an error occurs; * `response` will contain information related to this operation. */ BlobService.prototype.abortCopyBlob = function (container, blob, copyId, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('abortCopyBlob', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var resourceName = createResourceName(container, blob); var options = extend(true, {}, userOptions); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COPY_ID, copyId) .withQueryOption(QueryStringConstants.COMP, 'copy') .withHeader(HeaderConstants.COPY_ACTION, 'abort'); webResource.withHeader(HeaderConstants.LEASE_ID, options.leaseId); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Retrieves a shared access signature token. * * @this {BlobService} * @param {string} container The container name. * @param {string} [blob] The blob name. * @param {object} sharedAccessPolicy The shared access policy. * @param {string} [sharedAccessPolicy.Id] The signed identifier. * @param {object} [sharedAccessPolicy.AccessPolicy.Permissions] The permission type. * @param {date|string} [sharedAccessPolicy.AccessPolicy.Start] The time at which the Shared Access Signature becomes valid (The UTC value will be used). * @param {date|string} [sharedAccessPolicy.AccessPolicy.Expiry] The time at which the Shared Access Signature becomes expired (The UTC value will be used). * @param {string} [sharedAccessPolicy.AccessPolicy.IPAddressOrRange] An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. * @param {string} [sharedAccessPolicy.AccessPolicy.Protocols] The protocols permitted for a request made with the account SAS. * Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. * @param {object} [headers] The optional header values to set for a blob returned wth this SAS. * @param {string} [headers.cacheControl] The optional value of the Cache-Control response header to be returned when this SAS is used. * @param {string} [headers.contentType] The optional value of the Content-Type response header to be returned when this SAS is used. * @param {string} [headers.contentEncoding] The optional value of the Content-Encoding response header to be returned when this SAS is used. * @param {string} [headers.contentLanguage] The optional value of the Content-Language response header to be returned when this SAS is used. * @param {string} [headers.contentDisposition] The optional value of the Content-Disposition response header to be returned when this SAS is used. * @return {string} The shared access signature query string. Note this string does not contain the leading &quot;?&quot;. */ BlobService.prototype.generateSharedAccessSignature = function (container, blob, sharedAccessPolicy, headers) { // check if the BlobService is able to generate a shared access signature if (!this.storageCredentials) { throw new ArgumentNullError('storageCredentials'); } if (!this.storageCredentials.generateSignedQueryString) { throw new ArgumentError('storageCredentials', SR.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY); } // Validate container name. Blob name is optional. validate.validateArgs('generateSharedAccessSignature', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.object(sharedAccessPolicy, 'sharedAccessPolicy'); }); var resourceType = BlobConstants.ResourceTypes.CONTAINER; if (blob) { validate.validateArgs('generateSharedAccessSignature', function (v) { v.string(blob, 'blob'); }); resourceType = BlobConstants.ResourceTypes.BLOB; } if (sharedAccessPolicy.AccessPolicy) { if (!azureutil.objectIsNull(sharedAccessPolicy.AccessPolicy.Start)) { if (!_.isDate(sharedAccessPolicy.AccessPolicy.Start)) { sharedAccessPolicy.AccessPolicy.Start = new Date(sharedAccessPolicy.AccessPolicy.Start); } sharedAccessPolicy.AccessPolicy.Start = azureutil.truncatedISO8061Date(sharedAccessPolicy.AccessPolicy.Start); } if (!azureutil.objectIsNull(sharedAccessPolicy.AccessPolicy.Expiry)) { if (!_.isDate(sharedAccessPolicy.AccessPolicy.Expiry)) { sharedAccessPolicy.AccessPolicy.Expiry = new Date(sharedAccessPolicy.AccessPolicy.Expiry); } sharedAccessPolicy.AccessPolicy.Expiry = azureutil.truncatedISO8061Date(sharedAccessPolicy.AccessPolicy.Expiry); } } var resourceName = createResourceName(container, blob, true); return this.storageCredentials.generateSignedQueryString(Constants.ServiceType.Blob, resourceName, sharedAccessPolicy, null, { headers: headers, resourceType: resourceType }); }; /** * Retrieves a blob or container URL. * * @param {string} container The container name. * @param {string} [blob] The blob name. * @param {string} [sasToken] The Shared Access Signature token. * @param {boolean} [primary] A boolean representing whether to use the primary or the secondary endpoint. * @param {boolean} [snapshotId] The snapshot identifier. * @return {string} The formatted URL string. * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * var sharedAccessPolicy = { * AccessPolicy: { * Permissions: azure.BlobUtilities.SharedAccessPermissions.READ, * Start: startDate, * Expiry: expiryDate * }, * }; * * var sasToken = blobService.generateSharedAccessSignature(containerName, blobName, sharedAccessPolicy); * var sasUrl = blobService.getUrl(containerName, blobName, sasToken); */ BlobService.prototype.getUrl = function (container, blob, sasToken, primary, snapshotId) { validate.validateArgs('getUrl', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); }); var host; if (!azureutil.objectIsNull(primary) &amp;&amp; primary === false) { host = this.host.secondaryHost; } else { host = this.host.primaryHost; } host = azureutil.trimPortFromUri(host); if (host &amp;&amp; host.lastIndexOf('/') !== (host.length - 1)) { host = host + '/'; } var query = qs.parse(sasToken); if (snapshotId) { query[QueryStringConstants.SNAPSHOT] = snapshotId; } var fullPath = url.format({ pathname: this._getPath(createResourceName(container, blob)), query: query }); return url.resolve(host, fullPath); }; // Page blob methods /** * Creates a page blob of the specified length. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {int} length The length of the page blob in bytes. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {string} [options.leaseId] The target blob lease identifier. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The MD5 hash of the blob content. * @param {string} [options.sequenceNumber] The blob's sequence number. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.createPageBlob = function (container, blob, length, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createPageBlob', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.value(length, 'length'); v.callback(callback); }); if (length &amp;&amp; length % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_BLOB_LENGTH); } var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withHeader(HeaderConstants.BLOB_TYPE, BlobConstants.BlobTypes.PAGE) .withHeader(HeaderConstants.BLOB_CONTENT_LENGTH, length) .withHeader(HeaderConstants.CONTENT_LENGTH, 0) .withHeader(HeaderConstants.LEASE_ID, options.leaseId); BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Uploads a page blob from a stream. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createPageBlobFromStream = function (container, blob, stream, streamLength, optionsOrCallback, callback) { return this._createBlobFromStream(container, blob, BlobConstants.BlobTypes.PAGE, stream, streamLength, optionsOrCallback, callback); }; /** * Provides a stream to write to a page blob. Assumes that the blob exists. * If it does not, please create the blob using createPageBlob before calling this method or use createWriteStreamNewPageBlob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs and true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * blobService.createPageBlob(containerName, blobName, 1024, function (err) { * // Pipe file to a blob * var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToExistingPageBlob(containerName, blobName)); * }); */ BlobService.prototype.createWriteStreamToExistingPageBlob = function (container, blob, optionsOrCallback, callback) { return this._createWriteStreamToBlob(container, blob, BlobConstants.BlobTypes.PAGE, 0, false, optionsOrCallback, callback); }; /** * Provides a stream to write to a page blob. Creates the blob before writing data. If the blob already exists on the service, it will be overwritten. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} length The blob length. * @param {object} [options] The request options. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs and true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * blobService.createPageBlob(containerName, blobName, 1024, function (err) { * // Pipe file to a blob * var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToNewPageBlob(containerName, blobName)); * }); */ BlobService.prototype.createWriteStreamToNewPageBlob = function (container, blob, length, optionsOrCallback, callback) { return this._createWriteStreamToBlob(container, blob, BlobConstants.BlobTypes.PAGE, length, true, optionsOrCallback, callback); }; /** * Updates a page blob from a stream. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {Stream} readStream The read stream. * @param {int} rangeStart The range start. * @param {int} rangeEnd The range end. * @param {object} [options] The request options. * @param {string} [options.leaseId] The target blob lease identifier. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {string} [options.transactionalContentMD5] An optional hash value used to ensure transactional integrity for the page. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the page information. * `response` will contain information related to this operation. */ BlobService.prototype.createPagesFromStream = function (container, blob, readStream, rangeStart, rangeEnd, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createPagesFromStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); if ((rangeEnd - rangeStart) + 1 &gt; BlobConstants.MAX_UPDATE_PAGE_SIZE) { throw new RangeError(SR.INVALID_PAGE_RANGE_FOR_UPDATE); } var self = this; if (azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5) { azureutil.calculateMD5(readStream, BlobConstants.MAX_UPDATE_PAGE_SIZE, options, function (internalBuff, contentMD5) { options.transactionalContentMD5 = contentMD5; self._createPages(container, blob, internalBuff, null /* stream */, rangeStart, rangeEnd, options, callback); }); } else { self._createPages(container, blob, null /* text */, readStream, rangeStart, rangeEnd, options, callback); } }; /** * Lists page ranges. Lists all of the page ranges by default, or only the page ranges over a specific range of bytes if rangeStart and rangeEnd are specified. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {int} [options.rangeStart] The range start. * @param {int} [options.rangeEnd] The range end. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The target blob lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the page ranges information, see `[Range]{@link Range}` for detailed information. * `response` will contain information related to this operation. */ BlobService.prototype.listPageRanges = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listPageRanges', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.get(resourceName) .withQueryOption(QueryStringConstants.COMP, 'pagelist') .withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); if (options.rangeStart &amp;&amp; options.rangeStart % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_START_OFFSET); } if (options.rangeEnd &amp;&amp; (options.rangeEnd + 1) % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_END_OFFSET); } BlobResult.setHeadersFromBlob(webResource, options); options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.pageRanges = null; if (!responseObject.error) { responseObject.pageRanges = []; var pageRanges = []; if (responseObject.response.body.PageList.PageRange) { pageRanges = responseObject.response.body.PageList.PageRange; if (!_.isArray(pageRanges)) { pageRanges = [pageRanges]; } } pageRanges.forEach(function (pageRange) { var range = { start: parseInt(pageRange.Start, 10), end: parseInt(pageRange.End, 10) }; responseObject.pageRanges.push(range); }); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.pageRanges, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets page ranges that have been updated or cleared since the snapshot specified by `previousSnapshotTime` was taken. Gets all of the page ranges by default, or only the page ranges over a specific range of bytes if rangeStart and rangeEnd are specified. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} previousSnapshotTime The previous snapshot time for comparison. Must be prior to `options.snapshotId` if it's provided. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {int} [options.rangeStart] The range start. * @param {int} [options.rangeEnd] The range end. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The target blob lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the page ranges diff information, see `[RangeDiff]{@link RangeDiff}` for detailed information. * `response` will contain information related to this operation. */ BlobService.prototype.getPageRangesDiff = function (container, blob, previousSnapshotTime, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getPageRangesDiff', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.get(resourceName) .withQueryOption(QueryStringConstants.COMP, 'pagelist') .withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId) .withQueryOption(QueryStringConstants.PREV_SNAPSHOT, previousSnapshotTime); if (options.rangeStart &amp;&amp; options.rangeStart % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_START_OFFSET); } if (options.rangeEnd &amp;&amp; (options.rangeEnd + 1) % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_END_OFFSET); } if (options.rangeEnd &amp;&amp; (options.rangeEnd + 1) % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_END_OFFSET); } BlobResult.setHeadersFromBlob(webResource, options); options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.pageRangesDiff = null; if (!responseObject.error) { responseObject.pageRangesDiff = []; if (responseObject.response.body.PageList.PageRange) { var updatedPageRanges = responseObject.response.body.PageList.PageRange; if (!_.isArray(updatedPageRanges)) { updatedPageRanges = [updatedPageRanges]; } updatedPageRanges.forEach(function (pageRange) { var range = { start: parseInt(pageRange.Start, 10), end: parseInt(pageRange.End, 10), isCleared: false }; responseObject.pageRangesDiff.push(range); }); } if (responseObject.response.body.PageList.ClearRange) { var clearedPageRanges = responseObject.response.body.PageList.ClearRange; if (!_.isArray(clearedPageRanges)) { clearedPageRanges = [clearedPageRanges]; } clearedPageRanges.forEach(function (pageRange) { var range = { start: parseInt(pageRange.Start, 10), end: parseInt(pageRange.End, 10), isCleared: true }; responseObject.pageRangesDiff.push(range); }); } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.pageRangesDiff, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Clears a range of pages. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {int} rangeStart The range start. * @param {int} rangeEnd The range end. * @param {object} [options] The request options. * @param {string} [options.leaseId] The target blob lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.clearPageRange = function (container, blob, rangeStart, rangeEnd, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('clearPageRange', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var request = this._updatePageBlobPagesImpl(container, blob, rangeStart, rangeEnd, BlobConstants.PageWriteOptions.CLEAR, options); var self = this; var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; self.performRequest(request, null, options, processResponseCallback); }; /** * Resizes a page blob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {String} size The size of the page blob, in bytes. * @param {object} [options] The request options. * @param {string} [options.leaseId] The blob lease identifier. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the page information. * `response` will contain information related to this operation. */ BlobService.prototype.resizePageBlob = function (container, blob, size, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('resizePageBlob', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'properties'); if (size &amp;&amp; size % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_BLOB_LENGTH); } webResource.withHeader(HeaderConstants.BLOB_CONTENT_LENGTH, size); this._setBlobPropertiesHelper({ webResource: webResource, options: options, container: container, blob: blob, callback: callback }); }; /** * Sets the page blob's sequence number. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {SequenceNumberAction} sequenceNumberAction A value indicating the operation to perform on the sequence number. * The allowed values are defined in azure.BlobUtilities.SequenceNumberAction. * @param {string} sequenceNumber The sequence number. The value of the sequence number must be between 0 and 2^63 - 1. * Set this parameter to null if this operation is an increment action. * @param {object} [options] The request options. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the page information. * `response` will contain information related to this operation. */ BlobService.prototype.setPageBlobSequenceNumber = function (container, blob, sequenceNumberAction, sequenceNumber, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setPageBlobSequenceNumber', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); if (sequenceNumberAction === BlobUtilities.SequenceNumberAction.INCREMENT) { if (!azureutil.objectIsNull(sequenceNumber)) { throw new ArgumentError('sequenceNumber', SR.BLOB_INVALID_SEQUENCE_NUMBER); } } else { if (azureutil.objectIsNull(sequenceNumber)) { throw new ArgumentNullError('sequenceNumber', util.format(SR.ARGUMENT_NULL_OR_EMPTY, 'sequenceNumber')); } } var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'properties') .withHeader(HeaderConstants.SEQUENCE_NUMBER_ACTION, sequenceNumberAction); if (sequenceNumberAction !== BlobUtilities.SequenceNumberAction.INCREMENT) { webResource.withHeader(HeaderConstants.SEQUENCE_NUMBER, sequenceNumber); } var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; // Block blob methods /** * Uploads a block blob from a stream. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createBlockBlobFromStream = function (container, blob, stream, streamLength, optionsOrCallback, callback) { return this._createBlobFromStream(container, blob, BlobConstants.BlobTypes.BLOCK, stream, streamLength, optionsOrCallback, callback); }; /** * Uploads a block blob from a text string. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|object} text The blob text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.createBlockBlobFromText = function (container, blob, text, optionsOrCallback, callback) { return this._createBlobFromText(container, blob, BlobConstants.BlobTypes.BLOCK, text, optionsOrCallback, callback); }; /** * Provides a stream to write to a block blob. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs and true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToBlockBlob(containerName, blobName, { blockIdPrefix: 'block' })); */ BlobService.prototype.createWriteStreamToBlockBlob = function (container, blob, optionsOrCallback, callback) { return this._createWriteStreamToBlob(container, blob, BlobConstants.BlobTypes.BLOCK, 0, false, optionsOrCallback, callback); }; /** * Creates a new block to be committed as part of a blob. * * @this {BlobService} * @param {string} blockId The block identifier. * @param {string} container The container name. * @param {string} blob The blob name. * @param {Stream} readStream The read stream. * @param {int} streamLength The stream length. * @param {object} [options] The request options. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.createBlockFromStream = function (blockId, container, blob, readStream, streamLength, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createBlockFromStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.exists(readStream, 'readStream'); v.value(streamLength, 'streamLength'); v.callback(callback); }); var options = extend(true, {}, userOptions); if (streamLength &gt; BlobConstants.MAX_BLOCK_BLOB_BLOCK_SIZE) { throw new RangeError(SR.INVALID_STREAM_LENGTH); } else { this._createBlock(blockId, container, blob, null, readStream, streamLength, options, callback); } }; /** * Creates a new block to be committed as part of a blob. * * @this {BlobService} * @param {string} blockId The block identifier. * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|buffer} content The block content. * @param {object} [options] The request options. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.createBlockFromText = function (blockId, container, blob, content, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createBlockFromText', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var contentLength = (Buffer.isBuffer(content) ? content.length : Buffer.byteLength(content)); if (contentLength &gt; BlobConstants.MAX_BLOCK_BLOB_BLOCK_SIZE) { throw new RangeError(SR.INVALID_TEXT_LENGTH); } else { this._createBlock(blockId, container, blob, content, null, contentLength, options, callback); } }; /** * Creates a new block to be committed as part of a block blob. * @ignore * * @this {BlobService} * @param {string} blockId The block identifier. * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|buffer} content The block content. * @param (Stream) stream The stream to the data to store. * @param {int} length The length of the stream or text to upload. * @param {object} [options] The request options. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype._createBlock = function (blockId, container, blob, content, stream, length, options, callback) { var resourceName = createResourceName(container, blob); var self = this; var startCreateBlock = function () { var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'block') .withQueryOption(QueryStringConstants.BLOCK_ID, new Buffer(blockId).toString('base64')) .withHeader(HeaderConstants.CONTENT_LENGTH, length); BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; if (!azureutil.objectIsNull(content)) { self.performRequest(webResource, content, options, processResponseCallback); } else { self.performRequestOutputStream(webResource, stream, options, processResponseCallback); } }; if (azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5) { if (!azureutil.objectIsNull(content)) { options.transactionalContentMD5 = azureutil.getContentMd5(content); startCreateBlock(); } else { azureutil.calculateMD5(stream, length, options, function (internalBuff, contentMD5) { options.transactionalContentMD5 = contentMD5; content = internalBuff; length = internalBuff.length; startCreateBlock(); }); } } else { startCreateBlock(); } }; /** * Writes a blob by specifying the list of block IDs that make up the blob. * In order to be written as part of a blob, a block must have been successfully written to the server in a prior * createBlock operation. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} blockList The block identifiers. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {string} [options.leaseId] The target blob lease identifier. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.commitBlocks = function (container, blob, blockList, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('commitBlocks', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var blockListXml = BlockListResult.serialize(blockList); var resourceName = createResourceName(container, blob); var options = extend(true, {}, userOptions); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'blocklist') .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(blockListXml)) .withBody(blockListXml); BlobResult.setPropertiesFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.list = null; if (!responseObject.error) { responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); responseObject.blobResult.list = blockList; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Retrieves the list of blocks that have been uploaded as part of a block blob. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlockListFilter} blocklisttype The type of block list to retrieve. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The source blob snapshot identifier. * @param {string} [options.leaseId] The target blob lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the blocklist information. * `response` will contain information related to this operation. */ BlobService.prototype.listBlocks = function (container, blob, blocklisttype, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listBlocks', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var resourceName = createResourceName(container, blob); var options = extend(true, {}, userOptions); var webResource = WebResource.get(resourceName) .withQueryOption(QueryStringConstants.COMP, 'blocklist') .withQueryOption(QueryStringConstants.BLOCK_LIST_TYPE, blocklisttype) .withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.blockListResult = null; if (!responseObject.error) { responseObject.blockListResult = BlockListResult.parse(responseObject.response.body.BlockList); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blockListResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Generate a random block id prefix */ BlobService.prototype.generateBlockIdPrefix = function () { var prefix = Math.floor(Math.random() * 0x100000000).toString(16); return azureutil.zeroPaddingString(prefix, 8); }; /** * Get a block id according to prefix and block number */ BlobService.prototype.getBlockId = function (prefix, number) { return prefix + '-' + azureutil.zeroPaddingString(number, 6); }; // Append blob methods /** * Creates an empty append blob. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {string} [options.leaseId] The target blob lease identifier. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.createOrReplaceAppendBlob = function (container, blob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createOrReplaceAppendBlob', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withHeader(HeaderConstants.BLOB_TYPE, BlobConstants.BlobTypes.APPEND) .withHeader(HeaderConstants.LEASE_ID, options.leaseId) .withHeader(HeaderConstants.CONTENT_LENGTH, 0); BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Uploads an append blob from a stream. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * If you want to append data to an already existing blob, please look at appendFromStream. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createAppendBlobFromStream = function (container, blob, stream, streamLength, optionsOrCallback, callback) { return this._createBlobFromStream(container, blob, BlobConstants.BlobTypes.APPEND, stream, streamLength, optionsOrCallback, callback); }; /** * Uploads an append blob from a text string. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * If you want to append data to an already existing blob, please look at appendFromText. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|object} text The blob text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.createAppendBlobFromText = function (container, blob, text, optionsOrCallback, callback) { return this._createBlobFromText(container, blob, BlobConstants.BlobTypes.APPEND, text, optionsOrCallback, callback); }; /** * Provides a stream to write to a new append blob. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs and true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback The callback function. * @return {Stream} * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToAppendBlob(containerName, blobName)); */ BlobService.prototype.createWriteStreamToNewAppendBlob = function (container, blob, optionsOrCallback, callback) { return this._createWriteStreamToBlob(container, blob, BlobConstants.BlobTypes.APPEND, 0, true, optionsOrCallback, callback); }; /** * Provides a stream to write to an existing append blob. Assumes that the blob exists. * If it does not, please create the blob using createAppendBlob before calling this method or use createWriteStreamToNewAppendBlob. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs and true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback The callback function. * @return {Stream} * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToAppendBlob(containerName, blobName)); */ BlobService.prototype.createWriteStreamToExistingAppendBlob = function (container, blob, optionsOrCallback, callback) { return this._createWriteStreamToBlob(container, blob, BlobConstants.BlobTypes.APPEND, 0, false, optionsOrCallback, callback); }; /** * Appends to an append blob from a stream. Assumes the blob already exists on the service. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.appendFromStream = function (container, blob, stream, streamLength, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); validate.validateArgs('appendFromStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.exists(stream, 'stream'); v.value(streamLength, 'streamLength'); v.callback(callback); }); return this._uploadBlobFromStream(false, container, blob, BlobConstants.BlobTypes.APPEND, stream, streamLength, options, callback); }; /** * Appends to an append blob from a text string. Assumes the blob already exists on the service. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|object} text The blob text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.appendFromText = function (container, blob, text, optionsOrCallback, callback) { return this._uploadBlobFromText(false, container, blob, BlobConstants.BlobTypes.APPEND, text, optionsOrCallback, callback); }; /** * Creates a new block from a read stream to be appended to an append blob. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {Stream} readStream The read stream. * @param {int} streamLength The stream length. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {int} [options.maxBlobSize] The max length in bytes allowed for the append blob to grow to. * @param {int} [options.appendPosition] The number indicating the byte offset to check for. The append will succeed only if the end position of the blob is equal to this number. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype.appendBlockFromStream = function (container, blob, readStream, streamLength, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('appendBlockFromStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.exists(readStream, 'readStream'); v.value(streamLength, 'streamLength'); v.callback(callback); }); var options = extend(true, {}, userOptions); if (streamLength &gt; BlobConstants.MAX_APPEND_BLOB_BLOCK_SIZE) { throw new RangeError(SR.INVALID_STREAM_LENGTH); } else { this._appendBlock(container, blob, null, readStream, streamLength, options, callback); } }; /** * Creates a new block from a text to be appended to an append blob. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|object} content The block text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {int} [options.maxBlobSize] The max length in bytes allowed for the append blob to grow to. * @param {int} [options.appendPosition] The number indicating the byte offset to check for. The append will succeed only if the end position of the blob is equal to this number. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype.appendBlockFromText = function (container, blob, content, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('appendBlockFromText', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var contentLength = (Buffer.isBuffer(content) ? content.length : Buffer.byteLength(content)); if (contentLength &gt; BlobConstants.MAX_APPEND_BLOB_BLOCK_SIZE) { throw new RangeError(SR.INVALID_TEXT_LENGTH); } else { this._appendBlock(container, blob, content, null, contentLength, options, callback); } }; // Private methods /** * Creates a new blob from a stream. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The upload tracker objects. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback The callback function. * @return {SpeedSummary} */ BlobService.prototype._createBlobFromStream = function (container, blob, blobType, stream, streamLength, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_createBlobFromStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.blobTypeIsValid(blobType); v.exists(stream, 'stream'); v.value(streamLength, 'streamLength'); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; var creationCallback = function (createError, createBlob, createResponse) { if (createError) { callback(createError, createBlob, createResponse); } else { self._uploadBlobFromStream(true, container, blob, blobType, stream, streamLength, options, callback); } }; this._createBlob(container, blob, blobType, streamLength, options, creationCallback); return options.speedSummary; }; /** * Uploads a block blob or an append blob from a text string. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param {string|buffer} content The blob text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * information about the blob. * `response` will contain information related to this operation. */ BlobService.prototype._createBlobFromText = function (container, blob, blobType, content, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_createBlobFromText', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.blobTypeIsValid(blobType); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; var creationCallback = function (createError, createBlob, createResponse) { if (createError) { callback(createError, createBlob, createResponse); } else { self._uploadBlobFromText(true, container, blob, blobType, content, options, callback); } }; var contentLength = azureutil.objectIsNull(content) ? 0 : ((Buffer.isBuffer(content) ? content.length : Buffer.byteLength(content))); this._createBlob(container, blob, blobType, contentLength, options, creationCallback); return options.speedSummary; }; /** * Provides a stream to write to a block blob or an append blob. * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param {int} length The blob length. * @param {bool} createNewBlob Specifies whether create a new blob. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {string} [options.blockSize] The size of each block. Maximum is 100MB. (For block blob only) * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs and true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback The callback function. * @return {Stream} */ BlobService.prototype._createWriteStreamToBlob = function (container, blob, blobType, length, createNewBlob, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_createWriteStreamToBlob', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.blobTypeIsValid(blobType); }); var options = extend(true, {}, userOptions); var sizeLimitation; if (blobType === BlobConstants.BlobTypes.BLOCK) { // default to true, unless explicitly set to false options.storeBlobContentMD5 = options.storeBlobContentMD5 === false ? false : true; sizeLimitation = options.blockSize || BlobConstants.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES; } else if (blobType == BlobConstants.BlobTypes.PAGE) { sizeLimitation = BlobConstants.DEFAULT_WRITE_PAGE_SIZE_IN_BYTES; } else if (blobType == BlobConstants.BlobTypes.APPEND) { sizeLimitation = BlobConstants.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES; } var stream = new ChunkStream({ calcContentMd5: options.storeBlobContentMD5 }); stream._highWaterMark = sizeLimitation; stream.pause(); //Immediately pause the stream in order to wait for the destination to getting ready var self = this; var createCallback = function (createError, createBlob, createResponse) { if (createError) { if (callback) { callback(createError, createBlob, createResponse); } } else { self._uploadBlobFromStream(createNewBlob, container, blob, blobType, stream, null, options, function (error, blob, response) { if (error) { stream.emit('error', error); } if (callback) { callback(error, blob, response); } }); } }; if (createNewBlob === true) { this._createBlob(container, blob, blobType, length, options, createCallback); } else { createCallback(); } return stream; }; /** * Upload blob content from a stream. Assumes the blob already exists. * * @ignore * * @this {BlobService} * @param {bool} isNewBlob Specifies whether the blob is newly created. * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The upload tracker objects. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback The callback function. * @return {SpeedSummary} */ BlobService.prototype._uploadBlobFromStream = function (isNewBlob, container, blob, blobType, stream, streamLength, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); options.speedSummary = options.speedSummary || new SpeedSummary(blob); if (blobType === BlobConstants.BlobTypes.BLOCK) { // default to true, unless explicitly set to false options.storeBlobContentMD5 = options.storeBlobContentMD5 === false ? false : true; } stream.pause(); var self = this; var startUpload = function () { var putBlockBlobFromStream = function () { if (streamLength &gt; 0 &amp;&amp; azureutil.objectIsNull(azureutil.tryGetValueChain(options, ['contentSettings', 'contentMD5'], null)) &amp;&amp; options.storeBlobContentMD5) { azureutil.calculateMD5(stream, Math.min(self.singleBlobPutThresholdInBytes, streamLength), options, function (internalBuff, contentMD5) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], contentMD5); self._putBlockBlob(container, blob, internalBuff, null, internalBuff.length, options, callback); }); stream.resume(); } else { // Stream will resume when it has a pipe destination or a 'data' listener self._putBlockBlob(container, blob, null, stream, streamLength, options, callback); } }; if (streamLength === null || streamLength &gt;= self.singleBlobPutThresholdInBytes || blobType !== BlobConstants.BlobTypes.BLOCK) { var chunkStream = new ChunkStreamWithStream(stream, { calcContentMd5: options.storeBlobContentMD5 }); self._uploadContentFromChunkStream(container, blob, blobType, chunkStream, streamLength, options, callback); } else { putBlockBlobFromStream(); } }; if (!isNewBlob) { if (options.storeBlobContentMD5 &amp;&amp; blobType !== BlobConstants.BlobTypes.BLOCK) { throw new Error(SR.MD5_NOT_POSSIBLE); } if (blobType === BlobConstants.BlobTypes.APPEND || options.accessConditions) { // Do a getBlobProperties right at the beginning for existing blobs and use the user passed in access conditions. // So any pre-condition failure on the first block (in a strictly single writer scenario) is caught. // This call also helps us get the append position to append to if the user hasn’t specified an access condition. this.getBlobProperties(container, blob, options, function (error, properties, response) { if (error &amp;&amp; !(options.accessConditions &amp;&amp; options.accessConditions.EtagNonMatch === '*' &amp;&amp; response.statusCode === 400)) { callback(error); } else { if (blobType === BlobConstants.BlobTypes.APPEND) { options.appendPosition = properties.contentLength; } startUpload(); } }); } else { startUpload(); } } else { startUpload(); } return options.speedSummary; }; /** * Upload blob content from a text. Assumes the blob already exists. * * @ignore * * @this {BlobService} * @param {bool} isNewBlob Specifies whether the blob is newly created. * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param (string) content The blob text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The upload tracker objects. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback The callback function. * @return {SpeedSummary} */ BlobService.prototype._uploadBlobFromText = function (isNewBlob, container, blob, blobType, content, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); options.speedSummary = options.speedSummary || new SpeedSummary(blob); options[HeaderConstants.CONTENT_TYPE] = (options.contentSettings &amp;&amp; options.contentSettings.contentType) || 'text/plain;charset=&quot;utf-8&quot;'; var self = this; var startUpload = function () { var operationFunc; var length = azureutil.objectIsNull(content) ? 0 : (Buffer.isBuffer(content) ? content.length : Buffer.byteLength(content)); if (blobType === BlobConstants.BlobTypes.BLOCK) { // default to true, unless explicitly set to false options.storeBlobContentMD5 = options.storeBlobContentMD5 === false ? false : true; operationFunc = self._putBlockBlob; if (length &gt; BlobConstants.MAX_SINGLE_UPLOAD_BLOB_SIZE_IN_BYTES) { throw new RangeError(SR.INVALID_BLOB_LENGTH); } } else if (blobType === BlobConstants.BlobTypes.APPEND) { operationFunc = self._appendBlock; if (length &gt; BlobConstants.MAX_APPEND_BLOB_BLOCK_SIZE) { throw new RangeError(SR.INVALID_TEXT_LENGTH); } } var finalCallback = function (error, blobResult, response) { if (blobType !== BlobConstants.BlobTypes.BLOCK) { self.setBlobProperties(container, blob, options.contentSettings, function (error, blob, response) { blob = extend(false, blob, blobResult); callback(error, blob, response); }); } else { callback(error, blobResult, response); } }; operationFunc.call(self, container, blob, content, null, length, options, finalCallback); }; if (!isNewBlob) { if (options.storeBlobContentMD5 &amp;&amp; blobType !== BlobConstants.BlobTypes.BLOCK) { throw new Error(SR.MD5_NOT_POSSIBLE); } if (blobType === BlobConstants.BlobTypes.APPEND || options.accessConditions) { // Do a getBlobProperties right at the beginning for existing blobs and use the user passed in access conditions. // So any pre-condition failure on the first block (in a strictly single writer scenario) is caught. // This call also helps us get the append position to append to if the user hasn’t specified an access condition. this.getBlobProperties(container, blob, options, function (error, properties) { if (error) { callback(error); } else { if (blobType === BlobConstants.BlobTypes.APPEND) { options.appendPosition = properties.contentLength; } startUpload(); } }); } } else { if (!azureutil.objectIsNull(content) &amp;&amp; azureutil.objectIsNull(azureutil.tryGetValueChain(options, ['contentSettings', 'contentMD5'], null)) &amp;&amp; options.storeBlobContentMD5) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], azureutil.getContentMd5(content)); } startUpload(); } }; /** * Uploads a block blob from a stream. * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} text The blob text. * @param (Stream) stream Stream to the data to store. * @param {int} length The length of the stream or text to upload. * @param {object} [options] The request options. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * information about the blob. * `response` will contain information related to this operation. */ BlobService.prototype._putBlockBlob = function (container, blob, text, stream, length, options, callback) { if (!options.speedSummary) { options.speedSummary = new SpeedSummary(blob); } var speedSummary = options.speedSummary; speedSummary.totalSize = length; var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withHeader(HeaderConstants.CONTENT_TYPE, 'application/octet-stream') .withHeader(HeaderConstants.BLOB_TYPE, BlobConstants.BlobTypes.BLOCK) .withHeader(HeaderConstants.CONTENT_LENGTH, length); if (!azureutil.objectIsNull(text) &amp;&amp; azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5) { options.transactionalContentMD5 = azureutil.getContentMd5(text); } BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); if (options.metadata) { responseObject.blobResult.metadata = options.metadata; } } var finalCallback = function (returnObject) { if (!returnObject || !returnObject.error) { speedSummary.increment(length); } callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; if (!azureutil.objectIsNull(text)) { this.performRequest(webResource, text, options, processResponseCallback); } else { this.performRequestOutputStream(webResource, stream, options, processResponseCallback); } return options.speedSummary; }; /** * Appends a new block to an append blob. * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string|buffer} content The block content. * @param (Stream) stream The stream to the data to store. * @param {int} length The length of the stream or content to upload. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {int} [options.maxBlobSize] The max length in bytes allowed for the append blob to grow to. * @param {int} [options.appendPosition] The number indicating the byte offset to check for. The append will succeed only if the end position of the blob is equal to this number. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] The blob’s MD5 hash. This hash is used to verify the integrity of the blob during transport. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ BlobService.prototype._appendBlock = function (container, blob, content, stream, length, options, callback) { var speedSummary = options.speedSummary || new SpeedSummary(blob); speedSummary.totalSize = length; var self = this; var startAppendBlock = function () { var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'appendblock') .withHeader(HeaderConstants.CONTENT_LENGTH, length) .withHeader(HeaderConstants.BLOB_CONDITION_MAX_SIZE, options.maxBlobSize) .withHeader(HeaderConstants.BLOB_CONDITION_APPEND_POSITION, options.appendPosition); BlobResult.setHeadersFromBlob(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { if (!returnObject || !returnObject.error) { speedSummary.increment(length); } callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; if (!azureutil.objectIsNull(content)) { self.performRequest(webResource, content, options, processResponseCallback); } else { self.performRequestOutputStream(webResource, stream, options, processResponseCallback); } }; if (azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5) { if (!azureutil.objectIsNull(content)) { options.transactionalContentMD5 = azureutil.getContentMd5(content); startAppendBlock(); } else { azureutil.calculateMD5(stream, length, options, function (internalBuff, contentMD5) { options.transactionalContentMD5 = contentMD5; content = internalBuff; length = internalBuff.length; startAppendBlock(); }); } } else { startAppendBlock(); } return options.speedSummary; }; /** * Creates and dispatches lease requests. * @ignore * * @this {BlobService} * @param {object} webResource The web resource. * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} leaseId The lease identifier. Required to renew, change or release the lease. * @param {string} leaseAction The lease action (BlobConstants.LeaseOperation.*). Required. * @param {object} userOptions The request options. * @param {int} [userOptions.leaseBreakPeriod] The lease break period. * @param {string} [userOptions.leaseDuration] The lease duration. Default is never to expire. * @param {string} [userOptions.proposedLeaseId] The proposed lease identifier. This is required for the CHANGE lease action. * @param {LocationMode} [userOptions.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {int} [userOptions.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [userOptions.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, lease, response)} callback `error` will contain information * if an error occurs; otherwise `lease` will contain * the lease information. * `response` will contain information related to this operation. */ BlobService.prototype._leaseImpl = function (container, blob, leaseId, leaseAction, options, callback) { var webResource; if (!azureutil.objectIsNull(blob)) { validate.validateArgs('_leaseImpl', function (v) { v.string(blob, 'blob'); }); var resourceName = createResourceName(container, blob); webResource = WebResource.put(resourceName); } else { webResource = WebResource.put(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container'); } webResource.withQueryOption(QueryStringConstants.COMP, 'lease') .withHeader(HeaderConstants.LEASE_ID, leaseId) .withHeader(HeaderConstants.LEASE_ACTION, leaseAction.toLowerCase()) .withHeader(HeaderConstants.LEASE_BREAK_PERIOD, options.leaseBreakPeriod) .withHeader(HeaderConstants.PROPOSED_LEASE_ID, options.proposedLeaseId) .withHeader(HeaderConstants.LEASE_DURATION, options.leaseDuration); var processResponseCallback = function (responseObject, next) { responseObject.leaseResult = null; if (!responseObject.error) { responseObject.leaseResult = new LeaseResult(container, blob); responseObject.leaseResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.leaseResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Updates a page blob from text. * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} text The text string. * @param {Stream} readStream The read stream. * @param {int} rangeStart The range start. * @param {int} rangeEnd The range end. * @param {object} [options] The request options. * @param {string} [options.leaseId] The target blob lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the page content. This hash is used to verify the integrity of the page during transport. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, pageBlob, response)} callback `error` will contain information * if an error occurs; otherwise `pageBlob` will contain * the blob information. * `response` will contain information related to this operation. */ BlobService.prototype._createPages = function (container, blob, text, readStream, rangeStart, rangeEnd, options, callback) { var request = this._updatePageBlobPagesImpl(container, blob, rangeStart, rangeEnd, BlobConstants.PageWriteOptions.UPDATE, options); // At this point, we have already validated that the range is less than 4MB. Therefore, we just need to calculate the contentMD5 if required. // Even when this is called from the createPagesFromStream method, it is pre-buffered and called with text. if (!azureutil.objectIsNull(text) &amp;&amp; azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5) { request.withHeader(HeaderConstants.CONTENT_MD5, azureutil.getContentMd5(text)); } var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; if (!azureutil.objectIsNull(text)) { this.performRequest(request, text, options, processResponseCallback); } else { this.performRequestOutputStream(request, readStream, options, processResponseCallback); } }; /** * @ignore */ BlobService.prototype._updatePageBlobPagesImpl = function (container, blob, rangeStart, rangeEnd, writeMethod, options) { if (rangeStart &amp;&amp; rangeStart % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_START_OFFSET); } if (rangeEnd &amp;&amp; (rangeEnd + 1) % BlobConstants.PAGE_SIZE !== 0) { throw new RangeError(SR.INVALID_PAGE_END_OFFSET); } // this is necessary if this is called from _uploadContentFromChunkStream-&gt;_createPages if (!options) { options = {}; } options.rangeStart = rangeStart; options.rangeEnd = rangeEnd; options.contentLength = writeMethod === BlobConstants.PageWriteOptions.UPDATE ? (rangeEnd - rangeStart) + 1 : 0; var resourceName = createResourceName(container, blob); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'page') .withHeader(HeaderConstants.CONTENT_TYPE, 'application/octet-stream') .withHeader(HeaderConstants.PAGE_WRITE, writeMethod); BlobResult.setHeadersFromBlob(webResource, options); return webResource; }; /** * Uploads blob content from a stream. * For block blob, it creates a new block to be committed. * For page blob, it writes a range of pages. * For append blob, it appends a new block. * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} blobType The blob type. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object|function} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {int} [options.maxBlobSize] The max length in bytes allowed for the append blob to grow to. * @param {int} [options.appendPosition] The number indicating the byte offset to check for. The append will succeed only if the end position of the blob is equal to this number. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {function(error, null)} callback The callback function. * @return {SpeedSummary} */ BlobService.prototype._uploadContentFromChunkStream = function (container, blob, blobType, chunkStream, streamLength, options, callback) { this.logger.debug(util.format('_uploadContentFromChunkStream for blob %s', blob)); var apiName; var isBlockBlobUpload; var isPageBlobUpload; var isAppendBlobUpload; var sizeLimitation; var originalContentMD5 = azureutil.tryGetValueChain(options, ['contentSettings', 'contentMD5'], null); var parallelOperationThreadCount = options.parallelOperationThreadCount || this.parallelOperationThreadCount; if (blobType == BlobConstants.BlobTypes.BLOCK) { apiName = 'createBlockFromText'; isBlockBlobUpload = true; // BlockBlob can only have 50000 blocks in maximum var minBlockSize = Math.ceil(streamLength / 50000); if (options.blockSize) { if (options.blockSize &lt; minBlockSize) { // options.blockSize is less than the minBlockSize, error callback var error = new ArgumentError('options.blockSize', util.format('The minimum blockSize is %s and the provided blockSize %s is too small.', minBlockSize, options.blockSize)); callback(error); return; } else { sizeLimitation = options.blockSize; } } else { // 4MB minimum for auto-calculated block size sizeLimitation = Math.max(minBlockSize, BlobConstants.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES); } } else if (blobType == BlobConstants.BlobTypes.PAGE) { apiName = '_createPages'; isPageBlobUpload = true; sizeLimitation = BlobConstants.DEFAULT_WRITE_PAGE_SIZE_IN_BYTES; } else if (blobType == BlobConstants.BlobTypes.APPEND) { apiName = 'appendBlockFromText'; isAppendBlobUpload = true; parallelOperationThreadCount = 1; sizeLimitation = BlobConstants.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES; } else { var error = new ArgumentError('blobType', util.format('Unknown blob type %s', blobType)); callback(error); return; } chunkStream._highWaterMark = sizeLimitation; this._setOperationExpiryTime(options); // initialize the speed summary var speedSummary = options.speedSummary || new SpeedSummary(blob); speedSummary.totalSize = streamLength; // initialize chunk allocator var allocator = new ChunkAllocator(sizeLimitation, parallelOperationThreadCount, { logger: this.logger }); chunkStream.setMemoryAllocator(allocator); chunkStream.setOutputLength(streamLength); // if this is a FileReadStream, set the allocator on that stream if (chunkStream._stream &amp;&amp; chunkStream._stream.setMemoryAllocator) { var fileReadStreamAllocator = new ChunkAllocator(chunkStream._stream._highWaterMark, parallelOperationThreadCount, { logger: this.logger }); chunkStream._stream.setMemoryAllocator(fileReadStreamAllocator); } // initialize batch operations var batchOperations = new BatchOperation(apiName, { callInOrder: isAppendBlobUpload, callbackInOrder: isAppendBlobUpload, logger: this.logger, enableReuseSocket: this.defaultEnableReuseSocket, operationMemoryUsage: sizeLimitation }); batchOperations.setConcurrency(parallelOperationThreadCount); // initialize options var rangeOptions = { leaseId: options.leaseId, timeoutIntervalInMs: options.timeoutIntervalInMs, clientRequestTimeoutInMs: options.clientRequestTimeoutInMs, operationExpiryTime: options.operationExpiryTime, maxBlobSize: options.maxBlobSize, appendPosition: options.appendPosition || 0, initialAppendPosition: options.appendPosition || 0, absorbConditionalErrorsOnRetry: options.absorbConditionalErrorsOnRetry }; // initialize block blob variables var blockIdPrefix = options.blockIdPrefix || this.generateBlockIdPrefix(); var blockCount = 0; var blockIds = []; var blobResult = {}; var self = this; chunkStream.on('data', function (data, range) { var operation = null; var full = false; var autoIncrement = speedSummary.getAutoIncrementFunction(data.length); if (data.length &gt; sizeLimitation) { throw new RangeError(util.format(SR.EXCEEDED_SIZE_LIMITATION, sizeLimitation, data.length)); } if (options.useTransactionalMD5) { //calculate content md5 for the current uploading block data var contentMD5 = azureutil.getContentMd5(data); rangeOptions.transactionalContentMD5 = contentMD5; } var checkLengthLimit = function () { if (!streamLength) return true; if (range.start &gt;= streamLength) { self.logger.debug(util.format('Stop uploading data from %s bytes to %s bytes to blob %s because of limit %s', range.start, range.end, blob, streamLength)); chunkStream.stop(); return false; } else if (range.end &gt;= streamLength) { self.logger.debug(util.format('Clip uploading data from %s bytes to %s bytes to blob %s because of limit %s', range.start, range.end, blob, streamLength)); range.end = streamLength - 1; data = data.slice(0, streamLength - range.start); if (options.useTransactionalMD5) { rangeOptions.transactionalContentMD5 = azureutil.getContentMd5(data); } } return true; }; var uploadBlockBlobChunk = function () { if (!checkLengthLimit()) return; var blockId = self.getBlockId(blockIdPrefix, blockCount); blockIds.push(blockId); operation = new BatchOperation.RestOperation(self, apiName, blockId, container, blob, data, rangeOptions, function (error) { if (!error) { autoIncrement(); } else { self.logger.debug(util.format('Stop uploading data as error happens. Error: %s', util.inspect(error))); chunkStream.stop(); } allocator.releaseBuffer(data); data = null; }); blockCount++; }; var uploadPageBlobChunk = function () { if (!checkLengthLimit()) return; if (azureutil.isBufferAllZero(data)) { self.logger.debug(util.format('Skip upload data from %s bytes to %s bytes to blob %s', range.start, range.end, blob)); speedSummary.increment(data.length); } else { self.logger.debug(util.format('Upload data from %s bytes to %s bytes to blob %s', range.start, range.end, blob)); operation = new BatchOperation.RestOperation(self, apiName, container, blob, data, null, range.start, range.end, rangeOptions, function (error) { if (!error) { autoIncrement(); } else { self.logger.debug(util.format('Stop uploading data as error happens. Error: %s', util.inspect(error))); chunkStream.stop(); } allocator.releaseBuffer(data); data = null; }); } }; var uploadAppendBlobChunk = function () { if (!checkLengthLimit()) return; rangeOptions.appendPosition = Number(rangeOptions.initialAppendPosition) + Number(range.start); // We cannot differentiate between max size condition failing only in the retry versus failing in the first attempt and retry. // So we will eliminate the latter and handle the former in the append operation callback. if (options.maxBlobSize &amp;&amp; rangeOptions.appendPosition + data.length &gt; options.maxBlobSize) { throw new Error(SR.MAX_BLOB_SIZE_CONDITION_NOT_MEET); } operation = new BatchOperation.RestOperation(self, apiName, container, blob, data, rangeOptions, function (error, currentBlob) { if (!error) { autoIncrement(); } else { self.logger.debug(util.format('Stop uploading data as error happens. Error: %s', util.inspect(error))); chunkStream.stop(); } blobResult = currentBlob; allocator.releaseBuffer(data); data = null; }); }; if (isBlockBlobUpload) { uploadBlockBlobChunk(); } else if (isAppendBlobUpload) { uploadAppendBlobChunk(); } else if (isPageBlobUpload) { uploadPageBlobChunk(); } if (operation) { full = batchOperations.addOperation(operation); operation = null; if (full) { self.logger.debug('File stream paused'); chunkStream.pause(); } } }); chunkStream.on('end', function () { self.logger.debug(util.format('File read stream ended for blob %s', blob)); batchOperations.enableComplete(); }); batchOperations.on('drain', function () { self.logger.debug('file stream resume'); chunkStream.resume(); }); batchOperations.on('end', function (error) { self.logger.debug('batch operations commited'); speedSummary = null; if (error) { callback(error); return; } if (originalContentMD5) { options.contentSettings.contentMD5 = originalContentMD5; } else if (options.storeBlobContentMD5) { var contentMD5 = chunkStream.getContentMd5('base64'); azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], contentMD5); } if (isBlockBlobUpload) { //commit block list var blockList = { 'UncommittedBlocks': blockIds }; self.commitBlocks(container, blob, blockList, options, function (error, blockList, response) { self.logger.debug(util.format('Blob %s committed', blob)); if (error) { chunkStream.finish(); callback(error); } else { blobResult['commmittedBlocks'] = blockIds; chunkStream.finish(); callback(error, blobResult, response); } }); } else { // upload page blob or append blob completely var blobProperties = options.contentSettings; self.setBlobProperties(container, blob, blobProperties, function (error, blob, response) { chunkStream.finish(); blob = extend(false, blob, blobResult); callback(error, blob, response); }); } }); return speedSummary; }; /** * Checks whether or not a container exists on the service. * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {string} [options.leaseId] The lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the container information including `exists` boolean member. * `response` will contain information related to this operation. */ BlobService.prototype._doesContainerExist = function (container, primaryOnly, options, callback) { var webResource = WebResource.head(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withHeader(HeaderConstants.LEASE_ID, options.leaseId); if (primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; } var processResponseCallback = function (responseObject, next) { responseObject.containerResult = new ContainerResult(container); if (!responseObject.error) { responseObject.containerResult.exists = true; responseObject.containerResult.getPropertiesFromHeaders(responseObject.response.headers); } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.containerResult.exists = false; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.containerResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks whether or not a blob exists on the service. * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the blob information including `exists` boolean member. * `response` will contain information related to this operation. */ BlobService.prototype._doesBlobExist = function (container, blob, primaryOnly, options, callback) { var resourceName = createResourceName(container, blob); var webResource = WebResource.head(resourceName) .withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId) .withHeader(HeaderConstants.LEASE_ID, options.leaseId); if (primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; } var processResponseCallback = function (responseObject, next) { responseObject.blobResult = new BlobResult(container, blob); if (!responseObject.error) { responseObject.blobResult.exists = true; responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.blobResult.exists = false; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * @ignore */ BlobService.prototype._setBlobPropertiesHelper = function (settings) { var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(settings.container, settings.blob); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { settings.callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(settings.webResource, null, settings.options, processResponseCallback); }; /** * @ignore */ BlobService.prototype._validateLengthAndMD5 = function (options, responseObject) { var storedMD5 = responseObject.response.headers[Constants.HeaderConstants.CONTENT_MD5]; var contentLength; if (!azureutil.objectIsNull(responseObject.response.headers[Constants.HeaderConstants.CONTENT_LENGTH])) { contentLength = parseInt(responseObject.response.headers[Constants.HeaderConstants.CONTENT_LENGTH], 10); } // If the user has not specified this option, the default value should be false. if (azureutil.objectIsNull(options.disableContentMD5Validation)) { options.disableContentMD5Validation = false; } // None of the below cases should be retried. So set the error in every case so the retry policy filter handle knows that it shouldn't be retried. if (options.disableContentMD5Validation === false &amp;&amp; options.useTransactionalMD5 === true &amp;&amp; azureutil.objectIsNull(storedMD5)) { responseObject.error = new StorageError(SR.MD5_NOT_PRESENT_ERROR); responseObject.retryable = false; } // Validate length and if required, MD5. // If getBlobToText called this method, then the responseObject.length and responseObject.contentMD5 are not set. Calculate them first using responseObject.response.body and then validate. if (azureutil.objectIsNull(responseObject.length)) { if (typeof responseObject.response.body == 'string') { responseObject.length = Buffer.byteLength(responseObject.response.body); } else if (Buffer.isBuffer(responseObject.response.body)) { responseObject.length = responseObject.response.body.length; } } if (!azureutil.objectIsNull(contentLength) &amp;&amp; responseObject.length !== contentLength) { responseObject.error = new Error(SR.CONTENT_LENGTH_MISMATCH); responseObject.retryable = false; } if (options.disableContentMD5Validation === false &amp;&amp; azureutil.objectIsNull(responseObject.contentMD5)) { responseObject.contentMD5 = azureutil.getContentMd5(responseObject.response.body); } if (options.disableContentMD5Validation === false &amp;&amp; !azureutil.objectIsNull(storedMD5) &amp;&amp; storedMD5 !== responseObject.contentMD5) { responseObject.error = new Error(util.format(SR.HASH_MISMATCH, storedMD5, responseObject.contentMD5)); responseObject.retryable = false; } }; /** * @ignore */ BlobService.prototype._setRangeContentMD5Header = function (webResource, options) { if (!azureutil.objectIsNull(options.rangeStart) &amp;&amp; options.useTransactionalMD5) { if (azureutil.objectIsNull(options.rangeEnd)) { throw new ArgumentNullError('options.rangeEndHeader', util.format(SR.ARGUMENT_NULL_OR_EMPTY, options.rangeEndHeader)); } var size = parseInt(options.rangeEnd, 10) - parseInt(options.rangeStart, 10) + 1; if (size &gt; BlobConstants.MAX_RANGE_GET_SIZE_WITH_MD5) { throw new ArgumentError('options', SR.INVALID_RANGE_FOR_MD5); } else { webResource.withHeader(HeaderConstants.RANGE_GET_CONTENT_MD5, 'true'); } } }; /** * Downloads a blockblob, pageblob or appendblob into a range stream. * @ignore * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} blobType The type of blob to download: block blob, page blob or append blob. * @param {Stream} writeStream The write stream. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype._getBlobToRangeStream = function (container, blob, blobType, writeStream, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); validate.validateArgs('_getBlobToRangeStream', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.blobNameIsValid(container, blob); v.blobTypeIsValid(blobType); v.callback(callback); }); var rangeStream = null; var isPageBlobDownload = true; if (blobType == BlobConstants.BlobTypes.PAGE) { rangeStream = new PageRangeStream(this, container, blob, options); } else if (blobType == BlobConstants.BlobTypes.APPEND) { rangeStream = new RangeStream(this, container, blob, options); isPageBlobDownload = false; } else if (blobType == BlobConstants.BlobTypes.BLOCK) { rangeStream = new BlockRangeStream(this, container, blob, options); isPageBlobDownload = false; } if (!options.speedSummary) { options.speedSummary = new SpeedSummary(blob); } var speedSummary = options.speedSummary; var parallelOperationThreadCount = options.parallelOperationThreadCount || this.parallelOperationThreadCount; var batchOperations = new BatchOperation('getBlobInRanges', { callbackInOrder: true, logger: this.logger, enableReuseSocket: this.defaultEnableReuseSocket }); batchOperations.setConcurrency(parallelOperationThreadCount); var self = this; var checkMD5sum = !options.disableContentMD5Validation; var md5Hash = null; if (checkMD5sum) { md5Hash = new Md5Wrapper().createMd5Hash(); } var savedBlobResult = null; var savedBlobResponse = null; rangeStream.on('range', function (range) { if (!speedSummary.totalSize) { speedSummary.totalSize = rangeStream.rangeSize; } var requestOptions = { rangeStart: range.start, rangeEnd: range.end, responseEncoding: null //Use Buffer to store the response data }; var rangeSize = range.size; requestOptions.timeoutIntervalInMs = options.timeoutIntervalInMs; requestOptions.clientRequestTimeoutInMs = options.clientRequestTimeoutInMs; requestOptions.useTransactionalMD5 = options.useTransactionalMD5; if (range.dataSize === 0) { if (isPageBlobDownload) { var autoIncrement = speedSummary.getAutoIncrementFunction(rangeSize); //No operation to do and only wait for write zero to file in callback var writeZeroOperation = new BatchOperation.CommonOperation(BatchOperation.noOperation, function (error) { if (error) return; var bufferAvailable = azureutil.writeZerosToStream(writeStream, rangeSize, md5Hash, autoIncrement); //There is no need to pause the rangestream since we can perform http request and write disk at the same time self.logger.debug(util.format('Write %s bytes Zero from %s to %s', rangeSize, range.start, range.end)); if (!bufferAvailable) { self.logger.debug('Write stream is full and pause batch operation'); batchOperations.pause(); } }); batchOperations.addOperation(writeZeroOperation); } else { self.logger.debug(util.format('Can not read %s bytes to %s bytes of blob %s', range.start, range.end, blob)); } return; } if (range.start &gt; range.end) { return; } var operation = new BatchOperation.RestOperation(self, 'getBlobToText', container, blob, requestOptions, function (error, content, blobResult, response) { if (!error) { if (rangeSize !== content.length) { self.logger.warn(util.format('Request %s bytes, but server returns %s bytes', rangeSize, content.length)); } //Save one of the succeeded callback parameters and use them at the final callback if (!savedBlobResult) { savedBlobResult = blobResult; } if (!savedBlobResponse) { savedBlobResponse = response; } var autoIncrement = speedSummary.getAutoIncrementFunction(content.length); var bufferAvailable = writeStream.write(content, autoIncrement); if (!bufferAvailable) { self.logger.debug('Write stream is full and pause batch operation'); batchOperations.pause(); } if (md5Hash) { md5Hash.update(content); } content = null; } else { self.logger.debug(util.format('Stop downloading data as error happens. Error: %s', util.inspect(error))); rangeStream.stop(); } }); var full = batchOperations.addOperation(operation); if (full) { self.logger.debug('Pause range stream'); rangeStream.pause(); } }); rangeStream.on('end', function () { self.logger.debug('Range stream has ended.'); batchOperations.enableComplete(); }); batchOperations.on('drain', function () { self.logger.debug('Resume range stream'); rangeStream.resume(); }); writeStream.on('drain', function () { self.logger.debug('Resume batch operations'); batchOperations.resume(); }); batchOperations.on('end', function (error) { self.logger.debug('Download completed!'); if (error) { callback(error); return; } else { writeStream.end(function () { self.logger.debug('Write stream has ended'); if (writeStream.close) { writeStream.close(); } if (!savedBlobResult) { savedBlobResult = {}; } azureutil.setObjectInnerPropertyValue(savedBlobResult, ['contentSettings', 'contentMD5'], azureutil.tryGetValueChain(options, ['contentSettings', 'contentMD5'], null)); savedBlobResult.clientSideContentMD5 = null; if (md5Hash) { savedBlobResult.clientSideContentMD5 = md5Hash.digest('base64'); } callback(error, savedBlobResult, savedBlobResponse); }); } }); var listOptions = { timeoutIntervalInMs: options.timeoutIntervalInMs, clientRequestTimeoutInMs: options.clientRequestTimeoutInMs, snapshotId: options.snapshotId, leaseId: options.leaseId, blockListFilter: BlobUtilities.BlockListFilter.COMMITTED }; rangeStream.list(listOptions, function (error) { callback(error); }); return speedSummary; }; /** * Downloads a blockblob or pageblob into a stream. * @ignore * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {Stream} writeStream The write stream. * @param {object} [options] The request options. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the blob information. * `response` will contain information related to this operation. */ BlobService.prototype._getBlobToStream = function (container, blob, writeStream, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); var resourceName = createResourceName(container, blob); var webResource = WebResource.get(resourceName).withRawResponse(); var options = extend(true, {}, userOptions); webResource.withQueryOption(QueryStringConstants.SNAPSHOT, options.snapshotId); BlobResult.setHeadersFromBlob(webResource, options); this._setRangeContentMD5Header(webResource, options); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.blobResult = null; if (!responseObject.error) { responseObject.blobResult = new BlobResult(container, blob); responseObject.blobResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.blobResult.getPropertiesFromHeaders(responseObject.response.headers); self._validateLengthAndMD5(options, responseObject); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.blobResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequestInputStream(webResource, null, writeStream, options, processResponseCallback); }; /** * Lists a segment containing a collection of blob items whose names begin with the specified prefix in the container. * @ignore * @this {BlobService} * @param {string} container The container name. * @param {string} prefix The prefix of the blob name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {ListBlobTypes} listBlobType Specifies the item type of the results. * @param {object} [options] The request options. * @param {int} [options.maxResults] Specifies the maximum number of blobs to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {string} [options.include] Specifies that the response should include one or more of the following subsets: '', 'metadata', 'snapshots', 'uncommittedblobs', 'copy'). * Please find these values in BlobUtilities.BlobListingDetails. Multiple values can be added separated with a comma (,). * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the entries of blobs and the continuation token for the next listing operation. * `response` will contain information related to this operation. */ BlobService.prototype._listBlobsOrDircotriesSegmentedWithPrefix = function (container, prefix, currentToken, listBlobType, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listBlobsSegmented', function (v) { v.string(container, 'container'); v.containerNameIsValid(container); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(container) .withQueryOption(QueryStringConstants.RESTYPE, 'container') .withQueryOption(QueryStringConstants.COMP, 'list') .withQueryOption(QueryStringConstants.MAX_RESULTS, options.maxResults) .withQueryOptions(options, QueryStringConstants.DELIMITER, QueryStringConstants.INCLUDE); if (!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(QueryStringConstants.MARKER, currentToken.nextMarker); } webResource.withQueryOption(QueryStringConstants.PREFIX, prefix); options.requestLocationMode = azureutil.getNextListingLocationMode(currentToken); var processResponseCallback = function (responseObject, next) { responseObject.listBlobsResult = null; if (!responseObject.error) { responseObject.listBlobsResult = { entries: null, continuationToken: null }; responseObject.listBlobsResult.entries = []; var results = []; if (listBlobType == BlobConstants.ListBlobTypes.Directory &amp;&amp; responseObject.response.body.EnumerationResults.Blobs.BlobPrefix) { results = responseObject.response.body.EnumerationResults.Blobs.BlobPrefix; if (!_.isArray(results)) { results = [results]; } } else if (listBlobType == BlobConstants.ListBlobTypes.Blob &amp;&amp; responseObject.response.body.EnumerationResults.Blobs.Blob) { results = responseObject.response.body.EnumerationResults.Blobs.Blob; if (!_.isArray(results)) { results = [results]; } } results.forEach(function (currentBlob) { var blobResult = BlobResult.parse(currentBlob); responseObject.listBlobsResult.entries.push(blobResult); }); if (responseObject.response.body.EnumerationResults.NextMarker) { responseObject.listBlobsResult.continuationToken = { nextMarker: null, targetLocation: null }; responseObject.listBlobsResult.continuationToken.nextMarker = responseObject.response.body.EnumerationResults.NextMarker; responseObject.listBlobsResult.continuationToken.targetLocation = responseObject.targetLocation; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.listBlobsResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Create a new blob. * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param (BlobType) blobType The blob type. * @param {int} size The blob size. * @param {object} [options] The request options. * @param {errorOrResult} callback The callback which operates on the specific blob. */ BlobService.prototype._createBlob = function (container, blob, blobType, size, options, creationCallback) { if (blobType == BlobConstants.BlobTypes.APPEND) { this.createOrReplaceAppendBlob(container, blob, options, function (createError, createResponse) { creationCallback(createError, null, createResponse); }); } else if (blobType == BlobConstants.BlobTypes.PAGE) { this.createPageBlob(container, blob, size, options, function (createError) { creationCallback(createError); }); } else if (blobType == BlobConstants.BlobTypes.BLOCK) { creationCallback(); } }; /** * The callback for {BlobService~getBlobToText}. * @typedef {function} BlobService~blobToText * @param {object} error If an error occurs, the error information. * @param {string} text The text returned from the blob. * @param {object} blockBlob Information about the blob. * @param {object} response Information related to this operation. */ BlobService.SpeedSummary = SpeedSummary; module.exports = BlobService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_models_blobresult.js.html":{"id":"services_blob_models_blobresult.js.html","title":"Source: services/blob/models/blobresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/models/blobresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var _ = require('underscore'); var azureCommon = require('./../../../common/common.core'); var azureutil = azureCommon.util; var Constants = azureCommon.Constants; var HeaderConstants = Constants.HeaderConstants; /** * Creates a new BlobResult object. * @class * The BlobResult class is used to store the blob information. * * @property {string} container The container name. * @property {string} name The blob name. * @property {object} metadata The metadata key/value pair. * @property {string} etag The etag. * @property {string} lastModified The date/time that the blob was last modified. * @property {string} contentLength The size of the blob in bytes. * @property {string} blobType The blob type. * @property {boolean} isIncrementalCopy If the blob is incremental copy blob. * @property {string} requestId The request id. * @property {string} sequenceNumber The current sequence number for a page blob. * @property {string} contentRange The content range. * @property {string} committedBlockCount The committed block count. * @property {string} serverEncrypted If the blob data and application metadata are completely encrypted using the specified algorithm. true/false. * @property {object} contentSettings The content settings. * @property {string} contentSettings.contentType The content type. * @property {string} contentSettings.contentEncoding The content encoding. * @property {string} contentSettings.contentLanguage The content language. * @property {string} contentSettings.cacheControl The cache control. * @property {string} contentSettings.contentDisposition The content disposition. * @property {string} contentSettings.contentMD5 The content MD5 hash. * @property {object} lease The lease information. * @property {string} lease.id The lease id. * @property {string} lease.status The lease status. * @property {string} lease.state The lease state. * @property {string} lease.duration The lease duration. * @property {object} copy The copy information. * @property {string} copy.id The copy id. * @property {string} copy.status The copy status. * @property {string} copy.completionTime The copy completion time. * @property {string} copy.statusDescription The copy status description. * @property {string} copy.destinationSnapshot The snapshot time of the last successful incremental copy snapshot for this blob. * @property {string} copy.progress The copy progress. * @property {string} copy.source The copy source. * * @constructor * @param {string} [container] The container name. * @param {string} [name] The blob name. */ function BlobResult(container, name) { if (container) { this.container = container; } if (name) { this.name = name; } } BlobResult.parse = function (blobXml) { var blobResult = new BlobResult(); for (var propertyName in blobXml) { if (blobXml.hasOwnProperty(propertyName)) { if (propertyName === 'Properties') { // Lift out the properties onto the main object to keep consistent across all APIs like: getBlobProperties azureutil.setPropertyValueFromXML(blobResult, blobXml[propertyName], true); } else if (propertyName === 'Metadata') { var resultPropertyName = azureutil.normalizePropertyNameFromXML(propertyName); blobResult[resultPropertyName] = {}; azureutil.setPropertyValueFromXML(blobResult[resultPropertyName], blobXml[propertyName], false); } else { blobResult[propertyName.toLowerCase()] = blobXml[propertyName]; } } } // convert isIncrementalCopy to boolean type if (blobResult.isIncrementalCopy !== undefined) { blobResult.isIncrementalCopy = (blobResult.isIncrementalCopy == 'true'); } return blobResult; }; var headersForProperties = { 'lastModified': 'LAST_MODIFIED', 'etag': 'ETAG', 'sequenceNumber': 'SEQUENCE_NUMBER', 'blobType': 'BLOB_TYPE', 'contentLength': 'CONTENT_LENGTH', 'blobContentLength': 'BLOB_CONTENT_LENGTH', 'contentRange': 'CONTENT_RANGE', 'committedBlockCount': 'BLOB_COMMITTED_BLOCK_COUNT', 'serverEncrypted': 'SERVER_ENCRYPTED', 'requestId': 'REQUEST_ID', 'range': 'RANGE', 'blobRange': 'STORAGE_RANGE', 'getContentMd5': 'RANGE_GET_CONTENT_MD5', 'acceptRanges': 'ACCEPT_RANGES', 'appendOffset': 'BLOB_APPEND_OFFSET', 'isIncrementalCopy': 'INCREMENTAL_COPY', // ContentSettings 'contentSettings.contentType': 'CONTENT_TYPE', 'contentSettings.contentEncoding': 'CONTENT_ENCODING', 'contentSettings.contentLanguage': 'CONTENT_LANGUAGE', 'contentSettings.cacheControl': 'CACHE_CONTROL', 'contentSettings.contentDisposition': 'CONTENT_DISPOSITION', 'contentSettings.contentMD5': 'CONTENT_MD5', // Lease 'lease.id': 'LEASE_ID', 'lease.status': 'LEASE_STATUS', 'lease.duration': 'LEASE_DURATION', 'lease.state': 'LEASE_STATE', // Copy 'copy.id': 'COPY_ID', 'copy.status': 'COPY_STATUS', 'copy.source': 'COPY_SOURCE', 'copy.progress': 'COPY_PROGRESS', 'copy.completionTime': 'COPY_COMPLETION_TIME', 'copy.statusDescription': 'COPY_STATUS_DESCRIPTION', 'copy.destinationSnapshot': 'COPY_DESTINATION_SNAPSHOT' }; BlobResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; var setBlobPropertyFromHeaders = function (blobProperty, headerProperty) { if (!azureutil.tryGetValueChain(self, blobProperty.split('.'), null) &amp;&amp; headers[headerProperty.toLowerCase()]) { azureutil.setObjectInnerPropertyValue(self, blobProperty.split('.'), headers[headerProperty.toLowerCase()]); if (blobProperty === 'copy.progress') { var info = azureutil.parseCopyProgress(self.copy.progress); self.copy.bytesCopied = parseInt(info.bytesCopied); self.copy.totalBytes = parseInt(info.totalBytes); } } }; // For range get, 'x-ms-blob-content-md5' indicate the overall MD5 of the blob. Try to set the contentMD5 using this header if it presents setBlobPropertyFromHeaders('contentSettings.contentMD5', HeaderConstants['BLOB_CONTENT_MD5']); _.chain(headersForProperties).pairs().each(function (pair) { var property = pair[0]; var header = HeaderConstants[pair[1]]; setBlobPropertyFromHeaders(property, header); }); // convert isIncrementalCopy to boolean type if (self.isIncrementalCopy !== undefined) { self.isIncrementalCopy = (self.isIncrementalCopy == 'true'); } }; /** * This method sets the HTTP headers and is used by all methods except setBlobProperties and commitBlocks. Those 2 methods will set the x-ms-* headers using setPropertiesFromBlob. * @ignore */ BlobResult.setHeadersFromBlob = function (webResource, blob) { var setHeaderPropertyFromBlob = function (headerProperty, blobProperty) { var blobPropertyValue = azureutil.tryGetValueChain(blob, blobProperty.split('.'), null); if (blobPropertyValue) { webResource.withHeader(headerProperty, blobPropertyValue); } }; if (blob) { // Content-Type setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_TYPE, 'contentSettings.contentType'); // Content-Encoding setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_ENCODING, 'contentSettings.contentEncoding'); // Content-Language setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_LANGUAGE, 'contentSettings.contentLanguage'); // Content-Disposition setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_DISPOSITION, 'contentSettings.contentDisposition'); // Cache-Control setHeaderPropertyFromBlob(HeaderConstants.BLOB_CACHE_CONTROL, 'contentSettings.cacheControl'); // Blob's Content-MD5 setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_MD5, 'contentSettings.contentMD5'); // Content-Length setHeaderPropertyFromBlob(HeaderConstants.CONTENT_LENGTH, 'contentLength'); // transactional Content-MD5 setHeaderPropertyFromBlob(HeaderConstants.CONTENT_MD5, 'transactionalContentMD5'); // Range if (!azureutil.objectIsNull(blob.rangeStart)) { var range = 'bytes=' + blob.rangeStart + '-'; if (!azureutil.objectIsNull(blob.rangeEnd)) { range += blob.rangeEnd; } webResource.withHeader(HeaderConstants.RANGE, range); } // Blob Type setHeaderPropertyFromBlob(HeaderConstants.BLOB_TYPE, 'blobType'); // Lease id setHeaderPropertyFromBlob(HeaderConstants.LEASE_ID, 'leaseId'); // Sequence number setHeaderPropertyFromBlob(HeaderConstants.SEQUENCE_NUMBER, 'sequenceNumber'); setHeaderPropertyFromBlob(HeaderConstants.SEQUENCE_NUMBER_ACTION, 'sequenceNumberAction'); if (blob.metadata) { webResource.addOptionalMetadataHeaders(blob.metadata); } } }; /** * This method sets the x-ms-* headers and is used by setBlobProperties and commitBlocks. All other methods will set the regular HTTP headers using setHeadersFromBlob. * @ignore */ BlobResult.setPropertiesFromBlob = function (webResource, blob) { var setHeaderPropertyFromBlob = function (headerProperty, blobProperty) { var propertyValue = azureutil.tryGetValueChain(blob, blobProperty.split('.'), null); if (propertyValue) { webResource.withHeader(headerProperty, propertyValue); } }; if (blob) { // Content-Type setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_TYPE, 'contentSettings.contentType'); // Content-Encoding setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_ENCODING, 'contentSettings.contentEncoding'); // Content-Language setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_LANGUAGE, 'contentSettings.contentLanguage'); // Content-Disposition setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_DISPOSITION, 'contentSettings.contentDisposition'); // Cache-Control setHeaderPropertyFromBlob(HeaderConstants.BLOB_CACHE_CONTROL, 'contentSettings.cacheControl'); // Content-MD5 setHeaderPropertyFromBlob(HeaderConstants.BLOB_CONTENT_MD5, 'contentSettings.contentMD5'); // Lease id setHeaderPropertyFromBlob(HeaderConstants.LEASE_ID, 'leaseId'); if (blob.metadata) { webResource.addOptionalMetadataHeaders(blob.metadata); } } }; module.exports = BlobResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"common_services_storageserviceclient.js.html":{"id":"common_services_storageserviceclient.js.html","title":"Source: common/services/storageserviceclient.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: common/services/storageserviceclient.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var request = require('../request-wrapper'); var url = require('url'); var qs = require('querystring'); var util = require('util'); var xml2js = require('xml2js'); var events = require('events'); var _ = require('underscore'); var guid = require('uuid'); var os = require('os'); var extend = require('extend'); var Parser = require('json-edm-parser'); var Md5Wrapper = require('../md5-wrapper'); var azureutil = require('../util/util'); var validate = require('../util/validate'); var SR = require('../util/sr'); var WebResource = require('../http/webresource'); var BufferStream = require('../streams/bufferstream.js'); var ServiceSettings = require('./servicesettings'); var StorageServiceSettings = require('./storageservicesettings'); var Constants = require('../util/constants'); var StorageUtilities = require('../util/storageutilities'); var ServicePropertiesResult = require('../models/servicepropertiesresult'); var TableUtilities = require('../../services/table/tableutilities'); var SharedKey = require('../signing/sharedkey'); var SharedAccessSignature = require('../signing/sharedaccesssignature'); var HeaderConstants = Constants.HeaderConstants; var QueryStringConstants = Constants.QueryStringConstants; var HttpResponseCodes = Constants.HttpConstants.HttpResponseCodes; var StorageServiceClientConstants = Constants.StorageServiceClientConstants; var defaultRequestLocationMode = Constants.RequestLocationMode.PRIMARY_ONLY; var RequestLocationMode = Constants.RequestLocationMode; var Logger = require('../diagnostics/logger'); var errors = require('../errors/errors'); var ArgumentError = errors.ArgumentError; var ArgumentNullError = errors.ArgumentNullError; var TimeoutError = errors.TimeoutError; var StorageError = errors.StorageError; /** * Creates a new StorageServiceClient object. * * @class * The StorageServiceClient class is the base class of all the service classes. * @constructor * @param {string} storageAccount The storage account. * @param {string} storageAccessKey The storage access key. * @param {object} host The host for the service. * @param {bool} usePathStyleUri Boolean value indicating wether to use path style uris. * @param {string} sasToken The Shared Access Signature token. */ function StorageServiceClient(storageAccount, storageAccessKey, host, usePathStyleUri, sasToken) { StorageServiceClient['super_'].call(this); if(storageAccount &amp;&amp; storageAccessKey) { // account and key this.storageAccount = storageAccount; this.storageAccessKey = storageAccessKey; this.storageCredentials = new SharedKey(this.storageAccount, this.storageAccessKey, usePathStyleUri); } else if (sasToken) { // sas this.sasToken = sasToken; this.storageCredentials = new SharedAccessSignature(sasToken); } else { // anonymous this.anonymous = true; this.storageCredentials = { signRequest: function(webResource, callback){ // no op, anonymous access callback(null); } }; } if(host){ this.setHost(host); } this.apiVersion = HeaderConstants.TARGET_STORAGE_VERSION; this.usePathStyleUri = usePathStyleUri; this._initDefaultFilter(); /** * The logger of the service. To change the log level of the services, set the `[logger.level]{@link Logger#level}`. * @name StorageServiceClient#logger * @type Logger * */ this.logger = new Logger(Logger.LogLevels.INFO); this._setDefaultProxy(); this.xml2jsSettings = StorageServiceClient._getDefaultXml2jsSettings(); this.defaultLocationMode = StorageUtilities.LocationMode.PRIMARY_ONLY; } util.inherits(StorageServiceClient, events.EventEmitter); /** * Gets the default xml2js settings. * @ignore * @return {object} The default settings */ StorageServiceClient._getDefaultXml2jsSettings = function() { var xml2jsSettings = _.clone(xml2js.defaults['0.2']); // these determine what happens if the xml contains attributes xml2jsSettings.attrkey = Constants.TableConstants.XML_METADATA_MARKER; xml2jsSettings.charkey = Constants.TableConstants.XML_VALUE_MARKER; // from xml2js guide: always put child nodes in an array if true; otherwise an array is created only if there is more than one. xml2jsSettings.explicitArray = false; return xml2jsSettings; }; /** * Sets a host for the service. * @ignore * @param {string} host The host for the service. */ StorageServiceClient.prototype.setHost = function (host) { var parseHost = function(hostUri){ var parsedHost; if(!azureutil.objectIsNull(hostUri)) { if(hostUri.indexOf('http') === -1 &amp;&amp; hostUri.indexOf('//') !== 0){ hostUri = '//' + hostUri; } parsedHost = url.parse(hostUri, false, true); if(!parsedHost.protocol){ parsedHost.protocol = ServiceSettings.DEFAULT_PROTOCOL; } if (!parsedHost.port) { if (parsedHost.protocol === Constants.HTTPS) { parsedHost.port = Constants.DEFAULT_HTTPS_PORT; } else { parsedHost.port = Constants.DEFAULT_HTTP_PORT; } } parsedHost = url.format({ protocol: parsedHost.protocol, port: parsedHost.port, hostname: parsedHost.hostname, pathname: parsedHost.pathname }); } return parsedHost; }; validate.isValidHost(host); this.host = { primaryHost: parseHost(host.primaryHost), secondaryHost: parseHost(host.secondaryHost) }; }; /** * Performs a REST service request through HTTP expecting an input stream. * @ignore * * @param {WebResource} webResource The webresource on which to perform the request. * @param {string} outputData The outgoing request data as a raw string. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {function} callback The response callback function. */ StorageServiceClient.prototype.performRequest = function (webResource, outputData, options, callback) { if (!azureutil.isBrowser() &amp;&amp; Buffer.isBuffer(outputData)) { // Request module will take 200MB additional memory when we pass a 100MB buffer as body // Transfer buffer to stream will highly reduce the memory usage by request module this._performRequest(webResource, { outputData: new BufferStream(outputData) }, options, callback); } else { this._performRequest(webResource, { outputData: outputData }, options, callback); } }; /** * Performs a REST service request through HTTP expecting an input stream. * @ignore * * @param {WebResource} webResource The webresource on which to perform the request. * @param {Stream} outputStream The outgoing request data as a stream. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {function} callback The response callback function. */ StorageServiceClient.prototype.performRequestOutputStream = function (webResource, outputStream, options, callback) { this._performRequest(webResource, { outputStream: outputStream }, options, callback); }; /** * Performs a REST service request through HTTP expecting an input stream. * @ignore * * @param {WebResource} webResource The webresource on which to perform the request. * @param {string} outputData The outgoing request data as a raw string. * @param {Stream} inputStream The ingoing response data as a stream. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {function} callback The response callback function. */ StorageServiceClient.prototype.performRequestInputStream = function (webResource, outputData, inputStream, options, callback) { this._performRequest(webResource, { outputData: outputData, inputStream: inputStream }, options, callback); }; /** * Performs a REST service request through HTTP. * @ignore * * @param {WebResource} webResource The webresource on which to perform the request. * @param {object} body The request body. * @param {string} [body.outputData] The outgoing request data as a raw string. * @param {Stream} [body.outputStream] The outgoing request data as a stream. * @param {Stream} [body.inputStream] The ingoing response data as a stream. * @param {object} [options] The request options. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {function} callback The response callback function. */ StorageServiceClient.prototype._performRequest = function (webResource, body, options, callback) { var self = this; // Sets a requestId on the webResource if(!options.clientRequestId) { options.clientRequestId = guid.v1(); } webResource.withHeader(HeaderConstants.CLIENT_REQUEST_ID, options.clientRequestId); // Sets the user-agent string var userAgentComment = util.format('(NODE-VERSION %s; %s %s)', process.version, os.type(), os.release()); webResource.withHeader(HeaderConstants.USER_AGENT, Constants.USER_AGENT_PRODUCT_NAME + '/' + Constants.USER_AGENT_PRODUCT_VERSION + ' ' + userAgentComment); // Initialize the location that the request is going to be sent to. if(azureutil.objectIsNull(options.locationMode)) { options.locationMode = this.defaultLocationMode; } // Initialize the location that the request can be sent to. if(azureutil.objectIsNull(options.requestLocationMode)) { options.requestLocationMode = defaultRequestLocationMode; } // Initialize whether nagling is used or not. if(azureutil.objectIsNull(options.useNagleAlgorithm)) { options.useNagleAlgorithm = this.useNagleAlgorithm; } this._initializeLocation(options); // Initialize the operationExpiryTime this._setOperationExpiryTime(options); // If the output stream already got sent to server and got error back, // we should NOT retry within the SDK as the stream data is not valid anymore if we retry directly. // And it's very hard for SDK to re-wind the stream. // // If users want to retry on this kind of error, they can implement their own logic to parse the response and // determine if they need to re-prepare a stream and call our SDK API to retry. // // Currently for blobs/files with size greater than 32MB (DEFAULT_SINGLE_BLOB_PUT_THRESHOLD_IN_BYTES), // we'll send the steam by chunk buffers which doesn't have this issue. var outputStreamSent = false; var operation = function (options, next) { self._validateLocation(options); var currentLocation = options.currentLocation; self._buildRequestOptions(webResource, body, options, function (err, finalRequestOptions) { if (err) { callback({ error: err, response: null }, function (finalRequestOptions, finalCallback) { finalCallback(finalRequestOptions); }); } else { self.logger.log(Logger.LogLevels.DEBUG, 'FINAL REQUEST OPTIONS:\\n' + util.inspect(finalRequestOptions)); if(self._maximumExecutionTimeExceeded(Date.now(), options.operationExpiryTime)) { callback({ error: new TimeoutError(SR.MAXIMUM_EXECUTION_TIMEOUT_EXCEPTION), response: null }, function (finalRequestOptions, finalCallback) { finalCallback(finalRequestOptions); }); } else { var processResponseCallback = function (error, response) { var responseObject; if (error) { responseObject = { error: error, response: null }; } else { responseObject = self._processResponse(webResource, response, options); responseObject.contentMD5 = response.contentMD5; responseObject.length = response.length; } responseObject.operationEndTime = new Date(); // Required for listing operations to make sure successive operations go to the same location. responseObject.targetLocation = currentLocation; responseObject.outputStreamSent = outputStreamSent; callback(responseObject, next); }; var endResponse; var buildRequest = function (headersOnly, inputStream) { // Build request (if body was set before, request will process immediately, if not it'll wait for the piping to happen var requestStream; var requestWithDefaults; if(self.proxy) { if(requestWithDefaults === undefined) { requestWithDefaults = request.defaults({'proxy':self.proxy}); } } else { requestWithDefaults = request; } if (headersOnly) { requestStream = requestWithDefaults(finalRequestOptions); requestStream.on('error', processResponseCallback); requestStream.on('response', function (response) { var isValid = WebResource.validResponse(response.statusCode); if (!isValid) { // When getting invalid response, try to get the error message for future steps to extract the detailed error information var contentLength = parseInt(response.headers['content-length']); var errorMessageBuffer; var index = 0; if (contentLength !== undefined) { errorMessageBuffer = new Buffer(contentLength); } requestStream.on('data', function (data) { if (contentLength !== undefined) { data.copy(errorMessageBuffer, index); index += data.length; } else { if (!errorMessageBuffer) { errorMessageBuffer = data; } else { errorMessageBuffer = Buffer.concat([errorMessageBuffer, data]); } } }); requestStream.on('end', function () { if (errorMessageBuffer) { // Strip the UTF8 BOM following the same ways as 'request' module if (errorMessageBuffer.length &gt; 3 &amp;&amp; errorMessageBuffer[0] === 239 &amp;&amp; errorMessageBuffer[1] === 187 &amp;&amp; errorMessageBuffer[2] === 191) { response.body = errorMessageBuffer.toString('utf8', 3); } else { response.body = errorMessageBuffer.toString('utf8'); } } processResponseCallback(null, response); }); } else { // Only pipe to the destination stream when we get a valid response from service // Error message should NOT be piped to the destination stream if (inputStream) { requestStream.pipe(inputStream); } var responseLength = 0; var internalHash = new Md5Wrapper().createMd5Hash(); response.on('data', function(data) { responseLength += data.length; internalHash.update(data); }); response.on('end', function () { // Calculate and set MD5 here if(azureutil.objectIsNull(options.disableContentMD5Validation) || options.disableContentMD5Validation === false) { response.contentMD5 = internalHash.digest('base64'); } response.length = responseLength; endResponse = response; }); } }); } else { requestStream = requestWithDefaults(finalRequestOptions, processResponseCallback); } //If useNagleAlgorithm is not set or the value is set and is false, setNoDelay is set to true. if (azureutil.objectIsNull(options.useNagleAlgorithm) || options.useNagleAlgorithm === false) { requestStream.on('request', function(httpRequest) { httpRequest.setNoDelay(true); }); } // Workaround to avoid request from potentially setting unwanted (rejected) headers by the service var oldEnd = requestStream.end; requestStream.end = function () { if (finalRequestOptions.headers['content-length']) { requestStream.headers['content-length'] = finalRequestOptions.headers['content-length']; } else if (requestStream.headers['content-length']) { delete requestStream.headers['content-length']; } oldEnd.call(requestStream); }; // Bubble events up -- This is when the request is going to be made. requestStream.on('response', function (response) { self.emit('receivedResponseEvent', response); }); return requestStream; }; if (body &amp;&amp; body.outputData) { finalRequestOptions.body = body.outputData; } // Pipe any input / output streams if (body &amp;&amp; body.inputStream) { body.inputStream.on('close', function () { if (endResponse) { processResponseCallback(null, endResponse); endResponse = null; } }); body.inputStream.on('end', function () { if (endResponse) { processResponseCallback(null, endResponse); endResponse = null; } }); body.inputStream.on('finish', function () { if (endResponse) { processResponseCallback(null, endResponse); endResponse = null; } }); buildRequest(true, body.inputStream); } else if (body &amp;&amp; body.outputStream) { var sendUnchunked = function () { var size = finalRequestOptions.headers['content-length'] ? finalRequestOptions.headers['content-length'] : Constants.BlobConstants.MAX_SINGLE_UPLOAD_BLOB_SIZE_IN_BYTES; var concatBuf = new Buffer(size); var index = 0; body.outputStream.on('data', function (d) { outputStreamSent = true; if(self._maximumExecutionTimeExceeded(Date.now(), options.operationExpiryTime)) { processResponseCallback(new TimeoutError(SR.MAXIMUM_EXECUTION_TIMEOUT_EXCEPTION)); } else { d.copy(concatBuf, index); index += d.length; } }).on('end', function () { var requestStream = buildRequest(); requestStream.write(concatBuf); requestStream.end(); }); if (azureutil.isStreamPaused(body.outputStream)) { body.outputStream.resume(); } }; var sendStream = function () { // NOTE: workaround for an unexpected EPIPE exception when piping streams larger than 29 MB if (!azureutil.objectIsNull(finalRequestOptions.headers['content-length']) &amp;&amp; finalRequestOptions.headers['content-length'] &lt; 29 * 1024 * 1024) { body.outputStream.pipe(buildRequest()); outputStreamSent = true; if (azureutil.isStreamPaused(body.outputStream)) { body.outputStream.resume(); } } else { sendUnchunked(); } }; if (!body.outputStream.readable) { // if the content length is zero, build the request and don't send a body if (finalRequestOptions.headers['content-length'] === 0) { buildRequest(); } else { // otherwise, wait until we know the readable stream is actually valid before piping body.outputStream.on('open', function () { sendStream(); }); } } else { sendStream(); } // This catches any errors that happen while creating the readable stream (usually invalid names) body.outputStream.on('error', function (error) { processResponseCallback(error); }); } else { buildRequest(); } } } }); }; // The filter will do what it needs to the requestOptions and will provide a // function to be handled after the reply self.filter(options, function (postFiltersRequestOptions, nextPostCallback) { if(self._maximumExecutionTimeExceeded(Date.now() + postFiltersRequestOptions.retryInterval, postFiltersRequestOptions.operationExpiryTime)) { callback({ error: new TimeoutError(SR.MAXIMUM_EXECUTION_TIMEOUT_EXCEPTION), response: null}, function (postFiltersRequestOptions, finalCallback) { finalCallback(postFiltersRequestOptions); }); } else { // If there is a filter, flow is: // filter -&gt; operation -&gt; process response if(postFiltersRequestOptions.retryContext) { var func = function() { operation(postFiltersRequestOptions, nextPostCallback); }; // Sleep for retryInterval before making the request setTimeout(func, postFiltersRequestOptions.retryInterval); } else { // No retry policy filter specified operation(postFiltersRequestOptions, nextPostCallback); } } }); }; /** * Builds the request options to be passed to the http.request method. * @ignore * @param {WebResource} webResource The webresource where to build the options from. * @param {object} options The request options. * @param {function(error, requestOptions)} callback The callback function. */ StorageServiceClient.prototype._buildRequestOptions = function (webResource, body, options, callback) { webResource.withHeader(HeaderConstants.STORAGE_VERSION, this.apiVersion); webResource.withHeader(HeaderConstants.MS_DATE, new Date().toUTCString()); if (!webResource.headers[HeaderConstants.ACCEPT]) { webResource.withHeader(HeaderConstants.ACCEPT, 'application/atom+xml,application/xml'); } webResource.withHeader(HeaderConstants.ACCEPT_CHARSET, 'UTF-8'); // Browsers cache GET/HEAD requests by adding conditional headers such as 'IF_MODIFIED_SINCE' after Azure Storage 'Authorization header' calculation, // which may result in a 403 authorization error. So add timestamp to GET/HEAD request URLs thus avoid the browser cache. if (azureutil.isBrowser() &amp;&amp; ( webResource.method === Constants.HttpConstants.HttpVerbs.GET || webResource.method === Constants.HttpConstants.HttpVerbs.HEAD)) { webResource.withQueryOption(HeaderConstants.FORCE_NO_CACHE_IN_BROWSER, new Date().getTime()); } if(azureutil.objectIsNull(options.timeoutIntervalInMs)) { options.timeoutIntervalInMs = this.defaultTimeoutIntervalInMs; } if(azureutil.objectIsNull(options.clientRequestTimeoutInMs)) { options.clientRequestTimeoutInMs = this.defaultClientRequestTimeoutInMs; } if(!azureutil.objectIsNull(options.timeoutIntervalInMs) &amp;&amp; options.timeoutIntervalInMs &gt; 0) { webResource.withQueryOption(QueryStringConstants.TIMEOUT, Math.ceil(options.timeoutIntervalInMs / 1000)); } if(options.accessConditions) { webResource.withHeader(HeaderConstants.IF_MATCH, options.accessConditions.EtagMatch); webResource.withHeader(HeaderConstants.IF_MODIFIED_SINCE, options.accessConditions.DateModifedSince); webResource.withHeader(HeaderConstants.IF_NONE_MATCH, options.accessConditions.EtagNonMatch); webResource.withHeader(HeaderConstants.IF_UNMODIFIED_SINCE, options.accessConditions.DateUnModifiedSince); webResource.withHeader(HeaderConstants.SEQUENCE_NUMBER_EQUAL, options.accessConditions.SequenceNumberEqual); webResource.withHeader(HeaderConstants.SEQUENCE_NUMBER_LESS_THAN, options.accessConditions.SequenceNumberLessThan); webResource.withHeader(HeaderConstants.SEQUENCE_NUMBER_LESS_THAN_OR_EQUAL, options.accessConditions.SequenceNumberLessThanOrEqual); webResource.withHeader(HeaderConstants.BLOB_CONDITION_MAX_SIZE, options.accessConditions.MaxBlobSize); webResource.withHeader(HeaderConstants.BLOB_CONDITION_APPEND_POSITION, options.accessConditions.MaxAppendPosition); } if(options.sourceAccessConditions) { webResource.withHeader(HeaderConstants.SOURCE_IF_MATCH, options.sourceAccessConditions.EtagMatch); webResource.withHeader(HeaderConstants.SOURCE_IF_MODIFIED_SINCE, options.sourceAccessConditions.DateModifedSince); webResource.withHeader(HeaderConstants.SOURCE_IF_NONE_MATCH, options.sourceAccessConditions.EtagNonMatch); webResource.withHeader(HeaderConstants.SOURCE_IF_UNMODIFIED_SINCE, options.sourceAccessConditions.DateUnModifiedSince); } if (!webResource.headers || webResource.headers[HeaderConstants.CONTENT_TYPE] === undefined) { // work around to add an empty content type header to prevent the request module from magically adding a content type. webResource.headers[HeaderConstants.CONTENT_TYPE] = ''; } else if (webResource.headers &amp;&amp; webResource.headers[HeaderConstants.CONTENT_TYPE] === null) { delete webResource.headers[HeaderConstants.CONTENT_TYPE]; } if (!webResource.headers || webResource.headers[HeaderConstants.CONTENT_LENGTH] === undefined) { if (body &amp;&amp; body.outputData) { webResource.withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(body.outputData, 'UTF8')); } else if (webResource.headers[HeaderConstants.CONTENT_LENGTH] === undefined) { webResource.withHeader(HeaderConstants.CONTENT_LENGTH, 0); } } else if (webResource.headers &amp;&amp; webResource.headers[HeaderConstants.CONTENT_LENGTH] === null) { delete webResource.headers[HeaderConstants.CONTENT_LENGTH]; } // Sets the request url in the web resource. this._setRequestUrl(webResource, options); this.emit('sendingRequestEvent', webResource); // Now that the web request is finalized, sign it this.storageCredentials.signRequest(webResource, function (error) { var requestOptions = null; if (!error) { var targetUrl = webResource.uri; requestOptions = { uri: url.format(targetUrl), method: webResource.method, headers: webResource.headers, mode: 'disable-fetch' }; if (options) { //set encoding of response data. If set to null, the body is returned as a Buffer requestOptions.encoding = options.responseEncoding; } if (options &amp;&amp; options.clientRequestTimeoutInMs) { requestOptions.timeout = options.clientRequestTimeoutInMs; } else { requestOptions.timeout = Constants.DEFAULT_CLIENT_REQUEST_TIMEOUT_IN_MS; // 2 minutes } } callback(error, requestOptions); }); }; /** * Process the response. * @ignore * * @param {WebResource} webResource The web resource that made the request. * @param {Response} response The response object. * @param {Options} options The response parsing options. * @param {String} options.payloadFormat The payload format. * @return The normalized responseObject. */ StorageServiceClient.prototype._processResponse = function (webResource, response, options) { var self = this; function convertRawHeadersToHeaders(rawHeaders) { var headers = {}; if(!rawHeaders) { return undefined; } for(var i = 0; i &lt; rawHeaders.length; i++) { var headerName; if (rawHeaders[i].indexOf(HeaderConstants.PREFIX_FOR_STORAGE_METADATA) === 0) { headerName = rawHeaders[i]; } else { headerName = rawHeaders[i].toLowerCase(); } headers[headerName] = rawHeaders[++i]; } return headers; } var validResponse = WebResource.validResponse(response.statusCode); var rsp = StorageServiceClient._buildResponse(validResponse, response.body, convertRawHeadersToHeaders(response.rawHeaders) || response.headers, response.statusCode, response.md5); var responseObject; if (validResponse &amp;&amp; webResource.rawResponse) { responseObject = { error: null, response: rsp }; } else { // attempt to parse the response body, errors will be returned in rsp.error without modifying the body rsp = StorageServiceClient._parseResponse(rsp, self.xml2jsSettings, options); if (validResponse &amp;&amp; !rsp.error) { responseObject = { error: null, response: rsp }; } else { rsp.isSuccessful = false; if (response.statusCode &lt; 400 || response.statusCode &gt;= 500) { this.logger.log(Logger.LogLevels.DEBUG, 'ERROR code = ' + response.statusCode + ' :\\n' + util.inspect(rsp.body)); } // responseObject.error should contain normalized parser errors if they occured in _parseResponse // responseObject.response.body should contain the raw response body in that case var errorBody = rsp.body; if(rsp.error) { errorBody = rsp.error; delete rsp.error; } if (!errorBody) { var code = Object.keys(HttpResponseCodes).filter(function (name) { if (HttpResponseCodes[name] === rsp.statusCode) { return name; } }); errorBody = { error: { code: code[0] } }; } var normalizedError = StorageServiceClient._normalizeError(errorBody, response); responseObject = { error: normalizedError, response: rsp }; } } this.logger.log(Logger.LogLevels.DEBUG, 'RESPONSE:\\n' + util.inspect(responseObject)); return responseObject; }; /** * Associate a filtering operation with this StorageServiceClient. Filtering operations * can include logging, automatically retrying, etc. Filter operations are objects * that implement a method with the signature: * * &quot;function handle (requestOptions, next)&quot;. * * After doing its preprocessing on the request options, the method needs to call * &quot;next&quot; passing a callback with the following signature: * signature: * * &quot;function (returnObject, finalCallback, next)&quot; * * In this callback, and after processing the returnObject (the response from the * request to the server), the callback needs to either invoke next if it exists to * continue processing other filters or simply invoke finalCallback otherwise to end * up the service invocation. * * @param {Object} filter The new filter object. * @return {StorageServiceClient} A new service client with the filter applied. */ StorageServiceClient.prototype.withFilter = function (newFilter) { // Create a new object with the same members as the current service var derived = _.clone(this); // If the current service has a filter, merge it with the new filter // (allowing us to effectively pipeline a series of filters) var parentFilter = this.filter; var mergedFilter = newFilter; if (parentFilter !== undefined) { // The parentFilterNext is either the operation or the nextPipe function generated on a previous merge // Ordering is [f3 pre] -&gt; [f2 pre] -&gt; [f1 pre] -&gt; operation -&gt; [f1 post] -&gt; [f2 post] -&gt; [f3 post] mergedFilter = function (originalRequestOptions, parentFilterNext) { newFilter.handle(originalRequestOptions, function (postRequestOptions, newFilterCallback) { // handle parent filter pre and get Parent filter post var next = function (postPostRequestOptions, parentFilterCallback) { // The parentFilterNext is the filter next to the merged filter. // For 2 filters, that'd be the actual operation. parentFilterNext(postPostRequestOptions, function (responseObject, responseCallback, finalCallback) { parentFilterCallback(responseObject, finalCallback, function (postResponseObject) { newFilterCallback(postResponseObject, responseCallback, finalCallback); }); }); }; parentFilter(postRequestOptions, next); }); }; } // Store the filter so it can be applied in performRequest derived.filter = mergedFilter; return derived; }; /* * Builds a response object with normalized key names. * @ignore * * @param {Bool} isSuccessful Boolean value indicating if the request was successful * @param {Object} body The response body. * @param {Object} headers The response headers. * @param {int} statusCode The response status code. * @param {string} md5 The response's content md5 hash. * @return {Object} A response object. */ StorageServiceClient._buildResponse = function (isSuccessful, body, headers, statusCode, md5) { return { isSuccessful: isSuccessful, statusCode: statusCode, body: body, headers: headers, md5: md5 }; }; /** * Parses a server response body from XML or JSON into a JS object. * This is done using the xml2js library. * @ignore * * @param {object} response The response object with a property &quot;body&quot; with a XML or JSON string content. * @param {object} xml2jsSettings The XML to json settings. * @param {Options} options The response parsing options. * @param {String} options.payloadFormat The payload format. * @return {object} The same response object with the body part as a JS object instead of a XML or JSON string. */ StorageServiceClient._parseResponse = function (response, xml2jsSettings, options) { function parseXml(body) { var parsed; var parser = new xml2js.Parser(xml2jsSettings); parser.parseString(azureutil.removeBOM(body.toString()), function (err, parsedBody) { if (err) { var xmlError = new SyntaxError('EXMLFORMAT'); xmlError.innerError = err; throw xmlError; } else { parsed = parsedBody; } }); return parsed; } if (response.body &amp;&amp; Buffer.byteLength(response.body.toString()) &gt; 0) { var contentType = ''; if (response.headers &amp;&amp; response.headers['content-type']) { contentType = response.headers['content-type'].toLowerCase(); } try { if (contentType.indexOf('application/json') !== -1) { if (options &amp;&amp; options.payloadFormat &amp;&amp; options.payloadFormat !== TableUtilities.PayloadFormat.NO_METADATA) { var parser = new Parser(); parser.onValue = function (value) { response.body = value; }; parser.write(response.body); } else { response.body = JSON.parse(response.body); } } else if (contentType.indexOf('application/xml') !== -1 || contentType.indexOf('application/atom+xml') !== -1) { response.body = parseXml(response.body); } else if (contentType.indexOf('text/html') !== -1) { response.body = response.body; } else { response.body = parseXml(response.body); // throw new SyntaxError(SR.CONTENT_TYPE_MISSING, null); } } catch (e) { response.error = e; } } return response; }; /** * Gets the storage settings. * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string} [host] The host address. * @param {object} [sasToken] The sas token. * * @return {StorageServiceSettings} */ StorageServiceClient.getStorageSettings = function (storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix) { var storageServiceSettings; if (storageAccountOrConnectionString &amp;&amp; !storageAccessKey &amp;&amp; !sasToken) { // If storageAccountOrConnectionString was passed and no accessKey was passed, assume connection string storageServiceSettings = StorageServiceSettings.createFromConnectionString(storageAccountOrConnectionString); } else if ((storageAccountOrConnectionString &amp;&amp; storageAccessKey) || sasToken || host) { // Account and key or credentials or anonymous storageServiceSettings = StorageServiceSettings.createExplicitly(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix); } else { // Use environment variables storageServiceSettings = StorageServiceSettings.createFromEnvironment(); } return storageServiceSettings; }; /** * Sets the webResource's requestUrl based on the service client settings. * @ignore * * @param {WebResource} webResource The web resource where to set the request url. */ StorageServiceClient.prototype._setRequestUrl = function (webResource, options) { // Normalize the path // Backup the original path of the webResource to make sure it works fine even this function get executed multiple times - like RetryFilter webResource.originalPath = webResource.originalPath || webResource.path; webResource.path = this._getPath(webResource.originalPath); if(!this.host){ throw new ArgumentNullError('this.host', SR.STORAGE_HOST_LOCATION_REQUIRED); } var host = this.host.primaryHost; if(!azureutil.objectIsNull(options) &amp;&amp; options.currentLocation === Constants.StorageLocation.SECONDARY) { host = this.host.secondaryHost; } if(host &amp;&amp; host.lastIndexOf('/') !== (host.length - 1)){ host = host + '/'; } var fullPath = url.format({pathname: webResource.path, query: webResource.queryString}); webResource.uri = url.resolve(host, fullPath); webResource.path = url.parse(webResource.uri).pathname; }; /** * Retrieves the normalized path to be used in a request. * It also removes any leading &quot;/&quot; of the path in case * it's there before. * @ignore * @param {string} path The path to be normalized. * @return {string} The normalized path. */ StorageServiceClient.prototype._getPath = function (path) { if (path === null || path === undefined) { path = ''; } else if (path.indexOf('/') === 0) { path = path.substring(1); } return path; }; /** * Get the url of a given path */ StorageServiceClient.prototype._getUrl = function (path, sasToken, primary) { var host; if (!azureutil.objectIsNull(primary) &amp;&amp; primary === false) { host = this.host.secondaryHost; } else { host = this.host.primaryHost; } host = azureutil.trimPortFromUri(host); if(host &amp;&amp; host.lastIndexOf('/') !== (host.length - 1)){ host = host + '/'; } var query = qs.parse(sasToken); var fullPath = url.format({ pathname: this._getPath(path), query: query }); return url.resolve(host, fullPath); }; /** * Initializes the default filter. * This filter is responsible for chaining the pre filters request into the operation and, after processing the response, * pass it to the post processing filters. This method should only be invoked by the StorageServiceClient constructor. * @ignore * */ StorageServiceClient.prototype._initDefaultFilter = function () { this.filter = function (requestOptions, nextPreCallback) { if (nextPreCallback) { // Handle the next pre callback and pass the function to be handled as post call back. nextPreCallback(requestOptions, function (returnObject, finalCallback, nextPostCallback) { if (nextPostCallback) { nextPostCallback(returnObject); } else if (finalCallback) { finalCallback(returnObject); } }); } }; }; /** * Retrieves the metadata headers from the response headers. * @ignore * * @param {object} headers The metadata headers. * @return {object} An object with the metadata headers (without the &quot;x-ms-&quot; prefix). */ StorageServiceClient.prototype.parseMetadataHeaders = function (headers) { var metadata = {}; if (!headers) { return metadata; } for (var header in headers) { if (header.indexOf(HeaderConstants.PREFIX_FOR_STORAGE_METADATA) === 0) { var key = header.substr(HeaderConstants.PREFIX_FOR_STORAGE_METADATA.length, header.length - HeaderConstants.PREFIX_FOR_STORAGE_METADATA.length); metadata[key] = headers[header]; } } return metadata; }; /** * Gets the properties of a storage account’s service, including Azure Storage Analytics. * @ignore * * @this {StorageServiceClient} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; otherwise, `result` will contain the properties * and `response` will contain information related to this operation. */ StorageServiceClient.prototype.getAccountServiceProperties = function (optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getServiceProperties', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get() .withQueryOption(QueryStringConstants.COMP, 'properties') .withQueryOption(QueryStringConstants.RESTYPE, 'service'); options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.servicePropertiesResult = null; if (!responseObject.error) { responseObject.servicePropertiesResult = ServicePropertiesResult.parse(responseObject.response.body.StorageServiceProperties); } // function to be called after all filters var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.servicePropertiesResult, returnObject.response); }; // call the first filter next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets the properties of a storage account’s service, including Azure Storage Analytics. * You can also use this operation to set the default request version for all incoming requests that do not have a version specified. * * @this {StorageServiceClient} * @param {object} serviceProperties The service properties. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise, `response` * will contain information related to this operation. */ StorageServiceClient.prototype.setAccountServiceProperties = function (serviceProperties, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setServiceProperties', function (v) { v.object(serviceProperties, 'serviceProperties'); v.callback(callback); }); var options = extend(true, {}, userOptions); var servicePropertiesXml = ServicePropertiesResult.serialize(serviceProperties); var webResource = WebResource.put() .withQueryOption(QueryStringConstants.COMP, 'properties') .withQueryOption(QueryStringConstants.RESTYPE, 'service') .withHeader(HeaderConstants.CONTENT_TYPE, 'application/xml;charset=&quot;utf-8&quot;') .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(servicePropertiesXml)) .withBody(servicePropertiesXml); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; // Other functions /** * Processes the error body into a normalized error object with all the properties lowercased. * * Error information may be returned by a service call with additional debugging information: * http://msdn.microsoft.com/en-us/library/windowsazure/dd179382.aspx * * Table services returns these properties lowercased, example, &quot;code&quot; instead of &quot;Code&quot;. So that the user * can always expect the same format, this method lower cases everything. * * @ignore * * @param {Object} error The error object as returned by the service and parsed to JSON by the xml2json. * @return {Object} The normalized error object with all properties lower cased. */ StorageServiceClient._normalizeError = function (error, response) { if (azureutil.objectIsString(error)) { return new StorageError(error, null); } else if (error) { var normalizedError = {}; // blob/queue errors should have error.Error, table errors should have error['odata.error'] var errorProperties = error.Error || error.error || error['odata.error'] || error['m:error'] || error; normalizedError.code = errorProperties.message; // The message exists when there is error.Error. for (var property in errorProperties) { if (errorProperties.hasOwnProperty(property)) { var key = property.toLowerCase(); if(key.indexOf('m:') === 0) { key = key.substring(2); } normalizedError[key] = errorProperties[property]; // if this is a table error, message is an object - flatten it to normalize with blob/queue errors // ex: &quot;message&quot;:{&quot;lang&quot;:&quot;en-US&quot;,&quot;value&quot;:&quot;The specified resource does not exist.&quot;} becomes message: &quot;The specified resource does not exist.&quot; if (key === 'message' &amp;&amp; _.isObject(errorProperties[property])) { if (errorProperties[property]['value']) { normalizedError[key] = errorProperties[property]['value']; } } } } // add status code and server request id if available if (response) { if (response.statusCode) { normalizedError.statusCode = response.statusCode; } if (response.headers &amp;&amp; response.headers['x-ms-request-id']) { normalizedError.requestId = response.headers['x-ms-request-id']; } } var errorObject = new StorageError(normalizedError.code, normalizedError); return errorObject; } return null; }; /* * Sets proxy object specified by caller. * * @param {object} proxy proxy to use for tunneling * { * host: hostname * port: port number * proxyAuth: 'user:password' for basic auth * headers: {...} headers for proxy server * key: key for proxy server * ca: ca for proxy server * cert: cert for proxy server * } * if null or undefined, clears proxy */ StorageServiceClient.prototype.setProxy = function (proxy) { if (proxy) { this.proxy = proxy; } else { this.proxy = null; } }; /** * Sets the service host default proxy from the environment. * Can be overridden by calling _setProxyUrl or _setProxy * */ StorageServiceClient.prototype._setDefaultProxy = function () { var proxyUrl = StorageServiceClient._loadEnvironmentProxyValue(); if (proxyUrl) { var parsedUrl = url.parse(proxyUrl); if (!parsedUrl.port) { parsedUrl.port = 80; } this.setProxy(parsedUrl); } else { this.setProxy(null); } }; /* * Loads the fields &quot;useProxy&quot; and respective protocol, port and url * from the environment values HTTPS_PROXY and HTTP_PROXY * in case those are set. * @ignore * * @return {string} or null */ StorageServiceClient._loadEnvironmentProxyValue = function () { var proxyUrl = null; if (process.env[StorageServiceClientConstants.EnvironmentVariables.HTTPS_PROXY]) { proxyUrl = process.env[StorageServiceClientConstants.EnvironmentVariables.HTTPS_PROXY]; } else if (process.env[StorageServiceClientConstants.EnvironmentVariables.HTTPS_PROXY.toLowerCase()]) { proxyUrl = process.env[StorageServiceClientConstants.EnvironmentVariables.HTTPS_PROXY.toLowerCase()]; } else if (process.env[StorageServiceClientConstants.EnvironmentVariables.HTTP_PROXY]) { proxyUrl = process.env[StorageServiceClientConstants.EnvironmentVariables.HTTP_PROXY]; } else if (process.env[StorageServiceClientConstants.EnvironmentVariables.HTTP_PROXY.toLowerCase()]) { proxyUrl = process.env[StorageServiceClientConstants.EnvironmentVariables.HTTP_PROXY.toLowerCase()]; } return proxyUrl; }; /** * Initializes the location to which the operation is being sent to. */ StorageServiceClient.prototype._initializeLocation = function (options) { if(!azureutil.objectIsNull(options.locationMode)) { switch(options.locationMode) { case StorageUtilities.LocationMode.PRIMARY_ONLY: case StorageUtilities.LocationMode.PRIMARY_THEN_SECONDARY: options.currentLocation = Constants.StorageLocation.PRIMARY; break; case StorageUtilities.LocationMode.SECONDARY_ONLY: case StorageUtilities.LocationMode.SECONDARY_THEN_PRIMARY: options.currentLocation = Constants.StorageLocation.SECONDARY; break; default: throw new RangeError(util.format(SR.ARGUMENT_OUT_OF_RANGE_ERROR, 'locationMode', options.locationMode)); } } else { options.locationMode = StorageUtilities.LocationMode.PRIMARY_ONLY; options.currentLocation = Constants.StorageLocation.PRIMARY; } }; /** * Validates the location to which the operation is being sent to. */ StorageServiceClient.prototype._validateLocation = function (options) { if(this._invalidLocationMode(options.locationMode)) { throw new ArgumentNullError('host', SR.STORAGE_HOST_MISSING_LOCATION); } switch(options.requestLocationMode) { case Constants.RequestLocationMode.PRIMARY_ONLY: if(options.locationMode === StorageUtilities.LocationMode.SECONDARY_ONLY) { throw new ArgumentError('host.primaryHost', SR.PRIMARY_ONLY_COMMAND); } options.currentLocation = Constants.StorageLocation.PRIMARY; options.locationMode = StorageUtilities.LocationMode.PRIMARY_ONLY; break; case Constants.RequestLocationMode.SECONDARY_ONLY: if(options.locationMode === StorageUtilities.LocationMode.PRIMARY_ONLY) { throw new ArgumentError('host.secondaryHost', SR.SECONDARY_ONLY_COMMAND); } options.currentLocation = Constants.StorageLocation.SECONDARY; options.locationMode = StorageUtilities.LocationMode.SECONDARY_ONLY; break; default: // no op } }; /** * Checks whether we have the relevant host information based on the locationMode. */ StorageServiceClient.prototype._invalidLocationMode = function (locationMode) { switch(locationMode) { case StorageUtilities.LocationMode.PRIMARY_ONLY: return azureutil.objectIsNull(this.host.primaryHost); case StorageUtilities.LocationMode.SECONDARY_ONLY: return azureutil.objectIsNull(this.host.secondaryHost); default: return (azureutil.objectIsNull(this.host.primaryHost) || azureutil.objectIsNull(this.host.secondaryHost)); } }; /** * Checks to see if the maximum execution timeout provided has been exceeded. */ StorageServiceClient.prototype._maximumExecutionTimeExceeded = function (currentTime, expiryTime) { if(!azureutil.objectIsNull(expiryTime) &amp;&amp; currentTime &gt; expiryTime) { return true; } else { return false; } }; /** * Sets the operation expiry time. */ StorageServiceClient.prototype._setOperationExpiryTime = function (options) { if(azureutil.objectIsNull(options.operationExpiryTime)) { if(!azureutil.objectIsNull(options.maximumExecutionTimeInMs)) { options.operationExpiryTime = Date.now() + options.maximumExecutionTimeInMs; } else if(this.defaultMaximumExecutionTimeInMs) { options.operationExpiryTime = Date.now() + this.defaultMaximumExecutionTimeInMs; } } }; module.exports = StorageServiceClient; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_blobservice.browser.js.html":{"id":"services_blob_blobservice.browser.js.html","title":"Source: services/blob/blobservice.browser.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/blobservice.browser.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // var BlobService = require('./blobservice.core'); var azureCommon = require('./../../common/common.browser'); var extend = require('extend'); var mime = require('browserify-mime'); var Constants = azureCommon.Constants; var azureutil = azureCommon.util; var BlobConstants = Constants.BlobConstants; var BrowserFileReadStream = azureCommon.BrowserFileReadStream; var SpeedSummary = azureCommon.SpeedSummary; var validate = azureCommon.validate; /** * Creates a new block blob. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * (Only available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {File} browserFile The File object to be uploaded created by HTML File API. * @param {object} [options] The request options. * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createBlockBlobFromBrowserFile = function (container, blob, browserFile, optionsOrCallback, callback) { return this._createBlobFromBrowserFile(container, blob, BlobConstants.BlobTypes.BLOCK, browserFile, optionsOrCallback, callback); }; /** * Uploads a page blob from an HTML file. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * (Only available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {File} browserFile The File object to be uploaded created by HTML File API. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The upload tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createPageBlobFromBrowserFile = function (container, blob, browserFile, optionsOrCallback, callback) { return this._createBlobFromBrowserFile(container, blob, BlobConstants.BlobTypes.PAGE, browserFile, optionsOrCallback, callback); }; /** * Creates a new append blob from an HTML File object. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * If you want to append data to an already existing blob, please look at appendFromBrowserFile. * (Only available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {File} browserFile The File object to be uploaded created by HTML File API. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 ahash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createAppendBlobFromBrowserFile = function (container, blob, browserFile, optionsOrCallback, callback) { return this._createBlobFromBrowserFile(container, blob, BlobConstants.BlobTypes.APPEND, browserFile, optionsOrCallback, callback); }; /** * Appends to an append blob from an HTML File object. Assumes the blob already exists on the service. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * (Only available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {File} browserFile The File object to be uploaded created by HTML File API. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.appendFromBrowserFile = function (container, blob, browserFile, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('appendFromBrowserFile', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.browserFileIsValid(browserFile); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(blob); var stream = new BrowserFileReadStream(browserFile); var streamCallback = function (appendError, blob, response) { if (azureutil.objectIsFunction(stream.destroy)) { stream.destroy(); } callback(appendError, blob, response); }; this._uploadBlobFromStream(false, container, blob, BlobConstants.BlobTypes.APPEND, stream, browserFile.size, options, streamCallback); return options.speedSummary; }; // Private methods /** * Creates a new blob (Block/Page/Append). If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * (Only available in the JavaScript Client Library for Browsers) * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param {File} browserFile The File object to be uploaded created by HTML File API. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The MD5 hash of the blob content. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback The callback function. * * @return {SpeedSummary} * */ BlobService.prototype._createBlobFromBrowserFile = function (container, blob, blobType, browserFile, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_createBlobFromBrowserFile', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.blobTypeIsValid(blobType); v.browserFileIsValid(browserFile); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(blob); var self = this; var creationCallback = function (createError, createBlob, createResponse) { if (createError) { callback(createError, createBlob, createResponse); } else { // Automatically detect the mime type if(azureutil.tryGetValueChain(options, ['contentSettings','contentType'], undefined) === undefined) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings','contentType'], mime.lookup(browserFile.name)); } var stream = new BrowserFileReadStream(browserFile); var streamCallback = function (createError, createBlob, createResponse) { if (azureutil.objectIsFunction(stream.destroy)) { stream.destroy(); } callback(createError, createBlob, createResponse); }; self._uploadBlobFromStream(true, container, blob, blobType, stream, browserFile.size, options, streamCallback); } }; this._createBlob(container, blob, blobType, browserFile.size, options, creationCallback); return options.speedSummary; }; module.exports = BlobService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_blobservice.node.js.html":{"id":"services_blob_blobservice.node.js.html","title":"Source: services/blob/blobservice.node.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/blobservice.node.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var azureCommon = require('./../../common/common.node'); var BlobService = require('./blobservice.core'); var extend = require('extend'); var fs = require('fs'); var mime = require('browserify-mime'); var azureutil = azureCommon.util; var Constants = azureCommon.Constants; var FileReadStream = azureCommon.FileReadStream; var SpeedSummary = azureCommon.SpeedSummary; var validate = azureCommon.validate; var BlobConstants = Constants.BlobConstants; /** * Downloads a blob into a file. * (Not available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} localFileName The local path to the file to be downloaded. * @param {object} [options] The request options. * @param {boolean} [options.skipSizeCheck] Skip the size check to perform direct download. * Set the option to true for small blobs. * Parallel download and speed summary won't work with this option on. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link BlobResult}` will contain the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} * * @example * var azure = require('azure-storage'); * var blobService = azure.createBlobService(); * blobService.getBlobToLocalFile('taskcontainer', 'task1', 'task1-download.txt', function(error, serverBlob) { * if(!error) { * // Blob available in serverBlob.blob variable * } */ BlobService.prototype.getBlobToLocalFile = function (container, blob, localFileName, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); validate.validateArgs('getBlobToLocalFile', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.string(localFileName, 'localFileName'); v.containerNameIsValid(container); v.callback(callback); }); return this._getBlobToLocalFile(container, blob, localFileName, options, callback); }; /** * Uploads a page blob from file. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * (Not available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param (string) localFileName The local path to the file to be uploaded. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The upload tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. * The default value is false for page blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createPageBlobFromLocalFile = function (container, blob, localFileName, optionsOrCallback, callback) { return this._createBlobFromLocalFile(container, blob, BlobConstants.BlobTypes.PAGE, localFileName, optionsOrCallback, callback); }; /** * Creates a new block blob. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * (Not available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} localFileName The local path to the file to be uploaded. * @param {object} [options] The request options. * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createBlockBlobFromLocalFile = function (container, blob, localFileName, optionsOrCallback, callback) { return this._createBlobFromLocalFile(container, blob, BlobConstants.BlobTypes.BLOCK, localFileName, optionsOrCallback, callback); }; /** * Creates a new append blob from a local file. If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * If you want to append data to an already existing blob, please look at appendFromLocalFile. * (Not available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} localFileName The local path to the file to be uploaded. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 ahash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.createAppendBlobFromLocalFile = function (container, blob, localFileName, optionsOrCallback, callback) { return this._createBlobFromLocalFile(container, blob, BlobConstants.BlobTypes.APPEND, localFileName, optionsOrCallback, callback); }; /** * Appends to an append blob from a local file. Assumes the blob already exists on the service. * This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks. * If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. * (Not available in the JavaScript Client Library for Browsers) * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} localFileName The local path to the file to be uploaded. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. * @param {string} [options.leaseId] The lease identifier. * @param {object} [options.metadata] The metadata key/value pairs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The blob's MD5 hash. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link BlobResult}` will contain * the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ BlobService.prototype.appendFromLocalFile = function (container, blob, localFileName, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('appendFromLocalFile', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.string(localFileName, 'localFileName'); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(blob); var self = this; fs.stat(localFileName, function (error, stat) { if (error) { callback(error); } else { var stream = new FileReadStream(localFileName, { calcContentMd5: options.storeBlobContentMD5 }); var streamCallback = function (appendError, blob, response) { if (azureutil.objectIsFunction(stream.destroy)) { stream.destroy(); } callback(appendError, blob, response); }; self._uploadBlobFromStream(false, container, blob, BlobConstants.BlobTypes.APPEND, stream, stat.size, options, streamCallback); } }); return options.speedSummary; }; // Private methods /** * Creates a new blob (Block/Page/Append). If the blob already exists on the service, it will be overwritten. * To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. * * @ignore * * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {BlobType} blobType The blob type. * @param {string} localFileName The local path to the file to be uploaded. * @param {object} [options] The request options. * @param {bool} [options.absorbConditionalErrorsOnRetry] Specifies whether to absorb the conditional error on retry. (For append blob only) * @param {int} [options.blockSize] The size of each block. Maximum is 100MB. * @param {string} [options.blockIdPrefix] The prefix to be used to generate the block id. (For block blob only) * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.transactionalContentMD5] An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.storeBlobContentMD5] Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. * @param {object} [options.contentSettings] The content settings of the blob. * @param {string} [options.contentSettings.contentType] The MIME content type of the blob. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the blob. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The Blob service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The blob's content disposition. * @param {string} [options.contentSettings.contentMD5] The MD5 hash of the blob content. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback The callback function. * * @return {SpeedSummary} * */ BlobService.prototype._createBlobFromLocalFile = function (container, blob, blobType, localFileName, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_createBlobFromLocalFile', function (v) { v.string(container, 'container'); v.string(blob, 'blob'); v.containerNameIsValid(container); v.blobTypeIsValid(blobType); v.string(localFileName, 'localFileName'); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(blob); var self = this; var size = 0; var creationCallback = function (createError, createBlob, createResponse) { if (createError) { callback(createError, createBlob, createResponse); } else { // Automatically detect the mime type if(azureutil.tryGetValueChain(options, ['contentSettings','contentType'], undefined) === undefined) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings','contentType'], mime.lookup(localFileName)); } var stream = new FileReadStream(localFileName, { calcContentMd5: options.storeBlobContentMD5 }); var streamCallback = function (createError, createBlob, createResponse) { if (azureutil.objectIsFunction(stream.destroy)) { stream.destroy(); } callback(createError, createBlob, createResponse); }; self._uploadBlobFromStream(true, container, blob, blobType, stream, size, options, streamCallback); } }; // Check the file size to determine the upload method: single request or chunks fs.stat(localFileName, function (error, stat) { if (error) { callback(error); } else { size = stat.size; self._createBlob(container, blob, blobType, size, options, creationCallback); } }); return options.speedSummary; }; /** * Downloads a blob into a file. * @ignore * @this {BlobService} * @param {string} container The container name. * @param {string} blob The blob name. * @param {string} localFileName The local path to the file to be downloaded. * @param {object} [options] The request options. * @param {boolean} [options.skipSizeCheck] Skip the size check to perform direct download. * Set the option to true for small blobs. * Parallel download and speed summary won't work with this option on. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.snapshotId] The snapshot identifier. * @param {string} [options.leaseId] The lease identifier. * @param {string} [options.rangeStart] Return only the bytes of the blob in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the blob in the specified range. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading blobs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the blob information. * `response` will contain information related to this operation. * @return {SpeedSummary} * */ BlobService.prototype._getBlobToLocalFile = function (container, blob, localFileName, optionsOrCallback, callback) { var options; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; }); options.speedSummary = options.speedSummary || new SpeedSummary(blob); var writeStream = fs.createWriteStream(localFileName, { 'highWaterMark': BlobConstants.MAX_QUEUED_WRITE_DISK_BUFFER_SIZE }); writeStream.on('error', function (error) { callback(error); return; }); this.getBlobToStream(container, blob, writeStream, options, function (error, responseBlob, response) { if (error) { if (fs.existsSync(localFileName)) { // make sure writeStream is closed / destroyed to avoid locking issues if (writeStream.close) { writeStream.close(); } // If the download failed from the beginning, remove the file. fs.unlink(localFileName, function () { callback(error, responseBlob, response); }); return; } } callback(error, responseBlob, response); }); return options.speedSummary; }; module.exports = BlobService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_blobutilities.js.html":{"id":"services_blob_blobutilities.js.html","title":"Source: services/blob/blobutilities.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/blobutilities.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Expose 'BlobUtilities'. exports = module.exports; /** * Defines constants, enums, and utility functions for use with the Blob service. * @namespace BlobUtilities */ var BlobUtilities = { /** * Permission types * * @const * @enum {string} */ SharedAccessPermissions: { READ: 'r', ADD: 'a', CREATE: 'c', WRITE: 'w', DELETE: 'd', LIST: 'l' }, /** * Blob listing details. * * @const * @enum {string} */ BlobListingDetails: { SNAPSHOTS: 'snapshots', METADATA: 'metadata', UNCOMMITTED_BLOBS: 'uncommittedblobs', COPY: 'copy' }, /** * Deletion options for blob snapshots * * @const * @enum {string} */ SnapshotDeleteOptions: { SNAPSHOTS_ONLY: 'only', BLOB_AND_SNAPSHOTS: 'include' }, /** * Type of block list to retrieve * * @const * @enum {string} */ BlockListFilter: { ALL: 'all', COMMITTED: 'committed', UNCOMMITTED: 'uncommitted' }, /** * Blobs and container public access types. * * @const * @enum {string} */ BlobContainerPublicAccessType: { OFF: null, CONTAINER: 'container', BLOB: 'blob' }, /** * Describes actions that can be performed on a page blob sequence number. * @const * @enum */ SequenceNumberAction: { MAX: 'max', UPDATE: 'update', INCREMENT: 'increment' } }; module.exports = BlobUtilities; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_models_containerresult.js.html":{"id":"services_blob_models_containerresult.js.html","title":"Source: services/blob/models/containerresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/models/containerresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var azureCommon = require('./../../../common/common.core'); var azureutil = azureCommon.util; var Constants = azureCommon.Constants; var HeaderConstants = Constants.HeaderConstants; var BlobUtilities = require('../blobutilities'); /** * Creates a new ContainerResult object. * @class * The ContainerResult class is used to store the container information. * * @property {string} name The container name. * @property {string} publicAccessLevel The public access level. * @property {object} metadata The metadata key/value pair. * @property {string} etag The etag. * @property {string} lastModified The date/time that the container was last modified. * @property {string} requestId The request id. * @property {object} lease The lease information. * @property {string} lease.status The lease status. * @property {string} lease.state The lease state. * @property {string} lease.duration The lease duration. * * @constructor * @param {string} [container] The container name. * @param {string} [publicAccessLevel] The public access level. */ function ContainerResult(name, publicAccessLevel) { if (name) { this.name = name; } if (publicAccessLevel) { this.publicAccessLevel = publicAccessLevel; } } ContainerResult.parse = function (containerXml) { var containerResult = new ContainerResult(); for (var propertyName in containerXml) { if (containerXml.hasOwnProperty(propertyName)) { if (propertyName === 'Properties') { // Lift out the properties onto the main object to keep consistent across all APIs like: getContainerProperties azureutil.setPropertyValueFromXML(containerResult, containerXml[propertyName], true); } else if (propertyName === 'Metadata') { var resultPropertyName = azureutil.normalizePropertyNameFromXML(propertyName); containerResult[resultPropertyName] = {}; azureutil.setPropertyValueFromXML(containerResult[resultPropertyName], containerXml[propertyName], false); } else { containerResult[propertyName.toLowerCase()] = containerXml[propertyName]; } } } if (!containerResult.publicAccessLevel) { containerResult.publicAccessLevel = BlobUtilities.BlobContainerPublicAccessType.OFF; } return containerResult; }; ContainerResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; var setContainerPropertyFromHeaders = function (containerProperty, headerProperty) { if (!azureutil.tryGetValueChain(self, containerProperty.split('.'), null) &amp;&amp; headers[headerProperty.toLowerCase()]) { azureutil.setObjectInnerPropertyValue(self, containerProperty.split('.'), headers[headerProperty.toLowerCase()]); } }; setContainerPropertyFromHeaders('etag', HeaderConstants.ETAG); setContainerPropertyFromHeaders('lastModified', HeaderConstants.LAST_MODIFIED); setContainerPropertyFromHeaders('lease.status', HeaderConstants.LEASE_STATUS); setContainerPropertyFromHeaders('lease.state', HeaderConstants.LEASE_STATE); setContainerPropertyFromHeaders('lease.duration', HeaderConstants.LEASE_DURATION); setContainerPropertyFromHeaders('requestId', HeaderConstants.REQUEST_ID); if (!self.publicAccessLevel) { self.publicAccessLevel = BlobUtilities.BlobContainerPublicAccessType.OFF; if (headers[HeaderConstants.BLOB_PUBLIC_ACCESS]) { self.publicAccessLevel = headers[HeaderConstants.BLOB_PUBLIC_ACCESS]; } } if (self.publicAccessLevel === 'true') { // The container was marked for full public read access using a version prior to 2009-09-19. self.publicAccessLevel = BlobUtilities.BlobContainerPublicAccessType.CONTAINER; } }; /** * The container ACL settings. * @typedef {object} ContainerAclResult * @extends {ContainerResult} * @property {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The container ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. */ module.exports = ContainerResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_models_directoryresult.js.html":{"id":"services_file_models_directoryresult.js.html","title":"Source: services/file/models/directoryresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/models/directoryresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var HeaderConstants = require('./../../../common/common.core').Constants.HeaderConstants; /** * Creates a new DirectoryResult object. * @class * The DirectoryResult class is used to store the directory information. * * @property {string} name The container name. * @property {object} metadata The metadata key/value pair. * @property {string} etag The etag. * @property {string} lastModified The date/time that the directory was last modified. * @property {string} requestId The request id. * * @constructor * @param {string} [name] The directory name. */ function DirectoryResult(name) { this.name = name; } DirectoryResult.parse = function (dirXml) { return new DirectoryResult(dirXml.Name); }; DirectoryResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; var setDirectoryPropertyFromHeaders = function (directoryProperty, headerProperty) { if (!self[directoryProperty] &amp;&amp; headers[headerProperty.toLowerCase()]) { self[directoryProperty] = headers[headerProperty.toLowerCase()]; } }; setDirectoryPropertyFromHeaders('etag', HeaderConstants.ETAG); setDirectoryPropertyFromHeaders('lastModified', HeaderConstants.LAST_MODIFIED); setDirectoryPropertyFromHeaders('requestId', HeaderConstants.REQUEST_ID); }; module.exports = DirectoryResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"common_filters_exponentialretrypolicyfilter.js.html":{"id":"common_filters_exponentialretrypolicyfilter.js.html","title":"Source: common/filters/exponentialretrypolicyfilter.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: common/filters/exponentialretrypolicyfilter.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // 'use strict'; var RetryPolicyFilter = require('./retrypolicyfilter'); /** * Creates a new 'ExponentialRetryPolicyFilter' instance. * @class * The ExponentialRetryPolicyFilter allows you to retry operations, * using an exponential back-off interval between retries. * To apply a filter to service operations, use `withFilter` * and specify the filter to be used when creating a service. * @constructor * @param {number} [retryCount=3] The client retry count. * @param {number} [retryInterval=30000] The client retry interval, in milliseconds. * @param {number} [minRetryInterval=3000] The minimum retry interval, in milliseconds. * @param {number} [maxRetryInterval=90000] The maximum retry interval, in milliseconds. * * @example * var azure = require('azure-storage'); * var retryOperations = new azure.ExponentialRetryPolicyFilter(); * var blobService = azure.createBlobService().withFilter(retryOperations) */ function ExponentialRetryPolicyFilter(retryCount, retryInterval, minRetryInterval, maxRetryInterval) { this.retryCount = retryCount ? retryCount : ExponentialRetryPolicyFilter.DEFAULT_CLIENT_RETRY_COUNT; this.retryInterval = retryInterval ? retryInterval : ExponentialRetryPolicyFilter.DEFAULT_CLIENT_RETRY_INTERVAL; this.minRetryInterval = minRetryInterval ? minRetryInterval : ExponentialRetryPolicyFilter.DEFAULT_CLIENT_MIN_RETRY_INTERVAL; this.maxRetryInterval = maxRetryInterval ? maxRetryInterval : ExponentialRetryPolicyFilter.DEFAULT_CLIENT_MAX_RETRY_INTERVAL; } /** * Represents the default client retry interval, in milliseconds. */ ExponentialRetryPolicyFilter.DEFAULT_CLIENT_RETRY_INTERVAL = 1000 * 30; /** * Represents the default client retry count. */ ExponentialRetryPolicyFilter.DEFAULT_CLIENT_RETRY_COUNT = 3; /** * Represents the default maximum retry interval, in milliseconds. */ ExponentialRetryPolicyFilter.DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 90; /** * Represents the default minimum retry interval, in milliseconds. */ ExponentialRetryPolicyFilter.DEFAULT_CLIENT_MIN_RETRY_INTERVAL = 1000 * 3; /** * Determines if the operation should be retried and how long to wait until the next retry. * * @param {number} statusCode The HTTP status code. * @param {object} requestOptions The request options. * @return {retryInfo} Information about whether the operation qualifies for a retry and the retryInterval. */ ExponentialRetryPolicyFilter.prototype.shouldRetry = function (statusCode, requestOptions) { var retryData = (requestOptions &amp;&amp; requestOptions.retryContext) ? requestOptions.retryContext : {}; // Adjust retry interval var incrementDelta = Math.pow(2, retryData.retryCount) - 1; var boundedRandDelta = this.retryInterval * 0.8 + Math.floor(Math.random() * (this.retryInterval * 1.2 - this.retryInterval * 0.8)); incrementDelta *= boundedRandDelta; retryData.retryInterval = Math.min(this.minRetryInterval + incrementDelta, this.maxRetryInterval); return RetryPolicyFilter._shouldRetryOnError(statusCode, requestOptions); }; /** * Handles an operation with an exponential retry policy. * * @param {Object} requestOptions The original request options. * @param {function} next The next filter to be handled. */ ExponentialRetryPolicyFilter.prototype.handle = function (requestOptions, next) { RetryPolicyFilter._handle(this, requestOptions, next); }; module.exports = ExponentialRetryPolicyFilter; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_models_fileresult.js.html":{"id":"services_file_models_fileresult.js.html","title":"Source: services/file/models/fileresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/models/fileresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var _ = require('underscore'); var azureCommon = require('./../../../common/common.core'); var azureutil = azureCommon.util; var Constants = azureCommon.Constants; var HeaderConstants = Constants.HeaderConstants; /** * Creates a new FileResult object. * @class * The FileResult class is used to store the file information. * * @property {string} share The share name. * @property {string} directory The directory name. * @property {string} name The file name. * @property {object} metadata The metadata key/value pair. * @property {string} etag The etag. * @property {string} lastModified The date/time that the file was last modified. * @property {string} requestId The request id. * @property {string} acceptRanges The accept ranges. * @property {string} contentRange The content range * @property {string} contentLength The size of the file in bytes. * @property {object} contentSettings The content settings. * @property {string} contentSettings.contentType The content type. * @property {string} contentSettings.contentEncoding The content encoding. * @property {string} contentSettings.contentLanguage The content language. * @property {string} contentSettings.cacheControl The cache control. * @property {string} contentSettings.contentDisposition The content disposition. * @property {string} contentSettings.contentMD5 The content MD5 hash. * @property {object} copy The copy information. * @property {string} copy.id The copy id. * @property {string} copy.status The copy status. * @property {string} copy.completionTime The copy completion time. * @property {string} copy.statusDescription The copy status description. * @property {string} copy.progress The copy progress. * @property {string} copy.source The copy source. * * @constructor * @param {string} [share] The share name. * @param {string} [directory] The directory name. * @param {string} [name] The file name. */ function FileResult(share, directory, name) { this.share = share; this.directory = directory; this.name = name; } FileResult.parse = function (entryXml) { var listResult = new FileResult(); for (var propertyName in entryXml) { if (propertyName === 'Properties') { // Lift out the properties onto the main object to keep consistent across all APIs like: getFileProperties azureutil.setPropertyValueFromXML(listResult, entryXml[propertyName], true); } else { listResult[propertyName.toLowerCase()] = entryXml[propertyName]; } } return listResult; }; var responseHeaders = { 'acceptRanges': 'ACCEPT_RANGES', 'contentLength': 'CONTENT_LENGTH', 'contentRange': 'CONTENT_RANGE', 'contentSettings.contentType': 'CONTENT_TYPE', 'contentSettings.contentEncoding': 'CONTENT_ENCODING', 'contentSettings.contentLanguage': 'CONTENT_LANGUAGE', 'contentSettings.cacheControl': 'CACHE_CONTROL', 'contentSettings.contentDisposition': 'CONTENT_DISPOSITION', 'contentSettings.contentMD5': 'CONTENT_MD5', 'contentSettings.fileContentMD5': 'FILE_CONTENT_MD5', 'copy.id': 'COPY_ID', 'copy.status': 'COPY_STATUS', 'copy.source': 'COPY_SOURCE', 'copy.progress': 'COPY_PROGRESS', 'copy.completionTime': 'COPY_COMPLETION_TIME', 'copy.statusDescription': 'COPY_STATUS_DESCRIPTION' }; FileResult.prototype.getPropertiesFromHeaders = function (headers, content) { var self = this; var setFilePropertyFromHeaders = function (fileProperty, headerProperty) { if (!azureutil.tryGetValueChain(self, fileProperty.split('.'), null) &amp;&amp; headers[headerProperty.toLowerCase()]) { azureutil.setObjectInnerPropertyValue(self, fileProperty.split('.'), headers[headerProperty.toLowerCase()]); if (fileProperty === 'copy.progress') { var info = azureutil.parseCopyProgress(self.copy.progress); self.copy.bytesCopied = parseInt(info.bytesCopied); self.copy.totalBytes = parseInt(info.totalBytes); } } }; // For range get, 'x-ms-content-md5' indicate the overall MD5 of the file. Try to set the contentMD5 using this header if it presents setFilePropertyFromHeaders('contentSettings.contentMD5', HeaderConstants['FILE_CONTENT_MD5']); setFilePropertyFromHeaders('etag', HeaderConstants.ETAG); setFilePropertyFromHeaders('lastModified', HeaderConstants.LAST_MODIFIED); setFilePropertyFromHeaders('requestId', HeaderConstants.REQUEST_ID); if (content) { _.chain(responseHeaders).pairs().each(function (pair) { var property = pair[0]; var header = HeaderConstants[pair[1]]; setFilePropertyFromHeaders(property, header); }); } }; /** * This method sets the HTTP headers and is used by all methods except setFileProperties and createFile. * Those methods will set the x-ms-* headers using setProperties. */ FileResult.setHeaders = function (webResource, options) { var setHeaderProperty = function (headerProperty, fileProperty) { var propertyValue = azureutil.tryGetValueChain(options, fileProperty.split('.'), null); if (propertyValue) { webResource.withHeader(headerProperty, propertyValue); } }; if (options) { // Content-MD5 setHeaderProperty(HeaderConstants.CONTENT_MD5, 'transactionalContentMD5'); // Content-Length setHeaderProperty(HeaderConstants.CONTENT_LENGTH, 'contentLength'); // Range if (!azureutil.objectIsNull(options.rangeStart)) { var range = 'bytes=' + options.rangeStart + '-'; if (!azureutil.objectIsNull(options.rangeEnd)) { range += options.rangeEnd; } webResource.withHeader(HeaderConstants.STORAGE_RANGE, range); } } }; /** * This method sets the x-ms-* headers and is used by setFileProperties and createFile. * All other methods will set the regular HTTP headers using setHeaders. */ FileResult.setProperties = function (webResource, options) { var setHeaderProperty = function (headerProperty, fileProperty) { var propertyValue = azureutil.tryGetValueChain(options, fileProperty.split('.'), null); if (propertyValue) { webResource.withHeader(headerProperty, propertyValue); } }; if (options) { // Content-Length setHeaderProperty(HeaderConstants.FILE_CONTENT_LENGTH, 'contentLength'); // Content-Type setHeaderProperty(HeaderConstants.FILE_CONTENT_TYPE, 'contentSettings.contentType'); // Content-Encoding setHeaderProperty(HeaderConstants.FILE_CONTENT_ENCODING, 'contentSettings.contentEncoding'); // Content-Language setHeaderProperty(HeaderConstants.FILE_CONTENT_LANGUAGE, 'contentSettings.contentLanguage'); // Content-Disposition setHeaderProperty(HeaderConstants.FILE_CONTENT_DISPOSITION, 'contentSettings.contentDisposition'); // Cache-Control setHeaderProperty(HeaderConstants.FILE_CACHE_CONTROL, 'contentSettings.cacheControl'); // Content-MD5 setHeaderProperty(HeaderConstants.FILE_CONTENT_MD5, 'contentSettings.contentMD5'); if (options.metadata) { webResource.addOptionalMetadataHeaders(options.metadata); } } }; module.exports = FileResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_fileservice.core.js.html":{"id":"services_file_fileservice.core.js.html","title":"Source: services/file/fileservice.core.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/fileservice.core.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var qs = require('querystring'); var url = require('url'); var util = require('util'); var _ = require('underscore'); var extend = require('extend'); var path = require('path'); var azureCommon = require('./../../common/common.core'); var Md5Wrapper = require('./../../common/md5-wrapper'); var azureutil = azureCommon.util; var SR = azureCommon.SR; var validate = azureCommon.validate; var SpeedSummary = azureCommon.SpeedSummary; var StorageServiceClient = azureCommon.StorageServiceClient; var WebResource = azureCommon.WebResource; // Constants var Constants = azureCommon.Constants; var FileConstants = Constants.FileConstants; var HeaderConstants = Constants.HeaderConstants; var HttpConstants = Constants.HttpConstants; var QueryStringConstants = Constants.QueryStringConstants; // Streams var BatchOperation = azureCommon.BatchOperation; var SpeedSummary = azureCommon.SpeedSummary; var ChunkAllocator = azureCommon.ChunkAllocator; var ChunkStream = azureCommon.ChunkStream; var ChunkStreamWithStream = azureCommon.ChunkStreamWithStream; var FileRangeStream = require('./internal/filerangestream'); // Models requires var ShareResult = require('./models/shareresult'); var DirectoryResult = require('./models/directoryresult'); var FileResult = require('./models/fileresult'); var AclResult = azureCommon.AclResult; // Errors requires var errors = require('../../common/errors/errors'); var ArgumentNullError = errors.ArgumentNullError; /** * Creates a new FileService object. * If no connection string or storageaccount and storageaccesskey are provided, * the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. * @class * The FileService class is used to perform operations on the Microsoft Azure File Service. * The File Service provides storage for binary large objects, and provides functions for working with data stored in files. * * For more information on the File Service, as well as task focused information on using it in a Node.js application, see * [How to Use the File Service from Node.js](http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-file-storage/). * The following defaults can be set on the file service. * defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the file service. * defaultEnableReuseSocket The default boolean value to enable socket reuse when uploading local files or streams. * If the Node.js version is lower than 0.10.x, socket reuse will always be turned off. * defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the file service. * defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the file service. * defaultLocationMode The default location mode for requests made via the file service. * parallelOperationThreadCount The number of parallel operations that may be performed when uploading a file. * useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the file service; true to use the * Nagle algorithm; otherwise, false. The default value is false. * @constructor * @extends {StorageServiceClient} * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} [sasToken] The Shared Access Signature token. * @param {string} [endpointSuffix] The endpoint suffix. */ function FileService(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix) { var storageServiceSettings = StorageServiceClient.getStorageSettings(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix); FileService['super_'].call(this, storageServiceSettings._name, storageServiceSettings._key, storageServiceSettings._fileEndpoint, storageServiceSettings._usePathStyleUri, storageServiceSettings._sasToken); this.defaultEnableReuseSocket = Constants.DEFAULT_ENABLE_REUSE_SOCKET; this.singleFileThresholdInBytes = FileConstants.DEFAULT_SINGLE_FILE_GET_THRESHOLD_IN_BYTES; this.parallelOperationThreadCount = Constants.DEFAULT_PARALLEL_OPERATION_THREAD_COUNT; } util.inherits(FileService, StorageServiceClient); // Utility methods /** * Create resource name * @ignore * * @param {string} share Share name * @param {string} [directory] Directory name * @param {string} [file] File name * @return {string} The encoded resource name. */ function createResourceName(share, directory, file, forSAS) { var encode = function(name) { if (name &amp;&amp; !forSAS) { name = encodeURIComponent(name); name = name.replace(/%2F/g, '/'); name = name.replace(/%5C/g, '/'); name = name.replace(/\\+/g, '%20'); } return name; }; var name = share; if (directory) { // if directory does not start with '/', add it if (directory[0] !== '/') { name += ('/'); } name += encode(directory); } if (file) { // if the current path does not end with '/', add it if (name[name.length - 1] !== '/') { name += ('/'); } name += encode(file); } return path.normalize(name).replace(/\\\\/g, '/'); } // File service methods /** * Gets the properties of a storage account's File service, including Azure Storage Analytics. * * @this {FileService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; otherwise, `[result]{@link ServiceProperties}` will contain the properties * and `response` will contain information related to this operation. */ FileService.prototype.getServiceProperties = function (optionsOrCallback, callback) { return this.getAccountServiceProperties(optionsOrCallback, callback); }; /** * Sets the properties of a storage account's File service, including Azure Storage Analytics. * You can also use this operation to set the default request version for all incoming requests that do not have a version specified. * * @this {FileService} * @param {object} serviceProperties The service properties. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise, `response` * will contain information related to this operation. */ FileService.prototype.setServiceProperties = function (serviceProperties, optionsOrCallback, callback) { return this.setAccountServiceProperties(serviceProperties, optionsOrCallback, callback); }; // Share methods /** * Lists a segment containing a collection of share items under the specified account. * * @this {FileService} * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.maxResults] Specifies the maximum number of shares to return per call to Azure storage. * @param {string} [options.include] Include this parameter to specify that the share's metadata be returned as part of the response body. (allowed values: '', 'metadata') * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[shares]{@link ShareResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ FileService.prototype.listSharesSegmented = function (currentToken, optionsOrCallback, callback) { this.listSharesSegmentedWithPrefix(null /* prefix */, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of share items whose names begin with the specified prefix under the specified account. * * @this {FileService} * @param {string} prefix The prefix of the share name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {string} [options.prefix] Filters the results to return only shares whose name begins with the specified prefix. * @param {int} [options.maxResults] Specifies the maximum number of shares to return per call to Azure storage. * @param {string} [options.include] Include this parameter to specify that the share's metadata be returned as part of the response body. (allowed values: '', 'metadata') * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[shares]{@link ShareResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ FileService.prototype.listSharesSegmentedWithPrefix = function (prefix, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listShares', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get() .withQueryOption(QueryStringConstants.COMP, 'list') .withQueryOption(QueryStringConstants.MAX_RESULTS, options.maxResults) .withQueryOption(QueryStringConstants.INCLUDE, options.include); if (!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(QueryStringConstants.MARKER, currentToken.nextMarker); } webResource.withQueryOption(QueryStringConstants.PREFIX, prefix); //options.requestLocationMode = azureutil.getNextListingLocationMode(currentToken); var processResponseCallback = function (responseObject, next) { responseObject.listSharesResult = null; if (!responseObject.error) { responseObject.listSharesResult = { entries: null, continuationToken: null }; responseObject.listSharesResult.entries = []; var shares = []; if (responseObject.response.body.EnumerationResults.Shares &amp;&amp; responseObject.response.body.EnumerationResults.Shares.Share) { shares = responseObject.response.body.EnumerationResults.Shares.Share; if (!_.isArray(shares)) { shares = [shares]; } } shares.forEach(function (currentShare) { var shareResult = ShareResult.parse(currentShare); responseObject.listSharesResult.entries.push(shareResult); }); if (responseObject.response.body.EnumerationResults.NextMarker) { responseObject.listSharesResult.continuationToken = { nextMarker: null, targetLocation: null }; responseObject.listSharesResult.continuationToken.nextMarker = responseObject.response.body.EnumerationResults.NextMarker; responseObject.listSharesResult.continuationToken.targetLocation = responseObject.targetLocation; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.listSharesResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks whether or not a share exists on the service. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareResult}` will contain * the share information including `exists` boolean member. * `response` will contain information related to this operation. */ FileService.prototype.doesShareExist = function (share, optionsOrCallback, callback) { this._doesShareExist(share, false, optionsOrCallback, callback); }; /** * Creates a new share under the specified account. * If a share with the same name already exists, the operation fails. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {int} [options.quota] Specifies the maximum size of the share, in gigabytes. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareResult}` will contain * the share information. * `response` will contain information related to this operation. */ FileService.prototype.createShare = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createShare', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.shareQuotaIsValid(userOptions.quota); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withHeader(HeaderConstants.SHARE_QUOTA, options.quota); webResource.addOptionalMetadataHeaders(options.metadata); var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); if (options.metadata) { responseObject.shareResult.metadata = options.metadata; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Creates a new share under the specified account if the share does not exists. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {object} [options.metadata] The metadata key/value pairs. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareResult}` will contain * the share information including `created` boolean member. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var FileService = azure.createFileService(); * FileService.createShareIfNotExists('taskshare', function(error) { * if(!error) { * // Share created or already existed * } * }); */ FileService.prototype.createShareIfNotExists = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createShareIfNotExists', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesShareExist(share, true, options, function(error, result, response) { var exists = result.exists; result.created = false; delete result.exists; if(error){ callback(error, result, response); } else if (exists) { response.isSuccessful = true; callback(error, result, response); } else { self.createShare(share, options, function (createError, responseShare, createResponse) { if(!createError){ responseShare.created = true; } else if (createError &amp;&amp; createError.statusCode === HttpConstants.HttpResponseCodes.Conflict &amp;&amp; createError.code === Constants.FileErrorCodeStrings.SHARE_ALREADY_EXISTS) { // If it was created before, there was no actual error. createError = null; createResponse.isSuccessful = true; } callback(createError, responseShare, createResponse); }); } }); }; /** * Retrieves a share and its properties from a specified account. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareResult}` will contain * information for the share. * `response` will contain information related to this operation. */ FileService.prototype.getShareProperties = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getShareProperties', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share'); //options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets the properties for the specified share. * * @this {FileService} * @param {string} share The share name. * @param {object} [properties] The share properties to set. * @param {string|int} [properties.quota] Specifies the maximum size of the share, in gigabytes. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[share]{@link ShareResult}` will contain * information about the share. * `response` will contain information related to this operation. */ FileService.prototype.setShareProperties = function (share, properties, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setShareProperties', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.shareQuotaIsValid(userOptions.quota); v.callback(callback); }); var options = extend(true, properties, userOptions); var resourceName = createResourceName(share); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withQueryOption(QueryStringConstants.COMP, 'properties') .withHeader(HeaderConstants.SHARE_QUOTA, options.quota); FileResult.setProperties(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets the share statistics for a share. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; otherwise, `[result]{@link ServiceStats}` will contain the stats and * `response` will contain information related to this operation. */ FileService.prototype.getShareStats = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getShareStats', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share); var webResource = WebResource.get(resourceName) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withQueryOption(QueryStringConstants.COMP, 'stats'); var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = ShareResult.parse(responseObject.response.body, share); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); } // function to be called after all filters var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; // call the first filter next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Returns all user-defined metadata for the share. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareResult}` will contain * information for the share. * `response` will contain information related to this operation. */ FileService.prototype.getShareMetadata = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getShareMetadata', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withQueryOption(QueryStringConstants.COMP, 'metadata'); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets the share's metadata. * * Calling the Set Share Metadata operation overwrites all existing metadata that is associated with the share. * It's not possible to modify an individual name/value pair. * * @this {FileService} * @param {string} share The share name. * @param {object} metadata The metadata key/value pairs. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ FileService.prototype.setShareMetadata = function (share, metadata, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setShareMetadata', function (v) { v.string(share, 'share'); v.object(metadata, 'metadata'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withQueryOption(QueryStringConstants.COMP, 'metadata'); webResource.addOptionalMetadataHeaders(metadata); var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets the share's ACL. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareAclResult}` will contain * information for the share. * `response` will contain information related to this operation. */ FileService.prototype.getShareAcl = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getShareAcl', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withQueryOption(QueryStringConstants.COMP, 'acl'); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); responseObject.shareResult.signedIdentifiers = AclResult.parse(responseObject.response.body); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Updates the share's ACL. * * @this {FileService} * @param {string} share The share name. * @param {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The share ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link ShareAclResult}` will contain * information for the share. * `response` will contain information related to this operation. */ FileService.prototype.setShareAcl = function (share, signedIdentifiers, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setShareAcl', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var policies = null; if (signedIdentifiers) { if(_.isArray(signedIdentifiers)) { throw new TypeError(SR.INVALID_SIGNED_IDENTIFIERS); } policies = AclResult.serialize(signedIdentifiers); } var webResource = WebResource.put(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share') .withQueryOption(QueryStringConstants.COMP, 'acl') .withHeader(HeaderConstants.CONTENT_LENGTH, !azureutil.objectIsNull(policies) ? Buffer.byteLength(policies) : 0) .withBody(policies); var processResponseCallback = function (responseObject, next) { responseObject.shareResult = null; if (!responseObject.error) { responseObject.shareResult = new ShareResult(share); responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); if (signedIdentifiers) { responseObject.shareResult.signedIdentifiers = signedIdentifiers; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Marks the specified share for deletion. * The share and any files contained within it are later deleted during garbage collection. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ FileService.prototype.deleteShare = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteShare', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.del(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share'); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified share for deletion if it exists. * The share and any files contained within it are later deleted during garbage collection. * * @this {FileService} * @param {string} share The share name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will * be true if the share exists and was deleted, or false if the share * did not exist. * `response` will contain information related to this operation. */ FileService.prototype.deleteShareIfExists = function (share, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteShareIfExists', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesShareExist(share, true, options, function (error, result, response) { if(error){ callback(error, result.exists, response); } else if (!result.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteShare(share, options, function (deleteError, deleteResponse) { var deleted; if (!deleteError){ deleted = true; } else if (deleteError &amp;&amp; deleteError.statuscode === HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.FileErrorCodeStrings.SHARE_NOT_FOUND) { // If it was deleted already, there was no actual error. deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; // Directory methods /** * Checks whether or not a directory exists on the service. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link DirectoryResult}` will contain * the directory information including `exists` boolean member. * `response` will contain information related to this operation. */ FileService.prototype.doesDirectoryExist = function (share, directory, optionsOrCallback, callback) { this._doesDirectoryExist(share, directory, false, optionsOrCallback, callback); }; /** * Creates a new directory under the specified account. * If a directory with the same name already exists, the operation fails. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link DirectoryResult}` will contain * the directory information. * `response` will contain information related to this operation. */ FileService.prototype.createDirectory = function (share, directory, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createDirectory', function (v) { v.string(share, 'share'); v.string(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(createResourceName(share, directory)) .withQueryOption(QueryStringConstants.RESTYPE, 'directory'); webResource.addOptionalMetadataHeaders(options.metadata); var processResponseCallback = function (responseObject, next) { responseObject.directoryResult = null; if (!responseObject.error) { responseObject.directoryResult = new DirectoryResult(directory); responseObject.directoryResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.directoryResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Creates a new directory under the specified account if the directory does not exists. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link DirectoryResult}` will contain * the directory information including `created` boolean member. * already exists. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var FileService = azure.createFileService(); * FileService.createDirectoryIfNotExists('taskshare', taskdirectory', function(error) { * if(!error) { * // Directory created or already existed * } * }); */ FileService.prototype.createDirectoryIfNotExists = function (share, directory, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createDirectoryIfNotExists', function (v) { v.string(share, 'share'); v.string(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesDirectoryExist(share, directory, true, options, function(error, result, response) { var exists = result.exists; result.created = false; delete result.exists; if(error){ callback(error, result, response); } else if (exists) { response.isSuccessful = true; callback(error, result, response); } else { self.createDirectory(share, directory, options, function (createError, responseDirectory, createResponse) { if(!createError){ responseDirectory.created = true; } else if (createError &amp;&amp; createError.statusCode === HttpConstants.HttpResponseCodes.Conflict &amp;&amp; createError.code === Constants.StorageErrorCodeStrings.RESOURCE_ALREADY_EXISTS) { // If it was created before, there was no actual error. createError = null; createResponse.isSuccessful = true; } callback(createError, responseDirectory, createResponse); }); } }); }; /** * Retrieves a directory and its properties from a specified account. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link DirectoryResult}` will contain * information for the directory. * `response` will contain information related to this operation. */ FileService.prototype.getDirectoryProperties = function (share, directory, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getDirectoryProperties', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(createResourceName(share, directory)) .withQueryOption(QueryStringConstants.RESTYPE, 'directory'); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.directoryResult = null; if (!responseObject.error) { responseObject.directoryResult = new DirectoryResult(directory); responseObject.directoryResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.directoryResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.directoryResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified directory for deletion. The directory must be empty before it can be deleted. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ FileService.prototype.deleteDirectory = function (share, directory, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteDirectory', function (v) { v.string(share, 'share'); v.string(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.del(createResourceName(share, directory)) .withQueryOption(QueryStringConstants.RESTYPE, 'directory'); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified directory for deletion if it exists. The directory must be empty before it can be deleted. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will * be true if the directory exists and was deleted, or false if the directory * did not exist. * `response` will contain information related to this operation. */ FileService.prototype.deleteDirectoryIfExists = function (share, directory, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteDirectoryIfExists', function (v) { v.string(share, 'share'); v.string(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesDirectoryExist(share, directory, true, options, function(error, result, response) { if(error){ callback(error, result.exists, response); } else if (!result.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteDirectory(share, directory, options, function (deleteError, deleteResponse) { var deleted; if (!deleteError){ deleted = true; } else if (deleteError &amp;&amp; deleteError.statuscode === HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.StorageErrorCodeStrings.RESOURCE_NOT_FOUND) { // If it was deleted already, there was no actual error. deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; /** * Lists a segment containing a collection of file items in the directory. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {int} [options.maxResults] Specifies the maximum number of files to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * entries.files which contains a list of `[files]{@link FileResult}`, entries.directories which contains a list of `[directories]{@link DirectoryResult}` and the continuationToken for the next listing operation. * `response` will contain information related to this operation. */ FileService.prototype.listFilesAndDirectoriesSegmented = function (share, directory, currentToken, optionsOrCallback, callback) { this.listFilesAndDirectoriesSegmentedWithPrefix(share, directory, null /*prefix*/, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of file items in the directory. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} prefix The prefix of the directory/files name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {int} [options.maxResults] Specifies the maximum number of files to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * entries.files which contains a list of `[files]{@link FileResult}`, entries.directories which contains a list of `[directories]{@link DirectoryResult}` and the continuationToken for the next listing operation. * `response` will contain information related to this operation. */ FileService.prototype.listFilesAndDirectoriesSegmentedWithPrefix = function (share, directory, prefix, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listFilesSegmented', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(createResourceName(share, directory)) .withQueryOption(QueryStringConstants.RESTYPE, 'directory') .withQueryOption(QueryStringConstants.COMP, 'list') .withQueryOption(QueryStringConstants.MAX_RESULTS, options.maxResults); if (!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(QueryStringConstants.MARKER, currentToken.nextMarker); } webResource.withQueryOption(QueryStringConstants.PREFIX, prefix); var processResponseCallback = function (responseObject, next) { responseObject.listResult = null; if (!responseObject.error) { responseObject.listResult = { entries: null, continuationToken: null }; responseObject.listResult.entries = {}; responseObject.listResult.entries.files = []; responseObject.listResult.entries.directories = []; var files = []; var directories = []; // parse files if (responseObject.response.body.EnumerationResults.Entries.File) { files = responseObject.response.body.EnumerationResults.Entries.File; if (!_.isArray(files)) { files = [ files ]; } } files.forEach(function (currentFile) { var fileResult = FileResult.parse(currentFile); responseObject.listResult.entries.files.push(fileResult); }); // parse directories if (responseObject.response.body.EnumerationResults.Entries.Directory) { directories = responseObject.response.body.EnumerationResults.Entries.Directory; if (!_.isArray(directories)) { directories = [ directories ]; } } directories.forEach(function (currentDirectory) { var directoryResult = DirectoryResult.parse(currentDirectory); responseObject.listResult.entries.directories.push(directoryResult); }); // parse continuation token if(responseObject.response.body.EnumerationResults.NextMarker) { responseObject.listResult.continuationToken = { nextMarker: null, targetLocation: null }; responseObject.listResult.continuationToken.nextMarker = responseObject.response.body.EnumerationResults.NextMarker; responseObject.listResult.continuationToken.targetLocation = responseObject.targetLocation; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.listResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Returns all user-defined metadata for the specified directory. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link DirectoryResult}` will contain * information about the directory. * `response` will contain information related to this operation. */ FileService.prototype.getDirectoryMetadata = function (share, directory, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getDirectoryMetadata', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory); var webResource = WebResource.head(resourceName) .withQueryOption(QueryStringConstants.RESTYPE, 'directory') .withQueryOption(QueryStringConstants.COMP, 'metadata'); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.directoryResult = null; if (!responseObject.error) { responseObject.directoryResult = new DirectoryResult(directory); responseObject.directoryResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.directoryResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.directoryResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets user-defined metadata for the specified directory as one or more name-value pairs * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {object} metadata The metadata key/value pairs. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link DirectoryResult}` will contain * information on the directory. * `response` will contain information related to this operation. */ FileService.prototype.setDirectoryMetadata = function (share, directory, metadata, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setDirectoryMetadata', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.shareNameIsValid(share); v.object(metadata, 'metadata'); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.RESTYPE, 'directory') .withQueryOption(QueryStringConstants.COMP, 'metadata'); webResource.addOptionalMetadataHeaders(metadata); var processResponseCallback = function (responseObject, next) { responseObject.directoryResult = null; if (!responseObject.error) { responseObject.directoryResult = new DirectoryResult(directory); responseObject.directoryResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.directoryResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; // File methods /** * Retrieves a shared access signature token. * * @this {FileService} * @param {string} share The share name. * @param {string} [directory] The directory name. Use '' to refer to the base directory. * @param {string} [file] The file name. * @param {object} sharedAccessPolicy The shared access policy. * @param {string} [sharedAccessPolicy.Id] The signed identifier. * @param {object} [sharedAccessPolicy.AccessPolicy.Permissions] The permission type. * @param {date|string} [sharedAccessPolicy.AccessPolicy.Start] The time at which the Shared Access Signature becomes valid (The UTC value will be used). * @param {date|string} [sharedAccessPolicy.AccessPolicy.Expiry] The time at which the Shared Access Signature becomes expired (The UTC value will be used). * @param {string} [sharedAccessPolicy.AccessPolicy.IPAddressOrRange] An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. * @param {string} [sharedAccessPolicy.AccessPolicy.Protocols] The protocols permitted for a request made with the account SAS. * Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. * @param {object} [headers] The optional header values to set for a file returned wth this SAS. * @param {string} [headers.cacheControl] The optional value of the Cache-Control response header to be returned when this SAS is used. * @param {string} [headers.contentType] The optional value of the Content-Type response header to be returned when this SAS is used. * @param {string} [headers.contentEncoding] The optional value of the Content-Encoding response header to be returned when this SAS is used. * @param {string} [headers.contentLanguage] The optional value of the Content-Language response header to be returned when this SAS is used. * @param {string} [headers.contentDisposition] The optional value of the Content-Disposition response header to be returned when this SAS is used. * @return {string} The shared access signature query string. Note this string does not contain the leading &quot;?&quot;. */ FileService.prototype.generateSharedAccessSignature = function (share, directory, file, sharedAccessPolicy, headers) { // check if the FileService is able to generate a shared access signature if (!this.storageCredentials || !this.storageCredentials.generateSignedQueryString) { throw new Error(SR.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY); } // Validate share name. File name is optional. validate.validateArgs('generateSharedAccessSignature', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.object(sharedAccessPolicy, 'sharedAccessPolicy'); }); var resourceType = FileConstants.ResourceTypes.SHARE; if (file) { validate.validateArgs('generateSharedAccessSignature', function (v) { v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); }); resourceType = FileConstants.ResourceTypes.FILE; } else { directory = ''; // If file is not set, directory is not a part of the string to sign. } if (sharedAccessPolicy.AccessPolicy) { if (!azureutil.objectIsNull(sharedAccessPolicy.AccessPolicy.Start)) { if (!_.isDate(sharedAccessPolicy.AccessPolicy.Start)) { sharedAccessPolicy.AccessPolicy.Start = new Date(sharedAccessPolicy.AccessPolicy.Start); } sharedAccessPolicy.AccessPolicy.Start = azureutil.truncatedISO8061Date(sharedAccessPolicy.AccessPolicy.Start); } if (!azureutil.objectIsNull(sharedAccessPolicy.AccessPolicy.Expiry)) { if (!_.isDate(sharedAccessPolicy.AccessPolicy.Expiry)) { sharedAccessPolicy.AccessPolicy.Expiry = new Date(sharedAccessPolicy.AccessPolicy.Expiry); } sharedAccessPolicy.AccessPolicy.Expiry = azureutil.truncatedISO8061Date(sharedAccessPolicy.AccessPolicy.Expiry); } } var resourceName = createResourceName(share, directory, file, true); return this.storageCredentials.generateSignedQueryString(Constants.ServiceType.File, resourceName, sharedAccessPolicy, null, { headers: headers, resourceType: resourceType }); }; /** * Retrieves a file or directory URL. * * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} [file] The file name. File names may not start or end with the delimiter '/'. * @param {string} [sasToken] The Shared Access Signature token. * @param {boolean} [primary] A boolean representing whether to use the primary or the secondary endpoint. * @return {string} The formatted URL string. * @example * var azure = require('azure-storage'); * var fileService = azure.createFileService(); * var sharedAccessPolicy = { * AccessPolicy: { * Permissions: azure.FileUtilities.SharedAccessPermissions.READ, * Start: startDate, * Expiry: expiryDate * }, * }; * * var sasToken = fileService.generateSharedAccessSignature(shareName, directoryName, fileName, sharedAccessPolicy); * var url = fileService.getUrl(shareName, directoryName, fileName, sasToken, true); */ FileService.prototype.getUrl = function (share, directory, file, sasToken, primary) { validate.validateArgs('getUrl', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.shareNameIsValid(share); }); var host; if(!azureutil.objectIsNull(primary) &amp;&amp; primary === false) { host = this.host.secondaryHost; } else { host = this.host.primaryHost; } host = azureutil.trimPortFromUri(host); if(host &amp;&amp; host.lastIndexOf('/') !== (host.length - 1)){ host = host + '/'; } var name = createResourceName(share, directory, file); return url.resolve(host, url.format({pathname: this._getPath(name), query: qs.parse(sasToken)})); }; /** * Returns all user-defined metadata, standard HTTP properties, and system properties for the file. * It does not return or modify the content of the file. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * information about the file. * `response` will contain information related to this operation. */ FileService.prototype.getFileProperties = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getFileProperties', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.head(resourceName); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers, true); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Returns all user-defined metadata for the specified file. * It does not modify or return the content of the file. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * information about the file. * `response` will contain information related to this operation. */ FileService.prototype.getFileMetadata = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getFileMetadata', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.head(resourceName) .withQueryOption(QueryStringConstants.COMP, 'metadata'); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets user-defined properties for the specified file. * It does not modify or return the content of the file. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [properties] The file properties to set. * @param {string} [properties.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [properties.contentEncoding] The content encodings that have been applied to the file. * @param {string} [properties.contentLanguage] The natural languages used by this resource. * @param {string} [properties.cacheControl] The file's cache control. * @param {string} [properties.contentDisposition] The file's content disposition. * @param {string} [properties.contentLength] Resizes a file to the specified size. If the specified byte value is less than the current size of the file, * then all ranges above the specified byte value are cleared. * @param {string} [properties.contentMD5] The file's MD5 hash. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * information about the file. * `response` will contain information related to this operation. */ FileService.prototype.setFileProperties = function (share, directory, file, properties, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setFileProperties', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {contentSettings: properties, contentLength: properties.contentLength }, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'properties'); FileResult.setProperties(webResource, options); var processResponseCallback = function(responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function(returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets user-defined metadata for the specified file as one or more name-value pairs * It does not modify or return the content of the file. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} metadata The metadata key/value pairs. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * information on the file. * `response` will contain information related to this operation. */ FileService.prototype.setFileMetadata = function (share, directory, file, metadata, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setFileMetadata', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.object(metadata, 'metadata'); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'metadata'); webResource.addOptionalMetadataHeaders(metadata); var processResponseCallback = function (responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Resizes a file. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {String} size The size of the file, in bytes. * @param {object} [options] The request options. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * information about the file. * `response` will contain information related to this operation. */ FileService.prototype.resizeFile = function (share, directory, file, size, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('resizeFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.value(size); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'properties'); webResource.withHeader(HeaderConstants.FILE_CONTENT_LENGTH, size); var processResponseCallback = function(responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function(returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks whether or not a file exists on the service. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * the file information including the `exists` boolean member. * `response` will contain information related to this operation. */ FileService.prototype.doesFileExist = function (share, directory, file, optionsOrCallback, callback) { this._doesFileExist(share, directory, file, false, optionsOrCallback, callback); }; /** * Creates a file of the specified length. If the file already exists on the service, it will be overwritten. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {int} length The length of the file in bytes. * @param {object} [options] The request options. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * the file information. * `response` will contain information related to this operation. */ FileService.prototype.createFile = function (share, directory, file, length, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.value(length); v.callback(callback); }); var resourceName = createResourceName(share, directory, file); var options = extend(true, {}, userOptions); var webResource = WebResource.put(resourceName) .withHeader(HeaderConstants.TYPE, 'file') .withHeader(HeaderConstants.FILE_CONTENT_LENGTH, length); FileResult.setProperties(webResource, options); var processResponseCallback = function(responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function(returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified file for deletion. The file is later deleted during garbage collection. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; `response` will contain information related to this operation. */ FileService.prototype.deleteFile = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.del(resourceName); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Marks the specified file for deletion if it exists. The file is later deleted during garbage collection. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will * be true if the file was deleted, or false if the file * does not exist. * `response` will contain information related to this operation. */ FileService.prototype.deleteFileIfExists = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteFileIfExists', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesFileExist(share, directory, file, true, options, function(error, result, response) { if(error){ callback(error, result.exists, response); } else if (!result.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteFile(share, directory, file, options, function (deleteError, deleteResponse) { var deleted; if (!deleteError){ deleted = true; } else if (deleteError &amp;&amp; deleteError.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.FileErrorCodeStrings.FILE_NOT_FOUND) { // If it was deleted already, there was no actual error. deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; /** * Downloads a file into a text string. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {int} [options.rangeStart] The range start. * @param {int} [options.rangeEnd] The range end. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading files. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {FileService~FileToText} callback `error` will contain information * if an error occurs; otherwise `text` will contain the file contents, * and `[file]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. */ FileService.prototype.getFileToText = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getFileToText', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.get(resourceName) .withRawResponse(); FileResult.setHeaders(webResource, options); this._setRangeContentMD5Header(webResource, options); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.text = null; responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers, true); responseObject.fileResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.text = responseObject.response.body; self._validateLengthAndMD5(options, responseObject); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.text, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Provides a stream to read from a file. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {string} [options.rangeStart] Return only the bytes of the file in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the file in the specified range. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading files. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var fileService = azure.createFileService(); * var writable = fs.createWriteStream(destinationFileNameTarget); * fileService.createReadStream(shareName, directoryName, fileName).pipe(writable); */ FileService.prototype.createReadStream = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createReadStream', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); }); var options = extend(true, {}, userOptions); var readStream = new ChunkStream(options); this.getFileToStream(share, directory, file, readStream, options, function (error, fileResponse, response) { if(error) { readStream.emit('error', error); } if(callback) { callback(error, fileResponse, response); } }); return readStream; }; /** * Downloads a file into a stream. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {Stream} writeStream The write stream. * @param {object} [options] The request options. * @param {boolean} [options.skipSizeCheck] Skip the size check to perform direct download. * Set the option to true for small files. * Parallel download and speed summary won't work with this option on. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.rangeStart] Return only the bytes of the file in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the file in the specified range. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading files. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {SpeedSummary} * * * @example * var azure = require('azure-storage'); * var FileService = azure.createFileService(); * FileService.getFileToStream('taskshare', taskdirectory', 'task1', fs.createWriteStream('task1-download.txt'), function(error, serverFile) { * if(!error) { * // file available in serverFile.file variable * } * }); */ FileService.prototype.getFileToStream = function (share, directory, file, writeStream, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); userOptions.speedSummary = userOptions.speedSummary || new SpeedSummary(file); validate.validateArgs('getFileToStream', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.object(writeStream, 'writeStream'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var propertiesRequestOptions = { timeoutIntervalInMs : options.timeoutIntervalInMs, clientRequestTimeoutInMs : options.clientRequestTimeoutInMs, accessConditions : options.accessConditions }; if (options.skipSizeCheck) { this._getFileToStream(share, directory, file, writeStream, options, callback); } else { var self = this; this.getFileProperties(share, directory, file, propertiesRequestOptions, function (error, properties) { if (error) { callback(error); } else { var size; if (options.rangeStart) { var endOffset = properties.contentLength - 1; var end = options.rangeEnd ? Math.min(options.rangeEnd, endOffset) : endOffset; size = end - options.rangeStart + 1; } else { size = properties.contentLength; } options.speedSummary.totalSize = size; if (size &gt; self.singleFileThresholdInBytes) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], azureutil.tryGetValueChain(properties, ['contentSettings', 'contentMD5'], null)); self._getFileToRangeStream(share, directory, file, writeStream, options, callback); } else { self._getFileToStream(share, directory, file, writeStream, options, callback); } } }); } return options.speedSummary; }; /** * Lists file ranges. Lists all of the ranges by default, or only the ranges over a specific range of bytes if rangeStart and rangeEnd are specified. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {int} [options.rangeStart] The range start. * @param {int} [options.rangeEnd] The range end. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * the range information. * `response` will contain information related to this operation. */ FileService.prototype.listRanges = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listRanges', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var resourceName = createResourceName(share, directory, file); var options = extend(true, {}, userOptions); var webResource = WebResource.get(resourceName) .withQueryOption(QueryStringConstants.COMP, 'rangelist'); FileResult.setHeaders(webResource, options); var processResponseCallback = function (responseObject, next) { responseObject.ranges = null; if (!responseObject.error) { responseObject.ranges = []; var ranges = []; if (responseObject.response.body.Ranges.Range) { ranges = responseObject.response.body.Ranges.Range; if (!_.isArray(ranges)) { ranges = [ ranges ]; } } ranges.forEach(function (fileRange) { var range = { start: parseInt(fileRange.Start, 10), end: parseInt(fileRange.End, 10) }; responseObject.ranges.push(range); }); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.ranges, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Clears a range. Clears all of the ranges by default, or only the ranges over a specific range of bytes if rangeStart and rangeEnd are specified. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {int} rangeStart The range start. * @param {int} rangeEnd The range end. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * the directory information. * `response` will contain information related to this operation. */ FileService.prototype.clearRange = function (share, directory, file, rangeStart, rangeEnd, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('clearRange', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.value(rangeStart); v.value(rangeEnd); v.callback(callback); }); var options = extend(true, {}, userOptions); var request = this._updateFilesImpl(share, directory, file, rangeStart, rangeEnd, FileConstants.RangeWriteOptions.CLEAR, options); var processResponseCallback = function(responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function(returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(request, null, options, processResponseCallback); }; /** * Updates a range from a stream. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {Stream} readStream The read stream. * @param {int} rangeStart The range start. * @param {int} rangeEnd The range end. * @param {object} [options] The request options. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {string} [options.transactionalContentMD5] An optional hash value used to ensure transactional integrity for the page. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link FileResult}` will contain * the file information. * `response` will contain information related to this operation. */ FileService.prototype.createRangesFromStream = function (share, directory, file, readStream, rangeStart, rangeEnd, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createRangesFromStream', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.object(readStream, 'readStream'); v.shareNameIsValid(share); v.value(rangeStart); v.value(rangeEnd); v.callback(callback); }); var options = extend(true, {}, userOptions); var requiresContentMD5 = azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5 === true; var length = (rangeEnd - rangeStart) + 1; if(length &gt; FileConstants.MAX_UPDATE_FILE_SIZE) { throw new Error(SR.INVALID_FILE_RANGE_FOR_UPDATE); } var self = this; if (requiresContentMD5) { azureutil.calculateMD5(readStream, length, options, function(internalBuff, contentMD5) { options.transactionalContentMD5 = contentMD5; self._createRanges(share, directory, file, internalBuff, null /* stream */, rangeStart, rangeEnd, options, callback); }); } else { self._createRanges(share, directory, file, null /* text */, readStream, rangeStart, rangeEnd, options, callback); } }; /** * Uploads a file from a text string. If the file already exists on the service, it will be overwritten. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {string|object} text The file text, as a string or in a Buffer. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The upload tracker objects; * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * The default value is false for files. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {FileService~FileToText} callback `error` will contain information * if an error occurs; otherwise `text` will contain the file contents, * and `[file]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. */ FileService.prototype.createFileFromText = function (share, directory, file, text, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createFileFromText', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.exists(text, 'text'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var length = Buffer.isBuffer(text) ? text.length : Buffer.byteLength(text); if (length &gt; FileConstants.MAX_UPDATE_FILE_SIZE) { throw new Error(SR.INVALID_FILE_LENGTH); } if(options.storeFileContentMD5 &amp;&amp; azureutil.objectIsNull(azureutil.tryGetValueChain(options, ['contentSettings', 'contentMD5'], null))) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], azureutil.getContentMd5(text)); } var self = this; this.createFile(share, directory, file, length, options, function(error) { if(error) { callback(error); } else { self._createRanges(share, directory, file, text, null, 0, length - 1, options, callback); } }); }; /** * Uploads a file from a stream. If the file already exists on the service, it will be overwritten. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * The default value is false for files. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ FileService.prototype.createFileFromStream = function(share, directory, file, stream, streamLength, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createFileFromStream', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.object(stream, 'stream'); v.value(streamLength, 'streamLength'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(file); stream.pause(); // Immediately pause the stream in order to compatible with Node v0.8 var self = this; this.createFile(share, directory, file, streamLength, options, function(error) { if(error) { callback(error); } else { var chunkStream = new ChunkStreamWithStream(stream, {calcContentMd5: options.storeFileContentMD5}); self._createFileFromChunkStream(share, directory, file, chunkStream, streamLength, options, callback); } }); return options.speedSummary; }; /** * Provides a stream to write to a file. Assumes that the file exists. * If it does not, please create the file using createFile before calling this method or use createWriteStreamNewFile. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * The default value is false for files. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var FileService = azure.createFileService(); * FileService.createFile(shareName, directoryName, fileName, 1024, function (err) { * // Pipe file to a file * var stream = fs.createReadStream(fileNameTarget).pipe(FileService.createWriteStreamToExistingFile(shareName, directoryName, fileName)); * }); */ FileService.prototype.createWriteStreamToExistingFile = function (share, directory, file, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createWriteStreamToExistingFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); }); var options = extend(true, {}, userOptions); var stream = new ChunkStream({calcContentMd5: options.storeFileContentMD5}); this._createFileFromChunkStream(share, directory, file, stream, null, options, function (error, file, response) { if(error) { stream.emit('error', error); } if (callback) { callback(error, file, response); } }); return stream; }; /** * Provides a stream to write to a file. Creates the file before writing data. * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {string} length The file length. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * The default value is false for files. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {Stream} * @example * var azure = require('azure-storage'); * var FileService = azure.createFileService(); * var stream = fs.createReadStream(fileNameTarget).pipe(FileService.createWriteStreamToNewFile(shareName, directoryName, fileName)); */ FileService.prototype.createWriteStreamToNewFile = function (share, directory, file, length, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createWriteStreamToNewFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.value(length, 'length'); v.shareNameIsValid(share); }); var options = extend(true, {}, userOptions); var stream = new ChunkStream({calcContentMd5: options.storeFileContentMD5}); stream.pause(); var self = this; this.createFile(share, directory, file, length, options, function(error) { if(error) { stream.emit('error', error); callback(error); } else { stream.resume(); self._createFileFromChunkStream(share, directory, file, stream, null, options, function (error, file, response) { if(error) { stream.emit('error', error); } if (callback) { callback(error, file, response); } }); } }); return stream; }; /** * Starts to copy a file to a destination within the storage account. * * @this {FileService} * @param {string} sourceUri The source file or blob URI. * @param {string} targetShare The target share name. * @param {string} targetDirectory The target directory name. * @param {string} targetFile The target file name. * @param {object} [options] The request options. * @param {object} [options.metadata] The target file metadata key/value pairs. * @param {AccessConditions} [options.accessConditions] The access conditions. * @param {AccessConditions} [options.sourceAccessConditions] The source access conditions. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. */ FileService.prototype.startCopyFile = function (sourceUri, targetShare, targetDirectory, targetFile, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('startCopyFile', function (v) { v.string(targetShare, 'targetShare'); v.stringAllowEmpty(targetDirectory, 'targetDirectory'); v.string(targetFile, 'targetFile'); v.shareNameIsValid(targetShare); v.callback(callback); }); var targetResourceName = createResourceName(targetShare, targetDirectory, targetFile); var options = extend(true, {}, userOptions); var webResource = WebResource.put(targetResourceName) .withHeader(HeaderConstants.COPY_SOURCE, sourceUri) .addOptionalMetadataHeaders(options.metadata); var processResponseCallback = function (responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(targetShare, targetDirectory, targetFile); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers, true); if (options.metadata) { responseObject.fileResult.metadata = options.metadata; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Abort a file copy operation. * * @this {FileService} * @param {string} share The destination share name. * @param {string} directory The destination directory name. * @param {string} file The destination file name. * @param {string} copyId The copy operation identifier. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. */ FileService.prototype.abortCopyFile = function (share, directory, file, copyId, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('abortCopyFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var resourceName = createResourceName(share, directory, file); var options = extend(true, {}, userOptions); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COPY_ID, copyId) .withQueryOption(QueryStringConstants.COMP, 'copy') .withHeader(HeaderConstants.COPY_ACTION, 'abort'); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; // Internal Methods /** * Updates a file from text. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {string} text The text string. * @param {Stream} readStream The read stream. * @param {int} rangeStart The range start. * @param {int} rangeEnd The range end. * @param {object} [options] The request options. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {bool} [options.transactionalContentMD5] An MD5 hash of the content. This hash is used to verify the integrity of the data during transport. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, file, response)} callback `error` will contain information * if an error occurs; otherwise `file` will contain * the file information. * `response` will contain information related to this operation. */ FileService.prototype._createRanges = function (share, directory, file, text, readStream, rangeStart, rangeEnd, options, callback) { var request = this._updateFilesImpl(share, directory, file, rangeStart, rangeEnd, FileConstants.RangeWriteOptions.UPDATE, options); // At this point, we have already validated that the range is less than 4MB. Therefore, we just need to calculate the contentMD5 if required. if(!azureutil.objectIsNull(text) &amp;&amp; azureutil.objectIsNull(options.transactionalContentMD5) &amp;&amp; options.useTransactionalMD5 === true) { request.withHeader(HeaderConstants.CONTENT_MD5, azureutil.getContentMd5(text)); } var processResponseCallback = function (responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; if(!azureutil.objectIsNull(text)) { this.performRequest(request, text, options, processResponseCallback); } else { this.performRequestOutputStream(request, readStream, options, processResponseCallback); } }; /** * Uploads a file from a stream. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param (Stream) stream Stream to the data to store. * @param {int} streamLength The length of the stream to upload. * @param {object|function} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The MD5 hash of the file content. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {function(error, null)} callback The callback function. * @return {SpeedSummary} */ FileService.prototype._createFileFromChunkStream = function(share, directory, file, chunkStream, streamLength, options, callback) { this.logger.debug(util.format('_createFileFromChunkStream for file %s', file)); var apiName = '_createRanges'; var sizeLimitation = FileConstants.DEFAULT_WRITE_SIZE_IN_BYTES; var originalContentMD5 = azureutil.tryGetValueChain(options, ['contentSettings', 'contentMD5'], null); this._setOperationExpiryTime(options); // initialize the speed summary var speedSummary = options.speedSummary || new SpeedSummary(); speedSummary.totalSize = streamLength; var parallelOperationThreadCount = options.parallelOperationThreadCount || this.parallelOperationThreadCount; // initialize chunk allocator var allocator = new ChunkAllocator(sizeLimitation, parallelOperationThreadCount, { logger: this.logger }); // if this is a FileReadStream, set the allocator on that stream if (chunkStream._stream &amp;&amp; chunkStream._stream.setMemoryAllocator) { chunkStream._stream.setMemoryAllocator(allocator); } // initialize batch operations var batchOperations = new BatchOperation(apiName, { logger : this.logger, enableReuseSocket : this.defaultEnableReuseSocket}); batchOperations.setConcurrency(parallelOperationThreadCount); // initialize options var rangeOptions = { timeoutIntervalInMs: options.timeoutIntervalInMs, clientRequestTimeoutInMs: options.clientRequestTimeoutInMs, operationExpiryTime: options.operationExpiryTime }; var self = this; chunkStream.on('data', function (data, range) { var operation = null; var full = false; var autoIncrement = speedSummary.getAutoIncrementFunction(data.length); if(data.length &gt; sizeLimitation) { throw new Error(util.format(SR.EXCEEDED_SIZE_LIMITATION, sizeLimitation, data.length)); } if (options.useTransactionalMD5) { //calculate content md5 for the current uploading block data var contentMD5 = azureutil.getContentMd5(data); rangeOptions.transactionalContentMD5 = contentMD5; } if (azureutil.isBufferAllZero(data)) { self.logger.debug(util.format('Skip upload data from %s bytes to %s bytes to file %s', range.start, range.end, file)); speedSummary.increment(data.length); } else { operation = new BatchOperation.RestOperation(self, apiName, share, directory, file, data, null, range.start, range.end, rangeOptions, function (error) { if(!error) { autoIncrement(); } else { self.logger.debug(util.format('Stop downloading data as error happens. Error: %s', util.inspect(error))); chunkStream.stop(); } allocator.releaseBuffer(data); data = null; }); } if (operation) { full = batchOperations.addOperation(operation); operation = null; if(full) { self.logger.debug('file stream paused'); chunkStream.pause(); } } }); chunkStream.on('end', function () { self.logger.debug(util.format('File read stream ended for file %s', file)); batchOperations.enableComplete(); }); batchOperations.on('drain', function () { self.logger.debug('File stream resume'); chunkStream.resume(); }); batchOperations.on('end', function (error) { self.logger.debug('batch operations commited'); if (error) { callback(error); return; } if (originalContentMD5) { options.contentSettings.contentMD5 = originalContentMD5; } else if (options.storeFileContentMD5) { azureutil.setObjectInnerPropertyValue(options, ['contentSettings', 'contentMD5'], chunkStream.getContentMd5('base64')); } // upload file completely var fileProperties = extend(false, options.contentSettings, { contentLength: options.streamLength }); self.setFileProperties(share, directory, file, fileProperties, function (error, file, response) { chunkStream.finish(); callback(error, file, response); }); }); return speedSummary; }; /** * Downloads a file into a stream. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {Stream} writeStream The write stream. * @param {object} [options] The request options. * @param {string} [options.rangeStart] Return only the bytes of the file in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the file in the specified range. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading files. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the file information. * `response` will contain information related to this operation. * * @return {SpeedSummary} */ FileService.prototype._getFileToStream = function (share, directory, file, writeStream, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_getFileToStream', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.object(writeStream, 'writeStream'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.get(resourceName).withRawResponse(); FileResult.setHeaders(webResource, options); this._setRangeContentMD5Header(webResource, options); var self = this; var processResponseCallback = function (responseObject, next) { responseObject.fileResult = null; if (!responseObject.error) { responseObject.fileResult = new FileResult(share, directory, file); responseObject.fileResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers, true); self._validateLengthAndMD5(options, responseObject); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequestInputStream(webResource, null, writeStream, options, processResponseCallback); }; /** * Downloads a file into a range stream. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {Stream} writeStream The write stream. * @param {object} [options] The request options. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.rangeStart] Return only the bytes of the file in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the file in the specified range. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading files. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the file information. * `response` will contain information related to this operation. * * @return {SpeedSummary} */ FileService.prototype._getFileToRangeStream = function (share, directory, file, writeStream, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_getFileToRangeStream', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.object(writeStream, 'writeStream'); v.shareNameIsValid(share); v.callback(callback); }); var speedSummary = userOptions.speedSummary || new SpeedSummary(file); var parallelOperationThreadCount = userOptions.parallelOperationThreadCount || this.parallelOperationThreadCount; var batchOperations = new BatchOperation('getfile', { callbackInOrder: true, logger : this.logger, enableReuseSocket : this.defaultEnableReuseSocket }); batchOperations.setConcurrency(parallelOperationThreadCount); var rangeStream = new FileRangeStream(this, share, directory, file, userOptions); var self = this; var checkMD5sum = !userOptions.disableContentMD5Validation; var md5Hash = null; if (checkMD5sum) { md5Hash = new Md5Wrapper().createMd5Hash(); } var savedFileResult = null; var savedFileResponse = null; rangeStream.on('range', function (range) { if (!speedSummary.totalSize) { speedSummary.totalSize = rangeStream.rangeSize; } var requestOptions = { rangeStart : range.start, rangeEnd : range.end, responseEncoding : null //Use Buffer to store the response data }; var rangeSize = range.size; requestOptions.timeoutIntervalInMs = userOptions.timeoutIntervalInMs; requestOptions.clientRequestTimeoutInMs = userOptions.clientRequestTimeoutInMs; requestOptions.useTransactionalMD5 = userOptions.useTransactionalMD5; if (range.dataSize === 0) { var autoIncrement = speedSummary.getAutoIncrementFunction(rangeSize); //No operation to do and only wait for write zero to file in callback var writeZeroOperation = new BatchOperation.CommonOperation(BatchOperation.noOperation, function (error) { if (error) return; var bufferAvailable = azureutil.writeZerosToStream(writeStream, rangeSize, md5Hash, autoIncrement); //There is no need to pause the rangestream since we can perform http request and write disk at the same time self.logger.debug(util.format('Write %s bytes Zero from %s to %s', rangeSize, range.start, range.end)); if (!bufferAvailable) { self.logger.debug('Write stream is full and pause batch operation'); batchOperations.pause(); } }); batchOperations.addOperation(writeZeroOperation); return; } if (range.start &gt; range.end) { return; } var operation = new BatchOperation.RestOperation(self, 'getFileToText', share, directory, file, requestOptions, function (error, content, fileResult, response) { if (!error) { if (rangeSize !== content.length) { self.logger.warn(util.format('Request %s bytes, but server returns %s bytes', rangeSize, content.length)); } //Save one of the succeeded callback parameters and use them at the final callback if (!savedFileResult) { savedFileResult = fileResult; } if (!savedFileResponse) { savedFileResponse = response; } var autoIncrement = speedSummary.getAutoIncrementFunction(content.length); var bufferAvailable = writeStream.write(content, autoIncrement); if (!bufferAvailable) { self.logger.debug('Write stream is full and pause batch operation'); batchOperations.pause(); } if (md5Hash) { md5Hash.update(content); } content = null; } else { self.logger.debug(util.format('Stop downloading data as error happens. Error: %s', util.inspect(error))); rangeStream.stop(); } }); var full = batchOperations.addOperation(operation); if (full) { self.logger.debug('Pause range stream'); rangeStream.pause(); } }); rangeStream.on('end', function () { self.logger.debug('Range stream has ended.'); batchOperations.enableComplete(); }); batchOperations.on('drain', function () { self.logger.debug('Resume range stream'); rangeStream.resume(); }); writeStream.on('drain', function () { self.logger.debug('Resume batch operations'); batchOperations.resume(); }); batchOperations.on('end', function (error) { self.logger.debug('Download completed!'); if (error) { callback(error); } else { writeStream.end(function () { self.logger.debug('Write stream has ended'); if (writeStream.close) { writeStream.close(); } if (!savedFileResult) { savedFileResult = {}; } azureutil.setObjectInnerPropertyValue(savedFileResult, ['contentSettings', 'contentMD5'], azureutil.tryGetValueChain(userOptions, ['contentSettings', 'contentMD5'], null)); savedFileResult.clientSideContentMD5 = null; if (md5Hash) { savedFileResult.clientSideContentMD5 = md5Hash.digest('base64'); } callback(error, savedFileResult, savedFileResponse); }); } }); var listOptions = { timeoutIntervalInMs : userOptions.timeoutIntervalInMs, clientRequestTimeoutInMs : userOptions.clientRequestTimeoutInMs, }; rangeStream.list(listOptions); return speedSummary; }; /** * @ignore */ FileService.prototype._setRangeContentMD5Header = function (webResource, options) { if(!azureutil.objectIsNull(options.rangeStart) &amp;&amp; options.useTransactionalMD5) { if(azureutil.objectIsNull(options.rangeEnd)) { throw new ArgumentNullError(util.format(SR.ARGUMENT_NULL_OR_EMPTY, options.rangeEndHeader)); } var size = parseInt(options.rangeEnd, 10) - parseInt(options.rangeStart, 10) + 1; if (size &gt; FileConstants.MAX_RANGE_GET_SIZE_WITH_MD5) { throw new Error(SR.INVALID_RANGE_FOR_MD5); } else { webResource.withHeader(HeaderConstants.RANGE_GET_CONTENT_MD5, 'true'); } } }; /** * @ignore */ FileService.prototype._updateFilesImpl = function (share, directory, file, rangeStart, rangeEnd, writeMethod, options) { var resourceName = createResourceName(share, directory, file); var webResource = WebResource.put(resourceName) .withQueryOption(QueryStringConstants.COMP, 'range') .withHeader(HeaderConstants.CONTENT_TYPE, 'application/octet-stream') .withHeader(HeaderConstants.FILE_WRITE, writeMethod); options.rangeStart = rangeStart; options.rangeEnd = rangeEnd; FileResult.setHeaders(webResource, options); if(writeMethod === FileConstants.RangeWriteOptions.UPDATE) { var size = (rangeEnd - rangeStart) + 1; webResource.withHeader(HeaderConstants.CONTENT_LENGTH, size); } else { webResource.withHeader(HeaderConstants.CONTENT_LENGTH, 0); } return webResource; }; /** * @ignore */ FileService.prototype._validateLengthAndMD5 = function (options, responseObject) { var storedMD5 = responseObject.response.headers[Constants.HeaderConstants.CONTENT_MD5]; var contentLength; if (!azureutil.objectIsNull(responseObject.response.headers[Constants.HeaderConstants.CONTENT_LENGTH])) { contentLength = parseInt(responseObject.response.headers[Constants.HeaderConstants.CONTENT_LENGTH], 10); } // If the user has not specified this option, the default value should be false. if(azureutil.objectIsNull(options.disableContentMD5Validation)) { options.disableContentMD5Validation = false; } // None of the below cases should be retried. So set the error in every case so the retry policy filter handle knows that it shouldn't be retried. if (options.disableContentMD5Validation === false &amp;&amp; options.useTransactionalMD5 === true &amp;&amp; azureutil.objectIsNull(storedMD5)) { responseObject.error = new Error(SR.MD5_NOT_PRESENT_ERROR); responseObject.retryable = false; } // Validate length and if required, MD5. // If getFileToText called this method, then the responseObject.length and responseObject.contentMD5 are not set. Calculate them first using responseObject.response.body and then validate. if(azureutil.objectIsNull(responseObject.length)) { if (typeof responseObject.response.body == 'string') { responseObject.length = Buffer.byteLength(responseObject.response.body); } else if (Buffer.isBuffer(responseObject.response.body)) { responseObject.length = responseObject.response.body.length; } } if(!azureutil.objectIsNull(contentLength) &amp;&amp; responseObject.length !== contentLength) { responseObject.error = new Error(SR.CONTENT_LENGTH_MISMATCH); responseObject.retryable = false; } if(options.disableContentMD5Validation === false &amp;&amp; azureutil.objectIsNull(responseObject.contentMD5)) { responseObject.contentMD5 = azureutil.getContentMd5(responseObject.response.body); } if (options.disableContentMD5Validation === false &amp;&amp; !azureutil.objectIsNull(storedMD5) &amp;&amp; storedMD5 !== responseObject.contentMD5) { responseObject.error = new Error(util.format(SR.HASH_MISMATCH, storedMD5, responseObject.contentMD5)); responseObject.retryable = false; } }; /** * Checks whether or not a file exists on the service. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the file information including the `exists` boolean member. * `response` will contain information related to this operation. */ FileService.prototype._doesFileExist = function (share, directory, file, primaryOnly, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('FileExists', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var resourceName = createResourceName(share, directory, file); var webResource = WebResource.head(resourceName); /*if(primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; }*/ var processResponseCallback = function (responseObject, next) { responseObject.fileResult = new FileResult(share, directory, file); if (!responseObject.error) { responseObject.fileResult.exists = true; responseObject.fileResult.getPropertiesFromHeaders(responseObject.response.headers); } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.fileResult.exists = false; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.fileResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks whether or not a directory exists on the service. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the directory information including `exists` boolean member. * `response` will contain information related to this operation. */ FileService.prototype._doesDirectoryExist = function (share, directory, primaryOnly, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('directoryExists', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(createResourceName(share, directory)) .withQueryOption(QueryStringConstants.RESTYPE, 'directory'); /*if(primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; }*/ var self = this; var processResponseCallback = function(responseObject, next){ responseObject.directoryResult = new DirectoryResult(directory); responseObject.directoryResult.exists = false; if (!responseObject.error) { responseObject.directoryResult.exists = true; responseObject.directoryResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.directoryResult.getPropertiesFromHeaders(responseObject.response.headers); } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.directoryResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks whether or not a share exists on the service. * @ignore * * @this {FileService} * @param {string} share The share name. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise `result` will contain * the share information including `exists` boolean member. * `response` will contain information related to this operation. */ FileService.prototype._doesShareExist = function (share, primaryOnly, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('shareExists', function (v) { v.string(share, 'share'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(share) .withQueryOption(QueryStringConstants.RESTYPE, 'share'); /*if(primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; }*/ var processResponseCallback = function(responseObject, next){ responseObject.shareResult = new ShareResult(share); responseObject.shareResult.exists = false; if (!responseObject.error) { responseObject.shareResult.exists = true; responseObject.shareResult.getPropertiesFromHeaders(responseObject.response.headers); } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.shareResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * The callback for {FileService~getFileToText}. * @typedef {function} FileService~FileToText * @param {object} error If an error occurs, the error information. * @param {string} text The text returned from the file. * @param {object} file Information about the file. * @param {object} response Information related to this operation. */ FileService.SpeedSummary = SpeedSummary; module.exports = FileService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_fileservice.browser.js.html":{"id":"services_file_fileservice.browser.js.html","title":"Source: services/file/fileservice.browser.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/fileservice.browser.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var FileService = require('./fileservice.core'); var azureCommon = require('./../../common/common.browser'); var extend = require('extend'); var azureutil = azureCommon.util; var BrowserFileReadStream = azureCommon.BrowserFileReadStream; var SpeedSummary = azureCommon.SpeedSummary; var validate = azureCommon.validate; var ChunkStreamWithStream = azureCommon.ChunkStreamWithStream; /** * Uploads a file to storage from an HTML File object. If the file already exists on the service, it will be overwritten. * (Only available in the JavaScript Client Library for Browsers) * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {File} browserFile The File object to be uploaded created by HTML File API. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * The default value is false for files. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ FileService.prototype.createFileFromBrowserFile = function (share, directory, file, browserFile, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createFileFromBrowserFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.browserFileIsValid(browserFile); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(file); var self = this; this.createFile(share, directory, file, browserFile.size, options, function (error) { if (error) { callback(error); } else { var stream = new BrowserFileReadStream(browserFile); var chunkStream = new ChunkStreamWithStream(stream, { calcContentMd5: options.storeFileContentMD5 }); self._createFileFromChunkStream(share, directory, file, chunkStream, browserFile.size, options, callback); } }); return options.speedSummary; }; module.exports = FileService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_fileservice.node.js.html":{"id":"services_file_fileservice.node.js.html","title":"Source: services/file/fileservice.node.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/fileservice.node.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var azureCommon = require('./../../common/common.node'); var extend = require('extend'); var fs = require('fs'); var FileService = require('./fileservice.core'); var azureutil = azureCommon.util; var FileReadStream = azureCommon.FileReadStream; var SpeedSummary = azureCommon.SpeedSummary; var validate = azureCommon.validate; /** * Downloads an Azure file into a file. * (Not available in the JavaScript Client Library for Browsers) * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param {string} localFileName The local path to the file to be downloaded. * @param {object} [options] The request options. * @param {boolean} [options.skipSizeCheck] Skip the size check to perform direct download. * Set the option to true for small files. * Parallel download and speed summary won't work with this option on. * @param {SpeedSummary} [options.speedSummary] The download tracker objects. * @param {int} [options.parallelOperationThreadCount] The number of parallel operations that may be performed when uploading. * @param {string} [options.rangeStart] Return only the bytes of the file in the specified range. * @param {string} [options.rangeEnd] Return only the bytes of the file in the specified range. * @param {boolean} [options.useTransactionalMD5] When set to true, Calculate and send/validate content MD5 for transactions. * @param {boolean} [options.disableContentMD5Validation] When set to true, MD5 validation will be disabled when downloading files. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {SpeedSummary} * * @example * var azure = require('azure-storage'); * var FileService = azure.createFileService(); * FileService.getFileToLocalFile('taskshare', taskdirectory', 'task1', 'task1-download.txt', function(error, serverFile) { * if(!error) { * // file available in serverFile.file variable * } */ FileService.prototype.getFileToLocalFile = function (share, directory, file, localFileName, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); userOptions.speedSummary = userOptions.speedSummary || new SpeedSummary(file); validate.validateArgs('getFileToLocalFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.string(localFileName, 'localFileName'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); var writeStream = fs.createWriteStream(localFileName); writeStream.on('error', function (error) { callback(error); return; }); this.getFileToStream(share, directory, file, writeStream, options, function (error, responseFile, response) { if (error) { // make sure writeStream is closed / destroyed to avoid locking issues if (writeStream.close) { writeStream.close(); } if (fs.existsSync(localFileName)) { // If the download failed from the beginning, remove the file. fs.unlink(localFileName, function () { callback(error, responseFile, response); return; }); } } callback(error, responseFile, response); }); return options.speedSummary; }; /** * Uploads a file to storage from a local file. If the file already exists on the service, it will be overwritten. * (Not available in the JavaScript Client Library for Browsers) * * @this {FileService} * @param {string} share The share name. * @param {string} directory The directory name. Use '' to refer to the base directory. * @param {string} file The file name. File names may not start or end with the delimiter '/'. * @param (string) localFileName The local path to the file to be uploaded. * @param {object} [options] The request options. * @param {SpeedSummary} [options.speedSummary] The download tracker objects; * @param {bool} [options.storeFileContentMD5] Specifies whether the file's ContentMD5 header should be set on uploads. * The default value is false for files. * @param {bool} [options.useTransactionalMD5] Calculate and send/validate content MD5 for transactions. * @param {object} [options.contentSettings] The file's content settings. * @param {string} [options.contentSettings.contentType] The MIME content type of the file. The default type is application/octet-stream. * @param {string} [options.contentSettings.contentEncoding] The content encodings that have been applied to the file. * @param {string} [options.contentSettings.contentLanguage] The natural languages used by this resource. * @param {string} [options.contentSettings.cacheControl] The file service stores this value but does not use or modify it. * @param {string} [options.contentSettings.contentDisposition] The file's content disposition. * @param {string} [options.contentSettings.contentMD5] The file's MD5 hash. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link FileResult}` will contain the file information. * `response` will contain information related to this operation. * @return {SpeedSummary} */ FileService.prototype.createFileFromLocalFile = function (share, directory, file, localFileName, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createFileFromLocalFile', function (v) { v.string(share, 'share'); v.stringAllowEmpty(directory, 'directory'); v.string(file, 'file'); v.string(localFileName, 'localFileName'); v.shareNameIsValid(share); v.callback(callback); }); var options = extend(true, {}, userOptions); options.speedSummary = options.speedSummary || new SpeedSummary(file); var self = this; fs.stat(localFileName, function(error, stat) { if (error) { callback(error); } else { self.createFile(share, directory, file, stat.size, options, function(error) { if(error) { callback(error); } else { var stream = new FileReadStream(localFileName, {calcContentMd5: options.storeFileContentMD5}); self._createFileFromChunkStream(share, directory, file, stream, stat.size, options, callback); } }); } }); return options.speedSummary; }; module.exports = FileService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_fileutilities.js.html":{"id":"services_file_fileutilities.js.html","title":"Source: services/file/fileutilities.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/fileutilities.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Expose 'FileUtilities'. exports = module.exports; /** * Defines constants, enums, and utility functions for use with the File service. * @namespace FileUtilities */ var FileUtilities = { /** * Permission types * * @const * @enum {string} */ SharedAccessPermissions: { READ: 'r', CREATE: 'c', WRITE: 'w', DELETE: 'd', LIST: 'l' }, /** * Listing details. * * @const * @enum {string} */ ListingDetails: { METADATA: 'metadata' }, /** * File and share public access types. * * @const * @enum {string} */ SharePublicAccessType: { OFF: null, SHARE: 'share', FILE: 'file' } }; module.exports = FileUtilities; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_blob_models_leaseresult.js.html":{"id":"services_blob_models_leaseresult.js.html","title":"Source: services/blob/models/leaseresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/blob/models/leaseresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var Constants = require('./../../../common/common.core').Constants; var HeaderConstants = Constants.HeaderConstants; /** * Creates a new LeaseResult object. * @class * The LeaseResult class is used to store the lease information. * * @property {string} container The container name. * @property {string} blob The blob name. * @property {string} id The lease id. * @property {string} time Approximate time remaining in the lease period, in seconds. * @property {string} etag The etag. * @property {string} lastModified The date/time that the lease was last modified. * * @constructor * @param {string} [container] The container name. * @param {string} [blob] The blob name. * @param {string} [id] The lease id. * @param {string} [time] Approximate time remaining in the lease period, in seconds. */ function LeaseResult(container, blob, id, time) { if (container) { this.container = container; } if (blob) { this.blob = blob; } if (id) { this.id = id; } if (time) { this.time = time; } } LeaseResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; if (!self['id'] &amp;&amp; headers[HeaderConstants.LEASE_ID]) { self['id'] = headers[HeaderConstants.LEASE_ID]; } if (!self['time'] &amp;&amp; headers[HeaderConstants.LEASE_TIME]) { self['time'] = parseInt(headers[HeaderConstants.LEASE_TIME], 10); } self['etag'] = headers[HeaderConstants.ETAG]; self['lastModified'] = headers[HeaderConstants.LAST_MODIFIED.toLowerCase()]; }; module.exports = LeaseResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"common_filters_linearretrypolicyfilter.js.html":{"id":"common_filters_linearretrypolicyfilter.js.html","title":"Source: common/filters/linearretrypolicyfilter.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: common/filters/linearretrypolicyfilter.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // 'use strict'; var RetryPolicyFilter = require('./retrypolicyfilter'); /** * Creates a new LinearRetryPolicyFilter instance. * @class * The LinearRetryPolicyFilter allows you to retry operations, * using an linear back-off interval between retries. * To apply a filter to service operations, use `withFilter` * and specify the filter to be used when creating a service. * @constructor * @param {number} [retryCount=3] The client retry count. * @param {number} [retryInterval=30000] The client retry interval, in milliseconds. * * @example * var azure = require('azure-storage'); * var retryOperations = new azure.LinearRetryPolicyFilter(); * var blobService = azure.createBlobService().withFilter(retryOperations) */ function LinearRetryPolicyFilter(retryCount, retryInterval) { this.retryCount = retryCount ? retryCount : LinearRetryPolicyFilter.DEFAULT_CLIENT_RETRY_COUNT; this.retryInterval = retryInterval ? retryInterval : LinearRetryPolicyFilter.DEFAULT_CLIENT_RETRY_INTERVAL; } /** * Represents the default client retry interval, in milliseconds. */ LinearRetryPolicyFilter.DEFAULT_CLIENT_RETRY_INTERVAL = 1000 * 30; /** * Represents the default client retry count. */ LinearRetryPolicyFilter.DEFAULT_CLIENT_RETRY_COUNT = 3; /** * Determines if the operation should be retried and how long to wait until the next retry. * * @param {number} statusCode The HTTP status code. * @param {object} requestOptions The request options. * @return {retryInfo} Information about whether the operation qualifies for a retry and the retryInterval. */ LinearRetryPolicyFilter.prototype.shouldRetry = function (statusCode, requestOptions) { var retryData = (requestOptions &amp;&amp; requestOptions.retryContext) ? requestOptions.retryContext : {}; retryData.retryInterval = this.retryInterval; return RetryPolicyFilter._shouldRetryOnError(statusCode, requestOptions); }; /** * Handles an operation with a linear retry policy. * * @param {Object} requestOptions The original request options. * @param {function} next The next filter to be handled. */ LinearRetryPolicyFilter.prototype.handle = function (requestOptions, next) { RetryPolicyFilter._handle(this, requestOptions, next); }; module.exports = LinearRetryPolicyFilter; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"common_diagnostics_logger.js.html":{"id":"common_diagnostics_logger.js.html","title":"Source: common/diagnostics/logger.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: common/diagnostics/logger.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // /** * Creates a new Logger object * @class * The Logger class is used to write log information. * * @constructor * * @param {string} [level] The log level. Refer to Logger.LogLevels. * @param {object} [loggerFunction] The function to write log information. */ function Logger(level, loggerFunction) { /** * The log level. Refer to the Logger.LogLevels for available log levels. * @name Logger#level * @type {string} * @see Logger.LogLevels */ this.level = level; this.loggerFunction = loggerFunction; if (!this.loggerFunction) { this.loggerFunction = this.defaultLoggerFunction; } } /** * The available log levels. * * @const * @enum {string} */ Logger.LogLevels = { /** * System is unusable. */ EMERGENCY: 'emergency', /** * Action must be taken immediately. */ ALERT : 'alert', /** * Critical condition. */ CRITICAL : 'critical', /** * Error condition. */ ERROR : 'error', /** * Warning condition. */ WARNING : 'warning', /** * Normal but significant condition. */ NOTICE : 'notice', /** * Purely informational message. */ INFO : 'info', /** * Application debug messages. */ DEBUG : 'debug' }; Logger.logPriority = [ Logger.LogLevels.EMERGENCY, Logger.LogLevels.ALERT, Logger.LogLevels.CRITICAL, Logger.LogLevels.ERROR, Logger.LogLevels.WARNING, Logger.LogLevels.NOTICE, Logger.LogLevels.INFO, Logger.LogLevels.DEBUG ]; Logger.prototype.log = function (level, msg) { this.loggerFunction(level, msg); }; Logger.prototype.emergency = function(msg) { this.log(Logger.LogLevels.EMERGENCY, msg); }; Logger.prototype.critical = function(msg) { this.log(Logger.LogLevels.CRITICAL, msg); }; Logger.prototype.alert = function(msg) { this.log(Logger.LogLevels.ALERT, msg); }; Logger.prototype.error = function(msg) { this.log(Logger.LogLevels.ERROR, msg); }; Logger.prototype.warn = function(msg) { this.log(Logger.LogLevels.WARNING, msg); }; Logger.prototype.notice = function(msg) { this.log(Logger.LogLevels.NOTICE, msg); }; Logger.prototype.info = function(msg) { this.log(Logger.LogLevels.INFO, msg); }; Logger.prototype.debug = function(msg) { this.log(Logger.LogLevels.DEBUG, msg); }; Logger.prototype.defaultLoggerFunction = function(logLevel , msg) { var currentLevelIndex = Logger.logPriority.indexOf(this.level); var logLevelIndex = Logger.logPriority.indexOf(logLevel); var time = new Date(); var timeStamp = time.toISOString(); if (logLevelIndex &lt;= currentLevelIndex) { console.log('[' + timeStamp + ']' + this.level + ' : ' + msg); } }; module.exports = Logger; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_queue_models_queuemessageresult.js.html":{"id":"services_queue_models_queuemessageresult.js.html","title":"Source: services/queue/models/queuemessageresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/queue/models/queuemessageresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var azureCommon = require('./../../../common/common.core'); var azureutil = azureCommon.util; var xmlbuilder = azureCommon.xmlbuilder; var Constants = azureCommon.Constants; var HeaderConstants = Constants.HeaderConstants; /** * Creates a new QueueMessageResult object. * @class * The QueueMessageResult class is used to store the queue message information. * * @property {string} queue The queue name. * @property {string} messageId The message id. * @property {string} popReceipt The pop receipt. * @property {string} messageText The message text. * @property {string} timeNextVisible The time next visible. * @property {string} insertionTime The insertion time. * @property {string} expirationTime The expiration time. * @property {number} dequeueCount The dequeue count. * * @constructor * @param {string} [queue] The queue name. * @param {string} [messageId] The message id. * @param {string} [popReceipt] The pop receipt. */ function QueueMessageResult(queue, messageId, popReceipt) { if (queue) { this.queue = queue; } if (messageId) { this.messageId = messageId; } if (popReceipt) { this.popReceipt = popReceipt; } } /** * Builds an XML representation for a queue message * * @param {string} messageJs The queue message. * @param {QueueMessageEncoder} The message encoder. * @return {string} The XML queue message. */ QueueMessageResult.serialize = function (messageJs, encoder) { var doc = xmlbuilder.create(); doc = doc.begin(Constants.QueueConstants.QUEUE_MESSAGE_ELEMENT, { version: '1.0', encoding: 'utf-8' }); if (messageJs) { var message; if (encoder !== null &amp;&amp; encoder !== undefined) { message = encoder.encode(messageJs); } else { message = messageJs; } doc.ele(Constants.QueueConstants.MESSAGE_TEXT_ELEMENT) .txt(message) .up(); } else { doc.ele(Constants.QueueConstants.MESSAGE_TEXT_ELEMENT).up(); } return doc.doc().toString(); }; /** * Pase the XML representation of a queue message to a QueueMessageResult object. * * @param {Object} messageXml The XML representation of the queue message. * @param {QueueMessageEncoder} The message encoder. * @return {QueueMessageResult} The QueueMessageResult object. */ QueueMessageResult.parse = function (messageXml, encoder) { var queueMessageResult = new QueueMessageResult(); for (var property in messageXml) { if (property === Constants.QueueConstants.MESSAGE_TEXT_ELEMENT) { if (encoder !== null &amp;&amp; encoder !== undefined) { queueMessageResult.messageText = encoder.decode(messageXml[property]); } else { queueMessageResult.messageText = messageXml[property]; } } else { var resultPropertyName = azureutil.normalizePropertyNameFromXML(property); queueMessageResult[resultPropertyName] = messageXml[property]; } } // Convert dequeueCount to number if (queueMessageResult.dequeueCount) { queueMessageResult.dequeueCount = parseInt(queueMessageResult.dequeueCount); } return queueMessageResult; }; QueueMessageResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; var setmessagePropertyFromHeaders = function (messageProperty, headerProperty) { if (!self[messageProperty] &amp;&amp; headers[headerProperty.toLowerCase()]) { self[messageProperty] = headers[headerProperty.toLowerCase()]; } }; setmessagePropertyFromHeaders('popReceipt', HeaderConstants.POP_RECEIPT); setmessagePropertyFromHeaders('timeNextVisible', HeaderConstants.TIME_NEXT_VISIBLE); }; module.exports = QueueMessageResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_queue_models_queueresult.js.html":{"id":"services_queue_models_queueresult.js.html","title":"Source: services/queue/models/queueresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/queue/models/queueresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var Constants = require('./../../../common/common.core').Constants; var HeaderConstants = Constants.HeaderConstants; /** * Creates a new QueueResult object. * @class * The QueueResult class is used to store the queue information. * * @property {string} name The queue name. * @property {object} metadata The metadata key/value pair. * @property {number} approximateMessageCount The approximate number of messages in the queue. This number is not lower than the actual number of messages in the queue, but could be higher. * @property {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The container ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. * * @constructor * @param {string} [name] The queue name. * @param {string} [metadata] The metadata key/value pair. */ function QueueResult(name, metadata) { if (name) { this.name = name; } if (metadata) { this.metadata = metadata; } } QueueResult.parse = function (messageXml) { var queueResult = new QueueResult(); for (var property in messageXml) { if (messageXml.hasOwnProperty(property)) { queueResult[property.toLowerCase()] = messageXml[property]; } } return queueResult; }; QueueResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; var setPropertyFromHeaders = function (queueProperty, headerProperty, typeConverterFunc) { if (!self[queueProperty] &amp;&amp; headers[headerProperty.toLowerCase()]) { if(typeConverterFunc) { self[queueProperty] = typeConverterFunc(headers[headerProperty.toLowerCase()]); } else{ self[queueProperty] = headers[headerProperty.toLowerCase()]; } } }; setPropertyFromHeaders('approximateMessageCount', HeaderConstants.APPROXIMATE_MESSAGES_COUNT, parseInt); }; module.exports = QueueResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_queue_queueservice.js.html":{"id":"services_queue_queueservice.js.html","title":"Source: services/queue/queueservice.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/queue/queueservice.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var util = require('util'); var _ = require('underscore'); var extend = require('extend'); var azureCommon = require('./../../common/common.core'); var azureutil = azureCommon.util; var SR = azureCommon.SR; var validate = azureCommon.validate; var StorageServiceClient = azureCommon.StorageServiceClient; var WebResource = azureCommon.WebResource; var Constants = azureCommon.Constants; var QueryStringConstants = Constants.QueryStringConstants; var HeaderConstants = Constants.HeaderConstants; var RequestLocationMode = Constants.RequestLocationMode; // Models requires var QueueResult = require('./models/queueresult'); var AclResult = azureCommon.AclResult; var QueueMessageResult = require('./models/queuemessageresult'); var QueueMessageEncoder = require('./queuemessageencoder'); var ServiceStatsParser = azureCommon.ServiceStatsParser; /** * Creates a new QueueService object. * If no connection string or storageaccount and storageaccesskey are provided, * the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. * @class * The QueueService class is used to perform operations on the Microsoft Azure Queue Service. * * For more information on using the Queue Service, as well as task focused information on using it from a Node.js application, see * [How to Use the Queue Service from Node.js](http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-queues/). * The following defaults can be set on the Queue service. * messageEncoder The message encoder to specify how QueueService encodes and decodes the queue message. Default is `[TextXmlQueueMessageEncoder]{@link TextXmlQueueMessageEncoder}`. * defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the Queue service. * defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the Queue service. * defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the Queue service. * defaultLocationMode The default location mode for requests made via the Queue service. * useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the Queue service; true to use the * Nagle algorithm; otherwise, false. The default value is false. * @constructor * @augments {StorageServiceClient} * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} [sasToken] The Shared Access Signature token. * @param {string} [endpointSuffix] The endpoint suffix. */ function QueueService(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix) { var storageServiceSettings = StorageServiceClient.getStorageSettings(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix); QueueService['super_'].call(this, storageServiceSettings._name, storageServiceSettings._key, storageServiceSettings._queueEndpoint, storageServiceSettings._usePathStyleUri, storageServiceSettings._sasToken); if (this.anonymous) { throw new Error(SR.ANONYMOUS_ACCESS_BLOBSERVICE_ONLY); } /** * @property {boolean} QueueService#messageEncoder * @defaultvalue {QueueMessageEncoder} `[TextXmlQueueMessageEncoder]{@link TextXmlQueueMessageEncoder}`. * The message encoder to specify how QueueService encodes and decodes the queue message. Default is `[TextXmlQueueMessageEncoder]{@link TextXmlQueueMessageEncoder}`. */ this.messageEncoder = new QueueMessageEncoder.TextXmlQueueMessageEncoder(); } util.inherits(QueueService, StorageServiceClient); /** * Gets the service stats for a storage account’s Queue service. * * @this {QueueService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise, `[result]{@link ServiceStats}` * will contain the stats and `response` * will contain information related to this operation. */ QueueService.prototype.getServiceStats = function (optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getServiceStats', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get() .withQueryOption(QueryStringConstants.COMP, 'stats') .withQueryOption(QueryStringConstants.RESTYPE, 'service'); options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.serviceStatsResult = null; if (!responseObject.error) { responseObject.serviceStatsResult = ServiceStatsParser.parse(responseObject.response.body.StorageServiceStats); } // function to be called after all filters var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.serviceStatsResult, returnObject.response); }; // call the first filter next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets the properties of a storage account’s Queue service, including Microsoft Azure Storage Analytics. * * @this {QueueService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise, `[result]{@link ServiceProperties}` * will contain the properties and `response` * will contain information related to this operation. */ QueueService.prototype.getServiceProperties = function (optionsOrCallback, callback) { return this.getAccountServiceProperties(optionsOrCallback, callback); }; /** * Sets the properties of a storage account’s Queue service, including Microsoft Azure Storage Analytics. * You can also use this operation to set the default request version for all incoming requests that do not have a version specified. * * @this {QueueService} * @param {object} serviceProperties The service properties. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise, `response` * will contain information related to this operation. */ QueueService.prototype.setServiceProperties = function (serviceProperties, optionsOrCallback, callback) { return this.setAccountServiceProperties(serviceProperties, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of queue items whose names begin with the specified prefix under the given account. * * @this {QueueService} * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {int} [options.maxResults] Specifies the maximum number of queues to return per call to Azure storage. This does NOT affect list size returned by this function. (maximum: 5000) * @param {string} [options.include] Include this parameter to specify that the queue's metadata be returned as part of the response body. (allowed values: '', 'metadata') * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[queues]{@link QueueResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ QueueService.prototype.listQueuesSegmented = function (currentToken, optionsOrCallback, callback) { this.listQueuesSegmentedWithPrefix(null /* prefix */, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of queue items under the given account. * * @this {QueueService} * @param {string} prefix The prefix of the queue name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation.* @param {string} [options.prefix] Filters the results to return only queues whose name begins with the specified prefix. * @param {object} [options] The request options. * @param {string} [options.marker] String value that identifies the portion of the list to be returned with the next list operation. * @param {int} [options.maxResults] Specifies the maximum number of queues to return per call to Azure storage. This does NOT affect list size returned by this function. (maximum: 5000) * @param {string} [options.include] Include this parameter to specify that the queue's metadata be returned as part of the response body. (allowed values: '', 'metadata') * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of `[queues]{@link QueueResult}` and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ QueueService.prototype.listQueuesSegmentedWithPrefix = function (prefix, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listQueuesSegmentedWithPrefix', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(); webResource.withQueryOption(QueryStringConstants.COMP, 'list') .withQueryOption(QueryStringConstants.MAX_RESULTS, options.maxResults) .withQueryOption(QueryStringConstants.INCLUDE, options.include) .withQueryOption(QueryStringConstants.PREFIX, prefix); if(!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(QueryStringConstants.MARKER, currentToken.nextMarker); } options.requestLocationMode = azureutil.getNextListingLocationMode(currentToken); var processResponseCallback = function (responseObject, next) { responseObject.listQueuesResult = null; if (!responseObject.error) { responseObject.listQueuesResult = { entries: null, continuationToken: null }; responseObject.listQueuesResult.entries = []; var queues = []; if (responseObject.response.body.EnumerationResults.Queues &amp;&amp; responseObject.response.body.EnumerationResults.Queues.Queue) { queues = responseObject.response.body.EnumerationResults.Queues.Queue; if (!_.isArray(queues)) { queues = [ queues ]; } queues.forEach(function (currentQueue) { var queueResult = QueueResult.parse(currentQueue); responseObject.listQueuesResult.entries.push(queueResult); }); if(responseObject.response.body.EnumerationResults.NextMarker) { responseObject.listQueuesResult.continuationToken = { nextMarker: null, targetLocation: null }; responseObject.listQueuesResult.continuationToken.nextMarker = responseObject.response.body.EnumerationResults.NextMarker; responseObject.listQueuesResult.continuationToken.targetLocation = responseObject.targetLocation; } } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.listQueuesResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Checks to see if a queue exists. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise, `[result]{@link QueueResult}` will contain * the queue information including `exists` boolean member. * `response` will contain information related to this operation. */ QueueService.prototype.doesQueueExist = function (queue, optionsOrCallback, callback) { this._doesQueueExist(queue, false, optionsOrCallback, callback); }; /** * Creates a new queue under the given account. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueResult}` will contain * the queue information. * `response` will contain information related to this operation. */ QueueService.prototype.createQueue = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createQueue', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(queue); if (options) { webResource.addOptionalMetadataHeaders(options.metadata); } var processResponseCallback = function (responseObject, next) { responseObject.queueResult = null; if (!responseObject.error) { responseObject.queueResult = new QueueResult(queue); if (options &amp;&amp; options.metadata) { responseObject.queueResult.metadata = options.metadata; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Creates a new queue under the given account if it doesn't exist. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {object} [options.metadata] The metadata key/value pairs. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueResult}` will contain * the queue information including `created` boolean member and * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var queueService = azure.createQueueService(); * queueService.createQueueIfNotExists('taskqueue', function(error) { * if(!error) { * // Queue created or exists * } * }); */ QueueService.prototype.createQueueIfNotExists = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createQueueIfNotExists', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesQueueExist(queue, true, options, function(error, result, response) { var exists = result.exists; result.created = false; delete result.exists; if (error) { callback(error, result, response); } else if (exists) { response.isSuccessful = true; callback(error, result, response); } else { self.createQueue(queue, options, function(createError, responseQueue, createResponse) { if (!createError) { responseQueue.created = true; } else if (createError &amp;&amp; createError.statusCode === Constants.HttpConstants.HttpResponseCodes.Conflict &amp;&amp; createError.code === Constants.QueueErrorCodeStrings.QUEUE_ALREADY_EXISTS) { createError = null; responseQueue.created = false; createResponse.isSuccessful = true; } callback(createError, responseQueue, createResponse); }); } }); }; /** * Permanently deletes the specified queue. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information if an error occurs; * `response` will contain information related to this operation. */ QueueService.prototype.deleteQueue = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteQueue', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.del(queue); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Permanently deletes the specified queue if it exists. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * 'true' if the queue was deleted and 'false' if the queue did not exist. * `response` will contain information related to this operation. */ QueueService.prototype.deleteQueueIfExists = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteQueueIfExists', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesQueueExist(queue, true, options, function existsCallback(error, existsResult, response) { if (error) { callback(error, existsResult.exists, response); } else if (!existsResult.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteQueue(queue, options, function(deleteError, deleteResponse) { var deleted; if (!deleteError) { deleted = true; } else if (deleteError &amp;&amp; deleteError.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.QueueErrorCodeStrings.QUEUE_NOT_FOUND) { deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; /** * Returns queue properties, including user-defined metadata. * **Note** that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueResult}` will contain * the queue information. * `response` will contain information related to this operation. */ QueueService.prototype.getQueueMetadata = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getQueueMetadata', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(queue) .withQueryOption(QueryStringConstants.COMP, 'metadata'); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var self = this; var processResponseCallback = function (responseObject, next) { responseObject.queueResult = null; if (!responseObject.error) { responseObject.queueResult = new QueueResult(queue); responseObject.queueResult.metadata = self.parseMetadataHeaders(responseObject.response.headers); responseObject.queueResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Sets user-defined metadata on the specified queue. Metadata is associated with the queue as name-value pairs. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} metadata The metadata key/value pairs. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueResult}` will contain * the queue information. * `response` will contain information related to this operation. */ QueueService.prototype.setQueueMetadata = function (queue, metadata, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setQueueMetadata', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.put(queue) .withQueryOption(QueryStringConstants.COMP, 'metadata') .addOptionalMetadataHeaders(metadata); var processResponseCallback = function (responseObject, next) { responseObject.queueResult = null; if (!responseObject.error) { responseObject.queueResult = new QueueResult(queue, metadata); responseObject.queueResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Adds a new message to the back of the message queue. * The encoded message can be up to 64KB in size for versions 2011-08-18 and newer, or 8KB in size for previous versions. * Unencoded messages must be in a format that can be included in an XML request with UTF-8 encoding. * Queue messages are encoded using the `[TextXmlQueueMessageEncoder]{@link TextXmlQueueMessageEncoder}`. See queueService.messageEncoder to set encoder defaults. * * @this {QueueService} * @param {string} queue The queue name. * @param {string|Buffer} messageText The message text. * @param {object} [options] The request options. * @param {int} [options.messageTimeToLive] The time-to-live interval for the message, in seconds. The maximum time-to-live allowed is 7 days. If this parameter is omitted, the default time-to-live is 7 days * @param {int} [options.visibilityTimeout] Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message cannot be set to a value later than the expiry time. visibilitytimeout should be set to a value smaller than the time-to-live value. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueMessageResult}` will contain * the message. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var queueService = azure.createQueueService(); * queueService.createMessage('taskqueue', 'Hello world!', function(error) { * if(!error) { * // Message inserted * } * }); */ QueueService.prototype.createMessage = function (queue, messageText, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createMessage', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var xmlMessageDescriptor = QueueMessageResult.serialize(messageText, this.messageEncoder); var options = extend(true, {}, userOptions); var webResource = WebResource.post(queue + '/messages') .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;charset=&quot;utf-8&quot;') .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(xmlMessageDescriptor, 'utf8')) .withQueryOption(QueryStringConstants.MESSAGE_TTL, options.messageTimeToLive) .withQueryOption(QueryStringConstants.VISIBILITY_TIMEOUT, options.visibilityTimeout) .withBody(xmlMessageDescriptor); var processResponseCallback = function (responseObject, next) { responseObject.queueMessageResults = []; if (responseObject.response &amp;&amp; responseObject.response.body &amp;&amp; responseObject.response.body.QueueMessagesList &amp;&amp; responseObject.response.body.QueueMessagesList.QueueMessage) { var messages = responseObject.response.body.QueueMessagesList.QueueMessage; if (!_.isArray(messages)) { messages = [ messages ]; } messages.forEach(function (message) { var queueMessageResult = QueueMessageResult.parse(message, this.messageEncoder); responseObject.queueMessageResults.push(queueMessageResult); }); } var finalCallback = function (returnObject) { callback(returnObject.error, responseObject.queueMessageResults[0], returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Retrieve messages from the queue and makes them invisible to other consumers. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {int} [options.numOfMessages] A nonzero integer value that specifies the number of messages to retrieve from the queue, up to a maximum of 32. By default, a single message is retrieved from the queue with this operation. * @param {int} [options.visibilityTimeout] Required if not peek only. Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message can be set to a value later than the expiry time. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * a list of `[messages]{@link QueueMessageResult}`. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var queueService = azure.createQueueService(); * var queueName = 'taskqueue'; * queueService.getMessages(queueName, function(error, serverMessages) { * if(!error) { * // Process the message in less than 30 seconds, the message * // text is available in serverMessages[0].messagetext * queueService.deleteMessage(queueName, serverMessages[0].messageId, serverMessages[0].popReceipt, function(error) { * if(!error){ * // Message deleted * } * }); * } * }); */ QueueService.prototype.getMessages = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getMessages', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); delete options.peekOnly; this._getOrPeekMessages(queue, options, callback); }; /** * Retrieves a message from the queue and makes it invisible to other consumers. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {int} [options.visibilityTimeout] Required if not peek only. Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message can be set to a value later than the expiry time. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueMessageResult}` will contain * the message. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var queueService = azure.createQueueService(); * var queueName = 'taskqueue'; * queueService.getMessage(queueName, function(error, serverMessage) { * if(!error) { * // Process the message in less than 30 seconds, the message * // text is available in serverMessage.messagetext * queueService.deleteMessage(queueName, serverMessage.messageId, serverMessage.popReceipt, function(error) { * if(!error){ * // Message deleted * } * }); * } * }); */ QueueService.prototype.getMessage = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getMessage', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); options.numOfMessages = 1; var finalCallback = function(error, messages, response){ var message; if(messages &amp;&amp; messages.length &gt; 0){ message = messages[0]; } callback(error, message, response); }; this.getMessages(queue, options, finalCallback); }; /** * Retrieves messages from the front of the queue, without changing the messages visibility. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {int} [options.numOfMessages] A nonzero integer value that specifies the number of messages to retrieve from the queue, up to a maximum of 32. By default, a single message is retrieved from the queue with this operation. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `result` will contain * `[messages]{@link QueueMessageResult}`. * `response` will contain information related to this operation. */ QueueService.prototype.peekMessages = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('peekMessages', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); options.peekOnly = true; delete options.visibilityTimeout; this._getOrPeekMessages(queue, options, callback); }; /** * Retrieves a message from the front of the queue, without changing the message visibility. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueMessageResult}` will contain * the message. * `response` will contain information related to this operation. */ QueueService.prototype.peekMessage = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('peekMessage', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); options.numOfMessages = 1; var finalCallback = function(error, messages, response){ var message; if(messages &amp;&amp; messages.length &gt; 0){ message = messages[0]; } callback(error, message, response); }; this.peekMessages(queue, options, finalCallback); }; /** * Deletes a specified message from the queue. * * @this {QueueService} * @param {string} queue The queue name. * @param {string} messageId The message identifier of the message to delete. * @param {string} popReceipt A valid pop receipt value returned from an earlier call to the Get Messages or Update Message operation * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information if an error occurs; * `response` will contain information related to this operation. */ QueueService.prototype.deleteMessage = function (queue, messageId, popReceipt, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteMessage', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); if (azureutil.objectIsNull(popReceipt)) { throw new Error(SR.INVALID_POP_RECEIPT); } if (azureutil.objectIsNull(messageId)) { throw new Error(SR.INVALID_MESSAGE_ID); } var options = extend(true, {}, userOptions); var webResource = WebResource.del(queue + '/messages/' + messageId) .withQueryOption(QueryStringConstants.POP_RECEIPT, popReceipt, null, true); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Clears all messages from the queue. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information * if an error occurs; otherwise * `response` will contain information related to this operation. */ QueueService.prototype.clearMessages = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('clearMessages', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.del(queue + '/messages'); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Updates the visibility timeout of a message. You can also use this operation to update the contents of a message. * A message must be in a format that can be included in an XML request with UTF-8 encoding, and the encoded message can be up to 64KB in size. * * @this {QueueService} * @param {string} queue The queue name. * @param {string} messageId The message identifier of the message to update. * @param {string} popReceipt A valid pop receipt value returned from an earlier call to the Get Messages or Update Message operation * @param {int} visibilityTimeout Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message can be set to a value later than the expiry time. * @param {object} [options] The request options. * @param {object} [options.messageText] The new message text. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueMessageResult}` will contain * the message result information. * `response` will contain information related to this operation. */ QueueService.prototype.updateMessage = function (queue, messageId, popReceipt, visibilityTimeout, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('updateMessage', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); if (azureutil.objectIsNull(popReceipt)) { throw new Error(SR.INVALID_POP_RECEIPT); } if (azureutil.objectIsNull(messageId)) { throw new Error(SR.INVALID_MESSAGE_ID); } var options = extend(true, {}, userOptions); var content = null; if (options.messageText) { content = QueueMessageResult.serialize(options.messageText, this.messageEncoder); } var contentLength = content ? Buffer.byteLength(content, 'utf8') : 0; var webResource = WebResource.put(queue + '/messages/' + messageId) .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;charset=&quot;utf-8&quot;') .withHeader(HeaderConstants.CONTENT_LENGTH, contentLength) .withQueryOption(QueryStringConstants.POP_RECEIPT, popReceipt, null, true) .withQueryOption(QueryStringConstants.VISIBILITY_TIMEOUT, visibilityTimeout) .withBody(content); var processResponseCallback = function (responseObject, next) { responseObject.queueMessageResult = null; if (!responseObject.error) { responseObject.queueMessageResult = new QueueMessageResult(queue, messageId); responseObject.queueMessageResult.getPropertiesFromHeaders(responseObject.response.headers); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueMessageResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Gets the queue's ACL. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueResult}` will contain * information for the queue. * `response` will contain information related to this operation. */ QueueService.prototype.getQueueAcl = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getQueueAcl', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.get(queue) .withQueryOption(QueryStringConstants.COMP, 'acl'); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var processResponseCallback = function (responseObject, next) { responseObject.queueResult = null; if (!responseObject.error) { responseObject.queueResult = new QueueResult(queue); responseObject.queueResult.getPropertiesFromHeaders(responseObject.response.headers); responseObject.queueResult.signedIdentifiers = AclResult.parse(responseObject.response.body); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Updates the queue's ACL. * * @this {QueueService} * @param {string} queue The queue name. * @property {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The container ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information * if an error occurs; otherwise `[result]{@link QueueResult}` will contain * information for the queue. * `response` will contain information related to this operation. * @example * var azure = require('azure-storage'); * var SharedAccessPermissions = azure.QueueUtilities.SharedAccessPermissions; * var queueService = azure.createQueueService(); * var sharedAccessPolicies = [ * {AccessPolicy: { * Permissions: PROCESS, * Start: startDate, * Expiry: expiryDate * }, * Id: processOnly, * }, * {AccessPolicy: { * Permissions: SharedAccessPermissions.PROCESS + SharedAccessPermissions.DELETE, * Start: startDate, * Expiry: expiryDate * }, * Id: processAndDelete, * }]; * * queueService.setQueueAcl(queueName, sharedAccessPolicies, function(error, queueResult, response) { * // do whatever * }); */ QueueService.prototype.setQueueAcl = function (queue, signedIdentifiers, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setQueueAcl', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var policies = null; if (signedIdentifiers) { if(_.isArray(signedIdentifiers)) { throw new TypeError(SR.INVALID_SIGNED_IDENTIFIERS); } policies = AclResult.serialize(signedIdentifiers); } var webResource = WebResource.put(queue) .withQueryOption(QueryStringConstants.COMP, 'acl') .withHeader(HeaderConstants.CONTENT_LENGTH, !azureutil.objectIsNull(policies) ? Buffer.byteLength(policies) : 0) .withBody(policies); var processResponseCallback = function (responseObject, next) { responseObject.containerResult = null; if (!responseObject.error) { responseObject.queueResult = new QueueResult(queue); responseObject.queueResult.getPropertiesFromHeaders(responseObject.response.headers); if (signedIdentifiers) { responseObject.queueResult.signedIdentifiers = signedIdentifiers; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Retrieves a shared access signature token. * * @this {QueueService} * @param {string} queue The queue name. * @param {object} sharedAccessPolicy The shared access policy. * @param {string} [sharedAccessPolicy.Id] The signed identifier. * @param {object} [sharedAccessPolicy.AccessPolicy.Permissions] The permission type. * @param {date|string} [sharedAccessPolicy.AccessPolicy.Start] The time at which the Shared Access Signature becomes valid (The UTC value will be used). * @param {date|string} [sharedAccessPolicy.AccessPolicy.Expiry] The time at which the Shared Access Signature becomes expired (The UTC value will be used). * @param {string} [sharedAccessPolicy.AccessPolicy.IPAddressOrRange] An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. * @param {string} sharedAccessPolicy.AccessPolicy.Protocols The protocols permitted for a request made with the account SAS. * Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. * @return {string} The shared access signature query string. Note this string does not contain the leading &quot;?&quot;. */ QueueService.prototype.generateSharedAccessSignature = function (queue, sharedAccessPolicy) { // check if the QueueService is able to generate a shared access signature if (!this.storageCredentials || !this.storageCredentials.generateSignedQueryString) { throw new Error(SR.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY); } validate.validateArgs('generateSharedAccessSignature', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.object(sharedAccessPolicy, 'sharedAccessPolicy'); }); return this.storageCredentials.generateSignedQueryString(Constants.ServiceType.Queue, queue, sharedAccessPolicy, null); }; /** * Checks to see if a queue exists. * @ignore * * @this {QueueService} * @param {string} queue The queue name. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information * if an error occurs; otherwise, `result` will contain * the queue information including `exists` boolean member * and `response` will contain information related to this operation. * */ QueueService.prototype._doesQueueExist = function (queue, primaryOnly, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('doesQueueExist', function(v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.head(queue) .withQueryOption(QueryStringConstants.COMP, 'metadata'); if(primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; } var processResponseCallback = function(responseObject, next) { responseObject.queueResult = new QueueResult(queue); responseObject.queueResult.exists = false; if (!responseObject.error) { responseObject.queueResult.exists = true; responseObject.queueResult.getPropertiesFromHeaders(responseObject.response.headers); } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.queueResult.exists = false; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * @ignore */ QueueService.prototype._getOrPeekMessages = function (queue, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('_getOrPeekMessages', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); v.callback(callback); }); var options = extend(true, {}, userOptions); if (!options.numOfMessages) { options.numOfMessages = 1; } var webResource = WebResource.get(queue + '/messages') .withQueryOption(QueryStringConstants.NUM_OF_MESSAGES, options.numOfMessages) .withQueryOption(QueryStringConstants.VISIBILITY_TIMEOUT, options.visibilityTimeout) .withQueryOption(QueryStringConstants.PEEK_ONLY, options.peekOnly); if (options.peekOnly) { // For peek message, it's a read-only action and can be performed against secondary endpoint. options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; } var messageEncoder = this.messageEncoder; var processResponseCallback = function (responseObject, next) { responseObject.queueMessageResults = null; if (!responseObject.error) { responseObject.queueMessageResults = []; if (responseObject.response.body.QueueMessagesList &amp;&amp; responseObject.response.body.QueueMessagesList.QueueMessage) { var messages = responseObject.response.body.QueueMessagesList.QueueMessage; if (!_.isArray(messages)) { messages = [ messages ]; } messages.forEach(function (message) { var queueMessageResult = QueueMessageResult.parse(message, messageEncoder); responseObject.queueMessageResults.push(queueMessageResult); }); } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queueMessageResults, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Retrieves a queue URL. * * @param {string} queue The queue name. * @param {string} [sasToken] The Shared Access Signature token. * @param {boolean} [primary] A boolean representing whether to use the primary or the secondary endpoint. * @return {string} The formatted URL string. * @example * var azure = require('azure-storage'); * var queueService = azure.createQueueService(); * var sharedAccessPolicy = { * AccessPolicy: { * Permissions: azure.QueueUtilities.SharedAccessPermissions.READ, * Start: startDate, * Expiry: expiryDate * }, * }; * * var sasToken = queueService.generateSharedAccessSignature(queue, sharedAccessPolicy); * var sasUrl = queueService.getUrl(queue, sasToken); */ QueueService.prototype.getUrl = function (queue, sasToken, primary) { validate.validateArgs('getUrl', function (v) { v.string(queue, 'queue'); v.queueNameIsValid(queue); }); return this._getUrl(queue, sasToken, primary); }; module.exports = QueueService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_queue_queueutilities.js.html":{"id":"services_queue_queueutilities.js.html","title":"Source: services/queue/queueutilities.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/queue/queueutilities.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Expose 'QueueUtilities'. exports = module.exports; /** * Defines enums for use with the Queue service. * @namespace QueueUtilities */ var QueueUtilities = { /** * Permission types. * * @const * @enum {string} */ SharedAccessPermissions: { READ: 'r', ADD: 'a', UPDATE: 'u', PROCESS: 'p' } }; module.exports = QueueUtilities; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"common_filters_retrypolicyfilter.js.html":{"id":"common_filters_retrypolicyfilter.js.html","title":"Source: common/filters/retrypolicyfilter.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: common/filters/retrypolicyfilter.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // var azureutil = require('../util/util'); var Constants = require('../util/constants'); var StorageUtilities = require('../util/storageutilities'); var extend = require('util')._extend; /** * Creates a new RetryPolicyFilter instance. * @class * The RetryPolicyFilter allows you to retry operations, * using a custom retry policy. Users are responsible to * define the shouldRetry method. * To apply a filter to service operations, use `withFilter` * and specify the filter to be used when creating a service. * @constructor * @param {number} [retryCount=30000] The client retry count. * @param {number} [retryInterval=3] The client retry interval, in milliseconds. * * @example * var azure = require('azure-storage'); * var retryPolicy = new azure.RetryPolicyFilter(); * retryPolicy.retryCount = 3; * retryPolicy.retryInterval = 3000; * retryPolicy.shouldRetry = function(statusCode, retryContext) { * * }; * var blobService = azure.createBlobService().withFilter(retryPolicy); */ function RetryPolicyFilter(retryCount, retryInterval) { this.retryCount = retryCount ? retryCount : RetryPolicyFilter.DEFAULT_CLIENT_RETRY_COUNT; this.retryInterval = retryInterval ? retryInterval : RetryPolicyFilter.DEFAULT_CLIENT_RETRY_INTERVAL; } /** * Represents the default client retry interval, in milliseconds. */ RetryPolicyFilter.DEFAULT_CLIENT_RETRY_INTERVAL = 1000 * 30; /** * Represents the default client retry count. */ RetryPolicyFilter.DEFAULT_CLIENT_RETRY_COUNT = 3; /** * Handles an operation with a retry policy. * * @param {Object} requestOptions The original request options. * @param {function} next The next filter to be handled. */ RetryPolicyFilter.prototype.handle = function (requestOptions, next) { RetryPolicyFilter._handle(this, requestOptions, next); }; /** * Handles an operation with a retry policy. * * @param {Object} requestOptions The original request options. * @param {function} next The next filter to be handled. */ RetryPolicyFilter._handle = function (self, requestOptions, next) { var retryRequestOptions = extend({}, requestOptions); retryRequestOptions.retryInterval = 0; // Initialize retryContext because that will be passed to the shouldRetry method which users will implement retryRequestOptions.retryContext = { retryCount: 0, error: null, retryInterval: retryRequestOptions.retryInterval, locationMode: retryRequestOptions.locationMode, currentLocation: retryRequestOptions.currentLocation }; var lastPrimaryAttempt; var lastSecondaryAttempt; var operation = function () { // retry policies dont really do anything to the request options // so move on to next if (next) { next(retryRequestOptions, function (returnObject, finalCallback, nextPostCallback) { // Previous operation ended so update the retry data if (returnObject.error) { if (retryRequestOptions.retryContext.error) { returnObject.error.innerError = retryRequestOptions.retryContext.error; } retryRequestOptions.retryContext.error = returnObject.error; } // If a request sent to the secondary location fails with 404 (Not Found), it is possible // that the resource replication is not finished yet. So, in case of 404 only in the secondary // location, the failure should still be retryable. var secondaryNotFound = (retryRequestOptions.currentLocation === Constants.StorageLocation.SECONDARY) &amp;&amp; ((returnObject.response &amp;&amp; returnObject.response.statusCode === 404) || (returnObject.error &amp;&amp; returnObject.error.code === 'ENOTFOUND')); var notExceedMaxRetryCount = retryRequestOptions.retryContext.retryCount ? retryRequestOptions.retryContext.retryCount &lt;= self.retryCount : true; var retryInfo = self.shouldRetry(secondaryNotFound ? 500 : (azureutil.objectIsNull(returnObject.response) ? 306 : returnObject.response.statusCode), retryRequestOptions); retryRequestOptions.retryContext.retryCount++; if (retryInfo.ignore) { returnObject.error = null; } // If the custom retry logic(shouldRetry) does not return a targetLocation, calculate based on the previous location and locationMode. if(azureutil.objectIsNull(retryInfo.targetLocation)) { retryInfo.targetLocation = azureutil.getNextLocation(retryRequestOptions.currentLocation, retryRequestOptions.locationMode); } // If the custom retry logic(shouldRetry) does not return a retryInterval, try to set it to the value on the instance if it is available. Otherwise, the default(30000) will be used. if(azureutil.objectIsNull(retryInfo.retryInterval)) { retryInfo.retryInterval = self.retryInterval; } // Only in the case of success from server but client side failure like MD5 or length mismatch, returnObject.retryable has a value(we explicitly set it to false). // In this case, we should not retry the request. // If the output stream already get sent to server and get error back, // we should NOT retry within the SDK as the stream data is not valid anymore if we retry directly. if ( !returnObject.outputStreamSent &amp;&amp; returnObject.error &amp;&amp; azureutil.objectIsNull(returnObject.retryable) &amp;&amp; notExceedMaxRetryCount &amp;&amp; ( (!azureutil.objectIsNull(returnObject.response) &amp;&amp; retryInfo.retryable) || ( returnObject.error.code === 'ECONNREFUSED' || returnObject.error.code === 'ETIMEDOUT' || returnObject.error.code === 'ESOCKETTIMEDOUT' || returnObject.error.code === 'ECONNRESET' || returnObject.error.code === 'EAI_AGAIN' ) ) ) { if (retryRequestOptions.currentLocation === Constants.StorageLocation.PRIMARY) { lastPrimaryAttempt = returnObject.operationEndTime; } else { lastSecondaryAttempt = returnObject.operationEndTime; } // Moreover, in case of 404 when trying the secondary location, instead of retrying on the // secondary, further requests should be sent only to the primary location, as it most // probably has a higher chance of succeeding there. if (secondaryNotFound &amp;&amp; (retryRequestOptions.locationMode !== StorageUtilities.LocationMode.SECONDARY_ONLY)) { retryInfo.locationMode = StorageUtilities.LocationMode.PRIMARY_ONLY; retryInfo.targetLocation = Constants.StorageLocation.PRIMARY; } // Now is the time to calculate the exact retry interval. ShouldRetry call above already // returned back how long two requests to the same location should be apart from each other. // However, for the reasons explained above, the time spent between the last attempt to // the target location and current time must be subtracted from the total retry interval // that ShouldRetry returned. var lastAttemptTime = retryInfo.targetLocation === Constants.StorageLocation.PRIMARY ? lastPrimaryAttempt : lastSecondaryAttempt; if (!azureutil.objectIsNull(lastAttemptTime)) { var sinceLastAttempt = new Date().getTime() - lastAttemptTime.getTime(); if (sinceLastAttempt &lt; 0) { sinceLastAttempt = 0; } retryRequestOptions.retryInterval = retryInfo.retryInterval - sinceLastAttempt; } else { retryRequestOptions.retryInterval = 0; } if(!azureutil.objectIsNull(retryInfo.locationMode)) { retryRequestOptions.locationMode = retryInfo.locationMode; } retryRequestOptions.currentLocation = retryInfo.targetLocation; operation(); } else { if (nextPostCallback) { nextPostCallback(returnObject); } else if (finalCallback) { finalCallback(returnObject); } } }); } }; operation(); }; RetryPolicyFilter._shouldRetryOnError = function (statusCode, requestOptions) { var retryInfo = (requestOptions &amp;&amp; requestOptions.retryContext) ? requestOptions.retryContext : {}; // Non-timeout Cases if (statusCode &gt;= 300 &amp;&amp; statusCode != 408) { // Always no retry on &quot;not implemented&quot; and &quot;version not supported&quot; if (statusCode == 501 || statusCode == 505) { retryInfo.retryable = false; return retryInfo; } // When absorbConditionalErrorsOnRetry is set (for append blob) if (requestOptions &amp;&amp; requestOptions.absorbConditionalErrorsOnRetry) { if (statusCode == 412) { // When appending block with precondition failure and their was a server error before, we ignore the error. if (retryInfo.lastServerError) { retryInfo.ignore = true; retryInfo.retryable = true; } else { retryInfo.retryable = false; } } else if (retryInfo.retryable &amp;&amp; statusCode &gt;= 500 &amp;&amp; statusCode &lt; 600) { // Retry on the server error retryInfo.retryable = true; retryInfo.lastServerError = true; } } else if (statusCode &lt; 500) { // No retry on the client error retryInfo.retryable = false; } } return retryInfo; }; module.exports = RetryPolicyFilter; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_file_models_shareresult.js.html":{"id":"services_file_models_shareresult.js.html","title":"Source: services/file/models/shareresult.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/file/models/shareresult.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var azureCommon = require('./../../../common/common.core'); var azureutil = azureCommon.util; var Constants = azureCommon.Constants; var HeaderConstants = Constants.HeaderConstants; /** * Creates a new ShareResult object. * @class * The ShareResult class is used to store the share information. * * @property {string} name The share name. * @property {object} metadata The metadata key/value pair. * @property {string} etag The etag. * @property {string} lastModified The date/time that the share was last modified. * @property {string} requestId The request id. * @property {string} quota The share quota. * * @constructor * @param {string} [name] The share name. */ function ShareResult(name) { this.name = name; } ShareResult.parse = function (shareXml, name) { var shareResult = new ShareResult(name); for (var propertyName in shareXml) { if (shareXml.hasOwnProperty(propertyName)) { if (propertyName === 'Properties') { // Lift out the properties onto the main object to keep consistent across all APIs like: getShareProperties azureutil.setPropertyValueFromXML(shareResult, shareXml[propertyName], true); } else if (propertyName === 'Metadata' || propertyName === 'ShareStats') { var resultPropertyName = azureutil.normalizePropertyNameFromXML(propertyName); shareResult[resultPropertyName] = {}; azureutil.setPropertyValueFromXML(shareResult[resultPropertyName], shareXml[propertyName], propertyName === 'ShareStats'); } else { shareResult[propertyName.toLowerCase()] = shareXml[propertyName]; } } } return shareResult; }; ShareResult.prototype.getPropertiesFromHeaders = function (headers) { var self = this; var setSharePropertyFromHeaders = function (shareProperty, headerProperty) { if (!self[shareProperty] &amp;&amp; headers[headerProperty.toLowerCase()]) { self[shareProperty] = headers[headerProperty.toLowerCase()]; } }; setSharePropertyFromHeaders('etag', HeaderConstants.ETAG); setSharePropertyFromHeaders('lastModified', HeaderConstants.LAST_MODIFIED); setSharePropertyFromHeaders('requestId', HeaderConstants.REQUEST_ID); setSharePropertyFromHeaders('quota', HeaderConstants.SHARE_QUOTA); }; /** * The share ACL settings. * @typedef {object} ShareAclResult * @extends {ShareAclResult} * @property {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The container ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. */ module.exports = ShareResult; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_table_tablebatch.js.html":{"id":"services_table_tablebatch.js.html","title":"Source: services/table/tablebatch.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/table/tablebatch.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var extend = require('extend'); var azureCommon = require('./../../common/common.core'); var SR = azureCommon.SR; var validate = azureCommon.validate; var Constants = azureCommon.Constants; var TableConstants = Constants.TableConstants; /** * Creates a new TableBatch. * * @constructor */ function TableBatch() { this.operations = []; this.pk = null; this.retrieve = false; } /** * Removes all of the operations from the batch. */ TableBatch.prototype.clear = function () { this.operations = []; }; /** * Returns a boolean value indicating weather there are operations in the batch. * * @return {Boolean} True if there are operations queued up; false otherwise. */ TableBatch.prototype.hasOperations = function () { return this.operations.length &gt; 0; }; /** * Returns the number of operations in the batch. * * @return {number} The number of operations in the batch. */ TableBatch.prototype.size = function () { return this.operations.length; }; /** * Adds a retrieve operation to the batch. Note that this must be the only operation in the batch. * * @param {string} partitionKey The partition key. * @param {string} rowKey The row key. * @param {object} [options] The request options. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {TableService~propertyResolver} [options.propertyResolver] The property resolver. Given the partition key, row key, property name, property value, * and the property Edm type if given by the service, returns the Edm type of the property. * @param {Function(entity)} [options.entityResolver] The entity resolver. Given the single entity returned by the query, returns a modified object. */ TableBatch.prototype.retrieveEntity = function (partitionKey, rowKey, options) { var entity = { PartitionKey: {_: partitionKey, $: 'Edm.String'}, RowKey: {_: rowKey, $: 'Edm.String'}, }; this.addOperation(TableConstants.Operations.RETRIEVE, entity, options); }; /** * Adds an insert operation to the batch. * * @param {object} entity The entity. * @param {object} [options] The request options. * @param {string} [options.echoContent] Whether or not to return the entity upon a successful insert. Inserts only, default to false. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {TableService~propertyResolver} [options.propertyResolver] The property resolver. Only applied if echoContent is true. Given the partition key, row key, property name, * property value, and the property Edm type if given by the service, returns the Edm type of the property. * @param {Function(entity)} [options.entityResolver] The entity resolver. Only applied if echoContent is true. Given the single entity returned by the insert, returns * a modified object. */ TableBatch.prototype.insertEntity = function (entity, options) { this.addOperation(TableConstants.Operations.INSERT, entity, options); }; /** * Adds a delete operation to the batch. * * @param {object} entity The entity. */ TableBatch.prototype.deleteEntity = function (entity) { this.addOperation(TableConstants.Operations.DELETE, entity); }; /** * Adds a merge operation to the batch. * * @param {object} entity The entity. */ TableBatch.prototype.mergeEntity = function (entity) { this.addOperation(TableConstants.Operations.MERGE, entity); }; /** * Adds an replace operation to the batch. * * @param {object} entity The entity. */ TableBatch.prototype.replaceEntity = function (entity) { this.addOperation(TableConstants.Operations.REPLACE, entity); }; /** * Adds an insert or replace operation to the batch. * * @param {object} entity The entity. */ TableBatch.prototype.insertOrReplaceEntity = function (entity) { this.addOperation(TableConstants.Operations.INSERT_OR_REPLACE, entity); }; /** * Adds an insert or merge operation to the batch. * * @param {object} entity The entity. */ TableBatch.prototype.insertOrMergeEntity = function (entity) { this.addOperation(TableConstants.Operations.INSERT_OR_MERGE, entity); }; /** * Adds an operation to the batch after performing checks. * * @param {string} operationType The type of operation to perform. See Constants.TableConstants.Operations * @param {object} entity The entity. * @param {object} [options] The request options. */ TableBatch.prototype.addOperation = function (operationType, entity, options) { validate.validateArgs('addOperation', function (v) { v.object(entity, 'entity'); v.object(entity.PartitionKey, 'entity.PartitionKey'); v.object(entity.RowKey, 'entity.RowKey'); v.stringAllowEmpty(entity.PartitionKey._, 'entity.PartitionKey._'); v.stringAllowEmpty(entity.RowKey._, 'entity.RowKey._'); }); if(this.operations.length &gt;= 100) { throw new Error(SR.BATCH_TOO_LARGE); } if (operationType === TableConstants.Operations.RETRIEVE) { if(this.hasOperations()) { throw new Error(SR.BATCH_ONE_RETRIEVE); } else { this.retrieve = true; } } else if (this.retrieve) { throw new Error(SR.BATCH_ONE_RETRIEVE); } if (!this.hasOperations()) { this.pk = entity.PartitionKey._; } else if (entity.PartitionKey._ !== this.pk) { throw new Error(SR.BATCH_ONE_PARTITION_KEY); } var copiedOptions = extend(true, {}, options); this.operations.push({type: operationType, entity: entity, options: copiedOptions}); }; /** * Gets an operation from the batch. Returns null if the index does not exist. * * @param {number} index The index in the operations array at which to remove an element. * @return {object} The removed operation. */ TableBatch.prototype.getOperation = function (index) { return this.operations[index]; }; /** * Removes an operation from the batch. Returns null if the index does not exist. * * @param {number} index The index in the operations array at which to remove an element. * @return {object} The removed operation. */ TableBatch.prototype.removeOperation = function (index) { var operation = this.operations.splice(index, 1)[0]; // if the array is empty, unlock the partition key if (!this.hasOperations()) { this.pk = null; this.retrieve = false; } return operation; }; module.exports = TableBatch; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_table_tablequery.js.html":{"id":"services_table_tablequery.js.html","title":"Source: services/table/tablequery.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/table/tablequery.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var _ = require('underscore'); var util = require('util'); var azureCommon = require('./../../common/common.core'); var azureutil = azureCommon.util; var SR = azureCommon.SR; var QueryStringConstants = azureCommon.Constants.QueryStringConstants; var edmHandler = require('./internal/edmhandler'); var TableUtilities = require('./tableutilities'); var QueryComparisons = TableUtilities.QueryComparisons; var TableOperators = TableUtilities.TableOperators; var EdmType = TableUtilities.EdmType; /** * Creates a new TableQuery object. * * @constructor */ function TableQuery() { this._fields = []; this._where = []; this._top = null; } /** * Specifies the select clause. If no arguments are given, all fields will be selected. * * @param {array} fields The fields to be selected. * @return {TableQuery} A table query object with the select clause. * @example * var tableQuery = new TableQuery().select('field1', 'field2'); */ TableQuery.prototype.select = function () { var self = this; if (arguments) { _.each(arguments, function (argument) { self._fields.push(argument); }); } return this; }; /** * Specifies the top clause. * * @param {int} top The number of items to fetch. * @return {TableQuery} A table query object with the top clause. * @example * var tableQuery = new TableQuery().top(10); * * // tasktable should already exist and have entities * tableService.queryEntities('tasktable', tableQuery, null \\/*currentToken*\\/, function(error, result) { * if(!error) { * var entities = result.entities; // there will be 10 or less entities * // do stuff with the returned entities if there are any * // if result.continuationToken exists, to get the next 10 (or less) entities * // call queryEntities as above, but with the returned token instead of null * } * }); */ TableQuery.prototype.top = function (top) { this._top = top; return this; }; /** * Specifies the where clause. * * Valid type specifier strings include: ?string?, ?bool?, ?int32?, ?double?, ?date?, ?guid?, ?int64?, ?binary? * A type must be specified for guid, int64, and binaries or the filter produced will be incorrect. * * @param {string} condition The condition string. * @param {string|array} value Value(s) to insert in question mark (?) parameters. * @return {TableQuery} A table query object with the where clause. * @example * var tableQuery = new TableQuery().where(TableQuery.guidFilter('GuidField', QueryComparisons.EQUAL, guidVal)); * OR * var tableQuery = new TableQuery().where('Name == ? or Name &lt;= ?', name1, name2); * OR * var tableQuery = new TableQuery().where('Name == ?string? &amp;&amp; Value == ?int64?, name1, int64Val); * * // tasktable should already exist and have entities * tableService.queryEntities('tasktable', tableQuery, null \\/*currentToken*\\/, function(error, result, response) { * if(!error) { * var entities = result.entities; * // do stuff with the returned entities if there are any * } * }); */ TableQuery.prototype.where = function (condition) { this._where.push(TableQuery._encodeConditionString(condition, arguments)); return this; }; /** * Generates a property filter condition string for an 'int' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|int} value An 'int' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.int32Filter('IntField', QueryComparisons.EQUAL, 5); */ TableQuery.int32Filter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.INT32); }; /** * Generates a property filter condition string for a 'int64' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|int64} value An 'int64' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.int64Filter('Int64Field', QueryComparisons.EQUAL, 123); */ TableQuery.int64Filter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.INT64); }; /** * Generates a property filter condition string for a 'double' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|double}value A 'double' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.doubleFilter('DoubleField', QueryComparisons.EQUAL, 123.45); */ TableQuery.doubleFilter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.DOUBLE); }; /** * Generates a property filter condition string for a 'boolean' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|boolean} value A 'boolean' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.booleanFilter('BooleanField', QueryComparisons.EQUAL, false); */ TableQuery.booleanFilter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.BOOLEAN); }; /** * Generates a property filter condition string for a 'datetime' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|date} value A 'datetime' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.dateFilter('DateTimeField', QueryComparisons.EQUAL, new Date(Date.UTC(2001, 1, 3, 4, 5, 6))); */ TableQuery.dateFilter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.DATETIME); }; /** * Generates a property filter condition string for a 'guid' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|guid} value A 'guid' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.guidFilter('GuidField', QueryComparisons.EQUAL, guid.v1()); */ TableQuery.guidFilter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.GUID); }; /** * Generates a property filter condition string for a 'binary' value. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string|buffer}value A 'buffer' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.binaryFilter('BinaryField', QueryComparisons.EQUAL, new Buffer('hello')); */ TableQuery.binaryFilter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.BINARY); }; /** * Generates a property filter condition string. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {string} value A 'string' containing the value to compare with the property. * @return {string} A string containing the formatted filter condition. * @example * var query = TableQuery.stringFilter('StringField', QueryComparisons.EQUAL, 'name'); */ TableQuery.stringFilter = function (propertyName, operation, value) { return TableQuery._concatFilterString(propertyName, operation, value, EdmType.STRING); }; /** * Creates a filter condition using the specified logical operator on two filter conditions. * * @param {string} filterA A string containing the first formatted filter condition. * @param {string} operatorString A string containing the operator to use (AND, OR). * @param {string} filterB A string containing the second formatted filter condition. * @return {string} A string containing the combined filter expression. * @example * var filter1 = TableQuery.stringFilter('Name', QueryComparisons.EQUAL, 'Person'); * var filter2 = TableQuery.booleanFilter('Visible', QueryComparisons.EQUAL, true); * var combinedFilter = TableQuery.combineFilters(filter1, TablUtilities.TableOperators.AND, filter2); */ TableQuery.combineFilters = function (filterA, operatorString, filterB) { return filterA + ' ' + operatorString + ' ' + filterB; }; /** * Specifies an AND where condition. * * @param {string} condition The condition string. * @param {array} arguments Any number of arguments to be replaced in the condition by the question mark (?). * @return {TableQuery} A table query object with the and clause. * @example * var tableQuery = new TableQuery() * .where('Name == ? or Name &lt;= ?', 'Person1', 'Person2'); * .and('Age &gt;= ?', 18); */ TableQuery.prototype.and = function (condition) { if (this._where.length === 0) { throw new Error(util.format(SR.QUERY_OPERATOR_REQUIRES_WHERE, 'AND')); } this._where.push(' and ' + TableQuery._encodeConditionString(condition, arguments)); return this; }; /** * Specifies an OR where condition. * * @param {string} condition The condition. * @param {array} arguments Any number of arguments to be replaced in the condition by the question mark (?). * @return {TableQuery} A table query object with the or clause. * @example * var tableQuery = new TableQuery() * .where('Name == ? or Name &lt;= ?', 'Person1', 'Person2'); * .or('Age &gt;= ?', 18); */ TableQuery.prototype.or = function (condition) { if (this._where.length === 0) { throw new Error(util.format(SR.QUERY_OPERATOR_REQUIRES_WHERE, 'OR')); } this._where.push(' or ' + TableQuery._encodeConditionString(condition, arguments)); return this; }; /** * Returns the query string object for the query. * * @return {object} JSON object representing the query string arguments for the query. */ TableQuery.prototype.toQueryObject = function () { var query = {}; if (this._fields.length &gt; 0) { query[QueryStringConstants.SELECT] = this._fields.join(','); } if (this._where.length &gt; 0) { query[QueryStringConstants.FILTER] = this._where.join(''); } if (this._top) { query[QueryStringConstants.TOP] = this._top; } return query; }; // Functions /** * Concat the filter string parameters. * * @param {string} propertyName A string containing the name of the property to compare. * @param {string} operation A string containing the comparison operator to use. * See Constants.TableConstants.QueryComparisons for a list of allowed operations. * @param {object} value The value to compare with the property. * @param {string} type A string EdmType of the property to compare. * @return {string} A string containing the formatted filter condition. * @ignore */ TableQuery._concatFilterString = function (propertyName, operation, value, type) { if (azureutil.objectIsNull(propertyName)) { throw new Error(util.format(SR.ARGUMENT_NULL_OR_UNDEFINED, 'propertyName')); } if (azureutil.objectIsNull(operation)) { throw new Error(util.format(SR.ARGUMENT_NULL_OR_UNDEFINED, 'operation')); } if (azureutil.objectIsNull(value)) { throw new Error(util.format(SR.ARGUMENT_NULL_OR_UNDEFINED, 'value')); } var serializedValue = edmHandler.serializeQueryValue(value, type); return propertyName + ' ' + operation + ' ' + serializedValue; }; /** * Encodes a condition string. * * @param {string} condition The condition. * @param {array} arguments Any number of arguments to be replaced in the condition by the question mark (?). * @return {TableQuery} A table query object with the or clause * @ignore */ TableQuery._encodeConditionString = function (condition, args) { var encodedCondition = TableQuery._replaceOperators(condition); if (args.length &gt; 1) { var sections = encodedCondition.split(/(\\?string\\?|\\?int32\\?|\\?int64\\?|\\?bool\\?|\\?double\\?|\\?date\\?|\\?binary\\?|\\?guid\\?|\\?)/); var count = 1; for (var i = 0; i &lt; sections.length &amp;&amp; count &lt; args.length; i++) { if (sections[i].indexOf('?') === 0) { var type = TableQuery._getEdmType(sections[i]); sections[i] = edmHandler.serializeQueryValue(args[count], type); count++; } } encodedCondition = sections.join(''); } return encodedCondition; }; /** * Converts the query string type to an Edm type. * * @param {string} type The type included in the query string. * @return {string} The EdmType. * @ignore */ TableQuery._getEdmType = function (type) { switch (type) { case '?binary?': return EdmType.BINARY; case '?int64?': return EdmType.INT64; case '?date?': return EdmType.DATETIME; case '?guid?': return EdmType.GUID; case '?int32?': return EdmType.INT32; case '?double?': return EdmType.DOUBLE; case '?bool?': return EdmType.BOOLEAN; case '?string?': return EdmType.STRING; default: return undefined; } }; /** * Replace operators. * @ignore * @param {string} whereClause The text where to replace the operators. * @return {string} The string with the replaced operators. * @ignore */ TableQuery._replaceOperators = function (whereClause) { var encodedWhereClause = whereClause.replace(/ == /g, ' ' + QueryComparisons.EQUAL + ' '); encodedWhereClause = encodedWhereClause.replace(/ != /g, ' ' + QueryComparisons.NOT_EQUAL + ' '); encodedWhereClause = encodedWhereClause.replace(/ &gt;= /g, ' ' + QueryComparisons.GREATER_THAN_OR_EQUAL + ' '); encodedWhereClause = encodedWhereClause.replace(/ &gt; /g, ' ' + QueryComparisons.GREATER_THAN + ' '); encodedWhereClause = encodedWhereClause.replace(/ &lt;= /g, ' ' + QueryComparisons.LESS_THAN_OR_EQUAL + ' '); encodedWhereClause = encodedWhereClause.replace(/ &lt; /g, ' ' + QueryComparisons.LESS_THAN + ' '); encodedWhereClause = encodedWhereClause.replace(/ \\&amp;\\&amp; /g, ' ' + TableOperators.AND + ' '); encodedWhereClause = encodedWhereClause.replace(/ \\|\\| /g, ' ' + TableOperators.OR + ' '); encodedWhereClause = encodedWhereClause.replace(/!/g, TableOperators.NOT); return encodedWhereClause; }; module.exports = TableQuery; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_table_tableservice.js.html":{"id":"services_table_tableservice.js.html","title":"Source: services/table/tableservice.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/table/tableservice.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Module dependencies. var util = require('util'); var extend = require('extend'); var _ = require('underscore'); var azureCommon = require('./../../common/common.core'); var azureutil = azureCommon.util; var validate = azureCommon.validate; var SR = azureCommon.SR; var StorageServiceClient = azureCommon.StorageServiceClient; var SharedKeyTable = require('./internal/sharedkeytable'); var RequestHandler = require('./internal/requesthandler'); var TableQuery = require('./tablequery'); var WebResource = azureCommon.WebResource; var Constants = azureCommon.Constants; var QueryStringConstants = Constants.QueryStringConstants; var HeaderConstants = Constants.HeaderConstants; var TableConstants = Constants.TableConstants; var RequestLocationMode = Constants.RequestLocationMode; // Models requires var TableResult = require('./models/tableresult'); var entityResult = require('./models/entityresult'); var BatchResult = require('./models/batchresult'); var ServiceStatsParser = azureCommon.ServiceStatsParser; var AclResult = azureCommon.AclResult; var TableUtilities = require('./tableutilities'); /** * Creates a new TableService object. * If no connection string or storageaccount and storageaccesskey are provided, * the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. * @class * The TableService object allows you to peform management operations with the Microsoft Azure Table Service. * The Table Service stores data in rows of key-value pairs. A table is composed of multiple rows, and each row * contains key-value pairs. There is no schema, so each row in a table may store a different set of keys. * * For more information on the Table Service, as well as task focused information on using it from a Node.js application, see * [How to Use the Table Service from Node.js](http://azure.microsoft.com/en-us/documentation/articles/storage-nodejs-how-to-use-table-storage/). * The following defaults can be set on the Table service. * defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the Table service. * defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the Table service. * defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the Table service. * defaultLocationMode The default location mode for requests made via the Table service. * defaultPayloadFormat The default payload format for requests made via the Table service. * useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the Table service.; true to use the * Nagle algorithm; otherwise, false. The default value is false. * @constructor * @extends {StorageServiceClient} * * @param {string} [storageAccountOrConnectionString] The storage account or the connection string. * @param {string} [storageAccessKey] The storage access key. * @param {string|object} [host] The host address. To define primary only, pass a string. * Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. * @param {string} [sasToken] The Shared Access Signature token. * @param {string} [endpointSuffix] The endpoint suffix. */ function TableService(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix) { var storageServiceSettings = StorageServiceClient.getStorageSettings(storageAccountOrConnectionString, storageAccessKey, host, sasToken, endpointSuffix); TableService['super_'].call(this, storageServiceSettings._name, storageServiceSettings._key, storageServiceSettings._tableEndpoint, storageServiceSettings._usePathStyleUri, storageServiceSettings._sasToken); if (this.anonymous) { throw new Error(SR.ANONYMOUS_ACCESS_BLOBSERVICE_ONLY); } if(this.storageAccount &amp;&amp; this.storageAccessKey) { this.storageCredentials = new SharedKeyTable(this.storageAccount, this.storageAccessKey, this.usePathStyleUri); } this.defaultPayloadFormat = TableUtilities.PayloadFormat.MINIMAL_METADATA; } util.inherits(TableService, StorageServiceClient); // Table service methods /** * Gets the service stats for a storage account’s Table service. * * @this {TableService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link ServiceStats}` will contain the stats. * `response` will contain information related to this operation. */ TableService.prototype.getServiceStats = function (optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getServiceStats', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var webResource = WebResource.get() .withQueryOption(QueryStringConstants.COMP, 'stats') .withQueryOption(QueryStringConstants.RESTYPE, 'service'); var processResponseCallback = function (responseObject, next) { responseObject.serviceStatsResult = null; if (!responseObject.error) { responseObject.serviceStatsResult = ServiceStatsParser.parse(responseObject.response.body.StorageServiceStats); } // function to be called after all filters var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.serviceStatsResult, returnObject.response); }; // call the first filter next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Gets the properties of a storage account’s Table service, including Azure Storage Analytics. * * @this {TableService} * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `[result]{@link ServiceProperties}` will contain the properties. * `response` will contain information related to this operation. */ TableService.prototype.getServiceProperties = function (optionsOrCallback, callback) { return this.getAccountServiceProperties(optionsOrCallback, callback); }; /** * Sets the properties of a storage account’s Table service, including Azure Storage Analytics. * You can also use this operation to set the default request version for all incoming requests that do not have a version specified. * * @this {TableService} * @param {object} serviceProperties The service properties. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information if an error occurs; * `response` will contain information related to this operation. */ TableService.prototype.setServiceProperties = function (serviceProperties, optionsOrCallback, callback) { return this.setAccountServiceProperties(serviceProperties, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of table items under the specified account. * * @this {TableService} * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The create options or callback function. * @param {int} [options.maxResults] Specifies the maximum number of tables to return per call to Azure ServiceClient. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of tables and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ TableService.prototype.listTablesSegmented = function (currentToken, optionsOrCallback, callback) { this.listTablesSegmentedWithPrefix(null /* prefix */, currentToken, optionsOrCallback, callback); }; /** * Lists a segment containing a collection of table items under the specified account. * * @this {TableService} * @param {string} prefix The prefix of the table name. * @param {object} currentToken A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The create options or callback function. * @param {int} [options.maxResults] Specifies the maximum number of tables to return per call to Azure ServiceClient. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain `entries` and `continuationToken`. * `entries` gives a list of tables and the `continuationToken` is used for the next listing operation. * `response` will contain information related to this operation. */ TableService.prototype.listTablesSegmentedWithPrefix = function (prefix, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('listTables', function (v) { v.callback(callback); }); var options = extend(true, {}, userOptions); options.payloadFormat = options.payloadFormat || this.defaultPayloadFormat; var webResource = WebResource.get(TableConstants.TABLE_SERVICE_TABLE_NAME); RequestHandler.setTableRequestHeadersAndBody(webResource, null, options.payloadFormat); if(!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(TableConstants.NEXT_TABLE_NAME, currentToken.nextTableName); } if(!azureutil.objectIsNull(prefix)) { var query = new TableQuery() .where(TableConstants.TABLE_NAME + ' &gt;= ?', prefix) .and(TableConstants.TABLE_NAME + ' &lt; ?', prefix + '{'); webResource.withQueryOption(QueryStringConstants.FILTER, query.toQueryObject().$filter); } if(!azureutil.objectIsNull(options.maxResults)) { var query = new TableQuery().top(options.maxResults); webResource.withQueryOption(QueryStringConstants.TOP, query.toQueryObject().$top); } options.requestLocationMode = azureutil.getNextListingLocationMode(currentToken); var processResponseCallback = function (responseObject, next) { responseObject.listTablesResult = null; if (!responseObject.error) { responseObject.listTablesResult = { entries: null, continuationToken: null }; responseObject.listTablesResult.entries = TableResult.parse(responseObject.response); if (responseObject.response.headers[TableConstants.CONTINUATION_NEXT_TABLE_NAME] &amp;&amp; !azureutil.objectIsEmpty(responseObject.response.headers[TableConstants.CONTINUATION_NEXT_TABLE_NAME])) { responseObject.listTablesResult.continuationToken = { nextTableName: null, targetLocation: null }; responseObject.listTablesResult.continuationToken.nextTableName = responseObject.response.headers[TableConstants.CONTINUATION_NEXT_TABLE_NAME]; responseObject.listTablesResult.continuationToken.targetLocation = responseObject.targetLocation; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.listTablesResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; // Table Methods /** * Gets the table's ACL. * * @this {TableService} * @param {string} table The table name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the ACL information for the table. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. * `response` will contain information related to this operation. */ TableService.prototype.getTableAcl = function (table, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('getTableAcl', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); options.requestLocationMode = Constants.RequestLocationMode.PRIMARY_OR_SECONDARY; var webResource = WebResource.get(table) .withQueryOption(QueryStringConstants.COMP, 'acl'); var processResponseCallback = function (responseObject, next) { responseObject.tableResult = null; if (!responseObject.error) { responseObject.tableResult = new TableResult(table); responseObject.tableResult.signedIdentifiers = AclResult.parse(responseObject.response.body); } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.tableResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Updates the table's ACL. * * @this {TableService} * @param {string} table The table name. * @param {Object.&lt;string, AccessPolicy&gt;} signedIdentifiers The table ACL settings. See `[AccessPolicy]{@link AccessPolicy}` for detailed information. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain information for the table. * `response` will contain information related to this operation. */ TableService.prototype.setTableAcl = function (table, signedIdentifiers, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('setTableAcl', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); var policies = null; if (signedIdentifiers) { if(_.isArray(signedIdentifiers)) { throw new TypeError(SR.INVALID_SIGNED_IDENTIFIERS); } policies = AclResult.serialize(signedIdentifiers); } var webResource = WebResource.put(table) .withQueryOption(QueryStringConstants.COMP, 'acl') .withHeader(HeaderConstants.CONTENT_LENGTH, !azureutil.objectIsNull(policies) ? Buffer.byteLength(policies) : 0) .withBody(policies); var processResponseCallback = function (responseObject, next) { responseObject.tableResult = null; if (!responseObject.error) { // SetTableAcl doesn't actually return anything in the response responseObject.tableResult = new TableResult(table); if (signedIdentifiers) { responseObject.tableResult.signedIdentifiers = signedIdentifiers; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.tableResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Retrieves a shared access signature token. * * @this {TableService} * @param {string} table The table name. * @param {object} sharedAccessPolicy The shared access policy. * @param {string} [sharedAccessPolicy.Id] The signed identifier. * @param {object} [sharedAccessPolicy.AccessPolicy.Permissions] The permission type. * @param {date|string} [sharedAccessPolicy.AccessPolicy.Start] The time at which the Shared Access Signature becomes valid (The UTC value will be used). * @param {date|string} [sharedAccessPolicy.AccessPolicy.Expiry] The time at which the Shared Access Signature becomes expired (The UTC value will be used). * @param {string} [sharedAccessPolicy.AccessPolicy.IPAddressOrRange] An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. * @param {string} [sharedAccessPolicy.AccessPolicy.Protocols] The protocols permitted for a request made with the account SAS. * Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. * @param {string} [sharedAccessPolicy.AccessPolicy.StartPk] The starting Partition Key for which the SAS will be valid. * @param {string} [sharedAccessPolicy.AccessPolicy.EndPk] The ending Partition Key for which the SAS will be valid. * @param {string} [sharedAccessPolicy.AccessPolicy.StartRk] The starting Row Key for which the SAS will be valid. * @param {string} [sharedAccessPolicy.AccessPolicy.EndRk] The ending Row Key for which the SAS will be valid. * @return {object} An object with the shared access signature. */ TableService.prototype.generateSharedAccessSignature = function (table, sharedAccessPolicy) { // check if the TableService is able to generate a shared access signature if (!this.storageCredentials || !this.storageCredentials.generateSignedQueryString) { throw new Error(SR.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY); } validate.validateArgs('generateSharedAccessSignature', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.object(sharedAccessPolicy, 'sharedAccessPolicy'); }); var lowerCasedTableName = table.toLowerCase(); return this.storageCredentials.generateSignedQueryString(Constants.ServiceType.Table, lowerCasedTableName, sharedAccessPolicy, null, { tableName: lowerCasedTableName }); }; /** * Checks whether or not a table exists on the service. * * @this {TableService} * @param {string} table The table name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the table information including `exists` boolean member. * `response` will contain information related to this operation. */ TableService.prototype.doesTableExist = function (table, optionsOrCallback, callback) { this._doesTableExist(table, false, optionsOrCallback, callback); }; /** * Creates a new table within a storage account. * * @this {TableService} * @param {string} table The table name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the new table information. * `response` will contain information related to this operation. */ TableService.prototype.createTable = function (table, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createTable', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); var tableDescriptor = TableResult.serialize(table); var webResource = WebResource.post('Tables') .withHeader(HeaderConstants.PREFER, HeaderConstants.PREFER_NO_CONTENT); RequestHandler.setTableRequestHeadersAndBody(webResource, tableDescriptor, this.defaultPayloadFormat); var processResponseCallback = function (responseObject, next) { responseObject.tableResponse = {}; responseObject.tableResponse.isSuccessful = responseObject.error ? false : true; responseObject.tableResponse.statusCode = responseObject.response.statusCode; if (!responseObject.error) { responseObject.tableResponse.TableName = table; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.tableResponse, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Creates a new table within a storage account if it does not exists. * * @this {TableService} * @param {string} table The table name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * `result` will contain the table information including `created` boolean member * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var tableService = azure.createTableService(); * tableService.createTableIfNotExists('tasktable', function(error) { * if(!error) { * // Table created or exists * } * }); */ TableService.prototype.createTableIfNotExists = function (table, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('createTableIfNotExists', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesTableExist(table, true, options, function(error, result, response) { var exists = result.exists; result.created = false; delete result.exists; if (error) { callback(error, result, response); } else if (exists) { response.isSuccessful = true; callback(error, result, response); } else { self.createTable(table, options, function(createError, createResult, response) { if (!createError) { createResult.created = true; } else if (createError &amp;&amp; createError.statusCode === Constants.HttpConstants.HttpResponseCodes.Conflict &amp;&amp; createError.code === Constants.TableErrorCodeStrings.TABLE_ALREADY_EXISTS) { createError = null; createResult.created = false; createResult.isSuccessful = true; } callback(createError, createResult, response); }); } }); }; /** * Deletes a table from a storage account. * * @this {TableService} * @param {string} table The table name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information if an error occurs; * `response` will contain information related to this operation. */ TableService.prototype.deleteTable = function (table, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteTable', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); var webResource = WebResource.del('Tables(\\'' + table + '\\')'); RequestHandler.setTableRequestHeadersAndBody(webResource, null, this.defaultPayloadFormat); var processResponseCallback = function (responseObject, next) { var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Deletes a table from a storage account, if it exists. * * @this {TableService} * @param {string} table The table name. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * `result` will be `true` if table was deleted, false otherwise * `response` will contain information related to this operation. */ TableService.prototype.deleteTableIfExists = function (table, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('deleteTableIfExists', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); var self = this; self._doesTableExist(table, true, options, function(error, result, response) { if (error) { callback(error, result.exists, response); } else if (!result.exists) { response.isSuccessful = true; callback(error, false, response); } else { self.deleteTable(table, options, function(deleteError, deleteResponse) { var deleted; if (!deleteError) { deleted = true; } else if (deleteError &amp;&amp; deleteError.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound &amp;&amp; deleteError.code === Constants.StorageErrorCodeStrings.RESOURCE_NOT_FOUND) { deleted = false; deleteError = null; deleteResponse.isSuccessful = true; } callback(deleteError, deleted, deleteResponse); }); } }); }; // Table Entity Methods /** * Queries data in a table. To retrieve a single entity by partition key and row key, use retrieve entity. * * @this {TableService} * @param {string} table The table name. * @param {TableQuery} tableQuery The query to perform. Use null, undefined, or new TableQuery() to get all of the entities in the table. * @param {object} currentToken A continuation token returned by a previous listing operation. * Please use 'null' or 'undefined' if this is the first operation. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {bool} [options.autoResolveProperties] If true, guess at all property types. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(entity)} [options.entityResolver] The entity resolver. Given a single entity returned by the query, returns a modified object which is added to * the entities array. * @param {TableService~propertyResolver} [options.propertyResolver] The property resolver. Given the partition key, row key, property name, property value, * and the property Edm type if given by the service, returns the Edm type of the property. * @param {TableService~queryResponse} callback `error` will contain information if an error occurs; * otherwise `entities` will contain the entities returned by the query. * If more matching entities exist, and could not be returned, * `queryResultContinuation` will contain a continuation token that can be used * to retrieve the next set of results. * `response` will contain information related to this operation. * * The logic for returning entity types can get complicated. Here is the algorithm used: * ``` * var propertyType; * * if (propertyResovler) { // If the caller provides a propertyResolver in the options, use it * propertyType = propertyResolver(partitionKey, rowKey, propertyName, propertyValue, propertyTypeFromService); * } else if (propertyTypeFromService) { // If the service provides us a property type, use it. See below for an explanation of when this will and won't occur. * propertyType = propertyTypeFromService; * } else if (autoResolveProperties) { // If options.autoResolveProperties is set to true * if (javascript type is string) { // See below for an explanation of how and why autoResolveProperties works as it does. * propertyType = 'Edm.String'; * } else if (javascript type is boolean) { * propertyType = 'Edm.Boolean'; * } * } * * if (propertyType) { * // Set the property type on the property. * } else { * // Property gets no EdmType. * } * ``` * Notes: * * * The service only provides a type if JsonFullMetadata or JsonMinimalMetadata is used, and if the type is Int64, Guid, Binary, or DateTime. * * Explanation of autoResolveProperties: * * String gets correctly resolved to 'Edm.String'. * * Int64, Guid, Binary, and DateTime all get resolved to 'Edm.String.' This only happens if JsonNoMetadata is used (otherwise the service will provide the propertyType in a prior step). * * Boolean gets correctly resolved to 'Edm.Boolean'. * * For both Int32 and Double, no type information is returned, even in the case of autoResolveProperties = true. This is due to an * inability to distinguish between the two in certain cases. * * @example * var azure = require('azure-storage'); * var tableService = azure.createTableService(); * // tasktable should already exist and have entities * * // returns all entities in tasktable, and a continuation token for the next page of results if necessary * tableService.queryEntities('tasktable', null, null \\/*currentToken*\\/, function(error, result) { * if(!error) { * var entities = result.entities; * // do stuff with the returned entities if there are any * } * }); * * // returns field1 and field2 of the entities in tasktable, and a continuation token for the next page of results if necessary * var tableQuery = new TableQuery().select('field1', 'field2'); * tableService.queryEntities('tasktable', tableQuery, null \\/*currentToken*\\/, function(error, result) { * if(!error) { * var entities = result.entities; * // do stuff with the returned entities if there are any * } * }); */ TableService.prototype.queryEntities = function (table, tableQuery, currentToken, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('queryEntities', function (v) { v.string(table, 'table'); v.callback(callback); }); var options = extend(true, {}, userOptions); options.payloadFormat = options.payloadFormat || this.defaultPayloadFormat; var webResource = WebResource.get(table); RequestHandler.setTableRequestHeadersAndBody(webResource, null, options.payloadFormat); if (tableQuery) { var queryString = tableQuery.toQueryObject(); Object.keys(queryString).forEach(function (queryStringName) { webResource.withQueryOption(queryStringName, queryString[queryStringName]); }); } if(!azureutil.objectIsNull(currentToken)) { webResource.withQueryOption(TableConstants.NEXT_PARTITION_KEY, currentToken.nextPartitionKey); webResource.withQueryOption(TableConstants.NEXT_ROW_KEY, currentToken.nextRowKey); } options.requestLocationMode = azureutil.getNextListingLocationMode(currentToken); var processResponseCallback = function (responseObject, next) { responseObject.queryEntitiesResult = null; if (!responseObject.error) { responseObject.queryEntitiesResult = { entries: null, continuationToken: null }; // entries responseObject.queryEntitiesResult.entries = entityResult.parseQuery(responseObject.response, options.autoResolveProperties, options.propertyResolver, options.entityResolver); // continuation token var continuationToken = { nextPartitionKey: responseObject.response.headers[TableConstants.CONTINUATION_NEXT_PARTITION_KEY], nextRowKey: responseObject.response.headers[TableConstants.CONTINUATION_NEXT_ROW_KEY], targetLocation: responseObject.targetLocation }; if (!azureutil.IsNullOrEmptyOrUndefinedOrWhiteSpace(continuationToken.nextPartitionKey)) { responseObject.queryEntitiesResult.continuationToken = continuationToken; } } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.queryEntitiesResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Retrieves an entity from a table. * * @this {TableService} * @param {string} table The table name. * @param {string} partitionKey The partition key. * @param {string} rowKey The row key. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {bool} [options.autoResolveProperties] If true, guess at all property types. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {TableService~propertyResolver} [options.propertyResolver] The property resolver. Given the partition key, row key, property name, property value, * and the property Edm type if given by the service, returns the Edm type of the property. * @param {Function(entity)} [options.entityResolver] The entity resolver. Given the single entity returned by the query, returns a modified object. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will be the matching entity. * `response` will contain information related to this operation. * * The logic for returning entity types can get complicated. Here is the algorithm used: * ``` * var propertyType; * * if (propertyResovler) { // If the caller provides a propertyResolver in the options, use it * propertyType = propertyResolver(partitionKey, rowKey, propertyName, propertyValue, propertyTypeFromService); * } else if (propertyTypeFromService) { // If the service provides us a property type, use it. See below for an explanation of when this will and won't occur. * propertyType = propertyTypeFromService; * } else if (autoResolveProperties) { // If options.autoResolveProperties is set to true * if (javascript type is string) { // See below for an explanation of how and why autoResolveProperties works as it does. * propertyType = 'Edm.String'; * } else if (javascript type is boolean) { * propertyType = 'Edm.Boolean'; * } * } * * if (propertyType) { * // Set the property type on the property. * } else { * // Property gets no EdmType. * } * ``` * Notes: * * * The service only provides a type if JsonFullMetadata or JsonMinimalMetadata is used, and if the type is Int64, Guid, Binary, or DateTime. * * Explanation of autoResolveProperties: * * String gets correctly resolved to 'Edm.String'. * * Int64, Guid, Binary, and DateTime all get resolved to 'Edm.String.' This only happens if JsonNoMetadata is used (otherwise the service will provide the propertyType in a prior step). * * Boolean gets correctly resolved to 'Edm.Boolean'. * * For both Int32 and Double, no type information is returned, even in the case of autoResolveProperties = true. This is due to an * inability to distinguish between the two in certain cases. * * @example * var azure = require('azure-storage'); * var tableService = azure.createTableService(); * tableService.retrieveEntity('tasktable', 'tasksSeattle', '1', function(error, serverEntity) { * if(!error) { * // Entity available in serverEntity variable * } * }); */ TableService.prototype.retrieveEntity = function (table, partitionKey, rowKey, optionsOrCallback, callback) { var entityDescriptor = { PartitionKey: {_: partitionKey, $: 'Edm.String'}, RowKey: {_: rowKey, $: 'Edm.String'}, }; validate.validateArgs('retrieveEntity', function (v) { v.stringAllowEmpty(partitionKey, 'partitionKey'); v.stringAllowEmpty(rowKey, 'rowKey'); }); this._performEntityOperation(TableConstants.Operations.RETRIEVE, table, entityDescriptor, optionsOrCallback, callback); }; /** * Inserts a new entity into a table. * * @this {TableService} * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The request options. * @param {string} [options.echoContent] Whether or not to return the entity upon a successful insert. Default to false. * @param {string} [options.payloadFormat] The payload format to use in the response, if options.echoContent is true. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {TableService~propertyResolver} [options.propertyResolver] The property resolver. Only applied if echoContent is true. Given the partition key, row key, property name, * property value, and the property Edm type if given by the service, returns the Edm type of the property. * @param {Function(entity)} [options.entityResolver] The entity resolver. Only applied if echoContent is true. Given the single entity returned by the insert, returns * a modified object. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the entity information. * `response` will contain information related to this operation. * * @example * var azure = require('azure-storage'); * var tableService = azure.createTableService(); * var task1 = { * PartitionKey : {'_': 'tasksSeattle', '$':'Edm.String'}, * RowKey: {'_': '1', '$':'Edm.String'}, * Description: {'_': 'Take out the trash', '$':'Edm.String'}, * DueDate: {'_': new Date(2011, 12, 14, 12), '$':'Edm.DateTime'} * }; * tableService.insertEntity('tasktable', task1, function(error) { * if(!error) { * // Entity inserted * } * }); */ TableService.prototype.insertEntity = function (table, entityDescriptor, optionsOrCallback, callback) { this._performEntityOperation(TableConstants.Operations.INSERT, table, entityDescriptor, optionsOrCallback, callback); }; /** * Inserts or updates a new entity into a table. * * @this {TableService} * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the entity information. * `response` will contain information related to this operation. */ TableService.prototype.insertOrReplaceEntity = function (table, entityDescriptor, optionsOrCallback, callback) { this._performEntityOperation(TableConstants.Operations.INSERT_OR_REPLACE, table, entityDescriptor, optionsOrCallback, callback); }; /** * Replaces an existing entity within a table. To replace conditionally based on etag, set entity['.metadata']['etag']. * * @this {TableService} * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the entity information. * `response` will contain information related to this operation. */ TableService.prototype.replaceEntity = function (table, entityDescriptor, optionsOrCallback, callback) { this._performEntityOperation(TableConstants.Operations.REPLACE, table, entityDescriptor, optionsOrCallback, callback); }; /** * Updates an existing entity within a table by merging new property values into the entity. To merge conditionally based on etag, set entity['.metadata']['etag']. * * @this {TableService} * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the entity information. * response` will contain information related to this operation. */ TableService.prototype.mergeEntity = function (table, entityDescriptor, optionsOrCallback, callback) { this._performEntityOperation(TableConstants.Operations.MERGE, table, entityDescriptor, optionsOrCallback, callback); }; /** * Inserts or updates an existing entity within a table by merging new property values into the entity. * * @this {TableService} * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain the entity information. * `response` will contain information related to this operation. */ TableService.prototype.insertOrMergeEntity = function (table, entityDescriptor, optionsOrCallback, callback) { this._performEntityOperation(TableConstants.Operations.INSERT_OR_MERGE, table, entityDescriptor, optionsOrCallback, callback); }; /** * Deletes an entity within a table. To delete conditionally based on etag, set entity['.metadata']['etag']. * * @this {TableService} * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResponse} callback `error` will contain information if an error occurs; * `response` will contain information related to this operation. */ TableService.prototype.deleteEntity = function (table, entityDescriptor, optionsOrCallback, callback) { this._performEntityOperation(TableConstants.Operations.DELETE, table, entityDescriptor, optionsOrCallback, callback); }; /** * Executes the operations in the batch. * * @this {TableService} * @param {string} table The table name. * @param {TableBatch} batch The table batch to execute. * @param {object} [options] The create options or callback function. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `result` will contain responses for each operation executed in the batch; * `result.entity` will contain the entity information for each operation executed. * `result.response` will contain the response for each operations executed. * `response` will contain information related to this operation. */ TableService.prototype.executeBatch = function (table, batch, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('executeBatch', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.object(batch, 'batch'); v.callback(callback); }); if(!batch.hasOperations()) { throw new Error(SR.EMPTY_BATCH); } var options = extend(true, {}, userOptions); var batchResult = new BatchResult(this, table, batch.operations); var webResource = batchResult.constructWebResource(); var body = batchResult.serialize(); webResource.withBody(body); webResource.withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(body, 'utf8')); var processResponseCallback = function (responseObject, next) { var responseObjects = batchResult.parse(responseObject); var noError = true; // if the batch was unsuccesful, there will be a single response indicating the error if (responseObjects &amp;&amp; responseObjects.length &gt; 0) { responseObjects.forEach(function(item){ if(noError &amp;&amp; !item.response.isSuccessful){ responseObject = item; noError = false; } }); } if (noError) { responseObject.operationResponses = responseObjects; } var finalCallback = function (returnObject) { // perform final callback callback(returnObject.error, returnObject.operationResponses, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; // Private methods /** * Checks whether or not a table exists on the service. * @ignore * * @this {TableService} * @param {string} table The table name. * @param {string} primaryOnly If true, the request will be executed against the primary storage location. * @param {object} [options] The request options. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {Function(error, result, response)} callback `error` will contain information if an error occurs; * otherwise `result` will contain * the table information including `exists` boolean member. * `response` will contain information related to this operation. */ TableService.prototype._doesTableExist = function (table, primaryOnly, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('doesTableExist', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.callback(callback); }); var options = extend(true, {}, userOptions); if(primaryOnly === false) { options.requestLocationMode = RequestLocationMode.PRIMARY_OR_SECONDARY; } var webResource = WebResource.get('Tables(\\'' + table + '\\')'); webResource.withHeader(HeaderConstants.ACCEPT, this.defaultPayloadFormat); var processResponseCallback = function (responseObject, next) { responseObject.tableResult = {}; responseObject.tableResult.isSuccessful = responseObject.error ? false : true; responseObject.tableResult.statusCode = responseObject.response === null || responseObject.response === undefined ? undefined : responseObject.response.statusCode; responseObject.tableResult.TableName = table; if(!responseObject.error){ responseObject.tableResult.exists = true; } else if (responseObject.error &amp;&amp; responseObject.error.statusCode === Constants.HttpConstants.HttpResponseCodes.NotFound) { responseObject.error = null; responseObject.tableResult.exists = false; responseObject.response.isSuccessful = true; } var finalCallback = function (returnObject) { callback(returnObject.error, returnObject.tableResult, returnObject.response); }; next(responseObject, finalCallback); }; this.performRequest(webResource, null, options, processResponseCallback); }; /** * Peforms a table operation. * * @this {TableService} * @param {string} operation The operation to perform. * @param {string} table The table name. * @param {object} entityDescriptor The entity descriptor. * @param {object} [options] The create options or callback function. * @param {string} [options.echoContent] Whether or not to return the entity upon a successful insert. Default to false. * @param {string} [options.payloadFormat] The payload format to use for the request. * @param {LocationMode} [options.locationMode] Specifies the location mode used to decide which location the request should be sent to. * Please see StorageUtilities.LocationMode for the possible values. * @param {int} [options.timeoutIntervalInMs] The server timeout interval, in milliseconds, to use for the request. * @param {int} [options.clientRequestTimeoutInMs] The timeout of client requests, in milliseconds, to use for the request. * @param {int} [options.maximumExecutionTimeInMs] The maximum execution time, in milliseconds, across all potential retries, to use when making this request. * The maximum execution time interval begins at the time that the client begins building the request. The maximum * execution time is checked intermittently while performing requests, and before executing retries. * @param {string} [options.clientRequestId] A string that represents the client request ID with a 1KB character limit. * @param {bool} [options.useNagleAlgorithm] Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. * The default value is false. * @param {errorOrResult} callback `error` will contain information if an error occurs; * otherwise `entity` will contain the entity information. * `response` will contain information related to this operation. * @ignore */ TableService.prototype._performEntityOperation = function (operation, table, entityDescriptor, optionsOrCallback, callback) { var userOptions; azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { userOptions = o; callback = c; }); validate.validateArgs('entityOperation', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); v.object(entityDescriptor, 'entityDescriptor'); if(typeof entityDescriptor.PartitionKey !== 'string') { v.object(entityDescriptor.PartitionKey, 'entityDescriptor.PartitionKey'); v.stringAllowEmpty(entityDescriptor.PartitionKey._, 'entityDescriptor.PartitionKey._'); } if(typeof entityDescriptor.RowKey !== 'string') { v.object(entityDescriptor.RowKey, 'entityDescriptor.RowKey'); v.stringAllowEmpty(entityDescriptor.RowKey._, 'entityDescriptor.RowKey._'); } v.callback(callback); }); var options = extend(true, {}, userOptions); options.payloadFormat = options.payloadFormat || this.defaultPayloadFormat; var webResource = RequestHandler.constructEntityWebResource(operation, table, entityDescriptor, options); var processResponseCallback = function (responseObject, next) { var finalCallback; if (operation === TableConstants.Operations.DELETE) { finalCallback = function (returnObject) { callback(returnObject.error, returnObject.response); }; } else { responseObject.entityResponse = null; if (!responseObject.error) { responseObject.entityResponse = entityResult.parseEntity(responseObject.response, options.autoResolveProperties, options.propertyResolver, options.entityResolver); } finalCallback = function (returnObject) { callback(returnObject.error, returnObject.entityResponse, returnObject.response); }; } next(responseObject, finalCallback); }; this.performRequest(webResource, webResource.body, options, processResponseCallback); }; /** * Retrieves a table URL. * * @param {string} table The table name. * @param {string} [sasToken] The Shared Access Signature token. * @param {boolean} [primary] A boolean representing whether to use the primary or the secondary endpoint. * @return {string} The formatted URL string. * @example * var azure = require('azure-storage'); * var tableService = azure.createTableService(); * var sharedAccessPolicy = { * AccessPolicy: { * Permissions: azure.TableUtilities.SharedAccessPermissions.QUERY, * Start: startDate, * Expiry: expiryDate * }, * }; * * var sasToken = tableService.generateSharedAccessSignature(table, sharedAccessPolicy); * var sasUrl = tableService.getUrl(table, sasToken); */ TableService.prototype.getUrl = function (table, sasToken, primary) { validate.validateArgs('getUrl', function (v) { v.string(table, 'table'); v.tableNameIsValid(table); }); return this._getUrl(table, sasToken, primary); }; /** * Given the partition key, row key, property name, property value, * and the property Edm type if given by the service, returns the Edm type of the property. * @typedef {function} TableService~propertyResolver * @param {object} pk The partition key. * @param {object} rk The row key. * @param {string} name The property name. * @param {object} value The property value. * @param {string} type The EDM type. */ /** * Returns entities matched by a query. * @callback TableService~queryResponse * @param {object} error If an error occurs, the error information. * @param {object} entities The entities returned by the query. * @param {object} queryResultContinuation If more matching entities exist, and could not be returned, * a continuation token that can be used to retrieve more results. * @param {object} response Information related to this operation. */ module.exports = TableService; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"services_table_tableutilities.js.html":{"id":"services_table_tableutilities.js.html","title":"Source: services/table/tableutilities.js","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Source: services/table/tableutilities.js // // Copyright (c) Microsoft and contributors. All rights reserved. // // Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); // you may not use this file except in compliance with the License. // You may obtain a copy of the License at // http://www.apache.org/licenses/LICENSE-2.0 // // Unless required by applicable law or agreed to in writing, software // distributed under the License is distributed on an &quot;AS IS&quot; BASIS, // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. // // See the License for the specific language governing permissions and // limitations under the License. // // Expose 'HeaderConstants'. exports = module.exports; /** * Defines constants, enums, and utility functions for use with the Table service. * @namespace TableUtilities */ var TableUtilities = { /** * Permission types. * * @const * @enum {string} */ SharedAccessPermissions: { QUERY: 'r', ADD: 'a', UPDATE: 'u', DELETE: 'd' }, /** * Payload Format. * * @const * @enum {string} */ PayloadFormat: { FULL_METADATA: 'application/json;odata=fullmetadata', MINIMAL_METADATA: 'application/json;odata=minimalmetadata', NO_METADATA: 'application/json;odata=nometadata' }, /** * Defines the set of Boolean operators for constructing queries. * * @const * @enum {string} */ TableOperators: { AND: 'and', NOT: 'not', OR: 'or' }, /** * Filter property comparison operators. * * @const * @enum {string} */ QueryComparisons: { EQUAL: 'eq', NOT_EQUAL: 'ne', GREATER_THAN: 'gt', GREATER_THAN_OR_EQUAL: 'ge', LESS_THAN: 'lt', LESS_THAN_OR_EQUAL: 'le' }, /** * Edm types. * * @const * @enum {string} */ EdmType: { STRING: 'Edm.String', BINARY: 'Edm.Binary', INT64: 'Edm.Int64', INT32: 'Edm.Int32', DOUBLE: 'Edm.Double', DATETIME: 'Edm.DateTime', GUID: 'Edm.Guid', BOOLEAN: 'Edm.Boolean' }, /** * A helper to create table entities. * * @example * var entGen = TableUtilities.entityGenerator; * var entity = { PartitionKey: entGen.String('part2'), * RowKey: entGen.String('row1'), * boolValue: entGen.Boolean(true), * intValue: entGen.Int32(42), * dateValue: entGen.DateTime(new Date(Date.UTC(2011, 10, 25))), * }; */ entityGenerator: (function() { var EntityProperty = function (value, type) { var entityProperty = { _:value}; if (type) { entityProperty['$'] = type; } return entityProperty; }; return { EntityProperty : EntityProperty, Int32 : function(value) { return new EntityProperty(value, 'Edm.Int32'); }, Int64 : function(value) { return new EntityProperty(value, 'Edm.Int64'); }, Binary : function(value) { return new EntityProperty(value, 'Edm.Binary'); }, Boolean : function(value) { return new EntityProperty(value, 'Edm.Boolean'); }, String : function(value) { return new EntityProperty(value, 'Edm.String'); }, Guid : function(value) { return new EntityProperty(value, 'Edm.Guid'); }, Double : function(value) { return new EntityProperty(value, 'Edm.Double'); }, DateTime : function(value) { return new EntityProperty(value, 'Edm.DateTime'); } }; })() }; module.exports = TableUtilities; × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"global.html":{"id":"global.html","title":"Global","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Global Methods createBlobService(storageAccountOrConnectionString [, storageAccessKey] [, host]) Creates a new BlobService object.If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEYenvironment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. Source: azure-storage.js, line 97 Returns: A new BlobService object. Type BlobService createBlobServiceAnonymous(host) Creates a new BlobService object using the host uri and anonymous access. Parameters: Name Type Description host string | object The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. Source: azure-storage.js, line 120 Returns: A new BlobService object with the anonymous credentials. Type BlobService createBlobServiceWithSas(host, sasToken) Creates a new BlobService object using the host Uri and the SAS credentials provided. Parameters: Name Type Description host string | object The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string The Shared Access Signature token. Source: azure-storage.js, line 109 Returns: A new BlobService object with the SAS credentials. Type BlobService createFileService(storageAccountOrConnectionString [, storageAccessKey] [, host]) Creates a new FileService object.If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEYenvironment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. Source: azure-storage.js, line 144 Returns: A new FileService object. Type FileService createFileServiceWithSas(host, sasToken) Creates a new FileService object using the host Uri and the SAS credentials provided. Parameters: Name Type Description host string | object The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string The Shared Access Signature token. Source: azure-storage.js, line 156 Returns: A new FileService object with the SAS credentials. Type FileService createQueueService( [storageAccountOrConnectionString] [, storageAccessKey] [, host]) Creates a new QueueService object.If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEYenvironment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. Source: azure-storage.js, line 181 Returns: A new QueueService object. Type QueueService createQueueServiceWithSas(host, sasToken) Creates a new QueueService object using the host Uri and the SAS credentials provided. Parameters: Name Type Description host string | object The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string The Shared Access Signature token. Source: azure-storage.js, line 193 Returns: A new QueueService object with the SAS credentials. Type QueueService createTableService( [storageAccountOrConnectionString] [, storageAccessKey] [, host]) Creates a new TableService object.If no storageaccount or storageaccesskey are provided, the AZURE_STORAGE_CONNECTION_STRING and then the AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEYenvironment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. Source: azure-storage.js, line 61 Returns: A new TableService object. Type TableService createTableServiceWithSas(host, sasToken) Creates a new TableService object using the host Uri and the SAS credentials provided. Parameters: Name Type Description host string | object The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string The Shared Access Signature token. Source: azure-storage.js, line 73 Returns: A new TableService object with the SAS credentials. Type TableService generateAccountSharedAccessSignature( [storageAccountOrConnectionString] [, storageAccessKey], sharedAccessPolicy) Generates an account shared access signature token Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. sharedAccessPolicy object The shared access policy. Properties Name Type Description AccessPolicy.Services SharedAccessServices The services (blob, file, queue, table) for a shared access signature associated with this shared access policy. Refer to Constants.AccountSasConstants.Services. AccessPolicy.ResourceTypes SharedAccessResourceTypes The resource type for a shared access signature associated with this shared access policy. Refer to Constants.AccountSasConstants.ResourceTypes. AccessPolicy.Permissions SharedAccessPermissions The permissions for a shared access signature. Refer to Constants.AccountSasConstants.Permissions. AccessPolicy.Start date The time at which the Shared Access Signature becomes valid. AccessPolicy.Expiry date The time at which the Shared Access Signature becomes expired. AccessPolicy.IPAddressOrRange string The permission type. Refer to Constants.AccountSasConstants.ResourceTypes. AccessPolicy.Protocols string The possible protocols. Refer to Constants.AccountSasConstants.ResourceTypes. Source: azure-storage.js, line 222 generateDevelopmentStorageCredentials( [proxyUri]) Creates a connection string that can be used to create a service which runs on the storage emulator. The emulator must be downloaded separately. Parameters: Name Type Argument Description proxyUri string &lt;optional&gt; The proxyUri. By default, http://127.0.0.1 Source: azure-storage.js, line 29 Returns: A connection string representing the development storage credentials. Type string Example var azure = require('azure-storage'); var devStoreCreds = azure.generateDevelopmentStorageCredentials(); var blobService = azure.createBlobService(devStoreCreds); Type Definitions AccessConditions Specifying conditional headers for blob service operations. See http://msdn.microsoft.com/en-us/library/dd179371.aspx for more information. Type: object Properties: Name Type Description EtagMatch string If the ETag for the blob matches the specified ETag. Specify the wildcard character (*) to perform the operation only if the resource does exist, and fail the operation if it does not exist. EtagNonMatch string If the ETag for the blob does not match the specified ETag. Specify the wildcard character (*) to perform the operation only if the resource does not exist, and fail the operation if it does exist. DateModifedSince Date | string If the blob has been modified since the specified date. DateUnModifiedSince Date | string If the blob has not been modified since the specified date. SequenceNumberLessThanOrEqual Number | string If the blob's sequence number is less than or equal to the specified value. For Put Page operation only. See https://msdn.microsoft.com/en-us/library/azure/ee691975.aspx for more information. SequenceNumberLessThan Number | string If the blob's sequence number is less than the specified value. For Put Page operation only. See https://msdn.microsoft.com/en-us/library/azure/ee691975.aspx for more information. SequenceNumberEqual Number | string If the blob's sequence number is equal to the specified value. For Put Page operation only. See https://msdn.microsoft.com/en-us/library/azure/ee691975.aspx for more information. MaxBlobSize Number | string If the Append Block operation would cause the blob to exceed that limit or if the blob size is already greater than the specified value. For Append Block operation only. See https://msdn.microsoft.com/en-us/library/mt427365.aspx for more information. MaxAppendPosition Number | string If the append position is equal to the specified value. For Append Block operation only. See https://msdn.microsoft.com/en-us/library/mt427365.aspx for more information. Source: azure-storage.js, line 249 AccessPolicy The access policy. Type: object Properties: Name Type Description Permissions string The permission type. Start Date The time at which the access policy becomes valid. Expiry Date The time at which the access policy becomes expired. IPAddressOrRange string An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. Protocols string The protocols permitted for a request made with the SAS. Services string The services (blob, file, queue, table) for a shared access signature associated with this shared access policy. ResourceTypes string The resource type for a shared access signature associated with this shared access policy. Source: azure-storage.js, line 317 ContainerAclResult The container ACL settings. Type: object Properties: Name Type Description signedIdentifiers Object.&lt;string, AccessPolicy&gt; The container ACL settings. See AccessPolicy for detailed information. Source: services/blob/models/containerresult.js, line 109 CorsRule The CORS rule of a storage service. Type: object Properties: Name Type Description AllowedMethods Array.&lt;string&gt; A list of HTTP methods that are allowed to be executed by the origin. For Azure Storage, permitted methods are DELETE, GET, HEAD, MERGE, POST, OPTIONS or PUT. AllowedOrigins Array.&lt;string&gt; A list of origin domains that are allowed via CORS, or &quot;*&quot; if all domains are allowed. AllowedHeaders Array.&lt;string&gt; A list of headers allowed to be part of the cross-origin request. ExposedHeaders Array.&lt;string&gt; A list of response headers to expose to CORS clients. MaxAgeInSeconds number The number of seconds that the client/browser should cache a preflight response. Source: azure-storage.js, line 300 errorOrResponse(error, response) A callback that returns a response object. Parameters: Name Type Description error object If an error occurs, will contain information about the error. response object Contains information about the response returned for the operation. For example, HTTP status codes and headers. Source: azure-storage.js, line 231 errorOrResult(error, result, response) A callback that returns result and response objects. Parameters: Name Type Description error object If an error occurs, will contain information about the error. result object The result of the operation. response object Contains information about the response returned for the operation. For example, HTTP status codes and headers. Source: azure-storage.js, line 239 LoggingProperties The Azure Analytics logging settings. Type: object Properties: Name Type Description Version string The version of Storage Analytics currently in use for logging. Delete boolean Indicates whether delete requests are being logged. Read boolean Indicates whether read requests are being logged. Write boolean Indicates whether write requests are being logged. RetentionPolicy RetentionPolicy The retention policy of the log data. Source: azure-storage.js, line 281 MetricsProperties The setting of Azure Analytics summary of request stastics. Type: object Properties: Name Type Description Version string The version of Storage Analytics currently in use for hour metrics. Enabled string Indicates whether metrics are enabled IncludeAPIs boolean Indicates whether metrics generate summary statistics for called API operations. RetentionPolicy RetentionPolicy The retention policy of the metrics data. Source: azure-storage.js, line 291 Range The range. Type: object Properties: Name Type Description start number The start of the range. end number The end of the range. Source: azure-storage.js, line 339 RangeDiff The range diff. Refer to https://msdn.microsoft.com/en-us/library/azure/mt736912.aspx Type: object Properties: Name Type Description start number The start of the range. end number The end of the range. isCleared boolean If the range is cleared or not. Source: azure-storage.js, line 346 RetentionPolicy The Azure Analytics logging or metrics retention policy. Type: object Properties: Name Type Description Enabled boolean Indicates whether a retention policy is enabled for the storage service. Days number Indicates the number of days that logging data is retained. All data older than this value will be deleted. Source: azure-storage.js, line 310 ServiceProperties The properties of a storage service, including properties of Storage Analytics and CORS (Cross-Origin Resource Sharing) rules. Type: object Properties: Name Type Description DefaultServiceVersion string The default version of Storage Analytics currently in use. Logging LoggingProperties The Logging settings. HourMetrics MetricsProperties The HourMetrics settings provide a summary of request statistics grouped by API in hourly aggregates. MinuteMetrics MetricsProperties The HourMetrics settings provide request statistics grouped by API for each minute. Cors object Groups all CORS rules. Properties Name Type Description CorsRules Array.&lt;CorsRule&gt; Groups settings for a CORS rule. Source: azure-storage.js, line 270 ServiceStats The service statistics. Type: object Properties: Name Type Description GeoReplication object The geo replication stastics. Properties Name Type Description Status string The status of the secondary location. LastSyncTime Date A GMT date/time value, to the second. All primary writes preceding this value are guaranteed to be available for read operations at the secondary. Primary writes after this point in time may or may not be available for reads. Source: azure-storage.js, line 329 ShareAclResult The share ACL settings. Type: object Properties: Name Type Description signedIdentifiers Object.&lt;string, AccessPolicy&gt; The container ACL settings. See AccessPolicy for detailed information. Source: services/file/models/shareresult.js, line 77 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Classes Classes BinaryBase64QueueMessageEncoder BlobResult BlobService ContainerResult DirectoryResult ExponentialRetryPolicyFilter FileResult FileService LeaseResult LinearRetryPolicyFilter Logger QueueMessageEncoder QueueMessageResult QueueResult QueueService RetryPolicyFilter ShareResult StorageServiceClient TableBatch TableQuery TableService TextBase64QueueMessageEncoder TextXmlQueueMessageEncoder Namespaces BlobUtilities FileUtilities QueueUtilities TableUtilities × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"namespaces.list.html":{"id":"namespaces.list.html","title":"Namespaces","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Namespaces Classes BinaryBase64QueueMessageEncoder BlobResult BlobService ContainerResult DirectoryResult ExponentialRetryPolicyFilter FileResult FileService LeaseResult LinearRetryPolicyFilter Logger QueueMessageEncoder QueueMessageResult QueueResult QueueService RetryPolicyFilter ShareResult StorageServiceClient TableBatch TableQuery TableService TextBase64QueueMessageEncoder TextXmlQueueMessageEncoder Namespaces BlobUtilities FileUtilities QueueUtilities TableUtilities × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Microsoft Azure Storage SDK for Node.js Master Dev This project provides a Node.js package and a browser compatible JavaScript Client Library that make it easy to consume and manage Microsoft Azure Storage Services. If you are looking for the Node.js SDK for other Azure services, visit https://github.com/Azure/azure-sdk-for-node. Features Tables Create/Delete Tables Query/Create/Read/Update/Delete Entities Blobs Create/Delete Containers Create/Read/Update/Delete Blobs Files Create/Delete Shares Create/Delete Directories Create/Read/Update/Delete Files Queues Create/Delete Queues Insert/Peek Queue Messages Advanced Queue Operations Service Properties Get Service Properties Set Service Properties Please check details on API reference documents. Getting StartedInstallnpm install azure-storageUsagevar azure = require('azure-storage');When using the Storage SDK, you must provide connection information for the storage account to use. This can be provided using: Environment variables - AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY, or AZURE_STORAGE_CONNECTION_STRING. Constructors - For example, var tableSvc = azure.createTableService(accountName, accountKey); Table StorageTo ensure a table exists, call createTableIfNotExists: var azure = require('azure-storage'); var tableService = azure.createTableService(); tableService.createTableIfNotExists('mytable', function(error, result, response) { if (!error) { // result contains true if created; false if already exists } });A new entity can be added by calling insertEntity: var azure = require('azure-storage'); var tableService = azure.createTableService(); var entGen = azure.TableUtilities.entityGenerator; var entity = { PartitionKey: entGen.String('part2'), RowKey: entGen.String('row1'), boolValueTrue: entGen.Boolean(true), boolValueFalse: entGen.Boolean(false), intValue: entGen.Int32(42), dateValue: entGen.DateTime(new Date(Date.UTC(2011, 10, 25))), complexDateValue: entGen.DateTime(new Date(Date.UTC(2013, 02, 16, 01, 46, 20))) }; tableService.insertEntity('mytable', entity, function(error, result, response) { if (!error) { // result contains the ETag for the new entity } });Instead of creating entities manually, you can use entityGenerator: var azure = require('azure-storage'); var entGen = azure.TableUtilities.entityGenerator; var task = { PartitionKey: entGen.String('hometasks'), RowKey: entGen.String('1'), description: entGen.String('take out the trash'), dueDate: entGen.DateTime(new Date(Date.UTC(2015, 6, 20))), };The method retrieveEntity can then be used to fetch the entity that was just inserted: var azure = require('azure-storage'); var tableService = azure.createTableService(); tableService.retrieveEntity('mytable', 'part2', 'row1', function(error, result, response) { if (!error) { // result contains the entity } });Use TableQuery to build complex queries: var azure = require('azure-storage'); var tableService = azure.createTableService(); var query = new azure.TableQuery() .top(5) .where('PartitionKey eq ?', 'part2'); tableService.queryEntities('mytable', query, null, function(error, result, response) { if (!error) { // result.entries contains entities matching the query } });Blob StorageThe createContainerIfNotExists method can be used to create acontainer in which to store a blob: var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.createContainerIfNotExists('taskcontainer', { publicAccessLevel: 'blob' }, function(error, result, response) { if (!error) { // if result = true, container was created. // if result = false, container already existed. } });To upload a file (assuming it is called task1-upload.txt and it is placed in the same folder as the script below), the method createBlockBlobFromLocalFile can be used. var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.createBlockBlobFromLocalFile('mycontainer', 'taskblob', 'task1-upload.txt', function(error, result, response) { if (!error) { // file uploaded } });For page blobs, use createPageBlobFromLocalFile. There are other methods for uploading blobs also, such as createBlockBlobFromText or createPageBlobFromStream. There are also several ways to download block and page blobs. For example, getBlobToStream downloads the blob to a stream: var blobService = azure.createBlobService(); var fs = require('fs'); blobService.getBlobToStream('mycontainer', 'taskblob', fs.createWriteStream('output.txt'), function(error, result, response) { if (!error) { // blob retrieved } });To create a Shared Access Signature (SAS), use the generateSharedAccessSignature method. Additionally you can use the date helper functions to easily create a SAS that expires at some point relative to the current time. var azure = require('azure-storage'); var blobService = azure.createBlobService(); var startDate = new Date(); var expiryDate = new Date(startDate); expiryDate.setMinutes(startDate.getMinutes() + 100); startDate.setMinutes(startDate.getMinutes() - 100); var sharedAccessPolicy = { AccessPolicy: { Permissions: azure.BlobUtilities.SharedAccessPermissions.READ, Start: startDate, Expiry: expiryDate }, }; var token = blobService.generateSharedAccessSignature(containerName, blobName, sharedAccessPolicy); var sasUrl = blobService.getUrl(containerName, blobName, token);Queue StorageThe createQueueIfNotExists method can be used to ensure a queue exists: var azure = require('azure-storage'); var queueService = azure.createQueueService(); queueService.createQueueIfNotExists('taskqueue', function(error) { if (!error) { // Queue exists } });The createMessage method can then be called to insert the message into the queue: var queueService = azure.createQueueService(); queueService.createMessage('taskqueue', 'Hello world!', function(error) { if (!error) { // Message inserted } });It is then possible to call the getMessage method, process the message and then call deleteMessage inside the callback. This two-step process ensures messages don't get lost when they are removed from the queue. var queueService = azure.createQueueService(), queueName = 'taskqueue'; queueService.getMessages(queueName, function(error, serverMessages) { if (!error) { // Process the message in less than 30 seconds, the message // text is available in serverMessages[0].messageText queueService.deleteMessage(queueName, serverMessages[0].messageId, serverMessages[0].popReceipt, function(error) { if (!error) { // Message deleted } }); } });File StorageThe createShareIfNotExists method can be used to create ashare in which to store a file or a directory of files: var azure = require('azure-storage'); var fileService = azure.createFileService(); fileService.createShareIfNotExists('taskshare', function(error, result, response) { if (!error) { // if result = true, share was created. // if result = false, share already existed. } });To create a directory, the method createDirectoryIfNotExists can be used. var azure = require('azure-storage'); var fileService = azure.createFileService(); fileService.createDirectoryIfNotExists('taskshare', 'taskdirectory', function(error, result, response) { if (!error) { // if result = true, share was created. // if result = false, share already existed. } });To upload a file (assuming it is called task1-upload.txt and it is placed in the same folder as the script below), the method createFileFromLocalFile can be used. var azure = require('azure-storage'); var fileService = azure.createFileService(); fileService.createFileFromLocalFile('taskshare', 'taskdirectory', 'taskfile', 'task1-upload.txt', function(error, result, response) { if (!error) { // file uploaded } });There are other methods for uploading files also, such as createFileFromText or createFileFromStream. There are also several ways to download files. For example, getFileToStream downloads the file to a stream: var fileService = azure.createFileService(); var fs = require('fs'); fileService.getFileToStream('taskshare', 'taskdirectory', 'taskfile', fs.createWriteStream('output.txt'), function(error, result, response) { if (!error) { // file retrieved } });Service PropertiesThe getServiceProperties method can be used to fetch the logging, metrics and CORS settings on your storage account: var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.getServiceProperties(function(error, result, response) { if (!error) { var serviceProperties = result; // properties are fetched } });The setServiceProperties method can be used to modify the logging, metrics and CORS settings on your storage account: var azure = require('azure-storage'); var blobService = azure.createBlobService(); var serviceProperties = generateServiceProperties(); blobService.setServiceProperties(serviceProperties, function(error, result, response) { if (!error) { // properties are set } }); function generateServiceProperties() { return serviceProperties = { Logging: { Version: '1.0', Delete: true, Read: true, Write: true, RetentionPolicy: { Enabled: true, Days: 10, }, }, HourMetrics: { Version: '1.0', Enabled: true, IncludeAPIs: true, RetentionPolicy: { Enabled: true, Days: 10, }, }, MinuteMetrics: { Version: '1.0', Enabled: true, IncludeAPIs: true, RetentionPolicy: { Enabled: true, Days: 10, }, }, Cors: { CorsRule: [ { AllowedOrigins: ['www.azure.com', 'www.microsoft.com'], AllowedMethods: ['GET', 'PUT'], AllowedHeaders: ['x-ms-meta-data*', 'x-ms-meta-target*', 'x-ms-meta-xyz', 'x-ms-meta-foo'], ExposedHeaders: ['x-ms-meta-data*', 'x-ms-meta-source*', 'x-ms-meta-abc', 'x-ms-meta-bcd'], MaxAgeInSeconds: 500, }, { AllowedOrigins: ['www.msdn.com', 'www.asp.com'], AllowedMethods: ['GET', 'PUT'], AllowedHeaders: ['x-ms-meta-data*', 'x-ms-meta-target*', 'x-ms-meta-xyz', 'x-ms-meta-foo'], ExposedHeaders: ['x-ms-meta-data*', 'x-ms-meta-source*', 'x-ms-meta-abc', 'x-ms-meta-bcd'], MaxAgeInSeconds: 500, }, ], }, }; }When modifying the service properties, you can fetch the properties and then modify the them to prevent overwriting the existing settings. var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.getServiceProperties(function(error, result, response) { if (!error) { var serviceProperties = result; // modify the properties blobService.setServiceProperties(serviceProperties, function(error, result, response) { if (!error) { // properties are set } }); } });Code SamplesHow-Tos focused around accomplishing specific tasks are available on the Microsoft Azure Node.js Developer Center. How to use the Blob Service from Node.js How to use the Table Service from Node.js How to use the Queue Service from Node.js Running TestsUnit tests can then be run from the module's root directory using: npm testRunning test is also supported by Grunt by: grunt # mochaTest as the default taskBy default the unit tests are ran with Nock recording data. To run tests against real storage account, please set environment variable to turn off Nock by: set NOCK_OFF=trueand set up the following environment variable for storage account credentials by set AZURE_STORAGE_CONNECTION_STRING=&quot;valid storage connection string&quot;To record the data in a test pass against real storage account for future Nock usage: set AZURE_NOCK_RECORD=trueIn order to be able to use a proxy like fiddler, an additional environment variable should be set up: set NODE_TLS_REJECT_UNAUTHORIZED=0 set HTTP_PROXY=http://127.0.0.1:8888On Linux, please use export other than set to set the variables. Azure Storage JavaScript Client Library for Browsers JavaScript Client Library is currently in Preview. Questions and feedback are welcome in our Slack channel. Azure Storage Node.js Client Library is compatible with Browserify. This means you can bundle your Node.js application which depends on the Node.js Client Library using Browserify. You can also choose to download the JavaScript Client Library provided by us, or generate the library by yourself. Please refer to the README.md under browser folder for detailed usage guidelines. Downloading Azure Storage JavaScript Client LibraryIt's recommended to use the Azure Storage JavaScript Client Library provided by us. Please download the latest library. Generating Azure Storage JavaScript Client LibraryWe also provide browserify bundle scripts which generate Azure Storage JavaScript Client Library. The bundle script reduces the size of the Storage Client Library by splitting into smaller files, one per storage service and a common shared file. For more detailed information, refer to README.md under browser folder. JsDocJsDoc can be generated by grunt jsdoc. To load the docs by devserver after generation, run grunt doc and then browse the docs at http://localhost:8888. Need Help?Be sure to check out the Microsoft Azure Developer Forums on MSDN if you have trouble with the provided code or use StackOverflow. Learn More Microsoft Azure Node.js Developer Center Azure Storage Team Blog ContributeWe gladly accept community contributions. Issues: Please report bugs using the Issues section of GitHub Forums: Interact with the development teams on StackOverflow or the Microsoft Azure Forums Source Code Contributions: If you would like to become an active contributor to this project please follow the instructions provided in Contributing.md. This project has adopted the Microsoft Open Source Code of Conduct. For more information see the Code of Conduct FAQ or contact opencode@microsoft.com with any additional questions or comments. For general suggestions about Microsoft Azure please use our UserVoice forum. × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"BinaryBase64QueueMessageEncoder.html":{"id":"BinaryBase64QueueMessageEncoder.html","title":"Class: BinaryBase64QueueMessageEncoder","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: BinaryBase64QueueMessageEncoder BinaryBase64QueueMessageEncoder Encode from binary buffer to base64 stringDecode from base64 string to binary buffer. new BinaryBase64QueueMessageEncoder() Create a new BinaryBase64QueueMessageEncoder object Source: services/queue/queuemessageencoder.js, line 103 Extends QueueMessageEncoder Methods decode( [textToBeDecoded]) Decode from base64 string to binary buffer. This: BinaryBase64QueueMessageEncoder Parameters: Name Type Argument Description textToBeDecoded string &lt;optional&gt; The base64 string to be decoded. Overrides: QueueMessageEncoder#decode Source: services/queue/queuemessageencoder.js, line 128 Returns: Type Buffer encode( [input]) Encode from binary buffer string to base64 string This: BinaryBase64QueueMessageEncoder Parameters: Name Type Argument Description input Buffer &lt;optional&gt; The target to be encoded. Overrides: QueueMessageEncoder#encode Source: services/queue/queuemessageencoder.js, line 115 Returns: Type string × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"BlobResult.html":{"id":"BlobResult.html","title":"Class: BlobResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: BlobResult BlobResult The BlobResult class is used to store the blob information. new BlobResult( [container] [, name]) Creates a new BlobResult object. Parameters: Name Type Argument Description container string &lt;optional&gt; The container name. name string &lt;optional&gt; The blob name. Properties: Name Type Description container string The container name. name string The blob name. metadata object The metadata key/value pair. etag string The etag. lastModified string The date/time that the blob was last modified. contentLength string The size of the blob in bytes. blobType string The blob type. isIncrementalCopy boolean If the blob is incremental copy blob. requestId string The request id. sequenceNumber string The current sequence number for a page blob. contentRange string The content range. committedBlockCount string The committed block count. serverEncrypted string If the blob data and application metadata are completely encrypted using the specified algorithm. true/false. contentSettings object The content settings. Properties Name Type Description contentType string The content type. contentEncoding string The content encoding. contentLanguage string The content language. cacheControl string The cache control. contentDisposition string The content disposition. contentMD5 string The content MD5 hash. lease object The lease information. Properties Name Type Description id string The lease id. status string The lease status. state string The lease state. duration string The lease duration. copy object The copy information. Properties Name Type Description id string The copy id. status string The copy status. completionTime string The copy completion time. statusDescription string The copy status description. destinationSnapshot string The snapshot time of the last successful incremental copy snapshot for this blob. progress string The copy progress. source string The copy source. Source: services/blob/models/blobresult.js, line 68 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"BlobService.html":{"id":"BlobService.html","title":"Class: BlobService","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: BlobService BlobService The BlobService class is used to perform operations on the Microsoft Azure Blob Service.The Blob Service provides storage for binary large objects, and providesfunctions for working with data stored in blobs as either streams or pages of data. For more information on the Blob Service, as well as task focused information on using it in a Node.js application, seeHow to Use the Blob Service from Node.js.The following defaults can be set on the blob service.singleBlobPutThresholdInBytes The default maximum size, in bytes, of a blob before it must be separated into blocks.defaultEnableReuseSocket The default boolean value to enable socket reuse when uploading local files or streams. If the Node.js version is lower than 0.10.x, socket reuse will always be turned off.defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the Blob service.defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the Blob service.defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the Blob service.defaultLocationMode The default location mode for requests made via the Blob service.parallelOperationThreadCount The number of parallel operations that may be performed when uploading a blob that is greater than the value specified by the singleBlobPutThresholdInBytes property in size.useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the Blob service; true to use the Nagle algorithm; otherwise, false. The default value is false. new BlobService( [storageAccountOrConnectionString] [, storageAccessKey] [, host] [, sasToken] [, endpointSuffix]) Creates a new BlobService object.If no connection string or storageaccount and storageaccesskey are provided,the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string &lt;optional&gt; The Shared Access Signature token. endpointSuffix string &lt;optional&gt; The endpoint suffix. Source: services/blob/blobservice.core.js, line 98 Extends StorageServiceClient Members logger :Logger The logger of the service. To change the log level of the services, set the logger.level. Type: Logger Inherited From: StorageServiceClient#logger Source: common/services/storageserviceclient.js, line 105 Methods _getUrl() Get the url of a given path Inherited From: StorageServiceClient#_getUrl Source: common/services/storageserviceclient.js, line 959 _initializeLocation() Initializes the location to which the operation is being sent to. Inherited From: StorageServiceClient#_initializeLocation Source: common/services/storageserviceclient.js, line 1255 _invalidLocationMode() Checks whether we have the relevant host information based on the locationMode. Inherited From: StorageServiceClient#_invalidLocationMode Source: common/services/storageserviceclient.js, line 1310 _maximumExecutionTimeExceeded() Checks to see if the maximum execution timeout provided has been exceeded. Inherited From: StorageServiceClient#_maximumExecutionTimeExceeded Source: common/services/storageserviceclient.js, line 1324 _setDefaultProxy() Sets the service host default proxy from the environment.Can be overridden by calling _setProxyUrl or _setProxy Inherited From: StorageServiceClient#_setDefaultProxy Source: common/services/storageserviceclient.js, line 1216 _setOperationExpiryTime() Sets the operation expiry time. Inherited From: StorageServiceClient#_setOperationExpiryTime Source: common/services/storageserviceclient.js, line 1335 _validateLocation() Validates the location to which the operation is being sent to. Inherited From: StorageServiceClient#_validateLocation Source: common/services/storageserviceclient.js, line 1278 abortCopyBlob(container, blob, copyId [, options], callback) Abort a blob copy operation. This: {BlobService} Parameters: Name Type Argument Description container string The destination container name. blob string The destination blob name. copyId string The copy operation identifier. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The target blob lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2123 acquireLease(container, blob [, options], callback) Acquires a new lease. If container and blob are specified, acquires a blob lease. Otherwise, if only container is specified and blob is null, acquires a container lease. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseDuration string &lt;optional&gt; The lease duration in seconds. A non-infinite lease can be between 15 and 60 seconds. Default is never to expire. proposedLeaseId string &lt;optional&gt; The proposed lease identifier. Must be a GUID. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the lease information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1104 appendBlockFromStream(container, blob, readStream, streamLength [, options], callback) Creates a new block from a read stream to be appended to an append blob.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. readStream Stream The read stream. streamLength int The stream length. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. maxBlobSize int &lt;optional&gt; The max length in bytes allowed for the append blob to grow to. appendPosition int &lt;optional&gt; The number indicating the byte offset to check for. The append will succeed only if the end position of the blob is equal to this number. leaseId string &lt;optional&gt; The target blob lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3782 appendBlockFromText(container, blob, content [, options], callback) Creates a new block from a text to be appended to an append blob.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. content string | object The block text, as a string or in a Buffer. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. maxBlobSize int &lt;optional&gt; The max length in bytes allowed for the append blob to grow to. appendPosition int &lt;optional&gt; The number indicating the byte offset to check for. The append will succeed only if the end position of the blob is equal to this number. leaseId string &lt;optional&gt; The target blob lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3834 appendFromBrowserFile(container, blob, browserFile [, options], callback) Appends to an append blob from an HTML File object. Assumes the blob already exists on the service.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you.(Only available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. browserFile File The File object to be uploaded created by HTML File API. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.browser.js, line 204 Returns: Type SpeedSummary appendFromLocalFile(container, blob, localFileName [, options], callback) Appends to an append blob from a local file. Assumes the blob already exists on the service.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you.(Not available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. localFileName string The local path to the file to be uploaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.node.js, line 265 Returns: Type SpeedSummary appendFromStream(container, blob, (Stream), streamLength [, options], callback) Appends to an append blob from a stream. Assumes the blob already exists on the service.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. (Stream) stream Stream to the data to store. streamLength int The length of the stream to upload. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3691 Returns: Type SpeedSummary appendFromText(container, blob, text [, options], callback) Appends to an append blob from a text string. Assumes the blob already exists on the service.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. text string | object The blob text, as a string or in a Buffer. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3745 breakLease(container, blob [, options], callback) Breaks the lease but ensures that another client cannot acquire a new lease until the current lease period has expired. If container and blob are specified, breaks the blob lease.Otherwise, if only container is specified and blob is null, breaks the container lease. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseBreakPeriod int &lt;optional&gt; The lease break period, between 0 and 60 seconds. If unspecified, a fixed-duration lease breaks after the remaining lease period elapses, and an infinite lease breaks immediately. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the lease information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1267 changeLease(container, blob, leaseId, proposedLeaseId [, options], callback) Changes the lease ID of an active lease. If container and blob are specified, changes the blob lease. Otherwise, if only container is specified and blob is null, changes thecontainer lease. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. leaseId string The current lease identifier. proposedLeaseId string The proposed lease identifier. Must be a GUID. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the lease information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1186 clearPageRange(container, blob, rangeStart, rangeEnd [, options], callback) Clears a range of pages. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. rangeStart int The range start. rangeEnd int The range end. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The target blob lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2783 commitBlocks(container, blob, blockList [, options], callback) Writes a blob by specifying the list of block IDs that make up the blob.In order to be written as part of a blob, a block must have been successfully written to the server in a priorcreateBlock operation. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. blockList object The block identifiers. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. leaseId string &lt;optional&gt; The target blob lease identifier. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3287 createAppendBlobFromBrowserFile(container, blob, browserFile [, options], callback) Creates a new append blob from an HTML File object. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you.If you want to append data to an already existing blob, please look at appendFromBrowserFile.(Only available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. browserFile File The File object to be uploaded created by HTML File API. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 ahash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.browser.js, line 162 Returns: Type SpeedSummary createAppendBlobFromLocalFile(container, blob, localFileName [, options], callback) Creates a new append blob from a local file. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you.If you want to append data to an already existing blob, please look at appendFromLocalFile.(Not available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. localFileName string The local path to the file to be uploaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 ahash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.node.js, line 223 Returns: Type SpeedSummary createAppendBlobFromStream(container, blob, (Stream), streamLength [, options], callback) Uploads an append blob from a stream. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you.If you want to append data to an already existing blob, please look at appendFromStream. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. (Stream) stream Stream to the data to store. streamLength int The length of the stream to upload. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3513 Returns: Type SpeedSummary createAppendBlobFromText(container, blob, text [, options], callback) Uploads an append blob from a text string. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you.If you want to append data to an already existing blob, please look at appendFromText. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. text string | object The blob text, as a string or in a Buffer. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3557 createBlobSnapshot(container, blob [, options], callback) Creates a read-only snapshot of a blob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. metadata object &lt;optional&gt; The metadata key/value pairs. leaseId string &lt;optional&gt; The lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the ID of the snapshot. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1977 createBlockBlobFromBrowserFile(container, blob, browserFile [, options], callback) Creates a new block blob. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.(Only available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. browserFile File The File object to be uploaded created by HTML File API. options object &lt;optional&gt; The request options. Properties Name Type Argument Description blockSize int &lt;optional&gt; The size of each block. Maximum is 100MB. blockIdPrefix string &lt;optional&gt; The prefix to be used to generate the block id. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.browser.js, line 70 Returns: Type SpeedSummary createBlockBlobFromLocalFile(container, blob, localFileName [, options], callback) Creates a new block blob. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.(Not available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. localFileName string The local path to the file to be uploaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description blockSize int &lt;optional&gt; The size of each block. Maximum is 100MB. blockIdPrefix string &lt;optional&gt; The prefix to be used to generate the block id. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.node.js, line 177 Returns: Type SpeedSummary createBlockBlobFromStream(container, blob, (Stream), streamLength [, options], callback) Uploads a block blob from a stream. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. (Stream) stream Stream to the data to store. streamLength int The length of the stream to upload. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. blockSize int &lt;optional&gt; The size of each block. Maximum is 100MB. blockIdPrefix string &lt;optional&gt; The prefix to be used to generate the block id. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2986 Returns: Type SpeedSummary createBlockBlobFromText(container, blob, text [, options], callback) Uploads a block blob from a text string. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. text string | object The blob text, as a string or in a Buffer. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3027 createBlockFromStream(blockId, container, blob, readStream, streamLength [, options], callback) Creates a new block to be committed as part of a blob. This: {BlobService} Parameters: Name Type Argument Description blockId string The block identifier. container string The container name. blob string The blob name. readStream Stream The read stream. streamLength int The stream length. options object &lt;optional&gt; The request options. Properties Name Type Argument Description useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. leaseId string &lt;optional&gt; The target blob lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3108 createBlockFromText(blockId, container, blob, content [, options], callback) Creates a new block to be committed as part of a blob. This: {BlobService} Parameters: Name Type Argument Description blockId string The block identifier. container string The container name. blob string The blob name. content string | buffer The block content. options object &lt;optional&gt; The request options. Properties Name Type Argument Description useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. leaseId string &lt;optional&gt; The target blob lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the block content. This hash is used to verify the integrity of the block during transport. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3157 createContainer(container [, options], callback) Creates a new container under the specified account.If a container with the same name already exists, the operation fails. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. metadata object &lt;optional&gt; The metadata key/value pairs. publicAccessLevel string &lt;optional&gt; Specifies whether data in the container may be accessed publicly and the level of access. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the container information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 424 createContainerIfNotExists(container [, options], callback) Creates a new container under the specified account if the container does not exists. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. metadata object &lt;optional&gt; The metadata key/value pairs. publicAccessLevel string &lt;optional&gt; Specifies whether data in the container may be accessed publicly and the level of access. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the container information including created boolean member. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 496 Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.createContainerIfNotExists('taskcontainer', {publicAccessLevel : 'blob'}, function(error) { if(!error) { // Container created or exists, and is public } }); createOrReplaceAppendBlob(container, blob [, options], callback) Creates an empty append blob. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. leaseId string &lt;optional&gt; The target blob lease identifier. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3437 createPageBlob(container, blob, length [, options], callback) Creates a page blob of the specified length. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. length int The length of the page blob in bytes. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. leaseId string &lt;optional&gt; The target blob lease identifier. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The MD5 hash of the blob content. sequenceNumber string &lt;optional&gt; The blob's sequence number. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2310 createPageBlobFromBrowserFile(container, blob, browserFile [, options], callback) Uploads a page blob from an HTML file. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.(Only available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. browserFile File The File object to be uploaded created by HTML File API. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The upload tracker objects. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.browser.js, line 116 Returns: Type SpeedSummary createPageBlobFromLocalFile(container, blob, (string) [, options], callback) Uploads a page blob from file. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.(Not available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. (string) localFileName The local path to the file to be uploaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The upload tracker objects. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.node.js, line 132 Returns: Type SpeedSummary createPageBlobFromStream(container, blob, (Stream), streamLength [, options], callback) Uploads a page blob from a stream. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. (Stream) stream Stream to the data to store. streamLength int The length of the stream to upload. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects; parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; An MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2391 Returns: Type SpeedSummary createPagesFromStream(container, blob, readStream, rangeStart, rangeEnd [, options], callback) Updates a page blob from a stream. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. readStream Stream The read stream. rangeStart int The range start. rangeEnd int The range end. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The target blob lease identifier. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. transactionalContentMD5 string &lt;optional&gt; An optional hash value used to ensure transactional integrity for the page. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the page information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2524 createReadStream(container, blob [, options], callback) Provides a stream to read from a blob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. rangeStart string &lt;optional&gt; Return only the bytes of the blob in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the blob in the specified range. accessConditions AccessConditions &lt;optional&gt; The access conditions. useTransactionalMD5 boolean &lt;optional&gt; When set to true, Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading blobs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1581 Returns: Type Stream Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); var writable = fs.createWriteStream(destinationFileNameTarget); blobService.createReadStream(containerName, blobName).pipe(writable); createWriteStreamToBlockBlob(container, blob [, options], callback) Provides a stream to write to a block blob. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description blockSize int &lt;optional&gt; The size of each block. Maximum is 100MB. blockIdPrefix string &lt;optional&gt; The prefix to be used to generate the block id. leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs and true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3076 Returns: Type Stream Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToBlockBlob(containerName, blobName, { blockIdPrefix: 'block' })); createWriteStreamToExistingAppendBlob(container, blob [, options], callback) Provides a stream to write to an existing append blob. Assumes that the blob exists.If it does not, please create the blob using createAppendBlob before calling this method or use createWriteStreamToNewAppendBlob.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs and true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse The callback function. Source: services/blob/blobservice.core.js, line 3647 Returns: Type Stream Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToAppendBlob(containerName, blobName)); createWriteStreamToExistingPageBlob(container, blob [, options], callback) Provides a stream to write to a page blob. Assumes that the blob exists.If it does not, please create the blob using createPageBlob before calling this method or use createWriteStreamNewPageBlob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs and true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2441 Returns: Type Stream Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.createPageBlob(containerName, blobName, 1024, function (err) { // Pipe file to a blob var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToExistingPageBlob(containerName, blobName)); }); createWriteStreamToNewAppendBlob(container, blob [, options], callback) Provides a stream to write to a new append blob. If the blob already exists on the service, it will be overwritten.To avoid overwriting and instead throw an error if the blob exists, please pass in an accessConditions parameter in the options object.This API should be used strictly in a single writer scenario because the API internally uses the append-offset conditional header to avoid duplicate blocks.If you are guaranteed to have a single writer scenario, please look at options.absorbConditionalErrorsOnRetry and see if setting this flag to true is acceptable for you. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description absorbConditionalErrorsOnRetry bool &lt;optional&gt; Specifies whether to absorb the conditional error on retry. leaseId string &lt;optional&gt; The lease identifier. metadata object &lt;optional&gt; The metadata key/value pairs. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs and true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse The callback function. Source: services/blob/blobservice.core.js, line 3602 Returns: Type Stream Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToAppendBlob(containerName, blobName)); createWriteStreamToNewPageBlob(container, blob, length [, options], callback) Provides a stream to write to a page blob. Creates the blob before writing data. If the blob already exists on the service, it will be overwritten. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. length string The blob length. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The lease identifier. transactionalContentMD5 string &lt;optional&gt; The MD5 hash of the blob content. This hash is used to verify the integrity of the blob during transport. metadata object &lt;optional&gt; The metadata key/value pairs. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. storeBlobContentMD5 bool &lt;optional&gt; Specifies whether the blob's ContentMD5 header should be set on uploads. The default value is false for page blobs and true for block blobs. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The content settings of the blob. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The Blob service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2491 Returns: Type Stream Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.createPageBlob(containerName, blobName, 1024, function (err) { // Pipe file to a blob var stream = fs.createReadStream(fileNameTarget).pipe(blobService.createWriteStreamToNewPageBlob(containerName, blobName)); }); deleteBlob(container, blob [, options], callback) Marks the specified blob or snapshot for deletion. The blob is later deleted during garbage collection.If a blob has snapshots, you must delete them when deleting the blob. Using the deleteSnapshots option, you can choose either to delete both the blob and its snapshots,or to delete only the snapshots but not the blob itself. If the blob has snapshots, you must include the deleteSnapshots option or the blob service will return an errorand nothing will be deleted.If you are deleting a specific snapshot using the snapshotId option, the deleteSnapshots option must NOT be included. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description deleteSnapshots string &lt;optional&gt; The snapshot delete option. See azure.BlobUtilities.SnapshotDeleteOptions.*. snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1807 deleteBlobIfExists(container, blob [, options], callback) Marks the specified blob or snapshot for deletion if it exists. The blob is later deleted during garbage collection.If a blob has snapshots, you must delete them when deleting the blob. Using the deleteSnapshots option, you can choose either to delete both the blob and its snapshots,or to delete only the snapshots but not the blob itself. If the blob has snapshots, you must include the deleteSnapshots option or the blob service will return an errorand nothing will be deleted.If you are deleting a specific snapshot using the snapshotId option, the deleteSnapshots option must NOT be included. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description deleteSnapshots string &lt;optional&gt; The snapshot delete option. See azure.BlobUtilities.SnapshotDeleteOptions.*. snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will be true if the blob was deleted, or false if the blob does not exist. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1914 deleteContainer(container [, options], callback) Marks the specified container for deletion.The container and any blobs contained within it are later deleted during garbage collection. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. leaseId string &lt;optional&gt; The container lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 868 deleteContainerIfExists(container [, options], callback) Marks the specified container for deletion if it exists.The container and any blobs contained within it are later deleted during garbage collection. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. leaseId string &lt;optional&gt; The container lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will be true if the container exists and was deleted, or false if the container did not exist. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 919 doesBlobExist(container, blob [, options], callback) Checks whether or not a blob exists on the service. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback function error will contain information if an error occurs; otherwise result will contain the blob information including the exists boolean member. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1867 doesContainerExist(container [, options], callback) Checks whether or not a container exists on the service. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the container information including exists boolean member. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 385 generateBlockIdPrefix() Generate a random block id prefix Source: services/blob/blobservice.core.js, line 3391 generateSharedAccessSignature(container [, blob], sharedAccessPolicy [, headers]) Retrieves a shared access signature token. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string &lt;optional&gt; The blob name. sharedAccessPolicy object The shared access policy. Properties Name Type Argument Description Id string &lt;optional&gt; The signed identifier. AccessPolicy.Permissions object &lt;optional&gt; The permission type. AccessPolicy.Start date | string &lt;optional&gt; The time at which the Shared Access Signature becomes valid (The UTC value will be used). AccessPolicy.Expiry date | string &lt;optional&gt; The time at which the Shared Access Signature becomes expired (The UTC value will be used). AccessPolicy.IPAddressOrRange string &lt;optional&gt; An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. AccessPolicy.Protocols string &lt;optional&gt; The protocols permitted for a request made with the account SAS. Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. headers object &lt;optional&gt; The optional header values to set for a blob returned wth this SAS. Properties Name Type Argument Description cacheControl string &lt;optional&gt; The optional value of the Cache-Control response header to be returned when this SAS is used. contentType string &lt;optional&gt; The optional value of the Content-Type response header to be returned when this SAS is used. contentEncoding string &lt;optional&gt; The optional value of the Content-Encoding response header to be returned when this SAS is used. contentLanguage string &lt;optional&gt; The optional value of the Content-Language response header to be returned when this SAS is used. contentDisposition string &lt;optional&gt; The optional value of the Content-Disposition response header to be returned when this SAS is used. Source: services/blob/blobservice.core.js, line 2177 Returns: The shared access signature query string. Note this string does not contain the leading &quot;?&quot;. Type string getBlobMetadata(container, blob [, options], callback) Returns all user-defined metadata for the specified blob or snapshot.It does not modify or return the content of the blob.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the blob. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1380 getBlobProperties(container, blob [, options], callback) Returns all user-defined metadata, standard HTTP properties, and system properties for the blob.It does not return or modify the content of the blob.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the blob. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1311 getBlobToLocalFile(container, blob, localFileName [, options], callback) Downloads a blob into a file.(Not available in the JavaScript Client Library for Browsers) This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. localFileName string The local path to the file to be downloaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description skipSizeCheck boolean &lt;optional&gt; Skip the size check to perform direct download. Set the option to true for small blobs. Parallel download and speed summary won't work with this option on. speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. rangeStart string &lt;optional&gt; Return only the bytes of the blob in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the blob in the specified range. accessConditions AccessConditions &lt;optional&gt; The access conditions. useTransactionalMD5 boolean &lt;optional&gt; When set to true, Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading blobs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.node.js, line 75 Returns: Type SpeedSummary Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.getBlobToLocalFile('taskcontainer', 'task1', 'task1-download.txt', function(error, serverBlob) { if(!error) { // Blob available in serverBlob.blob variable } getBlobToStream(container, blob, writeStream [, options], callback) Downloads a blob into a stream. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. writeStream Stream The write stream. options object &lt;optional&gt; The request options. Properties Name Type Argument Description skipSizeCheck boolean &lt;optional&gt; Skip the size check to perform direct download. Set the option to true for small blobs. Parallel download and speed summary won't work with this option on. speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. rangeStart string &lt;optional&gt; Return only the bytes of the blob in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the blob in the specified range. useTransactionalMD5 boolean &lt;optional&gt; When set to true, Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading blobs. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1649 Returns: Type SpeedSummary Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); blobService.getBlobToStream('taskcontainer', 'task1', fs.createWriteStream('task1-download.txt'), function(error, serverBlob) { if(!error) { // Blob available in serverBlob.blob variable } }); getBlobToText(container, blob [, options], callback) Downloads a blob into a text string. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. rangeStart string &lt;optional&gt; Return only the bytes of the blob in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the blob in the specified range. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading blobs. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback BlobService~blobToText error will contain information if an error occurs; otherwise text will contain the blob contents, and blockBlob will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1732 getBlockId() Get a block id according to prefix and block number Source: services/blob/blobservice.core.js, line 3399 getContainerAcl(container [, options], callback) Gets the container's ACL. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The container lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the container. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 738 getContainerMetadata(container [, options], callback) Returns all user-defined metadata for the container.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The container lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the container. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 617 getContainerProperties(container [, options], callback) Retrieves a container and its properties from a specified account.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {BlobService} Parameters: Name Type Argument Description container string The container name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. leaseId string &lt;optional&gt; The container lease identifier. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the container. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 558 getPageRangesDiff(container, blob, previousSnapshotTime [, options], callback) Gets page ranges that have been updated or cleared since the snapshot specified by previousSnapshotTime was taken. Gets all of the page ranges by default, or only the page ranges over a specific range of bytes if rangeStart and rangeEnd are specified. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. previousSnapshotTime string The previous snapshot time for comparison. Must be prior to options.snapshotId if it's provided. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. rangeStart int &lt;optional&gt; The range start. rangeEnd int &lt;optional&gt; The range end. snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The target blob lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the page ranges diff information, see RangeDiff for detailed information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2671 getServiceProperties( [options], callback) Gets the properties of a storage account’s Blob service, including Azure Storage Analytics. This: {BlobService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise, result will contain the properties and response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 213 getServiceStats( [options], callback) Gets the service stats for a storage account’s Blob service. This: {BlobService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise, result will contain the stats and response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 163 getUrl(container [, blob] [, sasToken] [, primary] [, snapshotId]) Retrieves a blob or container URL. Parameters: Name Type Argument Description container string The container name. blob string &lt;optional&gt; The blob name. sasToken string &lt;optional&gt; The Shared Access Signature token. primary boolean &lt;optional&gt; A boolean representing whether to use the primary or the secondary endpoint. snapshotId boolean &lt;optional&gt; The snapshot identifier. Source: services/blob/blobservice.core.js, line 2247 Returns: The formatted URL string. Type string Example var azure = require('azure-storage'); var blobService = azure.createBlobService(); var sharedAccessPolicy = { AccessPolicy: { Permissions: azure.BlobUtilities.SharedAccessPermissions.READ, Start: startDate, Expiry: expiryDate }, }; var sasToken = blobService.generateSharedAccessSignature(containerName, blobName, sharedAccessPolicy); var sasUrl = blobService.getUrl(containerName, blobName, sasToken); listBlobDirectoriesSegmented(container, currentToken [, options], callback) Lists a segment containing a collection of blob directory items in the container. This: {BlobService} Parameters: Name Type Argument Description container string The container name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of directories to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of directories and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 978 listBlobDirectoriesSegmentedWithPrefix(container, prefix, currentToken [, options], callback) Lists a segment containing a collection of blob directory items in the container. This: {BlobService} Parameters: Name Type Argument Description container string The container name. prefix string The prefix of the blob directory. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of directories to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of directories and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1006 listBlobsSegmented(container, currentToken [, options], callback) Lists a segment containing a collection of blob items in the container. This: {BlobService} Parameters: Name Type Argument Description container string The container name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description delimiter string &lt;optional&gt; Delimiter, i.e. '/', for specifying folder hierarchy. maxResults int &lt;optional&gt; Specifies the maximum number of blobs to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) include string &lt;optional&gt; Specifies that the response should include one or more of the following subsets: '', 'metadata', 'snapshots', 'uncommittedblobs', 'copy'). Please find these values in BlobUtilities.BlobListingDetails. Multiple values can be added separated with a comma (,). Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of blobs and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1041 listBlobsSegmentedWithPrefix(container, prefix, currentToken [, options], callback) Lists a segment containing a collection of blob items whose names begin with the specified prefix in the container. This: {BlobService} Parameters: Name Type Argument Description container string The container name. prefix string The prefix of the blob name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description delimiter string &lt;optional&gt; Delimiter, i.e. '/', for specifying folder hierarchy. maxResults int &lt;optional&gt; Specifies the maximum number of blobs to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) include string &lt;optional&gt; Specifies that the response should include one or more of the following subsets: '', 'metadata', 'snapshots', 'uncommittedblobs', 'copy'). Please find these values in BlobUtilities.BlobListingDetails. Multiple values can be added separated with a comma (,). Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the entries of blobs and the continuation token for the next listing operation. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1073 listBlocks(container, blob, blocklisttype [, options], callback) Retrieves the list of blocks that have been uploaded as part of a block blob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. blocklisttype BlockListFilter The type of block list to retrieve. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The source blob snapshot identifier. leaseId string &lt;optional&gt; The target blob lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blocklist information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 3352 listContainersSegmented(currentToken [, options], callback) Lists a segment containing a collection of container items under the specified account. This: {BlobService} Parameters: Name Type Argument Description currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. maxResults int &lt;optional&gt; Specifies the maximum number of containers to return per call to Azure storage. include string &lt;optional&gt; Include this parameter to specify that the container's metadata be returned as part of the response body. (allowed values: '', 'metadata') Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of containers and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 266 listContainersSegmentedWithPrefix(prefix, currentToken [, options], callback) Lists a segment containing a collection of container items whose names begin with the specified prefix under the specified account. This: {BlobService} Parameters: Name Type Argument Description prefix string The prefix of the container name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. maxResults int &lt;optional&gt; Specifies the maximum number of containers to return per call to Azure storage. include string &lt;optional&gt; Include this parameter to specify that the container's metadata be returned as part of the response body. (allowed values: '', 'metadata') Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of containers and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 295 listPageRanges(container, blob [, options], callback) Lists page ranges. Lists all of the page ranges by default, or only the page ranges over a specific range of bytes if rangeStart and rangeEnd are specified. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. rangeStart int &lt;optional&gt; The range start. rangeEnd int &lt;optional&gt; The range end. snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The target blob lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the page ranges information, see Range for detailed information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2579 releaseLease(container, blob, leaseId [, options], callback) Releases the lease. If container and blob are specified, releases the blob lease. Otherwise, if only container is specified and blob is null, releases the container lease. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. leaseId string The lease identifier. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the lease information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1226 renewLease(container, blob, leaseId [, options], callback) Renews an existing lease. If container and blob are specified, renews the blob lease. Otherwise, if only container is specified and blob is null, renews the container lease. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. leaseId string The lease identifier. Must be a GUID. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the lease information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1146 resizePageBlob(container, blob, size [, options], callback) Resizes a page blob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. size String The size of the page blob, in bytes. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The blob lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the page information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2834 setAccountServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {StorageServiceClient} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Inherited From: StorageServiceClient#setAccountServiceProperties Source: common/services/storageserviceclient.js, line 1095 setBlobMetadata(container, blob, metadata [, options], callback) Sets user-defined metadata for the specified blob or snapshot as one or more name-value pairsIt does not modify or return the content of the blob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. metadata object The metadata key/value pairs. options object &lt;optional&gt; The request options. Properties Name Type Argument Description snapshotId string &lt;optional&gt; The snapshot identifier. leaseId string &lt;optional&gt; The lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information on the blob. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1507 setBlobProperties(container, blob [, properties] [, options], callback) Sets user-defined properties for the specified blob or snapshot.It does not modify or return the content of the blob. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. properties object &lt;optional&gt; The blob properties to set. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the blob. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the blob. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The blob's cache control. contentDisposition string &lt;optional&gt; The blob's content disposition. contentMD5 string &lt;optional&gt; The blob's MD5 hash. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. accessConditions AccessConditions &lt;optional&gt; The access conditions. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the blob. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 1453 setContainerAcl(container, signedIdentifiers [, options], callback) Updates the container's ACL. This: {BlobService} Parameters: Name Type Argument Description container string The container name. signedIdentifiers Object.&lt;string, AccessPolicy&gt; The container ACL settings. See AccessPolicy for detailed information. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. publicAccessLevel string &lt;optional&gt; Specifies whether data in the container may be accessed publicly and the level of access. leaseId string &lt;optional&gt; The container lease identifier. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the container. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 797 setContainerMetadata(container, metadata [, options], callback) Sets the container's metadata. Calling the Set Container Metadata operation overwrites all existing metadata that is associated with the container.It's not possible to modify an individual name/value pair. This: {BlobService} Parameters: Name Type Argument Description container string The container name. metadata object The metadata key/value pairs. options object &lt;optional&gt; The request options. Properties Name Type Argument Description leaseId string &lt;optional&gt; The container lease identifier. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. accessConditions AccessConditions &lt;optional&gt; The access conditions. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 680 setPageBlobSequenceNumber(container, blob, sequenceNumberAction, sequenceNumber [, options], callback) Sets the page blob's sequence number. This: {BlobService} Parameters: Name Type Argument Description container string The container name. blob string The blob name. sequenceNumberAction SequenceNumberAction A value indicating the operation to perform on the sequence number. The allowed values are defined in azure.BlobUtilities.SequenceNumberAction. sequenceNumber string The sequence number. The value of the sequence number must be between 0 and 2^63 - 1. Set this parameter to null if this operation is an increment action. options object &lt;optional&gt; The request options. Properties Name Type Argument Description accessConditions AccessConditions &lt;optional&gt; The access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the page information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2893 setProxy(proxy) /*Sets proxy object specified by caller. Parameters: Name Type Description proxy object proxy to use for tunneling { host: hostname port: port number proxyAuth: 'user:password' for basic auth headers: {...} headers for proxy server key: key for proxy server ca: ca for proxy server cert: cert for proxy server } if null or undefined, clears proxy Inherited From: StorageServiceClient#setProxy Source: common/services/storageserviceclient.js, line 1203 setServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account's Blob service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {BlobService} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 238 startCopyBlob(sourceUri, targetContainer, targetBlob [, options], callback) Starts to copy a blob to a destination within the storage account. The Copy Blob operation copies the entire committed blob. This: {BlobService} Parameters: Name Type Argument Description sourceUri string The source blob URI. targetContainer string The target container name. targetBlob string The target blob name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description isIncrementalCopy boolean &lt;optional&gt; If it's incremental copy or not. Refer to https://docs.microsoft.com/en-us/rest/api/storageservices/fileservices/incremental-copy-blob snapshotId string &lt;optional&gt; The source blob snapshot identifier. metadata object &lt;optional&gt; The target blob metadata key/value pairs. leaseId string &lt;optional&gt; The target blob lease identifier. sourceLeaseId string &lt;optional&gt; The source blob lease identifier. accessConditions AccessConditions &lt;optional&gt; The access conditions. sourceAccessConditions AccessConditions &lt;optional&gt; The source access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the blob information. response will contain information related to this operation. Source: services/blob/blobservice.core.js, line 2041 withFilter(filter) Associate a filtering operation with this StorageServiceClient. Filtering operationscan include logging, automatically retrying, etc. Filter operations are objectsthat implement a method with the signature: &quot;function handle (requestOptions, next)&quot;.After doing its preprocessing on the request options, the method needs to call&quot;next&quot; passing a callback with the following signature:signature: &quot;function (returnObject, finalCallback, next)&quot;In this callback, and after processing the returnObject (the response from therequest to the server), the callback needs to either invoke next if it exists tocontinue processing other filters or simply invoke finalCallback otherwise to endup the service invocation. Parameters: Name Type Description filter Object The new filter object. Inherited From: StorageServiceClient#withFilter Source: common/services/storageserviceclient.js, line 767 Returns: A new service client with the filter applied. Type StorageServiceClient Type Definitions blobToText(error, text, blockBlob, response) The callback for {BlobService~getBlobToText}. Parameters: Name Type Description error object If an error occurs, the error information. text string The text returned from the blob. blockBlob object Information about the blob. response object Information related to this operation. Source: services/blob/blobservice.core.js, line 5574 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"BlobUtilities.html":{"id":"BlobUtilities.html","title":"Namespace: BlobUtilities","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Namespace: BlobUtilities BlobUtilities Defines constants, enums, and utility functions for use with the Blob service. Source: services/blob/blobutilities.js, line 20 Members &lt;static&gt; BlobContainerPublicAccessType :string Blobs and container public access types. Type: string Properties: Name Type Default Description OFF string null CONTAINER string container BLOB string blob Source: services/blob/blobutilities.js, line 82 &lt;static&gt; BlobListingDetails :string Blob listing details. Type: string Properties: Name Type Default Description SNAPSHOTS string snapshots METADATA string metadata UNCOMMITTED_BLOBS string uncommittedblobs COPY string copy Source: services/blob/blobutilities.js, line 46 &lt;static&gt; BlockListFilter :string Type of block list to retrieve Type: string Properties: Name Type Default Description ALL string all COMMITTED string committed UNCOMMITTED string uncommitted Source: services/blob/blobutilities.js, line 70 &lt;static&gt; SequenceNumberAction Describes actions that can be performed on a page blob sequence number. Properties: Name Type Default Description MAX max UPDATE update INCREMENT increment Source: services/blob/blobutilities.js, line 93 &lt;static&gt; SharedAccessPermissions :string Permission types Type: string Properties: Name Type Default Description READ string r ADD string a CREATE string c WRITE string w DELETE string d LIST string l Source: services/blob/blobutilities.js, line 31 &lt;static&gt; SnapshotDeleteOptions :string Deletion options for blob snapshots Type: string Properties: Name Type Default Description SNAPSHOTS_ONLY string only BLOB_AND_SNAPSHOTS string include Source: services/blob/blobutilities.js, line 59 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"ContainerResult.html":{"id":"ContainerResult.html","title":"Class: ContainerResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: ContainerResult ContainerResult The ContainerResult class is used to store the container information. new ContainerResult( [container] [, publicAccessLevel]) Creates a new ContainerResult object. Parameters: Name Type Argument Description container string &lt;optional&gt; The container name. publicAccessLevel string &lt;optional&gt; The public access level. Properties: Name Type Description name string The container name. publicAccessLevel string The public access level. metadata object The metadata key/value pair. etag string The etag. lastModified string The date/time that the container was last modified. requestId string The request id. lease object The lease information. Properties Name Type Description status string The lease status. state string The lease state. duration string The lease duration. Source: services/blob/models/containerresult.js, line 45 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"DirectoryResult.html":{"id":"DirectoryResult.html","title":"Class: DirectoryResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: DirectoryResult DirectoryResult The DirectoryResult class is used to store the directory information. new DirectoryResult( [name]) Creates a new DirectoryResult object. Parameters: Name Type Argument Description name string &lt;optional&gt; The directory name. Properties: Name Type Description name string The container name. metadata object The metadata key/value pair. etag string The etag. lastModified string The date/time that the directory was last modified. requestId string The request id. Source: services/file/models/directoryresult.js, line 34 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"ExponentialRetryPolicyFilter.html":{"id":"ExponentialRetryPolicyFilter.html","title":"Class: ExponentialRetryPolicyFilter","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: ExponentialRetryPolicyFilter ExponentialRetryPolicyFilter The ExponentialRetryPolicyFilter allows you to retry operations,using an exponential back-off interval between retries.To apply a filter to service operations, use withFilterand specify the filter to be used when creating a service. new ExponentialRetryPolicyFilter( [retryCount] [, retryInterval] [, minRetryInterval] [, maxRetryInterval]) Creates a new 'ExponentialRetryPolicyFilter' instance. Parameters: Name Type Argument Default Description retryCount number &lt;optional&gt; 3 The client retry count. retryInterval number &lt;optional&gt; 30000 The client retry interval, in milliseconds. minRetryInterval number &lt;optional&gt; 3000 The minimum retry interval, in milliseconds. maxRetryInterval number &lt;optional&gt; 90000 The maximum retry interval, in milliseconds. Source: common/filters/exponentialretrypolicyfilter.js, line 38 Example var azure = require('azure-storage'); var retryOperations = new azure.ExponentialRetryPolicyFilter(); var blobService = azure.createBlobService().withFilter(retryOperations) Members &lt;static&gt; DEFAULT_CLIENT_MAX_RETRY_INTERVAL Represents the default maximum retry interval, in milliseconds. Source: common/filters/exponentialretrypolicyfilter.js, line 58 &lt;static&gt; DEFAULT_CLIENT_MIN_RETRY_INTERVAL Represents the default minimum retry interval, in milliseconds. Source: common/filters/exponentialretrypolicyfilter.js, line 63 &lt;static&gt; DEFAULT_CLIENT_RETRY_COUNT Represents the default client retry count. Source: common/filters/exponentialretrypolicyfilter.js, line 53 &lt;static&gt; DEFAULT_CLIENT_RETRY_INTERVAL Represents the default client retry interval, in milliseconds. Source: common/filters/exponentialretrypolicyfilter.js, line 48 Methods handle(requestOptions, next) Handles an operation with an exponential retry policy. Parameters: Name Type Description requestOptions Object The original request options. next function The next filter to be handled. Source: common/filters/exponentialretrypolicyfilter.js, line 91 shouldRetry(statusCode, requestOptions) Determines if the operation should be retried and how long to wait until the next retry. Parameters: Name Type Description statusCode number The HTTP status code. requestOptions object The request options. Source: common/filters/exponentialretrypolicyfilter.js, line 72 Returns: Information about whether the operation qualifies for a retry and the retryInterval. Type retryInfo × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"FileResult.html":{"id":"FileResult.html","title":"Class: FileResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: FileResult FileResult The FileResult class is used to store the file information. new FileResult( [share] [, directory] [, name]) Creates a new FileResult object. Parameters: Name Type Argument Description share string &lt;optional&gt; The share name. directory string &lt;optional&gt; The directory name. name string &lt;optional&gt; The file name. Properties: Name Type Description share string The share name. directory string The directory name. name string The file name. metadata object The metadata key/value pair. etag string The etag. lastModified string The date/time that the file was last modified. requestId string The request id. acceptRanges string The accept ranges. contentRange string The content range contentLength string The size of the file in bytes. contentSettings object The content settings. Properties Name Type Description contentType string The content type. contentEncoding string The content encoding. contentLanguage string The content language. cacheControl string The cache control. contentDisposition string The content disposition. contentMD5 string The content MD5 hash. copy object The copy information. Properties Name Type Description id string The copy id. status string The copy status. completionTime string The copy completion time. statusDescription string The copy status description. progress string The copy progress. source string The copy source. Source: services/file/models/fileresult.js, line 60 Methods &lt;static&gt; setHeaders() This method sets the HTTP headers and is used by all methods except setFileProperties and createFile.Those methods will set the x-ms-* headers using setProperties. Source: services/file/models/fileresult.js, line 137 &lt;static&gt; setProperties() This method sets the x-ms-* headers and is used by setFileProperties and createFile.All other methods will set the regular HTTP headers using setHeaders. Source: services/file/models/fileresult.js, line 169 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"FileService.html":{"id":"FileService.html","title":"Class: FileService","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: FileService FileService The FileService class is used to perform operations on the Microsoft Azure File Service.The File Service provides storage for binary large objects, and provides functions for working with data stored in files. For more information on the File Service, as well as task focused information on using it in a Node.js application, seeHow to Use the File Service from Node.js.The following defaults can be set on the file service.defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the file service.defaultEnableReuseSocket The default boolean value to enable socket reuse when uploading local files or streams. If the Node.js version is lower than 0.10.x, socket reuse will always be turned off.defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the file service.defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the file service.defaultLocationMode The default location mode for requests made via the file service.parallelOperationThreadCount The number of parallel operations that may be performed when uploading a file.useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the file service; true to use the Nagle algorithm; otherwise, false. The default value is false. new FileService( [storageAccountOrConnectionString] [, storageAccessKey] [, host] [, sasToken] [, endpointSuffix]) Creates a new FileService object.If no connection string or storageaccount and storageaccesskey are provided,the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string &lt;optional&gt; The Shared Access Signature token. endpointSuffix string &lt;optional&gt; The endpoint suffix. Source: services/file/fileservice.core.js, line 89 Extends StorageServiceClient Members logger :Logger The logger of the service. To change the log level of the services, set the logger.level. Type: Logger Inherited From: StorageServiceClient#logger Source: common/services/storageserviceclient.js, line 105 Methods _getUrl() Get the url of a given path Inherited From: StorageServiceClient#_getUrl Source: common/services/storageserviceclient.js, line 959 _initializeLocation() Initializes the location to which the operation is being sent to. Inherited From: StorageServiceClient#_initializeLocation Source: common/services/storageserviceclient.js, line 1255 _invalidLocationMode() Checks whether we have the relevant host information based on the locationMode. Inherited From: StorageServiceClient#_invalidLocationMode Source: common/services/storageserviceclient.js, line 1310 _maximumExecutionTimeExceeded() Checks to see if the maximum execution timeout provided has been exceeded. Inherited From: StorageServiceClient#_maximumExecutionTimeExceeded Source: common/services/storageserviceclient.js, line 1324 _setDefaultProxy() Sets the service host default proxy from the environment.Can be overridden by calling _setProxyUrl or _setProxy Inherited From: StorageServiceClient#_setDefaultProxy Source: common/services/storageserviceclient.js, line 1216 _setOperationExpiryTime() Sets the operation expiry time. Inherited From: StorageServiceClient#_setOperationExpiryTime Source: common/services/storageserviceclient.js, line 1335 _validateLocation() Validates the location to which the operation is being sent to. Inherited From: StorageServiceClient#_validateLocation Source: common/services/storageserviceclient.js, line 1278 abortCopyFile(share, directory, file, copyId [, options], callback) Abort a file copy operation. This: {FileService} Parameters: Name Type Argument Description share string The destination share name. directory string The destination directory name. file string The destination file name. copyId string The copy operation identifier. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 3005 clearRange(share, directory, file, rangeStart, rangeEnd [, options], callback) Clears a range. Clears all of the ranges by default, or only the ranges over a specific range of bytes if rangeStart and rangeEnd are specified. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. rangeStart int The range start. rangeEnd int The range end. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the directory information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2529 createDirectory(share, directory [, options], callback) Creates a new directory under the specified account.If a directory with the same name already exists, the operation fails. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the directory information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1045 createDirectoryIfNotExists(share, directory [, options], callback) Creates a new directory under the specified account if the directory does not exists. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the directory information including created boolean member. already exists. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1112 Example var azure = require('azure-storage'); var FileService = azure.createFileService(); FileService.createDirectoryIfNotExists('taskshare', taskdirectory', function(error) { if(!error) { // Directory created or already existed } }); createFile(share, directory, file, length [, options], callback) Creates a file of the specified length. If the file already exists on the service, it will be overwritten. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. length int The length of the file in bytes. options object &lt;optional&gt; The request options. Properties Name Type Argument Description contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2054 createFileFromBrowserFile(share, directory, file, browserFile [, options], callback) Uploads a file to storage from an HTML File object. If the file already exists on the service, it will be overwritten.(Only available in the JavaScript Client Library for Browsers) This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. browserFile File The File object to be uploaded created by HTML File API. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects; storeFileContentMD5 bool &lt;optional&gt; Specifies whether the file's ContentMD5 header should be set on uploads. The default value is false for files. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.browser.js, line 65 Returns: Type SpeedSummary createFileFromLocalFile(share, directory, file, (string) [, options], callback) Uploads a file to storage from a local file. If the file already exists on the service, it will be overwritten.(Not available in the JavaScript Client Library for Browsers) This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. (string) localFileName The local path to the file to be uploaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects; storeFileContentMD5 bool &lt;optional&gt; Specifies whether the file's ContentMD5 header should be set on uploads. The default value is false for files. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.node.js, line 151 Returns: Type SpeedSummary createFileFromStream(share, directory, file, (Stream), streamLength [, options], callback) Uploads a file from a stream. If the file already exists on the service, it will be overwritten. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. (Stream) stream Stream to the data to store. streamLength int The length of the stream to upload. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects; storeFileContentMD5 bool &lt;optional&gt; Specifies whether the file's ContentMD5 header should be set on uploads. The default value is false for files. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2733 Returns: Type SpeedSummary createFileFromText(share, directory, file, text [, options], callback) Uploads a file from a text string. If the file already exists on the service, it will be overwritten. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. text string | object The file text, as a string or in a Buffer. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The upload tracker objects; storeFileContentMD5 bool &lt;optional&gt; Specifies whether the file's ContentMD5 header should be set on uploads. The default value is false for files. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback FileService~FileToText error will contain information if an error occurs; otherwise text will contain the file contents, and file will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2661 createRangesFromStream(share, directory, file, readStream, rangeStart, rangeEnd [, options], callback) Updates a range from a stream. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. readStream Stream The read stream. rangeStart int The range start. rangeEnd int The range end. options object &lt;optional&gt; The request options. Properties Name Type Argument Description useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. transactionalContentMD5 string &lt;optional&gt; An optional hash value used to ensure transactional integrity for the page. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2591 createReadStream(share, directory, file [, options], callback) Provides a stream to read from a file. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description rangeStart string &lt;optional&gt; Return only the bytes of the file in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the file in the specified range. useTransactionalMD5 boolean &lt;optional&gt; When set to true, Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading files. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2303 Returns: Type Stream Example var azure = require('azure-storage'); var fileService = azure.createFileService(); var writable = fs.createWriteStream(destinationFileNameTarget); fileService.createReadStream(shareName, directoryName, fileName).pipe(writable); createShare(share [, options], callback) Creates a new share under the specified account.If a share with the same name already exists, the operation fails. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description quota int &lt;optional&gt; Specifies the maximum size of the share, in gigabytes. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. metadata object &lt;optional&gt; The metadata key/value pairs. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the share information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 372 createShareIfNotExists(share [, options], callback) Creates a new share under the specified account if the share does not exists. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. metadata object &lt;optional&gt; The metadata key/value pairs. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the share information including created boolean member. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 442 Example var azure = require('azure-storage'); var FileService = azure.createFileService(); FileService.createShareIfNotExists('taskshare', function(error) { if(!error) { // Share created or already existed } }); createWriteStreamToExistingFile(share, directory, file [, options], callback) Provides a stream to write to a file. Assumes that the file exists.If it does not, please create the file using createFile before calling this method or use createWriteStreamNewFile. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects; storeFileContentMD5 bool &lt;optional&gt; Specifies whether the file's ContentMD5 header should be set on uploads. The default value is false for files. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2808 Returns: Type Stream Example var azure = require('azure-storage'); var FileService = azure.createFileService(); FileService.createFile(shareName, directoryName, fileName, 1024, function (err) { // Pipe file to a file var stream = fs.createReadStream(fileNameTarget).pipe(FileService.createWriteStreamToExistingFile(shareName, directoryName, fileName)); }); createWriteStreamToNewFile(share, directory, file, length [, options], callback) Provides a stream to write to a file. Creates the file before writing data. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. length string The file length. options object &lt;optional&gt; The request options. Properties Name Type Argument Description speedSummary SpeedSummary &lt;optional&gt; The download tracker objects; storeFileContentMD5 bool &lt;optional&gt; Specifies whether the file's ContentMD5 header should be set on uploads. The default value is false for files. useTransactionalMD5 bool &lt;optional&gt; Calculate and send/validate content MD5 for transactions. contentSettings object &lt;optional&gt; The file's content settings. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file service stores this value but does not use or modify it. contentDisposition string &lt;optional&gt; The file's content disposition. contentMD5 string &lt;optional&gt; The file's MD5 hash. metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2875 Returns: Type Stream Example var azure = require('azure-storage'); var FileService = azure.createFileService(); var stream = fs.createReadStream(fileNameTarget).pipe(FileService.createWriteStreamToNewFile(shareName, directoryName, fileName)); deleteDirectory(share, directory [, options], callback) Marks the specified directory for deletion. The directory must be empty before it can be deleted. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1230 deleteDirectoryIfExists(share, directory [, options], callback) Marks the specified directory for deletion if it exists. The directory must be empty before it can be deleted. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will be true if the directory exists and was deleted, or false if the directory did not exist. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1279 deleteFile(share, directory, file [, options], callback) Marks the specified file for deletion. The file is later deleted during garbage collection. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2112 deleteFileIfExists(share, directory, file [, options], callback) Marks the specified file for deletion if it exists. The file is later deleted during garbage collection. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will be true if the file was deleted, or false if the file does not exist. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2163 deleteShare(share [, options], callback) Marks the specified share for deletion.The share and any files contained within it are later deleted during garbage collection. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/file/fileservice.core.js, line 909 deleteShareIfExists(share [, options], callback) Marks the specified share for deletion if it exists.The share and any files contained within it are later deleted during garbage collection. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will be true if the share exists and was deleted, or false if the share did not exist. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 957 doesDirectoryExist(share, directory [, options], callback) Checks whether or not a directory exists on the service. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the directory information including exists boolean member. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1017 doesFileExist(share, directory, file [, options], callback) Checks whether or not a file exists on the service. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback function error will contain information if an error occurs; otherwise result will contain the file information including the exists boolean member. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2018 doesShareExist(share [, options], callback) Checks whether or not a share exists on the service. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the share information including exists boolean member. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 344 generateSharedAccessSignature(share [, directory] [, file], sharedAccessPolicy [, headers]) Retrieves a shared access signature token. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string &lt;optional&gt; The directory name. Use '' to refer to the base directory. file string &lt;optional&gt; The file name. sharedAccessPolicy object The shared access policy. Properties Name Type Argument Description Id string &lt;optional&gt; The signed identifier. AccessPolicy.Permissions object &lt;optional&gt; The permission type. AccessPolicy.Start date | string &lt;optional&gt; The time at which the Shared Access Signature becomes valid (The UTC value will be used). AccessPolicy.Expiry date | string &lt;optional&gt; The time at which the Shared Access Signature becomes expired (The UTC value will be used). AccessPolicy.IPAddressOrRange string &lt;optional&gt; An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. AccessPolicy.Protocols string &lt;optional&gt; The protocols permitted for a request made with the account SAS. Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. headers object &lt;optional&gt; The optional header values to set for a file returned wth this SAS. Properties Name Type Argument Description cacheControl string &lt;optional&gt; The optional value of the Cache-Control response header to be returned when this SAS is used. contentType string &lt;optional&gt; The optional value of the Content-Type response header to be returned when this SAS is used. contentEncoding string &lt;optional&gt; The optional value of the Content-Encoding response header to be returned when this SAS is used. contentLanguage string &lt;optional&gt; The optional value of the Content-Language response header to be returned when this SAS is used. contentDisposition string &lt;optional&gt; The optional value of the Content-Disposition response header to be returned when this SAS is used. Source: services/file/fileservice.core.js, line 1594 Returns: The shared access signature query string. Note this string does not contain the leading &quot;?&quot;. Type string getDirectoryMetadata(share, directory, callback) Returns all user-defined metadata for the specified directory.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. options.timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. options.clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. options.maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. options.clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. options.useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the directory. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1475 getDirectoryProperties(share, directory [, options], callback) Retrieves a directory and its properties from a specified account.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the directory. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1175 getFileMetadata(share, directory, file, callback) Returns all user-defined metadata for the specified file.It does not modify or return the content of the file.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options.locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. options.timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. options.clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. options.maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. options.clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. options.useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the file. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1769 getFileProperties(share, directory, file [, options], callback) Returns all user-defined metadata, standard HTTP properties, and system properties for the file.It does not return or modify the content of the file.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the file. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1710 getFileToLocalFile(share, directory, file, localFileName [, options], callback) Downloads an Azure file into a file.(Not available in the JavaScript Client Library for Browsers) This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. localFileName string The local path to the file to be downloaded. options object &lt;optional&gt; The request options. Properties Name Type Argument Description skipSizeCheck boolean &lt;optional&gt; Skip the size check to perform direct download. Set the option to true for small files. Parallel download and speed summary won't work with this option on. speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. rangeStart string &lt;optional&gt; Return only the bytes of the file in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the file in the specified range. useTransactionalMD5 boolean &lt;optional&gt; When set to true, Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading files. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.node.js, line 70 Returns: Type SpeedSummary Example var azure = require('azure-storage'); var FileService = azure.createFileService(); FileService.getFileToLocalFile('taskshare', taskdirectory', 'task1', 'task1-download.txt', function(error, serverFile) { if(!error) { // file available in serverFile.file variable } getFileToStream(share, directory, file, writeStream [, options], callback) Downloads a file into a stream. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. writeStream Stream The write stream. options object &lt;optional&gt; The request options. Properties Name Type Argument Description skipSizeCheck boolean &lt;optional&gt; Skip the size check to perform direct download. Set the option to true for small files. Parallel download and speed summary won't work with this option on. speedSummary SpeedSummary &lt;optional&gt; The download tracker objects. parallelOperationThreadCount int &lt;optional&gt; The number of parallel operations that may be performed when uploading. rangeStart string &lt;optional&gt; Return only the bytes of the file in the specified range. rangeEnd string &lt;optional&gt; Return only the bytes of the file in the specified range. useTransactionalMD5 boolean &lt;optional&gt; When set to true, Calculate and send/validate content MD5 for transactions. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading files. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2373 Returns: Type SpeedSummary Example var azure = require('azure-storage'); var FileService = azure.createFileService(); FileService.getFileToStream('taskshare', taskdirectory', 'task1', fs.createWriteStream('task1-download.txt'), function(error, serverFile) { if(!error) { // file available in serverFile.file variable } }); getFileToText(share, directory, file [, options], callback) Downloads a file into a text string. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description rangeStart int &lt;optional&gt; The range start. rangeEnd int &lt;optional&gt; The range end. disableContentMD5Validation boolean &lt;optional&gt; When set to true, MD5 validation will be disabled when downloading files. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback FileService~FileToText error will contain information if an error occurs; otherwise text will contain the file contents, and file will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2227 getServiceProperties( [options], callback) Gets the properties of a storage account's File service, including Azure Storage Analytics. This: {FileService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise, result will contain the properties and response will contain information related to this operation. Source: services/file/fileservice.core.js, line 171 getShareAcl(share [, options], callback) Gets the share's ACL. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the share. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 787 getShareMetadata(share [, options], callback) Returns all user-defined metadata for the share.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the share. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 673 getShareProperties(share [, options], callback) Retrieves a share and its properties from a specified account.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the share. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 505 getShareStats(share [, options], callback) Gets the share statistics for a share. This: {FileService} Parameters: Name Type Argument Description share string The share name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise, result will contain the stats and response will contain information related to this operation. Source: services/file/fileservice.core.js, line 617 getUrl(share, directory [, file] [, sasToken] [, primary]) Retrieves a file or directory URL. Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string &lt;optional&gt; The file name. File names may not start or end with the delimiter '/'. sasToken string &lt;optional&gt; The Shared Access Signature token. primary boolean &lt;optional&gt; A boolean representing whether to use the primary or the secondary endpoint. Source: services/file/fileservice.core.js, line 1663 Returns: The formatted URL string. Type string Example var azure = require('azure-storage'); var fileService = azure.createFileService(); var sharedAccessPolicy = { AccessPolicy: { Permissions: azure.FileUtilities.SharedAccessPermissions.READ, Start: startDate, Expiry: expiryDate }, }; var sasToken = fileService.generateSharedAccessSignature(shareName, directoryName, fileName, sharedAccessPolicy); var url = fileService.getUrl(shareName, directoryName, fileName, sasToken, true); listFilesAndDirectoriesSegmented(share, directory, currentToken [, options], callback) Lists a segment containing a collection of file items in the directory. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of files to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries.files which contains a list of files, entries.directories which contains a list of directories and the continuationToken for the next listing operation. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1340 listFilesAndDirectoriesSegmentedWithPrefix(share, directory, prefix, currentToken [, options], callback) Lists a segment containing a collection of file items in the directory. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. prefix string The prefix of the directory/files name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of files to return per call to Azure ServiceClient. This does NOT affect list size returned by this function. (maximum: 5000) locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries.files which contains a list of files, entries.directories which contains a list of directories and the continuationToken for the next listing operation. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1370 listRanges(share, directory, file [, options], callback) Lists file ranges. Lists all of the ranges by default, or only the ranges over a specific range of bytes if rangeStart and rangeEnd are specified. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. options object &lt;optional&gt; The request options. Properties Name Type Argument Description rangeStart int &lt;optional&gt; The range start. rangeEnd int &lt;optional&gt; The range end. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the range information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2451 listSharesSegmented(currentToken [, options], callback) Lists a segment containing a collection of share items under the specified account. This: {FileService} Parameters: Name Type Argument Description currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. maxResults int &lt;optional&gt; Specifies the maximum number of shares to return per call to Azure storage. include string &lt;optional&gt; Include this parameter to specify that the share's metadata be returned as part of the response body. (allowed values: '', 'metadata') Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of shares and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 226 listSharesSegmentedWithPrefix(prefix, currentToken [, options], callback) Lists a segment containing a collection of share items whose names begin with the specified prefix under the specified account. This: {FileService} Parameters: Name Type Argument Description prefix string The prefix of the share name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. prefix string &lt;optional&gt; Filters the results to return only shares whose name begins with the specified prefix. maxResults int &lt;optional&gt; Specifies the maximum number of shares to return per call to Azure storage. include string &lt;optional&gt; Include this parameter to specify that the share's metadata be returned as part of the response body. (allowed values: '', 'metadata') Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of shares and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 256 resizeFile(share, directory, file, size [, options], callback) Resizes a file. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. size String The size of the file, in bytes. options object &lt;optional&gt; The request options. Properties Name Type Argument Description timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the file. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1958 setAccountServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {StorageServiceClient} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Inherited From: StorageServiceClient#setAccountServiceProperties Source: common/services/storageserviceclient.js, line 1095 setDirectoryMetadata(share, directory, metadata [, options], callback) Sets user-defined metadata for the specified directory as one or more name-value pairs This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. metadata object The metadata key/value pairs. options object &lt;optional&gt; The request options. Properties Name Type Argument Description timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information on the directory. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1532 setFileMetadata(share, directory, file, metadata [, options], callback) Sets user-defined metadata for the specified file as one or more name-value pairsIt does not modify or return the content of the file. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. metadata object The metadata key/value pairs. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information on the file. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1899 setFileProperties(share, directory, file [, properties] [, options], callback) Sets user-defined properties for the specified file.It does not modify or return the content of the file. This: {FileService} Parameters: Name Type Argument Description share string The share name. directory string The directory name. Use '' to refer to the base directory. file string The file name. File names may not start or end with the delimiter '/'. properties object &lt;optional&gt; The file properties to set. Properties Name Type Argument Description contentType string &lt;optional&gt; The MIME content type of the file. The default type is application/octet-stream. contentEncoding string &lt;optional&gt; The content encodings that have been applied to the file. contentLanguage string &lt;optional&gt; The natural languages used by this resource. cacheControl string &lt;optional&gt; The file's cache control. contentDisposition string &lt;optional&gt; The file's content disposition. contentLength string &lt;optional&gt; Resizes a file to the specified size. If the specified byte value is less than the current size of the file, then all ranges above the specified byte value are cleared. contentMD5 string &lt;optional&gt; The file's MD5 hash. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information about the file. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 1838 setProxy(proxy) /*Sets proxy object specified by caller. Parameters: Name Type Description proxy object proxy to use for tunneling { host: hostname port: port number proxyAuth: 'user:password' for basic auth headers: {...} headers for proxy server key: key for proxy server ca: ca for proxy server cert: cert for proxy server } if null or undefined, clears proxy Inherited From: StorageServiceClient#setProxy Source: common/services/storageserviceclient.js, line 1203 setServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account's File service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {FileService} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Source: services/file/fileservice.core.js, line 196 setShareAcl(share, signedIdentifiers [, options], callback) Updates the share's ACL. This: {FileService} Parameters: Name Type Argument Description share string The share name. signedIdentifiers Object.&lt;string, AccessPolicy&gt; The share ACL settings. See AccessPolicy for detailed information. options object &lt;optional&gt; The request options. Properties Name Type Argument Description timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the share. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 842 setShareMetadata(share, metadata [, options], callback) Sets the share's metadata. Calling the Set Share Metadata operation overwrites all existing metadata that is associated with the share.It's not possible to modify an individual name/value pair. This: {FileService} Parameters: Name Type Argument Description share string The share name. metadata object The metadata key/value pairs. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/file/fileservice.core.js, line 731 setShareProperties(share [, properties] [, options], callback) Sets the properties for the specified share. This: {FileService} Parameters: Name Type Argument Description share string The share name. properties object &lt;optional&gt; The share properties to set. Properties Name Type Argument Description quota string | int &lt;optional&gt; Specifies the maximum size of the share, in gigabytes. options object &lt;optional&gt; The request options. Properties Name Type Argument Description timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise share will contain information about the share. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 561 startCopyFile(sourceUri, targetShare, targetDirectory, targetFile [, options], callback) Starts to copy a file to a destination within the storage account. This: {FileService} Parameters: Name Type Argument Description sourceUri string The source file or blob URI. targetShare string The target share name. targetDirectory string The target directory name. targetFile string The target file name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The target file metadata key/value pairs. accessConditions AccessConditions &lt;optional&gt; The access conditions. sourceAccessConditions AccessConditions &lt;optional&gt; The source access conditions. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the file information. response will contain information related to this operation. Source: services/file/fileservice.core.js, line 2941 withFilter(filter) Associate a filtering operation with this StorageServiceClient. Filtering operationscan include logging, automatically retrying, etc. Filter operations are objectsthat implement a method with the signature: &quot;function handle (requestOptions, next)&quot;.After doing its preprocessing on the request options, the method needs to call&quot;next&quot; passing a callback with the following signature:signature: &quot;function (returnObject, finalCallback, next)&quot;In this callback, and after processing the returnObject (the response from therequest to the server), the callback needs to either invoke next if it exists tocontinue processing other filters or simply invoke finalCallback otherwise to endup the service invocation. Parameters: Name Type Description filter Object The new filter object. Inherited From: StorageServiceClient#withFilter Source: common/services/storageserviceclient.js, line 767 Returns: A new service client with the filter applied. Type StorageServiceClient Type Definitions FileToText(error, text, file, response) The callback for {FileService~getFileToText}. Parameters: Name Type Description error object If an error occurs, the error information. text string The text returned from the file. file object Information about the file. response object Information related to this operation. Source: services/file/fileservice.core.js, line 3787 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"FileUtilities.html":{"id":"FileUtilities.html","title":"Namespace: FileUtilities","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Namespace: FileUtilities FileUtilities Defines constants, enums, and utility functions for use with the File service. Source: services/file/fileutilities.js, line 20 Members &lt;static&gt; ListingDetails :string Listing details. Type: string Properties: Name Type Default Description METADATA string metadata Source: services/file/fileutilities.js, line 45 &lt;static&gt; SharedAccessPermissions :string Permission types Type: string Properties: Name Type Default Description READ string r CREATE string c WRITE string w DELETE string d LIST string l Source: services/file/fileutilities.js, line 31 &lt;static&gt; SharePublicAccessType :string File and share public access types. Type: string Properties: Name Type Default Description OFF string null SHARE string share FILE string file Source: services/file/fileutilities.js, line 55 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"LeaseResult.html":{"id":"LeaseResult.html","title":"Class: LeaseResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: LeaseResult LeaseResult The LeaseResult class is used to store the lease information. new LeaseResult( [container] [, blob] [, id] [, time]) Creates a new LeaseResult object. Parameters: Name Type Argument Description container string &lt;optional&gt; The container name. blob string &lt;optional&gt; The blob name. id string &lt;optional&gt; The lease id. time string &lt;optional&gt; Approximate time remaining in the lease period, in seconds. Properties: Name Type Description container string The container name. blob string The blob name. id string The lease id. time string Approximate time remaining in the lease period, in seconds. etag string The etag. lastModified string The date/time that the lease was last modified. Source: services/blob/models/leaseresult.js, line 40 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"LinearRetryPolicyFilter.html":{"id":"LinearRetryPolicyFilter.html","title":"Class: LinearRetryPolicyFilter","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: LinearRetryPolicyFilter LinearRetryPolicyFilter The LinearRetryPolicyFilter allows you to retry operations,using an linear back-off interval between retries.To apply a filter to service operations, use withFilterand specify the filter to be used when creating a service. new LinearRetryPolicyFilter( [retryCount] [, retryInterval]) Creates a new LinearRetryPolicyFilter instance. Parameters: Name Type Argument Default Description retryCount number &lt;optional&gt; 3 The client retry count. retryInterval number &lt;optional&gt; 30000 The client retry interval, in milliseconds. Source: common/filters/linearretrypolicyfilter.js, line 36 Example var azure = require('azure-storage'); var retryOperations = new azure.LinearRetryPolicyFilter(); var blobService = azure.createBlobService().withFilter(retryOperations) Members &lt;static&gt; DEFAULT_CLIENT_RETRY_COUNT Represents the default client retry count. Source: common/filters/linearretrypolicyfilter.js, line 49 &lt;static&gt; DEFAULT_CLIENT_RETRY_INTERVAL Represents the default client retry interval, in milliseconds. Source: common/filters/linearretrypolicyfilter.js, line 44 Methods handle(requestOptions, next) Handles an operation with a linear retry policy. Parameters: Name Type Description requestOptions Object The original request options. next function The next filter to be handled. Source: common/filters/linearretrypolicyfilter.js, line 71 shouldRetry(statusCode, requestOptions) Determines if the operation should be retried and how long to wait until the next retry. Parameters: Name Type Description statusCode number The HTTP status code. requestOptions object The request options. Source: common/filters/linearretrypolicyfilter.js, line 58 Returns: Information about whether the operation qualifies for a retry and the retryInterval. Type retryInfo × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"Logger.html":{"id":"Logger.html","title":"Class: Logger","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: Logger Logger The Logger class is used to write log information. new Logger( [level] [, loggerFunction]) Creates a new Logger object Parameters: Name Type Argument Description level string &lt;optional&gt; The log level. Refer to Logger.LogLevels. loggerFunction object &lt;optional&gt; The function to write log information. Source: common/diagnostics/logger.js, line 27 Members &lt;static&gt; LogLevels :string The available log levels. Type: string Properties: Name Type Default Description EMERGENCY string emergency System is unusable. ALERT string alert Action must be taken immediately. CRITICAL string critical Critical condition. ERROR string error Error condition. WARNING string warning Warning condition. NOTICE string notice Normal but significant condition. INFO string info Purely informational message. DEBUG string debug Application debug messages. Source: common/diagnostics/logger.js, line 49 level :string The log level. Refer to the Logger.LogLevels for available log levels. Type: string Source: common/diagnostics/logger.js, line 28 See: Logger.LogLevels × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"QueueMessageEncoder.html":{"id":"QueueMessageEncoder.html","title":"Class: QueueMessageEncoder","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: QueueMessageEncoder QueueMessageEncoder new QueueMessageEncoder() The interface for classes that represent a encoder which can be used to specify how the queue service encodes and decodes queue messages. To specify how the queue service encodes and decodes queue messages, set queueService.messageEncoder to object of built-in encoder typesTextBase64QueueMessageEncoder, BinaryBase64QueueMessageEncoder, TextXmlQueueMessageEncoder,or custom implementation of the QueueMessageEncoder. Source: services/queue/queuemessageencoder.js, line 30 Methods decode( [textToBeDecoded]) Function to decode queue messages Parameters: Name Type Argument Description textToBeDecoded string &lt;optional&gt; The base64 string to be decoded. Source: services/queue/queuemessageencoder.js, line 49 Returns: Type any encode( [input]) Function to encode queue messages. Parameters: Name Type Argument Description input object &lt;optional&gt; The target to be encoded. Source: services/queue/queuemessageencoder.js, line 39 Returns: Type string × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"QueueMessageResult.html":{"id":"QueueMessageResult.html","title":"Class: QueueMessageResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: QueueMessageResult QueueMessageResult The QueueMessageResult class is used to store the queue message information. new QueueMessageResult( [queue] [, messageId] [, popReceipt]) Creates a new QueueMessageResult object. Parameters: Name Type Argument Description queue string &lt;optional&gt; The queue name. messageId string &lt;optional&gt; The message id. popReceipt string &lt;optional&gt; The pop receipt. Properties: Name Type Description queue string The queue name. messageId string The message id. popReceipt string The pop receipt. messageText string The message text. timeNextVisible string The time next visible. insertionTime string The insertion time. expirationTime string The expiration time. dequeueCount number The dequeue count. Source: services/queue/models/queuemessageresult.js, line 44 Methods &lt;static&gt; parse(messageXml, The) Pase the XML representation of a queue message to a QueueMessageResult object. Parameters: Name Type Description messageXml Object The XML representation of the queue message. The QueueMessageEncoder message encoder. Source: services/queue/models/queuemessageresult.js, line 95 Returns: The QueueMessageResult object. Type QueueMessageResult &lt;static&gt; serialize(messageJs, The) Builds an XML representation for a queue message Parameters: Name Type Description messageJs string The queue message. The QueueMessageEncoder message encoder. Source: services/queue/models/queuemessageresult.js, line 65 Returns: The XML queue message. Type string × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"QueueResult.html":{"id":"QueueResult.html","title":"Class: QueueResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: QueueResult QueueResult The QueueResult class is used to store the queue information. new QueueResult( [name] [, metadata]) Creates a new QueueResult object. Parameters: Name Type Argument Description name string &lt;optional&gt; The queue name. metadata string &lt;optional&gt; The metadata key/value pair. Properties: Name Type Description name string The queue name. metadata object The metadata key/value pair. approximateMessageCount number The approximate number of messages in the queue. This number is not lower than the actual number of messages in the queue, but could be higher. signedIdentifiers Object.&lt;string, AccessPolicy&gt; The container ACL settings. See AccessPolicy for detailed information. Source: services/queue/models/queueresult.js, line 35 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"QueueService.html":{"id":"QueueService.html","title":"Class: QueueService","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: QueueService QueueService The QueueService class is used to perform operations on the Microsoft Azure Queue Service. For more information on using the Queue Service, as well as task focused information on using it from a Node.js application, seeHow to Use the Queue Service from Node.js.The following defaults can be set on the Queue service.messageEncoder The message encoder to specify how QueueService encodes and decodes the queue message. Default is TextXmlQueueMessageEncoder.defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the Queue service.defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the Queue service.defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the Queue service.defaultLocationMode The default location mode for requests made via the Queue service.useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the Queue service; true to use the Nagle algorithm; otherwise, false. The default value is false. new QueueService( [storageAccountOrConnectionString] [, storageAccessKey] [, host] [, sasToken] [, endpointSuffix]) Creates a new QueueService object.If no connection string or storageaccount and storageaccesskey are provided,the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string &lt;optional&gt; The Shared Access Signature token. endpointSuffix string &lt;optional&gt; The endpoint suffix. Source: services/queue/queueservice.js, line 68 Extends StorageServiceClient Members logger :Logger The logger of the service. To change the log level of the services, set the logger.level. Type: Logger Inherited From: StorageServiceClient#logger Source: common/services/storageserviceclient.js, line 105 messageEncoder Properties: Name Type Description QueueService#messageEncoder boolean Default Value: {QueueMessageEncoder} `TextXmlQueueMessageEncoder`. The message encoder to specify how QueueService encodes and decodes the queue message. Default is `TextXmlQueueMessageEncoder`. Source: services/queue/queueservice.js, line 87 Methods _getUrl() Get the url of a given path Inherited From: StorageServiceClient#_getUrl Source: common/services/storageserviceclient.js, line 959 _initializeLocation() Initializes the location to which the operation is being sent to. Inherited From: StorageServiceClient#_initializeLocation Source: common/services/storageserviceclient.js, line 1255 _invalidLocationMode() Checks whether we have the relevant host information based on the locationMode. Inherited From: StorageServiceClient#_invalidLocationMode Source: common/services/storageserviceclient.js, line 1310 _maximumExecutionTimeExceeded() Checks to see if the maximum execution timeout provided has been exceeded. Inherited From: StorageServiceClient#_maximumExecutionTimeExceeded Source: common/services/storageserviceclient.js, line 1324 _setDefaultProxy() Sets the service host default proxy from the environment.Can be overridden by calling _setProxyUrl or _setProxy Inherited From: StorageServiceClient#_setDefaultProxy Source: common/services/storageserviceclient.js, line 1216 _setOperationExpiryTime() Sets the operation expiry time. Inherited From: StorageServiceClient#_setOperationExpiryTime Source: common/services/storageserviceclient.js, line 1335 _validateLocation() Validates the location to which the operation is being sent to. Inherited From: StorageServiceClient#_validateLocation Source: common/services/storageserviceclient.js, line 1278 clearMessages(queue [, options], callback) Clears all messages from the queue. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise response will contain information related to this operation. Source: services/queue/queueservice.js, line 1034 createMessage(queue, messageText [, options], callback) Adds a new message to the back of the message queue.The encoded message can be up to 64KB in size for versions 2011-08-18 and newer, or 8KB in size for previous versions.Unencoded messages must be in a format that can be included in an XML request with UTF-8 encoding.Queue messages are encoded using the TextXmlQueueMessageEncoder. See queueService.messageEncoder to set encoder defaults. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. messageText string | Buffer The message text. options object &lt;optional&gt; The request options. Properties Name Type Argument Description messageTimeToLive int &lt;optional&gt; The time-to-live interval for the message, in seconds. The maximum time-to-live allowed is 7 days. If this parameter is omitted, the default time-to-live is 7 days visibilityTimeout int &lt;optional&gt; Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message cannot be set to a value later than the expiry time. visibilitytimeout should be set to a value smaller than the time-to-live value. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the message. response will contain information related to this operation. Source: services/queue/queueservice.js, line 711 Example var azure = require('azure-storage'); var queueService = azure.createQueueService(); queueService.createMessage('taskqueue', 'Hello world!', function(error) { if(!error) { // Message inserted } }); createQueue(queue [, options], callback) Creates a new queue under the given account. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the queue information. response will contain information related to this operation. Source: services/queue/queueservice.js, line 361 createQueueIfNotExists(queue [, options], callback) Creates a new queue under the given account if it doesn't exist. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description metadata object &lt;optional&gt; The metadata key/value pairs. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the queue information including created boolean member and response will contain information related to this operation. Source: services/queue/queueservice.js, line 427 Example var azure = require('azure-storage'); var queueService = azure.createQueueService(); queueService.createQueueIfNotExists('taskqueue', function(error) { if(!error) { // Queue created or exists } }); deleteMessage(queue, messageId, popReceipt [, options], callback) Deletes a specified message from the queue. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. messageId string The message identifier of the message to delete. popReceipt string A valid pop receipt value returned from an earlier call to the Get Messages or Update Message operation options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/queue/queueservice.js, line 981 deleteQueue(queue [, options], callback) Permanently deletes the specified queue. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/queue/queueservice.js, line 485 deleteQueueIfExists(queue [, options], callback) Permanently deletes the specified queue if it exists. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain 'true' if the queue was deleted and 'false' if the queue did not exist. response will contain information related to this operation. Source: services/queue/queueservice.js, line 529 doesQueueExist(queue [, options], callback) Checks to see if a queue exists. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback function error will contain information if an error occurs; otherwise, result will contain the queue information including exists boolean member. response will contain information related to this operation. Source: services/queue/queueservice.js, line 335 generateSharedAccessSignature(queue, sharedAccessPolicy) Retrieves a shared access signature token. This: {QueueService} Parameters: Name Type Description queue string The queue name. sharedAccessPolicy object The shared access policy. Properties Name Type Argument Description Id string &lt;optional&gt; The signed identifier. AccessPolicy.Permissions object &lt;optional&gt; The permission type. AccessPolicy.Start date | string &lt;optional&gt; The time at which the Shared Access Signature becomes valid (The UTC value will be used). AccessPolicy.Expiry date | string &lt;optional&gt; The time at which the Shared Access Signature becomes expired (The UTC value will be used). AccessPolicy.IPAddressOrRange string &lt;optional&gt; An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. AccessPolicy.Protocols string The protocols permitted for a request made with the account SAS. Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. Source: services/queue/queueservice.js, line 1294 Returns: The shared access signature query string. Note this string does not contain the leading &quot;?&quot;. Type string getMessage(queue [, options], callback) Retrieves a message from the queue and makes it invisible to other consumers. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description visibilityTimeout int &lt;optional&gt; Required if not peek only. Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message can be set to a value later than the expiry time. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the message. response will contain information related to this operation. Source: services/queue/queueservice.js, line 850 Example var azure = require('azure-storage'); var queueService = azure.createQueueService(); var queueName = 'taskqueue'; queueService.getMessage(queueName, function(error, serverMessage) { if(!error) { // Process the message in less than 30 seconds, the message // text is available in serverMessage.messagetext queueService.deleteMessage(queueName, serverMessage.messageId, serverMessage.popReceipt, function(error) { if(!error){ // Message deleted } }); } }); getMessages(queue [, options], callback) Retrieve messages from the queue and makes them invisible to other consumers. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description numOfMessages int &lt;optional&gt; A nonzero integer value that specifies the number of messages to retrieve from the queue, up to a maximum of 32. By default, a single message is retrieved from the queue with this operation. visibilityTimeout int &lt;optional&gt; Required if not peek only. Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message can be set to a value later than the expiry time. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain a list of messages. response will contain information related to this operation. Source: services/queue/queueservice.js, line 796 Example var azure = require('azure-storage'); var queueService = azure.createQueueService(); var queueName = 'taskqueue'; queueService.getMessages(queueName, function(error, serverMessages) { if(!error) { // Process the message in less than 30 seconds, the message // text is available in serverMessages[0].messagetext queueService.deleteMessage(queueName, serverMessages[0].messageId, serverMessages[0].popReceipt, function(error) { if(!error){ // Message deleted } }); } }); getQueueAcl(queue [, options], callback) Gets the queue's ACL. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the queue. response will contain information related to this operation. Source: services/queue/queueservice.js, line 1155 getQueueMetadata(queue [, options], callback) Returns queue properties, including user-defined metadata.Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the queue information. response will contain information related to this operation. Source: services/queue/queueservice.js, line 586 getServiceProperties( [options], callback) Gets the properties of a storage account’s Queue service, including Microsoft Azure Storage Analytics. This: {QueueService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise, result will contain the properties and response will contain information related to this operation. Source: services/queue/queueservice.js, line 165 getServiceStats( [options], callback) Gets the service stats for a storage account’s Queue service. This: {QueueService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise, result will contain the stats and response will contain information related to this operation. Source: services/queue/queueservice.js, line 112 getUrl(queue [, sasToken] [, primary]) Retrieves a queue URL. Parameters: Name Type Argument Description queue string The queue name. sasToken string &lt;optional&gt; The Shared Access Signature token. primary boolean &lt;optional&gt; A boolean representing whether to use the primary or the secondary endpoint. Source: services/queue/queueservice.js, line 1457 Returns: The formatted URL string. Type string Example var azure = require('azure-storage'); var queueService = azure.createQueueService(); var sharedAccessPolicy = { AccessPolicy: { Permissions: azure.QueueUtilities.SharedAccessPermissions.READ, Start: startDate, Expiry: expiryDate }, }; var sasToken = queueService.generateSharedAccessSignature(queue, sharedAccessPolicy); var sasUrl = queueService.getUrl(queue, sasToken); listQueuesSegmented(currentToken [, options], callback) Lists a segment containing a collection of queue items whose names begin with the specified prefix under the given account. This: {QueueService} Parameters: Name Type Argument Description currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of queues to return per call to Azure storage. This does NOT affect list size returned by this function. (maximum: 5000) include string &lt;optional&gt; Include this parameter to specify that the queue's metadata be returned as part of the response body. (allowed values: '', 'metadata') Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of queues and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/queue/queueservice.js, line 218 listQueuesSegmentedWithPrefix(prefix, currentToken [, options], callback) Lists a segment containing a collection of queue items under the given account. This: {QueueService} Parameters: Name Type Argument Description prefix string The prefix of the queue name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation.* @param {string} [options.prefix] Filters the results to return only queues whose name begins with the specified prefix. options object &lt;optional&gt; The request options. Properties Name Type Argument Description marker string &lt;optional&gt; String value that identifies the portion of the list to be returned with the next list operation. maxResults int &lt;optional&gt; Specifies the maximum number of queues to return per call to Azure storage. This does NOT affect list size returned by this function. (maximum: 5000) include string &lt;optional&gt; Include this parameter to specify that the queue's metadata be returned as part of the response body. (allowed values: '', 'metadata') Note that all metadata names returned from the server will be converted to lower case by NodeJS itself as metadata is set via HTTP headers and HTTP header names are case insensitive. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of queues and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/queue/queueservice.js, line 248 peekMessage(queue [, options], callback) Retrieves a message from the front of the queue, without changing the message visibility. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the message. response will contain information related to this operation. Source: services/queue/queueservice.js, line 935 peekMessages(queue [, options], callback) Retrieves messages from the front of the queue, without changing the messages visibility. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description numOfMessages int &lt;optional&gt; A nonzero integer value that specifies the number of messages to retrieve from the queue, up to a maximum of 32. By default, a single message is retrieved from the queue with this operation. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain messages. response will contain information related to this operation. Source: services/queue/queueservice.js, line 897 setAccountServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {StorageServiceClient} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Inherited From: StorageServiceClient#setAccountServiceProperties Source: common/services/storageserviceclient.js, line 1095 setProxy(proxy) /*Sets proxy object specified by caller. Parameters: Name Type Description proxy object proxy to use for tunneling { host: hostname port: port number proxyAuth: 'user:password' for basic auth headers: {...} headers for proxy server key: key for proxy server ca: ca for proxy server cert: cert for proxy server } if null or undefined, clears proxy Inherited From: StorageServiceClient#setProxy Source: common/services/storageserviceclient.js, line 1203 setQueueAcl(queue [, options], callback) Updates the queue's ACL. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the queue. response will contain information related to this operation. Properties: Name Type Description signedIdentifiers Object.&lt;string, AccessPolicy&gt; The container ACL settings. See AccessPolicy for detailed information. Source: services/queue/queueservice.js, line 1234 Example var azure = require('azure-storage'); var SharedAccessPermissions = azure.QueueUtilities.SharedAccessPermissions; var queueService = azure.createQueueService(); var sharedAccessPolicies = [ {AccessPolicy: { Permissions: PROCESS, Start: startDate, Expiry: expiryDate }, Id: processOnly, }, {AccessPolicy: { Permissions: SharedAccessPermissions.PROCESS + SharedAccessPermissions.DELETE, Start: startDate, Expiry: expiryDate }, Id: processAndDelete, }]; queueService.setQueueAcl(queueName, sharedAccessPolicies, function(error, queueResult, response) { // do whatever }); setQueueMetadata(queue, metadata [, options], callback) Sets user-defined metadata on the specified queue. Metadata is associated with the queue as name-value pairs. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. metadata object The metadata key/value pairs. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the queue information. response will contain information related to this operation. Source: services/queue/queueservice.js, line 643 setServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s Queue service, including Microsoft Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {QueueService} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Source: services/queue/queueservice.js, line 190 updateMessage(queue, messageId, popReceipt, visibilityTimeout [, options], callback) Updates the visibility timeout of a message. You can also use this operation to update the contents of a message.A message must be in a format that can be included in an XML request with UTF-8 encoding, and the encoded message can be up to 64KB in size. This: {QueueService} Parameters: Name Type Argument Description queue string The queue name. messageId string The message identifier of the message to update. popReceipt string A valid pop receipt value returned from an earlier call to the Get Messages or Update Message operation visibilityTimeout int Specifies the new visibility timeout value, in seconds, relative to server time. The new value must be larger than or equal to 0, and cannot be larger than 7 days. The visibility timeout of a message can be set to a value later than the expiry time. options object &lt;optional&gt; The request options. Properties Name Type Argument Description messageText object &lt;optional&gt; The new message text. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the message result information. response will contain information related to this operation. Source: services/queue/queueservice.js, line 1084 withFilter(filter) Associate a filtering operation with this StorageServiceClient. Filtering operationscan include logging, automatically retrying, etc. Filter operations are objectsthat implement a method with the signature: &quot;function handle (requestOptions, next)&quot;.After doing its preprocessing on the request options, the method needs to call&quot;next&quot; passing a callback with the following signature:signature: &quot;function (returnObject, finalCallback, next)&quot;In this callback, and after processing the returnObject (the response from therequest to the server), the callback needs to either invoke next if it exists tocontinue processing other filters or simply invoke finalCallback otherwise to endup the service invocation. Parameters: Name Type Description filter Object The new filter object. Inherited From: StorageServiceClient#withFilter Source: common/services/storageserviceclient.js, line 767 Returns: A new service client with the filter applied. Type StorageServiceClient × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"QueueUtilities.html":{"id":"QueueUtilities.html","title":"Namespace: QueueUtilities","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Namespace: QueueUtilities QueueUtilities Defines enums for use with the Queue service. Source: services/queue/queueutilities.js, line 20 Members &lt;static&gt; SharedAccessPermissions :string Permission types. Type: string Properties: Name Type Default Description READ string r ADD string a UPDATE string u PROCESS string p Source: services/queue/queueutilities.js, line 31 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"RetryPolicyFilter.html":{"id":"RetryPolicyFilter.html","title":"Class: RetryPolicyFilter","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: RetryPolicyFilter RetryPolicyFilter The RetryPolicyFilter allows you to retry operations,using a custom retry policy. Users are responsible todefine the shouldRetry method.To apply a filter to service operations, use withFilterand specify the filter to be used when creating a service. new RetryPolicyFilter( [retryCount] [, retryInterval]) Creates a new RetryPolicyFilter instance. Parameters: Name Type Argument Default Description retryCount number &lt;optional&gt; 30000 The client retry count. retryInterval number &lt;optional&gt; 3 The client retry interval, in milliseconds. Source: common/filters/retrypolicyfilter.js, line 44 Example var azure = require('azure-storage'); var retryPolicy = new azure.RetryPolicyFilter(); retryPolicy.retryCount = 3; retryPolicy.retryInterval = 3000; retryPolicy.shouldRetry = function(statusCode, retryContext) { }; var blobService = azure.createBlobService().withFilter(retryPolicy); Members &lt;static&gt; DEFAULT_CLIENT_RETRY_COUNT Represents the default client retry count. Source: common/filters/retrypolicyfilter.js, line 57 &lt;static&gt; DEFAULT_CLIENT_RETRY_INTERVAL Represents the default client retry interval, in milliseconds. Source: common/filters/retrypolicyfilter.js, line 52 Methods &lt;static&gt; _handle(requestOptions, next) Handles an operation with a retry policy. Parameters: Name Type Description requestOptions Object The original request options. next function The next filter to be handled. Source: common/filters/retrypolicyfilter.js, line 75 handle(requestOptions, next) Handles an operation with a retry policy. Parameters: Name Type Description requestOptions Object The original request options. next function The next filter to be handled. Source: common/filters/retrypolicyfilter.js, line 65 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"ShareResult.html":{"id":"ShareResult.html","title":"Class: ShareResult","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: ShareResult ShareResult The ShareResult class is used to store the share information. new ShareResult( [name]) Creates a new ShareResult object. Parameters: Name Type Argument Description name string &lt;optional&gt; The share name. Properties: Name Type Description name string The share name. metadata object The metadata key/value pair. etag string The etag. lastModified string The date/time that the share was last modified. requestId string The request id. quota string The share quota. Source: services/file/models/shareresult.js, line 38 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"StorageServiceClient.html":{"id":"StorageServiceClient.html","title":"Class: StorageServiceClient","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: StorageServiceClient StorageServiceClient The StorageServiceClient class is the base class of all the service classes. new StorageServiceClient(storageAccount, storageAccessKey, host, usePathStyleUri, sasToken) Creates a new StorageServiceClient object. Parameters: Name Type Description storageAccount string The storage account. storageAccessKey string The storage access key. host object The host for the service. usePathStyleUri bool Boolean value indicating wether to use path style uris. sasToken string The Shared Access Signature token. Source: common/services/storageserviceclient.js, line 73 Members logger :Logger The logger of the service. To change the log level of the services, set the logger.level. Type: Logger Source: common/services/storageserviceclient.js, line 105 Methods &lt;static&gt; getStorageSettings( [storageAccountOrConnectionString] [, storageAccessKey] [, host] [, sasToken]) Gets the storage settings. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string &lt;optional&gt; The host address. sasToken object &lt;optional&gt; The sas token. Source: common/services/storageserviceclient.js, line 891 Returns: Type StorageServiceSettings _getUrl() Get the url of a given path Source: common/services/storageserviceclient.js, line 959 _initializeLocation() Initializes the location to which the operation is being sent to. Source: common/services/storageserviceclient.js, line 1255 _invalidLocationMode() Checks whether we have the relevant host information based on the locationMode. Source: common/services/storageserviceclient.js, line 1310 _maximumExecutionTimeExceeded() Checks to see if the maximum execution timeout provided has been exceeded. Source: common/services/storageserviceclient.js, line 1324 _setDefaultProxy() Sets the service host default proxy from the environment.Can be overridden by calling _setProxyUrl or _setProxy Source: common/services/storageserviceclient.js, line 1216 _setOperationExpiryTime() Sets the operation expiry time. Source: common/services/storageserviceclient.js, line 1335 _validateLocation() Validates the location to which the operation is being sent to. Source: common/services/storageserviceclient.js, line 1278 setAccountServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {StorageServiceClient} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Source: common/services/storageserviceclient.js, line 1095 setProxy(proxy) /*Sets proxy object specified by caller. Parameters: Name Type Description proxy object proxy to use for tunneling { host: hostname port: port number proxyAuth: 'user:password' for basic auth headers: {...} headers for proxy server key: key for proxy server ca: ca for proxy server cert: cert for proxy server } if null or undefined, clears proxy Source: common/services/storageserviceclient.js, line 1203 withFilter(filter) Associate a filtering operation with this StorageServiceClient. Filtering operationscan include logging, automatically retrying, etc. Filter operations are objectsthat implement a method with the signature: &quot;function handle (requestOptions, next)&quot;.After doing its preprocessing on the request options, the method needs to call&quot;next&quot; passing a callback with the following signature:signature: &quot;function (returnObject, finalCallback, next)&quot;In this callback, and after processing the returnObject (the response from therequest to the server), the callback needs to either invoke next if it exists tocontinue processing other filters or simply invoke finalCallback otherwise to endup the service invocation. Parameters: Name Type Description filter Object The new filter object. Source: common/services/storageserviceclient.js, line 767 Returns: A new service client with the filter applied. Type StorageServiceClient × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"TableBatch.html":{"id":"TableBatch.html","title":"Class: TableBatch","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: TableBatch TableBatch new TableBatch() Creates a new TableBatch. Source: services/table/tablebatch.js, line 31 Methods addOperation(operationType, entity [, options]) Adds an operation to the batch after performing checks. Parameters: Name Type Argument Description operationType string The type of operation to perform. See Constants.TableConstants.Operations entity object The entity. options object &lt;optional&gt; The request options. Source: services/table/tablebatch.js, line 148 clear() Removes all of the operations from the batch. Source: services/table/tablebatch.js, line 40 deleteEntity(entity) Adds a delete operation to the batch. Parameters: Name Type Description entity object The entity. Source: services/table/tablebatch.js, line 101 getOperation(index) Gets an operation from the batch. Returns null if the index does not exist. Parameters: Name Type Description index number The index in the operations array at which to remove an element. Source: services/table/tablebatch.js, line 187 Returns: The removed operation. Type object hasOperations() Returns a boolean value indicating weather there are operations in the batch. Source: services/table/tablebatch.js, line 49 Returns: True if there are operations queued up; false otherwise. Type Boolean insertEntity(entity [, options]) Adds an insert operation to the batch. Parameters: Name Type Argument Description entity object The entity. options object &lt;optional&gt; The request options. Properties Name Type Argument Description echoContent string &lt;optional&gt; Whether or not to return the entity upon a successful insert. Inserts only, default to false. payloadFormat string &lt;optional&gt; The payload format to use for the request. propertyResolver TableService~propertyResolver &lt;optional&gt; The property resolver. Only applied if echoContent is true. Given the partition key, row key, property name, property value, and the property Edm type if given by the service, returns the Edm type of the property. entityResolver function &lt;optional&gt; The entity resolver. Only applied if echoContent is true. Given the single entity returned by the insert, returns a modified object. Source: services/table/tablebatch.js, line 92 insertOrMergeEntity(entity) Adds an insert or merge operation to the batch. Parameters: Name Type Description entity object The entity. Source: services/table/tablebatch.js, line 137 insertOrReplaceEntity(entity) Adds an insert or replace operation to the batch. Parameters: Name Type Description entity object The entity. Source: services/table/tablebatch.js, line 128 mergeEntity(entity) Adds a merge operation to the batch. Parameters: Name Type Description entity object The entity. Source: services/table/tablebatch.js, line 110 removeOperation(index) Removes an operation from the batch. Returns null if the index does not exist. Parameters: Name Type Description index number The index in the operations array at which to remove an element. Source: services/table/tablebatch.js, line 197 Returns: The removed operation. Type object replaceEntity(entity) Adds an replace operation to the batch. Parameters: Name Type Description entity object The entity. Source: services/table/tablebatch.js, line 119 retrieveEntity(partitionKey, rowKey [, options]) Adds a retrieve operation to the batch. Note that this must be the only operation in the batch. Parameters: Name Type Argument Description partitionKey string The partition key. rowKey string The row key. options object &lt;optional&gt; The request options. Properties Name Type Argument Description payloadFormat string &lt;optional&gt; The payload format to use for the request. propertyResolver TableService~propertyResolver &lt;optional&gt; The property resolver. Given the partition key, row key, property name, property value, and the property Edm type if given by the service, returns the Edm type of the property. entityResolver function &lt;optional&gt; The entity resolver. Given the single entity returned by the query, returns a modified object. Source: services/table/tablebatch.js, line 73 size() Returns the number of operations in the batch. Source: services/table/tablebatch.js, line 58 Returns: The number of operations in the batch. Type number × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"TableQuery.html":{"id":"TableQuery.html","title":"Class: TableQuery","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: TableQuery TableQuery new TableQuery() Creates a new TableQuery object. Source: services/table/tablequery.js, line 37 Methods &lt;static&gt; binaryFilter(propertyName, operation, value) Generates a property filter condition string for a 'binary' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | buffer A 'buffer' containing the value to compare with the property. Source: services/table/tablequery.js, line 215 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.binaryFilter('BinaryField', QueryComparisons.EQUAL, new Buffer('hello')); &lt;static&gt; booleanFilter(propertyName, operation, value) Generates a property filter condition string for a 'boolean' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | boolean A 'boolean' containing the value to compare with the property. Source: services/table/tablequery.js, line 170 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.booleanFilter('BooleanField', QueryComparisons.EQUAL, false); &lt;static&gt; combineFilters(filterA, operatorString, filterB) Creates a filter condition using the specified logical operator on two filter conditions. Parameters: Name Type Description filterA string A string containing the first formatted filter condition. operatorString string A string containing the operator to use (AND, OR). filterB string A string containing the second formatted filter condition. Source: services/table/tablequery.js, line 246 Returns: A string containing the combined filter expression. Type string Example var filter1 = TableQuery.stringFilter('Name', QueryComparisons.EQUAL, 'Person'); var filter2 = TableQuery.booleanFilter('Visible', QueryComparisons.EQUAL, true); var combinedFilter = TableQuery.combineFilters(filter1, TablUtilities.TableOperators.AND, filter2); &lt;static&gt; dateFilter(propertyName, operation, value) Generates a property filter condition string for a 'datetime' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | date A 'datetime' containing the value to compare with the property. Source: services/table/tablequery.js, line 185 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.dateFilter('DateTimeField', QueryComparisons.EQUAL, new Date(Date.UTC(2001, 1, 3, 4, 5, 6))); &lt;static&gt; doubleFilter(propertyName, operation, value) Generates a property filter condition string for a 'double' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | double A 'double' containing the value to compare with the property. Source: services/table/tablequery.js, line 155 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.doubleFilter('DoubleField', QueryComparisons.EQUAL, 123.45); &lt;static&gt; guidFilter(propertyName, operation, value) Generates a property filter condition string for a 'guid' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | guid A 'guid' containing the value to compare with the property. Source: services/table/tablequery.js, line 200 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.guidFilter('GuidField', QueryComparisons.EQUAL, guid.v1()); &lt;static&gt; int32Filter(propertyName, operation, value) Generates a property filter condition string for an 'int' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | int An 'int' containing the value to compare with the property. Source: services/table/tablequery.js, line 125 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.int32Filter('IntField', QueryComparisons.EQUAL, 5); &lt;static&gt; int64Filter(propertyName, operation, value) Generates a property filter condition string for a 'int64' value. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string | int64 An 'int64' containing the value to compare with the property. Source: services/table/tablequery.js, line 140 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.int64Filter('Int64Field', QueryComparisons.EQUAL, 123); &lt;static&gt; stringFilter(propertyName, operation, value) Generates a property filter condition string. Parameters: Name Type Description propertyName string A string containing the name of the property to compare. operation string A string containing the comparison operator to use. See Constants.TableConstants.QueryComparisons for a list of allowed operations. value string A 'string' containing the value to compare with the property. Source: services/table/tablequery.js, line 230 Returns: A string containing the formatted filter condition. Type string Example var query = TableQuery.stringFilter('StringField', QueryComparisons.EQUAL, 'name'); and(condition, arguments) Specifies an AND where condition. Parameters: Name Type Description condition string The condition string. arguments array Any number of arguments to be replaced in the condition by the question mark (?). Source: services/table/tablequery.js, line 261 Returns: A table query object with the and clause. Type TableQuery Example var tableQuery = new TableQuery() .where('Name == ? or Name &lt;= ?', 'Person1', 'Person2'); .and('Age &gt;= ?', 18); or(condition, arguments) Specifies an OR where condition. Parameters: Name Type Description condition string The condition. arguments array Any number of arguments to be replaced in the condition by the question mark (?). Source: services/table/tablequery.js, line 281 Returns: A table query object with the or clause. Type TableQuery Example var tableQuery = new TableQuery() .where('Name == ? or Name &lt;= ?', 'Person1', 'Person2'); .or('Age &gt;= ?', 18); select(fields) Specifies the select clause. If no arguments are given, all fields will be selected. Parameters: Name Type Description fields array The fields to be selected. Source: services/table/tablequery.js, line 51 Returns: A table query object with the select clause. Type TableQuery Example var tableQuery = new TableQuery().select('field1', 'field2'); top(top) Specifies the top clause. Parameters: Name Type Description top int The number of items to fetch. Source: services/table/tablequery.js, line 80 Returns: A table query object with the top clause. Type TableQuery Example var tableQuery = new TableQuery().top(10); // tasktable should already exist and have entities tableService.queryEntities('tasktable', tableQuery, null \\/*currentToken*\\/, function(error, result) { if(!error) { var entities = result.entities; // there will be 10 or less entities // do stuff with the returned entities if there are any // if result.continuationToken exists, to get the next 10 (or less) entities // call queryEntities as above, but with the returned token instead of null } }); toQueryObject() Returns the query string object for the query. Source: services/table/tablequery.js, line 295 Returns: JSON object representing the query string arguments for the query. Type object where(condition, value) Specifies the where clause. Valid type specifier strings include: ?string?, ?bool?, ?int32?, ?double?, ?date?, ?guid?, ?int64?, ?binary?A type must be specified for guid, int64, and binaries or the filter produced will be incorrect. Parameters: Name Type Description condition string The condition string. value string | array Value(s) to insert in question mark (?) parameters. Source: services/table/tablequery.js, line 109 Returns: A table query object with the where clause. Type TableQuery Example var tableQuery = new TableQuery().where(TableQuery.guidFilter('GuidField', QueryComparisons.EQUAL, guidVal)); OR var tableQuery = new TableQuery().where('Name == ? or Name &lt;= ?', name1, name2); OR var tableQuery = new TableQuery().where('Name == ?string? &amp;&amp; Value == ?int64?, name1, int64Val); // tasktable should already exist and have entities tableService.queryEntities('tasktable', tableQuery, null \\/*currentToken*\\/, function(error, result, response) { if(!error) { var entities = result.entities; // do stuff with the returned entities if there are any } }); × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"TableService.html":{"id":"TableService.html","title":"Class: TableService","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: TableService TableService The TableService object allows you to peform management operations with the Microsoft Azure Table Service.The Table Service stores data in rows of key-value pairs. A table is composed of multiple rows, and each rowcontains key-value pairs. There is no schema, so each row in a table may store a different set of keys. For more information on the Table Service, as well as task focused information on using it from a Node.js application, seeHow to Use the Table Service from Node.js.The following defaults can be set on the Table service.defaultTimeoutIntervalInMs The default timeout interval, in milliseconds, to use for request made via the Table service.defaultClientRequestTimeoutInMs The default timeout of client requests, in milliseconds, to use for the request made via the Table service.defaultMaximumExecutionTimeInMs The default maximum execution time across all potential retries, for requests made via the Table service.defaultLocationMode The default location mode for requests made via the Table service.defaultPayloadFormat The default payload format for requests made via the Table service.useNagleAlgorithm Determines whether the Nagle algorithm is used for requests made via the Table service.; true to use the Nagle algorithm; otherwise, false. The default value is false. new TableService( [storageAccountOrConnectionString] [, storageAccessKey] [, host] [, sasToken] [, endpointSuffix]) Creates a new TableService object.If no connection string or storageaccount and storageaccesskey are provided,the AZURE_STORAGE_CONNECTION_STRING or AZURE_STORAGE_ACCOUNT and AZURE_STORAGE_ACCESS_KEY environment variables will be used. Parameters: Name Type Argument Description storageAccountOrConnectionString string &lt;optional&gt; The storage account or the connection string. storageAccessKey string &lt;optional&gt; The storage access key. host string | object &lt;optional&gt; The host address. To define primary only, pass a string. Otherwise 'host.primaryHost' defines the primary host and 'host.secondaryHost' defines the secondary host. sasToken string &lt;optional&gt; The Shared Access Signature token. endpointSuffix string &lt;optional&gt; The endpoint suffix. Source: services/table/tableservice.js, line 74 Extends StorageServiceClient Members logger :Logger The logger of the service. To change the log level of the services, set the logger.level. Type: Logger Inherited From: StorageServiceClient#logger Source: common/services/storageserviceclient.js, line 105 Methods _getUrl() Get the url of a given path Inherited From: StorageServiceClient#_getUrl Source: common/services/storageserviceclient.js, line 959 _initializeLocation() Initializes the location to which the operation is being sent to. Inherited From: StorageServiceClient#_initializeLocation Source: common/services/storageserviceclient.js, line 1255 _invalidLocationMode() Checks whether we have the relevant host information based on the locationMode. Inherited From: StorageServiceClient#_invalidLocationMode Source: common/services/storageserviceclient.js, line 1310 _maximumExecutionTimeExceeded() Checks to see if the maximum execution timeout provided has been exceeded. Inherited From: StorageServiceClient#_maximumExecutionTimeExceeded Source: common/services/storageserviceclient.js, line 1324 _setDefaultProxy() Sets the service host default proxy from the environment.Can be overridden by calling _setProxyUrl or _setProxy Inherited From: StorageServiceClient#_setDefaultProxy Source: common/services/storageserviceclient.js, line 1216 _setOperationExpiryTime() Sets the operation expiry time. Inherited From: StorageServiceClient#_setOperationExpiryTime Source: common/services/storageserviceclient.js, line 1335 _validateLocation() Validates the location to which the operation is being sent to. Inherited From: StorageServiceClient#_validateLocation Source: common/services/storageserviceclient.js, line 1278 createTable(table [, options], callback) Creates a new table within a storage account. This: {TableService} Parameters: Name Type Argument Description table string The table name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the new table information. response will contain information related to this operation. Source: services/table/tableservice.js, line 515 createTableIfNotExists(table [, options], callback) Creates a new table within a storage account if it does not exists. This: {TableService} Parameters: Name Type Argument Description table string The table name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; result will contain the table information including created boolean member response will contain information related to this operation. Source: services/table/tableservice.js, line 581 Example var azure = require('azure-storage'); var tableService = azure.createTableService(); tableService.createTableIfNotExists('tasktable', function(error) { if(!error) { // Table created or exists } }); deleteEntity(table, entityDescriptor [, options], callback) Deletes an entity within a table. To delete conditionally based on etag, set entity['.metadata']['etag']. This: {TableService} Parameters: Name Type Argument Description table string The table name. entityDescriptor object The entity descriptor. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/table/tableservice.js, line 1118 deleteTable(table [, options], callback) Deletes a table from a storage account. This: {TableService} Parameters: Name Type Argument Description table string The table name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/table/tableservice.js, line 639 deleteTableIfExists(table [, options], callback) Deletes a table from a storage account, if it exists. This: {TableService} Parameters: Name Type Argument Description table string The table name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; result will be true if table was deleted, false otherwise response will contain information related to this operation. Source: services/table/tableservice.js, line 685 doesTableExist(table [, options], callback) Checks whether or not a table exists on the service. This: {TableService} Parameters: Name Type Argument Description table string The table name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the table information including exists boolean member. response will contain information related to this operation. Source: services/table/tableservice.js, line 491 executeBatch(table, batch [, options], callback) Executes the operations in the batch. This: {TableService} Parameters: Name Type Argument Description table string The table name. batch TableBatch The table batch to execute. options object &lt;optional&gt; The create options or callback function. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain responses for each operation executed in the batch; result.entity will contain the entity information for each operation executed. result.response will contain the response for each operations executed. response will contain information related to this operation. Source: services/table/tableservice.js, line 1145 generateSharedAccessSignature(table, sharedAccessPolicy) Retrieves a shared access signature token. This: {TableService} Parameters: Name Type Description table string The table name. sharedAccessPolicy object The shared access policy. Properties Name Type Argument Description Id string &lt;optional&gt; The signed identifier. AccessPolicy.Permissions object &lt;optional&gt; The permission type. AccessPolicy.Start date | string &lt;optional&gt; The time at which the Shared Access Signature becomes valid (The UTC value will be used). AccessPolicy.Expiry date | string &lt;optional&gt; The time at which the Shared Access Signature becomes expired (The UTC value will be used). AccessPolicy.IPAddressOrRange string &lt;optional&gt; An IP address or a range of IP addresses from which to accept requests. When specifying a range, note that the range is inclusive. AccessPolicy.Protocols string &lt;optional&gt; The protocols permitted for a request made with the account SAS. Possible values are both HTTPS and HTTP (https,http) or HTTPS only (https). The default value is https,http. AccessPolicy.StartPk string &lt;optional&gt; The starting Partition Key for which the SAS will be valid. AccessPolicy.EndPk string &lt;optional&gt; The ending Partition Key for which the SAS will be valid. AccessPolicy.StartRk string &lt;optional&gt; The starting Row Key for which the SAS will be valid. AccessPolicy.EndRk string &lt;optional&gt; The ending Row Key for which the SAS will be valid. Source: services/table/tableservice.js, line 455 Returns: An object with the shared access signature. Type object getServiceProperties( [options], callback) Gets the properties of a storage account’s Table service, including Azure Storage Analytics. This: {TableService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the properties. response will contain information related to this operation. Source: services/table/tableservice.js, line 170 getServiceStats( [options], callback) Gets the service stats for a storage account’s Table service. This: {TableService} Parameters: Name Type Argument Description options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the stats. response will contain information related to this operation. Source: services/table/tableservice.js, line 118 getTableAcl(table [, options], callback) Gets the table's ACL. This: {TableService} Parameters: Name Type Argument Description table string The table name. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the ACL information for the table. See AccessPolicy for detailed information. response will contain information related to this operation. Source: services/table/tableservice.js, line 336 getUrl(table [, sasToken] [, primary]) Retrieves a table URL. Parameters: Name Type Argument Description table string The table name. sasToken string &lt;optional&gt; The Shared Access Signature token. primary boolean &lt;optional&gt; A boolean representing whether to use the primary or the secondary endpoint. Source: services/table/tableservice.js, line 1361 Returns: The formatted URL string. Type string Example var azure = require('azure-storage'); var tableService = azure.createTableService(); var sharedAccessPolicy = { AccessPolicy: { Permissions: azure.TableUtilities.SharedAccessPermissions.QUERY, Start: startDate, Expiry: expiryDate }, }; var sasToken = tableService.generateSharedAccessSignature(table, sharedAccessPolicy); var sasUrl = tableService.getUrl(table, sasToken); insertEntity(table, entityDescriptor [, options], callback) Inserts a new entity into a table. This: {TableService} Parameters: Name Type Argument Description table string The table name. entityDescriptor object The entity descriptor. options object &lt;optional&gt; The request options. Properties Name Type Argument Description echoContent string &lt;optional&gt; Whether or not to return the entity upon a successful insert. Default to false. payloadFormat string &lt;optional&gt; The payload format to use in the response, if options.echoContent is true. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. propertyResolver TableService~propertyResolver &lt;optional&gt; The property resolver. Only applied if echoContent is true. Given the partition key, row key, property name, property value, and the property Edm type if given by the service, returns the Edm type of the property. entityResolver function &lt;optional&gt; The entity resolver. Only applied if echoContent is true. Given the single entity returned by the insert, returns a modified object. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the entity information. response will contain information related to this operation. Source: services/table/tableservice.js, line 994 Example var azure = require('azure-storage'); var tableService = azure.createTableService(); var task1 = { PartitionKey : {'_': 'tasksSeattle', '$':'Edm.String'}, RowKey: {'_': '1', '$':'Edm.String'}, Description: {'_': 'Take out the trash', '$':'Edm.String'}, DueDate: {'_': new Date(2011, 12, 14, 12), '$':'Edm.DateTime'} }; tableService.insertEntity('tasktable', task1, function(error) { if(!error) { // Entity inserted } }); insertOrMergeEntity(table, entityDescriptor [, options], callback) Inserts or updates an existing entity within a table by merging new property values into the entity. This: {TableService} Parameters: Name Type Argument Description table string The table name. entityDescriptor object The entity descriptor. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the entity information. response will contain information related to this operation. Source: services/table/tableservice.js, line 1094 insertOrReplaceEntity(table, entityDescriptor [, options], callback) Inserts or updates a new entity into a table. This: {TableService} Parameters: Name Type Argument Description table string The table name. entityDescriptor object The entity descriptor. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the entity information. response will contain information related to this operation. Source: services/table/tableservice.js, line 1019 listTablesSegmented(currentToken [, options], callback) Lists a segment containing a collection of table items under the specified account. This: {TableService} Parameters: Name Type Argument Description currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The create options or callback function. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of tables to return per call to Azure ServiceClient. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. payloadFormat string &lt;optional&gt; The payload format to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of tables and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/table/tableservice.js, line 221 listTablesSegmentedWithPrefix(prefix, currentToken [, options], callback) Lists a segment containing a collection of table items under the specified account. This: {TableService} Parameters: Name Type Argument Description prefix string The prefix of the table name. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The create options or callback function. Properties Name Type Argument Description maxResults int &lt;optional&gt; Specifies the maximum number of tables to return per call to Azure ServiceClient. locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. payloadFormat string &lt;optional&gt; The payload format to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain entries and continuationToken. entries gives a list of tables and the continuationToken is used for the next listing operation. response will contain information related to this operation. Source: services/table/tableservice.js, line 249 mergeEntity(table, entityDescriptor [, options], callback) Updates an existing entity within a table by merging new property values into the entity. To merge conditionally based on etag, set entity['.metadata']['etag']. This: {TableService} Parameters: Name Type Argument Description table string The table name. entityDescriptor object The entity descriptor. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the entity information. response` will contain information related to this operation. Source: services/table/tableservice.js, line 1069 queryEntities(table, tableQuery, currentToken [, options], callback) Queries data in a table. To retrieve a single entity by partition key and row key, use retrieve entity. This: {TableService} Parameters: Name Type Argument Description table string The table name. tableQuery TableQuery The query to perform. Use null, undefined, or new TableQuery() to get all of the entities in the table. currentToken object A continuation token returned by a previous listing operation. Please use 'null' or 'undefined' if this is the first operation. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. payloadFormat string &lt;optional&gt; The payload format to use for the request. autoResolveProperties bool &lt;optional&gt; If true, guess at all property types. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. entityResolver function &lt;optional&gt; The entity resolver. Given a single entity returned by the query, returns a modified object which is added to the entities array. propertyResolver TableService~propertyResolver &lt;optional&gt; The property resolver. Given the partition key, row key, property name, property value, and the property Edm type if given by the service, returns the Edm type of the property. callback TableService~queryResponse error will contain information if an error occurs; otherwise entities will contain the entities returned by the query. If more matching entities exist, and could not be returned, queryResultContinuation will contain a continuation token that can be used to retrieve the next set of results. response will contain information related to this operation. The logic for returning entity types can get complicated. Here is the algorithm used: var propertyType; if (propertyResovler) { // If the caller provides a propertyResolver in the options, use it propertyType = propertyResolver(partitionKey, rowKey, propertyName, propertyValue, propertyTypeFromService); } else if (propertyTypeFromService) { // If the service provides us a property type, use it. See below for an explanation of when this will and won't occur. propertyType = propertyTypeFromService; } else if (autoResolveProperties) { // If options.autoResolveProperties is set to true if (javascript type is string) { // See below for an explanation of how and why autoResolveProperties works as it does. propertyType = 'Edm.String'; } else if (javascript type is boolean) { propertyType = 'Edm.Boolean'; } } if (propertyType) { // Set the property type on the property. } else { // Property gets no EdmType. }Notes: The service only provides a type if JsonFullMetadata or JsonMinimalMetadata is used, and if the type is Int64, Guid, Binary, or DateTime. Explanation of autoResolveProperties: String gets correctly resolved to 'Edm.String'. Int64, Guid, Binary, and DateTime all get resolved to 'Edm.String.' This only happens if JsonNoMetadata is used (otherwise the service will provide the propertyType in a prior step). Boolean gets correctly resolved to 'Edm.Boolean'. For both Int32 and Double, no type information is returned, even in the case of autoResolveProperties = true. This is due to an inability to distinguish between the two in certain cases. Source: services/table/tableservice.js, line 809 Example var azure = require('azure-storage'); var tableService = azure.createTableService(); // tasktable should already exist and have entities // returns all entities in tasktable, and a continuation token for the next page of results if necessary tableService.queryEntities('tasktable', null, null \\/*currentToken*\\/, function(error, result) { if(!error) { var entities = result.entities; // do stuff with the returned entities if there are any } }); // returns field1 and field2 of the entities in tasktable, and a continuation token for the next page of results if necessary var tableQuery = new TableQuery().select('field1', 'field2'); tableService.queryEntities('tasktable', tableQuery, null \\/*currentToken*\\/, function(error, result) { if(!error) { var entities = result.entities; // do stuff with the returned entities if there are any } }); replaceEntity(table, entityDescriptor [, options], callback) Replaces an existing entity within a table. To replace conditionally based on etag, set entity['.metadata']['etag']. This: {TableService} Parameters: Name Type Argument Description table string The table name. entityDescriptor object The entity descriptor. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain the entity information. response will contain information related to this operation. Source: services/table/tableservice.js, line 1044 retrieveEntity(table, partitionKey, rowKey [, options], callback) Retrieves an entity from a table. This: {TableService} Parameters: Name Type Argument Description table string The table name. partitionKey string The partition key. rowKey string The row key. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. payloadFormat string &lt;optional&gt; The payload format to use for the request. autoResolveProperties bool &lt;optional&gt; If true, guess at all property types. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. propertyResolver TableService~propertyResolver &lt;optional&gt; The property resolver. Given the partition key, row key, property name, property value, and the property Edm type if given by the service, returns the Edm type of the property. entityResolver function &lt;optional&gt; The entity resolver. Given the single entity returned by the query, returns a modified object. callback errorOrResult error will contain information if an error occurs; otherwise result will be the matching entity. response will contain information related to this operation. The logic for returning entity types can get complicated. Here is the algorithm used: var propertyType; if (propertyResovler) { // If the caller provides a propertyResolver in the options, use it propertyType = propertyResolver(partitionKey, rowKey, propertyName, propertyValue, propertyTypeFromService); } else if (propertyTypeFromService) { // If the service provides us a property type, use it. See below for an explanation of when this will and won't occur. propertyType = propertyTypeFromService; } else if (autoResolveProperties) { // If options.autoResolveProperties is set to true if (javascript type is string) { // See below for an explanation of how and why autoResolveProperties works as it does. propertyType = 'Edm.String'; } else if (javascript type is boolean) { propertyType = 'Edm.Boolean'; } } if (propertyType) { // Set the property type on the property. } else { // Property gets no EdmType. }Notes: The service only provides a type if JsonFullMetadata or JsonMinimalMetadata is used, and if the type is Int64, Guid, Binary, or DateTime. Explanation of autoResolveProperties: String gets correctly resolved to 'Edm.String'. Int64, Guid, Binary, and DateTime all get resolved to 'Edm.String.' This only happens if JsonNoMetadata is used (otherwise the service will provide the propertyType in a prior step). Boolean gets correctly resolved to 'Edm.Boolean'. For both Int32 and Double, no type information is returned, even in the case of autoResolveProperties = true. This is due to an inability to distinguish between the two in certain cases. Source: services/table/tableservice.js, line 939 Example var azure = require('azure-storage'); var tableService = azure.createTableService(); tableService.retrieveEntity('tasktable', 'tasksSeattle', '1', function(error, serverEntity) { if(!error) { // Entity available in serverEntity variable } }); setAccountServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {StorageServiceClient} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; otherwise, response will contain information related to this operation. Inherited From: StorageServiceClient#setAccountServiceProperties Source: common/services/storageserviceclient.js, line 1095 setProxy(proxy) /*Sets proxy object specified by caller. Parameters: Name Type Description proxy object proxy to use for tunneling { host: hostname port: port number proxyAuth: 'user:password' for basic auth headers: {...} headers for proxy server key: key for proxy server ca: ca for proxy server cert: cert for proxy server } if null or undefined, clears proxy Inherited From: StorageServiceClient#setProxy Source: common/services/storageserviceclient.js, line 1203 setServiceProperties(serviceProperties [, options], callback) Sets the properties of a storage account’s Table service, including Azure Storage Analytics.You can also use this operation to set the default request version for all incoming requests that do not have a version specified. This: {TableService} Parameters: Name Type Argument Description serviceProperties object The service properties. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResponse error will contain information if an error occurs; response will contain information related to this operation. Source: services/table/tableservice.js, line 194 setTableAcl(table, signedIdentifiers [, options], callback) Updates the table's ACL. This: {TableService} Parameters: Name Type Argument Description table string The table name. signedIdentifiers Object.&lt;string, AccessPolicy&gt; The table ACL settings. See AccessPolicy for detailed information. options object &lt;optional&gt; The request options. Properties Name Type Argument Description locationMode LocationMode &lt;optional&gt; Specifies the location mode used to decide which location the request should be sent to. Please see StorageUtilities.LocationMode for the possible values. timeoutIntervalInMs int &lt;optional&gt; The server timeout interval, in milliseconds, to use for the request. clientRequestTimeoutInMs int &lt;optional&gt; The timeout of client requests, in milliseconds, to use for the request. maximumExecutionTimeInMs int &lt;optional&gt; The maximum execution time, in milliseconds, across all potential retries, to use when making this request. The maximum execution time interval begins at the time that the client begins building the request. The maximum execution time is checked intermittently while performing requests, and before executing retries. clientRequestId string &lt;optional&gt; A string that represents the client request ID with a 1KB character limit. useNagleAlgorithm bool &lt;optional&gt; Determines whether the Nagle algorithm is used; true to use the Nagle algorithm; otherwise, false. The default value is false. callback errorOrResult error will contain information if an error occurs; otherwise result will contain information for the table. response will contain information related to this operation. Source: services/table/tableservice.js, line 390 withFilter(filter) Associate a filtering operation with this StorageServiceClient. Filtering operationscan include logging, automatically retrying, etc. Filter operations are objectsthat implement a method with the signature: &quot;function handle (requestOptions, next)&quot;.After doing its preprocessing on the request options, the method needs to call&quot;next&quot; passing a callback with the following signature:signature: &quot;function (returnObject, finalCallback, next)&quot;In this callback, and after processing the returnObject (the response from therequest to the server), the callback needs to either invoke next if it exists tocontinue processing other filters or simply invoke finalCallback otherwise to endup the service invocation. Parameters: Name Type Description filter Object The new filter object. Inherited From: StorageServiceClient#withFilter Source: common/services/storageserviceclient.js, line 767 Returns: A new service client with the filter applied. Type StorageServiceClient Type Definitions propertyResolver(pk, rk, name, value, type) Given the partition key, row key, property name, property value,and the property Edm type if given by the service, returns the Edm type of the property. Parameters: Name Type Description pk object The partition key. rk object The row key. name string The property name. value object The property value. type string The EDM type. Source: services/table/tableservice.js, line 1370 queryResponse(error, entities, queryResultContinuation, response) Returns entities matched by a query. Parameters: Name Type Description error object If an error occurs, the error information. entities object The entities returned by the query. queryResultContinuation object If more matching entities exist, and could not be returned, a continuation token that can be used to retrieve more results. response object Information related to this operation. Source: services/table/tableservice.js, line 1381 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"TableUtilities.html":{"id":"TableUtilities.html","title":"Namespace: TableUtilities","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Namespace: TableUtilities TableUtilities Defines constants, enums, and utility functions for use with the Table service. Source: services/table/tableutilities.js, line 20 Members &lt;static&gt; EdmType :string Edm types. Type: string Properties: Name Type Default Description STRING string Edm.String BINARY string Edm.Binary INT64 string Edm.Int64 INT32 string Edm.Int32 DOUBLE string Edm.Double DATETIME string Edm.DateTime GUID string Edm.Guid BOOLEAN string Edm.Boolean Source: services/table/tableutilities.js, line 83 &lt;static&gt; entityGenerator A helper to create table entities. Source: services/table/tableutilities.js, line 106 Example var entGen = TableUtilities.entityGenerator; var entity = { PartitionKey: entGen.String('part2'), RowKey: entGen.String('row1'), boolValue: entGen.Boolean(true), intValue: entGen.Int32(42), dateValue: entGen.DateTime(new Date(Date.UTC(2011, 10, 25))), }; &lt;static&gt; PayloadFormat :string Payload Format. Type: string Properties: Name Type Default Description FULL_METADATA string application/json;odata=fullmetadata MINIMAL_METADATA string application/json;odata=minimalmetadata NO_METADATA string application/json;odata=nometadata Source: services/table/tableutilities.js, line 44 &lt;static&gt; QueryComparisons :string Filter property comparison operators. Type: string Properties: Name Type Default Description EQUAL string eq NOT_EQUAL string ne GREATER_THAN string gt GREATER_THAN_OR_EQUAL string ge LESS_THAN string lt LESS_THAN_OR_EQUAL string le Source: services/table/tableutilities.js, line 68 &lt;static&gt; SharedAccessPermissions :string Permission types. Type: string Properties: Name Type Default Description QUERY string r ADD string a UPDATE string u DELETE string d Source: services/table/tableutilities.js, line 31 &lt;static&gt; TableOperators :string Defines the set of Boolean operators for constructing queries. Type: string Properties: Name Type Default Description AND string and NOT string not OR string or Source: services/table/tableutilities.js, line 56 × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"TextBase64QueueMessageEncoder.html":{"id":"TextBase64QueueMessageEncoder.html","title":"Class: TextBase64QueueMessageEncoder","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: TextBase64QueueMessageEncoder TextBase64QueueMessageEncoder Encode from utf-8 string to base64 stringDecode from base64 string to utf-8 string. new TextBase64QueueMessageEncoder() Create a new TextBase64QueueMessageEncoder object Source: services/queue/queuemessageencoder.js, line 64 Extends QueueMessageEncoder Methods decode( [textToBeDecoded]) Decode from base64 string to utf-8 string. This: TextBase64QueueMessageEncoder Parameters: Name Type Argument Description textToBeDecoded string &lt;optional&gt; The base64 string to be decoded. Overrides: QueueMessageEncoder#decode Source: services/queue/queuemessageencoder.js, line 88 Returns: Type string encode( [input]) Encode from utf-8 string to base64 string This: TextBase64QueueMessageEncoder Parameters: Name Type Argument Description input string &lt;optional&gt; The target to be encoded. Overrides: QueueMessageEncoder#encode Source: services/queue/queuemessageencoder.js, line 76 Returns: Type string × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "},"TextXmlQueueMessageEncoder.html":{"id":"TextXmlQueueMessageEncoder.html","title":"Class: TextXmlQueueMessageEncoder","body":" Microsoft Azure Storage Client Library for node.js Namespaces BlobUtilitiesFileUtilitiesQueueUtilitiesTableUtilities Classes BinaryBase64QueueMessageEncoderBlobResultBlobServiceContainerResultDirectoryResultExponentialRetryPolicyFilterFileResultFileServiceLeaseResultLinearRetryPolicyFilterLoggerQueueMessageEncoderQueueMessageResultQueueResultQueueServiceRetryPolicyFilterShareResultStorageServiceClientTableBatchTableQueryTableServiceTextBase64QueueMessageEncoderTextXmlQueueMessageEncoder Global createBlobServicecreateBlobServiceAnonymouscreateBlobServiceWithSascreateFileServicecreateFileServiceWithSascreateQueueServicecreateQueueServiceWithSascreateTableServicecreateTableServiceWithSasgenerateAccountSharedAccessSignaturegenerateDevelopmentStorageCredentials Class: TextXmlQueueMessageEncoder TextXmlQueueMessageEncoder Encode utf-8 string by escaping the xml markup characters.Decode from utf-8 string by unescaping the xml markup characters. new TextXmlQueueMessageEncoder() Create a new TextXmlQueueMessageEncoder object Source: services/queue/queuemessageencoder.js, line 143 Extends QueueMessageEncoder Methods decode( [textToBeDecoded]) Decode from utf-8 string by unescaping the xml markup characters. This: TextXmlQueueMessageEncoder Parameters: Name Type Argument Description textToBeDecoded string &lt;optional&gt; The base64 string to be decoded. Overrides: QueueMessageEncoder#decode Source: services/queue/queuemessageencoder.js, line 171 Returns: Type string encode( [input]) Encode utf-8 string by escaping the xml markup characters. This: TextXmlQueueMessageEncoder Parameters: Name Type Argument Description input string &lt;optional&gt; The target to be encoded. Overrides: QueueMessageEncoder#encode Source: services/queue/queuemessageencoder.js, line 155 Returns: Type string × Search results Close Documentation generated by JSDoc 3.5.2 on Thu Jul 13th 2017 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
